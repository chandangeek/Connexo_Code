package test.com.energyict;

import com.energyict.protocol.ProfileData;
import com.energyict.protocolimpl.iec1107.abba1700.ABBA1700Profile;
import com.energyict.protocolimpl.utils.ProtocolTools;
import org.junit.jupiter.api.Test;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.Arrays;

/**
 * Copyrights EnergyICT
 * Date: 12/10/12
 * Time: 12:11
 */
public class JustATestClass {

    @Test
    public void testLoadProfileSpike() throws IOException {
        String raw = "E4803801640101990085568248832200839042480002009408026188820010387356640200129302640001EA7A5501640085952254592200851842538242008288024435220084864249344200808322460802001011835075220073107310336300747523716162006984339292820058580368160200504643769282007004137372820079175362784200811903908162007924537078420059257311744300466503890882005027831161630042266394592200629633114753004769931043230041556393122200540803103743004890831317830055437316435300581063127933006384039607220033766310022300203653107393001652535229420015424345440200164483588162001616635862420016519359392200153473509442001636534467220017107344928200156803501122001527035094420013869357536200979882625282009388826329620088704257920200875522497922E4008A02640101990088896254848200875522508802009388825708820010336358368200100223632322009619626208020084928252288200780162419202009260825427220097472254912200638843105473006369339107420065082398176200487493934402003717739203220064058346400200877823105023008515936560420066419311552300451263842882005413139510420082739401620034733390944200147843905602001398437571220011821345440200120253490882001196834640020011303338272200118653440962001189833174420013152341536200118273449282001084833776020010598343072200780242423682007251224096020076416242304200759682456962E480DB036401019900720002408322FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF";

        String currentRaw = "4646464646";
        String previousRaw = "4646464646";

        byte[] currentBytes = ProtocolTools.getBytesFromHexString(currentRaw, 2);
        byte[] previousBytes = ProtocolTools.getBytesFromHexString(previousRaw, 2);

        boolean currentReceivedDataDuplicate = isCurrentReceivedDataDuplicate(previousBytes, currentBytes);

        boolean resultBool = containsOnlyHexF(currentBytes);


        byte[] input = ProtocolTools.getBytesFromHexString(raw, 2);

        ByteArrayInputStream bais = new ByteArrayInputStream(input);
        ABBA1700Profile profileParser = new ABBA1700Profile(null, null);

        ProfileData result = profileParser.parse(bais, 2);

        System.out.println(result);
    }

    private boolean isCurrentReceivedDataDuplicate(byte[] previousReceivedBytes, byte[] currentReceivedBytes) {
        return currentReceivedBytes.length == previousReceivedBytes.length &&
                Arrays.equals(currentReceivedBytes, previousReceivedBytes) &&
                !containsOnlyHexF(currentReceivedBytes);
    }

    private boolean containsOnlyHexF(byte[] inputBytes) {
        for (byte item : inputBytes) {
            if (item != (byte) 0x46) {
                return false;
            }
        }
        return true;
    }

}
