Ext.define("Dsh.view.widget.HeaderSection",{extend:"Ext.panel.Panel",alias:"widget.header-section",itemId:"header-section",wTitle:Uni.I18n.translate("overview.widget.headerSection.title","DSH","Overview"),layout:"column",initComponent:function(){var a=this;this.items=[{itemId:"headerTitle",baseCls:"x-panel-header-text-container-large",html:a.wTitle},{xtype:"fieldcontainer",layout:"hbox",style:"float: right; margin-top: 18px",items:[{xtype:"displayfield",itemId:"last-updated-field",style:"margin-right: 10px"},{xtype:"button",itemId:"refresh-btn",text:Uni.I18n.translate("overview.widget.headerSection.refreshBtnTxt","DSH","Refresh"),style:{lineHeight:"none"},iconCls:"fa fa-refresh fa-lg"}]}];this.callParent(arguments)}});Ext.define("Dsh.view.widget.common.Bar",{alias:"widget.bar",extend:"Ext.Component",requires:["Ext.Template","Ext.CompositeElement","Ext.TaskManager","Ext.layout.component.ProgressBar"],total:100,limit:100,count:0,baseCls:Ext.baseCSSPrefix+"bar",trackTpl:'<div class="{baseCls}-track" style="width: {count}%;"></div>',renderTpl:['<tpl for=".">','<span class="{baseCls}-label">{label}</span>','<div class="{baseCls}-container" style="width: 100%;">','<div class="{baseCls}-fill" style="width: {limit}%;">',"{track}","</div>","<div>","</tpl>"],prepareData:function(){var a=this;return{limit:!a.total?0:Math.round(a.limit*100/a.total),label:a.label,count:!a.limit?0:Math.round(a.count*100/a.limit)}},initRenderData:function(){var b=this;var a=new Ext.XTemplate(b.trackTpl);var c=Ext.apply(b.callParent(),b.prepareData());return Ext.apply(c,{track:a.apply(c)})}});Ext.define("Dsh.view.widget.Summary",{extend:"Ext.panel.Panel",requires:["Dsh.view.widget.common.Bar"],alias:"widget.summary",itemId:"summary",wTitle:Uni.I18n.translate("overview.widget.summary.title","DSH","Summary"),initComponent:function(){var a=this;this.items=[{html:"<h3>"+a.wTitle+"</h3>"},{xtype:"dataview",itemId:"summary-dataview",itemSelector:"tbody.item",cls:"summary",total:0,tpl:'<table><tpl for="."><tbody class="item item-{#}">{% var parentIndex = xindex; %}<tr><td class="label"><a href="#{alias}">{displayName}</a></td><td width="100%" id="bar-{[parentIndex]}" class="bar-{alias}"></td></tr><tpl for="counters"><tr class="child"><td class="label"><a href="#{alias}">{displayName}</a></td><td width="100%" id="bar-{[parentIndex]}-{#}" class="bar-{alias}"></td></tr></tpl></tbody></tpl></table>',listeners:{refresh:function(b){Ext.each(b.getNodes(),function(g,e){var c=b.getRecord(g),h=e+1;if(c.counters()){c.counters().each(function(l,i){var k=Ext.widget("bar",{limit:c.get("count"),total:b.total,count:l.get("count"),label:!c.get("count")?0:Math.round(!b.total?0:l.get("count")*100/c.get("count"))+"% ("+l.get("count")+")"});k.render(b.getEl().down("#bar-"+h+"-"+(i+1)));var j=a.router.getRoute("workspace/datacommunication/"+a.parent).buildUrl(null,{filter:[{property:b.record.get("alias"),value:l.get("id")}]});b.getEl().down(".item-"+h+"  tr.child > td > a").set({href:j})})}var f=Ext.widget("bar",{limit:b.total,total:b.total,count:c.get("count"),label:Math.round(!b.total?0:c.get("count")*100/b.total)+"% ("+c.get("count")+")"});f.render(b.getEl().down("#bar-"+h));var d=a.router.getRoute("workspace/datacommunication/"+a.parent).buildUrl(null,{filter:[{property:b.record.get("alias"),value:c.get("id")}]});b.getEl().down(".item-"+h+" > tr > td > a").set({href:d})})}}}];this.callParent(arguments)},setRecord:function(b){var c=this;var a=c.down("#summary-dataview");a.total=b.get("total")||0;a.record=b;a.bindStore(b.counters())}});Ext.define("Dsh.view.widget.CommunicationServers",{extend:"Ext.panel.Panel",alias:"widget.communication-servers",initComponent:function(){var a=this.router;this.items=[{xtype:"dataview",store:"CommunicationServerInfos",itemSelector:"tr.comserver",emptyText:Uni.I18n.translate("overview.widget.communicationServers.noServersFound","DSH","No communication servers found"),tpl:new Ext.XTemplate("<div>","<h3>"+Uni.I18n.translate("overview.widget.communicationServers.title","DSH","Communication servers")+"</h3>",'<table style="margin: 5px 0 10px 0">','<tpl for=".">','<tpl if="!running && xindex &lt; 4">','<tr class="comserver" >',"<td>",'<a href="'+a.getRoute("administration/comservers/detail/overview").buildUrl({id:"{comServerId}"})+'">{comServerName}</a>',"</td>",'<td style="padding-left: 15px;">','<tpl if="running">','<span style="color: #00aa00" class="fa fa-caret-square-o-up"/>',"<tpl else>",'<span style="color: #d80000" class="fa fa-caret-square-o-down"/>',"</tpl>","</td>","</tr>","</tpl>","</tpl>","</table>",'<a href="'+a.getRoute("administration/comservers").buildUrl()+'">'+Uni.I18n.translate("overview.widget.communicationServers.viewAll","DSH","View all communication servers")+"</a>","</div>"),listeners:{afterrender:function(b){b.store.load()},itemmouseenter:function(c,b){Ext.create("Ext.tip.ToolTip",{itemId:"communication-servers-tooltip",target:c.el,delegate:c.itemSelector,trackMouse:true,showDelay:50,hideDelay:0,html:'<table><tr><td style="text-align: right; padding-right: 10px; white-space: nowrap">'+Uni.I18n.translate("overview.widget.communicationServers.tt.communicationServer","DSH","Communication server")+"</td><td>"+b.get("comServerName")+'</td></tr><tr><td style="text-align: right; padding-right: 10px; white-space: nowrap">'+Uni.I18n.translate("overview.widget.communicationServers.tt.onlineRemote","DSH","Online/Remote")+"</td><td>"+b.get("comServerType").charAt(0).toUpperCase()+b.get("comServerType").slice(1).toLocaleLowerCase()+'</td></tr><tr><td style="text-align: right; padding-right: 10px; white-space: nowrap">'+Uni.I18n.translate("overview.widget.communicationServers.tt.downSince","DSH","Down since")+"</td><td>"+Ext.util.Format.date(new Date(),"D M j, Y G:i")+"</td></tr></table>",listeners:{hide:function(d){d.destroy()}}})}}}];this.callParent(arguments)},reload:function(){this.down("dataview").store.load()}});Ext.define("Dsh.view.widget.QuickLinks",{extend:"Ext.panel.Panel",alias:"widget.quick-links",data:[],items:[{itemId:"quicklinksTplPanel",tpl:new Ext.XTemplate("<div>","<h3>"+Uni.I18n.translate("overview.widget.quicklinks.title","DSH","Quick links")+"</h3>",'<ul style="list-style: none; padding: 0; margin-top: 5px">','<tpl for=".">','<li><a href="{href}">{link}</a></li>',"</tpl>","</ul>","</div>")}],initComponent:function(){this.callParent(arguments);this.down("#quicklinksTplPanel").data=this.data}});Ext.define("Dsh.view.widget.ReadOutsOverTime",{extend:"Ext.panel.Panel",alias:"widget.read-outs-over-time",itemId:"read-outs-over-time",wTitle:Uni.I18n.translate("overview.widget.readOutsOverTime.title","DSH","Read-outs over time"),layout:"fit",initComponent:function(){var a=this;this.items=[{xtype:"container",layout:{type:"hbox",align:"stretch"},style:{paddingBottom:"30px"},items:[{xtype:"container",itemId:"readOutsTitle",baseCls:"x-panel-header-text-container-medium",html:a.wTitle},{xtype:"container",flex:1,width:200,html:'<svg id="read-outs-legend-container" style="width: 100%"></svg>'}]},{xtype:"container",height:400,style:{marginTop:"-130px",marginBottom:"180px"},listeners:{scope:this,afterrender:function(b){var c=this;Ext.defer(function(){new Highcharts.Chart({chart:{type:"spline",zoomType:"x",renderTo:b.el.dom,events:{load:function(){$("#"+b.getId()+" .highcharts-legend").appendTo("#read-outs-legend-container")}}},title:{text:""},legend:{align:"left",verticalAlign:"top",floating:true,x:25,y:-5},credits:{enabled:false},exporting:{enabled:false},tooltip:{valueSuffix:"%"},plotOptions:{series:{animation:false,pointInterval:3600*1000},spline:{lineWidth:3,states:{hover:{lineWidth:5}},marker:{enabled:false}}},xAxis:{lineWidth:2,type:"datetime",dateTimeLabelFormats:{day:"%H:%M"},tickInterval:3600*1000},yAxis:{title:{text:"Number of connections"},labels:{format:"{value}%"},lineWidth:2,tickWidth:1,gridLineWidth:0,floor:0,ceiling:100,tickInterval:10},series:[{name:"Target",data:c.getFakeData()},{name:"Pending",dashStyle:"longdash",data:c.getFakeData()},{name:"Waiting",data:c.getFakeData()},{name:"Failed",data:c.getFakeData()},{name:"On hold",data:c.getFakeData()}]})},100)}}}];this.callParent(arguments)},getFakeData:function(){var b=[];for(var a=0;a<24;a++){b.push(Math.floor((Math.random()*100)))}return b}});Ext.define("Dsh.view.widget.Overview",{extend:"Ext.panel.Panel",requires:["Dsh.view.widget.common.Bar"],alias:"widget.overview",itemId:"overview",title:Uni.I18n.translate("overview.widget.overview.title","DSH","Overview"),ui:"medium",style:{paddingTop:0},mixins:{bindable:"Ext.util.Bindable"},layout:{type:"hbox",align:"stretch"},defaults:{flex:1,style:{paddingRight:"20px"}},total:0,bindStore:function(a){var b=this;b.removeAll(true);a.each(function(e,c){e.counters().sort({property:"count",direction:"DESC"});var d=Ext.create("Ext.panel.Panel",{tbar:{xtype:"container",itemId:"title",html:"<h3>"+e.get("displayName")+"</h3>"},items:{xtype:"dataview",itemId:e.get("alias")+"-dataview",itemSelector:"tbody.item",total:e.get("total")||b.total,store:e.counters(),tpl:'<table><tpl for="."><tbody class="item item-{#}"><tr><td><div style="width: 200px; overflow: hidden; text-overflow: ellipsis; padding-right: 20px"><a href="#{id}">{displayName}</a></div></td><td width="100%" id="bar-{#}"></td></tr></tbody></tpl></table>',listeners:{refresh:function(f){Ext.each(f.getNodes(),function(k,i){var g=f.getRecord(k),l=i+1;var j=Ext.widget("bar",{limit:g.get("count"),total:f.total,count:g.get("count"),label:g.get("count")}).render(f.getEl().down("#bar-"+l));var h=b.router.getRoute("workspace/datacommunication/"+b.parent).buildUrl(null,{filter:[{property:e.get("alias"),value:g.get("id")}]});f.getEl().down(".item-"+l+" > tr > td > div > a").set({href:h})})}}}});b.add(d)});b.mixins.bindable.bindStore.apply(this,arguments)}});Ext.define("Dsh.view.widget.common.StackedBar",{alias:"widget.stacked-bar",extend:"Dsh.view.widget.common.Bar",tooltipTpl:'<table><tpl foreach="."><tr><td>{[xkey]}</td><td>{.}</td></tr></tpl></table>',trackTpl:['<div data-qtip="{tooltip}">','<tpl foreach="count">','<div class="{parent.baseCls}-track {parent.baseCls}-track-stacked {[xkey]}" style="width: {.}%;"></div>',"</tpl>","</div>"],prepareData:function(){var b=this;var a=_.object(_.map(b.count,function(d,c){return[c,!b.limit?0:Math.round(d*100/b.limit)]}));return Ext.apply(b.callParent(),{count:a,tooltip:new Ext.XTemplate(b.tooltipTpl).apply(b.count)})}});Ext.define("Dsh.view.widget.HeatMap",{extend:"Ext.panel.Panel",alias:"widget.heat-map",layout:"fit",minHeight:450,tbar:["->",{xtype:"fieldcontainer",fieldLabel:"Combine",items:{xtype:"combobox",itemId:"combine-combo",displayField:"localizedValue",queryMode:"local",valueField:"breakdown",store:"Dsh.store.CombineStore",autoSelect:true}},"->"],items:{xtype:"box",minHeight:400,itemId:"heatmapchart"},setChartData:function(b){var a=this;a.chart.series[0].setData([],true);a.chart.series[0].setData(b,true)},setXAxis:function(a,c){var b=this;b.chart.series[0].xAxis.update({title:{text:c}},false);b.chart.series[0].xAxis.update({categories:a},false)},setYAxis:function(a,c){var b=this;b.chart.series[0].yAxis.update({title:{text:c}},false);b.chart.series[0].yAxis.update({categories:a},false)},storeToHighchartData:function(b){var c=[],a=0,d=0;b.each(function(e){Ext.each(e.data.data,function(g){var f=g.count,h=(f==0?f.toString():f);c.push([a,d,h]);++d});d=0;++a});return c},getCombo:function(){return this.down("#combine-combo")},loadChart:function(b,e){if(b.getCount()>0){var d=this,a=[],c=b.collect("displayValue");Ext.each(b.getAt(0).data.data,function(f){a.push(f.displayName)});d.setXAxis(c,e);d.setYAxis(a,"Latest result");d.setChartData(d.storeToHighchartData(b))}},initComponent:function(){var c=this,d="",a=Ext.getStore("Dsh.store.ConnectionResultsStore");this.callParent(arguments);a.on("load",function(){c.loadChart(a,d)});var e=c.getCombo(),b=c.down("#heatmapchart");e.getStore().on("load",function(f){if(f.getCount()>0){var g=f.getAt(1);e.select(g);d=g.get("localizedValue")}});e.on("change",function(g,f){a.proxy.extraParams.filter='[{"property":"breakdown","value": "'+f+'"}]';a.load()});b.on("afterrender",function(){Ext.defer(function(){c.renderChart(b.getEl().dom)},100)})},renderChart:function(a){var b=this;this.chart=new Highcharts.Chart({chart:{type:"heatmap",renderTo:a},exporting:{enabled:false},credits:{enabled:false},title:null,xAxis:{title:{style:{color:"#707070",fontWeight:"bold"}}},yAxis:{title:{style:{color:"#707070",fontWeight:"bold"}}},colorAxis:{min:0,minColor:"#FFFFFF",maxColor:Highcharts.getOptions().colors[0]},options:{width:"100%",height:"100%"},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",symbolHeight:350},tooltip:{formatter:function(){return"<b>"+this.series.xAxis.categories[this.point.x]+"</b><br><b>"+this.series.yAxis.categories[this.point.y]+"</b><br><b>"+this.point.value+"</b>"}},series:[{name:"Latest Result",borderWidth:1,dataLabels:{enabled:true,color:"black",style:{textShadow:"none",HcTextStroke:null}}}]},function(){b.doLayout()})}});Ext.define("Dsh.view.widget.Breakdown",{extend:"Ext.panel.Panel",alias:"widget.breakdown",itemId:"breakdown",ui:"medium",cls:"breakdown",layout:{type:"vbox",align:"stretch"},requires:["Ext.view.View","Dsh.view.widget.common.StackedBar","Ext.button.Button","Dsh.view.widget.HeatMap"],mixins:{bindable:"Ext.util.Bindable"},itemsInCollapsedMode:5,tbar:[{xtype:"container",itemId:"title",html:"<h2>"+Uni.I18n.translate("overview.widget.breakdown.title","DSH","Breakdown")+"</h2>"},"->",{xtype:"container",html:'<div class="legend"><ul><li><span class="color failed"></span> '+Uni.I18n.translate("overview.widget.breakdown.failed","DSH","Failed")+'</li><li><span class="color success"></span> '+Uni.I18n.translate("overview.widget.breakdown.success","DSH","Success")+'</li><li><span class="color pending"></span> '+Uni.I18n.translate("overview.widget.breakdown.pending","DSH","Pending")+"</li></ul></div>"}],items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},defaults:{flex:1},items:[{xtype:"panel",itemId:"summaries-0",style:{marginRight:"10px"}},{xtype:"panel",itemId:"summaries-1",style:{marginLeft:"10px"}}]}],initComponent:function(){var a=this;a.callParent(arguments);a.add({xtype:"heat-map",itemId:"heatmap",router:a.router})},bindStore:function(a){var b=this;b.down("#summaries-0").removeAll(true);b.down("#summaries-1").removeAll(true);a.each(function(e,c){e.counters().sort({property:"total",direction:"DESC"});var d=Ext.create("Ext.panel.Panel",{tbar:{xtype:"container",itemId:"title",html:"<h3>"+e.get("displayName")+"</h3>"},bbar:["->",{xtype:"button",ui:"link",text:Uni.I18n.translate("overview.widget.breakdown.showMore","DSH","show more"),hidden:e.counters().count()<=b.itemsInCollapsedMode,handler:function(){b.summaryMoreLess(d)}}],items:{xtype:"dataview",itemId:e.get("alias")+"-dataview",itemSelector:"tbody.item",total:e.get("total"),store:e.counters(),tpl:'<table><tpl for="."><tbody class="item item-{#}"><tr><td><a><div style="width: 200px; overflow: hidden; text-overflow: ellipsis; padding-right: 20px">{displayName}</div></a></td><td width="100%" id="bar-{#}"></td></tr></tbody></tpl></table>',listeners:{refresh:function(f){Ext.each(f.getNodes(),function(k,i){var g=f.getRecord(k),m=i+1;var l={failed:g.get("failedCount"),pending:g.get("pendingCount"),success:g.get("successCount")};var j=Ext.widget("stacked-bar",{limit:g.get("total"),total:e.get("total"),count:l,label:g.get("total")});j.render(f.getEl().down("#bar-"+m));var h=b.router.getRoute("workspace/datacommunication/"+b.parent).buildUrl(null,{filter:[{property:e.get("alias"),value:g.get("id")}]});f.getEl().down(".item-"+m+" a").set({href:h})});f.collapsed=e.counters().count()>b.itemsInCollapsedMode;f.expandedHeight=f.getHeight();f.collapsedHeight=f.expandedHeight/e.counters().count()*b.itemsInCollapsedMode;if(f.collapsed){f.setHeight(f.collapsedHeight)}}}}});b.down("#summaries-"+c%2).add(d)});b.mixins.bindable.bindStore.apply(this,arguments)},summaryMoreLess:function(b){var a=b.down("dataview");b.down("button").setText(a.collapsed?Uni.I18n.translate("overview.widget.breakdown.showLess","DSH","show less"):Uni.I18n.translate("overview.widget.breakdown.showMore","DSH","show more"));a.animate({duration:300,to:{height:(a.collapsed?a.expandedHeight:a.collapsedHeight)}});a.collapsed=!a.collapsed}});Ext.define("Dsh.view.CommunicationOverview",{extend:"Ext.container.Container",requires:["Dsh.view.widget.HeaderSection","Dsh.view.widget.Summary","Dsh.view.widget.CommunicationServers","Dsh.view.widget.QuickLinks","Dsh.view.widget.ReadOutsOverTime","Dsh.view.widget.Overview","Dsh.view.widget.Breakdown"],alias:"widget.communication-overview",itemId:"communication-overview",autoScroll:true,layout:{type:"vbox",align:"stretch"},style:{padding:"15px"},defaults:{style:{marginTop:"30px",paddingTop:"30px",borderTop:"3px dotted grey"}},initComponent:function(){var a=this;a.items=[{xtype:"header-section",wTitle:Uni.I18n.translate("communication.widget.headerSection.title","DSH","Communication overview"),style:"none"},{layout:"hbox",style:{marginTop:"30px",border:"none"},defaults:{style:{paddingRight:"50px"}},items:[{xtype:"summary",flex:3,wTitle:Uni.I18n.translate("communication.widget.summary.title","DSH","Communication summary"),style:{paddingRight:"150px"}},{xtype:"communication-servers",itemId:"communication-servers",router:a.router,flex:1,style:{borderRight:"3px dotted grey"}},{xtype:"quick-links",itemId:"quick-links",flex:1,style:{paddingLeft:"50px"},data:[{link:Uni.I18n.translate("communication.widget.quicklinks.viewAll","DSH","View all communications"),href:a.router.getRoute("workspace/datacommunication/communications").buildUrl()},{link:Uni.I18n.translate("connection.widget.headerSection.title","DSH","Connection overview"),href:a.router.getRoute("workspace/datacommunication/connection").buildUrl()}]}]},{xtype:"overview",category:"Communication"},{xtype:"breakdown",parent:"communications",router:a.router}];this.callParent(arguments)}});Ext.define("Dsh.model.communication.Overview",{extend:"Ext.data.Model",proxy:{type:"ajax",url:"/api/dsr/communicationoverview",reader:{type:"json",root:"data"}}});Ext.define("Dsh.model.CommunicationServerInfo",{extend:"Ext.data.Model",fields:[{name:"comServerId",type:"int"},{name:"comServerName",type:"string"},{name:"comServerType",type:"string"},{name:"running",type:"boolean"},{name:"blocked",type:"boolean"},{name:"blockTime",type:"auto"}],associations:[{name:"blockTime",type:"hasOne",model:"Dsh.model.TimeInfo",associationKey:"blockTime"}],proxy:{type:"ajax",url:"../../api/dsr/comserverstatussummary",reader:{type:"json",root:"comServerStatusInfos"}}});Ext.define("Dsh.store.CommunicationServerInfos",{extend:"Ext.data.Store",storeId:"CommunicationServerInfos",requires:["Dsh.model.CommunicationServerInfo"],model:"Dsh.model.CommunicationServerInfo",sorters:[{property:"running",direction:"ASC"}]});Ext.define("Dsh.controller.CommunicationOverview",{extend:"Ext.app.Controller",models:["Dsh.model.communication.Overview"],stores:["CommunicationServerInfos"],views:["Dsh.view.CommunicationOverview"],refs:[{ref:"communicationOverview",selector:"#communication-overview"},{ref:"header",selector:"#header-section"},{ref:"summary",selector:"#summary"},{ref:"communicationServers",selector:"#communication-servers"},{ref:"overview",selector:"#overview"},{ref:"breakdown",selector:"#breakdown"}],init:function(){this.control({"#communication-overview #refresh-btn":{click:this.loadData}})},showOverview:function(){var a=this.getController("Uni.controller.history.Router");this.getApplication().fireEvent("changecontentevent",Ext.widget("communication-overview",{router:a}));this.loadData()},loadData:function(){var b=this,a=b.getModel("Dsh.model.communication.Overview");b.getCommunicationOverview().setLoading();b.getCommunicationServers().reload();a.load(null,{success:function(c){b.getSummary().setRecord(c.getSummary());b.getOverview().bindStore(c.overviews());b.getBreakdown().bindStore(c.breakdowns());b.getHeader().down("#last-updated-field").setValue("Last updated at "+Ext.util.Format.date(new Date(),"H:i"))},callback:function(){b.getCommunicationOverview().setLoading(false)}})}});Ext.define("Dsh.view.widget.ActionMenu",{extend:"Ext.menu.Menu",alias:"widget.dsh-action-menu",plain:true,items:[{itemId:"assign",text:"Item 1",action:"assign"},{itemId:"close",text:"item 2",action:"close"}]});Ext.define("Dsh.view.widget.CommunicationsList",{extend:"Ext.grid.Panel",alias:"widget.communications-list",store:"Dsh.store.CommunicationTasks",requires:["Ext.grid.column.Date","Ext.form.field.ComboBox","Ext.grid.column.Template","Uni.grid.column.Action","Uni.view.toolbar.PagingTop","Uni.view.toolbar.PagingBottom","Dsh.view.widget.ActionMenu"],columns:{defaults:{sortable:false,menuDisabled:true},items:[{itemId:"name",text:Uni.I18n.translate("communication.widget.details.commTask","DSH","Communications"),dataIndex:"name",flex:2},{itemId:"device",text:Uni.I18n.translate("communication.widget.details.device","DSH","Device"),dataIndex:"device",flex:1,renderer:function(a){return a.name?a.name:""}},{itemId:"currentState",text:Uni.I18n.translate("communication.widget.details.currentState","DSH","Current state"),dataIndex:"currentState",flex:1,renderer:function(a){return a.displayValue?a.displayValue:""}},{itemId:"latestResult",text:Uni.I18n.translate("connection.widget.details.latestResult","DSH","Latest result"),dataIndex:"latestResult",flex:1,renderer:function(a){return a.displayValue?a.displayValue:""}},{itemId:"nextCommunication",text:Uni.I18n.translate("communication.widget.details.nextCommunication","DSH","Next communication"),dataIndex:"nextCommunication",xtype:"datecolumn",format:"m/d/Y h:i:s",flex:2},{itemId:"startTime",text:Uni.I18n.translate("communication.widget.details.startedOn","DSH","Started on"),dataIndex:"startTime",xtype:"datecolumn",format:"m/d/Y h:i:s",flex:2},{itemId:"successfulFinishTime",text:Uni.I18n.translate("communication.widget.details.finishedOn","DSH","Finished succesfuly on"),dataIndex:"successfulFinishTime",xtype:"datecolumn",format:"m/d/Y h:i:s",flex:2},{itemId:"action",xtype:"uni-actioncolumn"}]}});Ext.define("Dsh.view.widget.PreviewCommunication",{extend:"Ext.form.Panel",alias:"widget.preview_communication",title:"",frame:true,layout:{type:"column"},tools:[],items:[{columnWidth:0.5,defaults:{xtype:"displayfield",labelWidth:200},items:[{fieldLabel:Uni.I18n.translate("communication.widget.details.commTask","DSH","Name"),name:"name"},{fieldLabel:Uni.I18n.translate("communication.widget.details.commTask","DSH","Communication task(s)"),name:"title"},{fieldLabel:Uni.I18n.translate("communication.widget.details.device","DSH","Device"),name:"device",renderer:function(a){return a?'<a href="#/devices/'+a.id+'">'+a.name+"</a>":""}},{fieldLabel:Uni.I18n.translate("communication.widget.details.deviceType","DSH","Device type"),name:"deviceType",renderer:function(a){return a?'<a href="#/administration/devicetypes/'+a.id+'">'+a.name+"</a>":""}},{fieldLabel:Uni.I18n.translate("communication.widget.details.deviceConfig","DSH","Device configuration"),name:"devConfig",renderer:function(b){var a="";b&&(a='<a href="#/administration/devicetypes/'+b.devType.id+"/deviceconfigurations/"+b.config.id+'">'+b.config.name+"</a>");return a}},{fieldLabel:Uni.I18n.translate("communication.widget.details.frequency","DSH","Frequency"),name:"comScheduleName"},{fieldLabel:" ",name:"comScheduleFrequency",renderer:function(b){var a="";if(b){a=Uni.I18n.translate("communication.widget.details.every","DSH","Every")+" "+b.every.count+" "+b.every.timeUnit}return a}},{fieldLabel:Uni.I18n.translate("communication.widget.details.urgency","DSH","Urgency"),name:"urgency"},{fieldLabel:Uni.I18n.translate("communication.widget.details.executeOnInbound","DSH","Always execute on inbound"),name:"alwaysExecuteOnInbound",renderer:function(a){if(!_.isUndefined(a)){return a?"Yes":"No"}else{return""}}}]},{columnWidth:0.5,defaults:{xtype:"displayfield",labelWidth:200},items:[{fieldLabel:Uni.I18n.translate("communication.widget.details.currentState","DSH","Current state"),name:"currentState",renderer:function(a){return a.displayValue?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("communication.widget.details.latestResult","DSH","Latest result"),name:"latestResult",renderer:function(a){return a.displayValue?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("communication.widget.details.startedOn","DSH","Started on"),name:"startTime",renderer:function(a){return Ext.Date.format(a,"m/d/Y h:i:s")}},{fieldLabel:Uni.I18n.translate("communication.widget.details.finishedOn","DSH","Finished successful on"),name:"successfulFinishTime",renderer:function(a){return Ext.Date.format(a,"m/d/Y h:i:s")}},{fieldLabel:Uni.I18n.translate("communication.widget.details.nextComm","DSH","Next communication"),name:"nextCommunication",renderer:function(a){return Ext.Date.format(a,"m/d/Y h:i:s")}}]}],initComponent:function(){var a=this;a.callParent(arguments)}});Ext.define("Dsh.view.widget.PreviewConnection",{extend:"Ext.form.Panel",alias:"widget.preview_connection",title:"",frame:true,layout:{type:"column"},tools:[],items:[{columnWidth:0.5,defaults:{xtype:"displayfield",labelWidth:200},items:[{fieldLabel:Uni.I18n.translate("connection.widget.details.device","DSH","Device"),name:"device",renderer:function(a){return a?'<a href="#/devices/'+a.id+'">'+a.name+"</a>":""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.deviceType","DSH","Device type"),name:"deviceType",renderer:function(a){return a?'<a href="#/administration/devicetypes/'+a.id+'">'+a.name+"</a>":""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.deviceConfig","DSH","Device configuration"),name:"devConfig",renderer:function(b){var a="";b&&(a='<a href="#/administration/devicetypes/'+b.devType.id+"/deviceconfigurations/"+b.config.id+'">'+b.config.name+"</a>");return a}},{fieldLabel:Uni.I18n.translate("connection.widget.details.direction","DSH","Direction"),name:"direction"},{fieldLabel:Uni.I18n.translate("connection.widget.details.connType","DSH","Connection type"),name:"connectionType"},{fieldLabel:Uni.I18n.translate("connection.widget.details.connMethod","DSH","Connection method"),name:"connectionMethod",renderer:function(a){return a?a.name:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.connWindow","DSH","Connection window"),name:"window"},{fieldLabel:Uni.I18n.translate("connection.widget.details.strategy","DSH","Strategy"),name:"connectionStrategy",renderer:function(a){return a?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.nextConnection","DSH","Next connection"),name:"nextExecution",renderer:function(a){return a?Ext.Date.format(a,"m/d/Y h:i:s"):""}}]},{columnWidth:0.5,defaults:{xtype:"displayfield",labelWidth:200},items:[{fieldLabel:Uni.I18n.translate("connection.widget.details.currentState","DSH","Current state"),name:"currentState",renderer:function(a){return a?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.latestStatus","DSH","Latest status"),name:"latestStatus",renderer:function(a){return a?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.latestResult","DSH","Latest result"),name:"latestResult",renderer:function(a){return a?a.displayValue:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.commTasks","DSH","Communication tasks"),name:"taskCount",renderer:function(a){return'<tpl><span class="fa fa-check fa-lg" style="color: green; width: 24px; vertical-align: 0% !important;"></span>'+(a.numberOfSuccessfulTasks?a.numberOfSuccessfulTasks:"")+'</span><br></tpl><tpl><span class="fa fa-times fa-lg" style="color: red; width: 24px; vertical-align: 0% !important;"></span>'+(a.numberOfFailedTasks?a.numberOfFailedTasks:"")+'<br></tpl><tpl><span class="fa fa-ban fa-lg" style="color: #333333; width: 24px; vertical-align: 0% !important"></span>'+(a.numberOfIncompleteTasks?a.numberOfIncompleteTasks:"")+"</tpl>"}},{fieldLabel:Uni.I18n.translate("connection.widget.details.startedOn","DSH","Started on"),name:"startDateTime",renderer:function(a){return a?Ext.Date.format(a,"m/d/Y h:i:s"):""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.finishedOn","DSH","Finished on"),name:"endDateTime",renderer:function(a){return a?Ext.Date.format(a,"m/d/Y h:i:s"):""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.duration","DSH","Duration"),name:"duration",renderer:function(a){return a?a.count+" "+a.timeUnit:""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.commServer","DSH","Communication server"),name:"comServer",renderer:function(a){return a?'<a href="#/administration/comservers/'+a.id+'">'+a.name+"</a>":""}},{fieldLabel:Uni.I18n.translate("connection.widget.details.commPort","DSH","Communication port"),name:"comPortPool",renderer:function(a){return a?a.name:""}}]}],initComponent:function(){var a=this;a.callParent(arguments)}});Ext.define("Dsh.view.widget.common.SideFilterCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.side-filter-combo",editable:false,multiSelect:true,queryMode:"local",triggerAction:"all",initComponent:function(){var a=this;this.callParent(arguments);this.listConfig={getInnerTpl:function(){return'<div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="x-form-checkbox" /> {'+a.displayField+"}</div>"}};this.store=Ext.create("Ext.data.Store",{autoLoad:true,fields:[a.valueField,a.displayField],proxy:{type:"ajax",url:a.url,reader:{type:"json",root:a.root}},listeners:{load:function(){a.select(a.up("form").getRecord().get(a.name))}}})}});Ext.define("Dsh.view.widget.common.DateTimeField",{extend:"Ext.form.FieldSet",alias:"widget.datetime-field",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:30,labelAlign:"left",labelStyle:"font-weight: normal"},items:[{xtype:"datefield",name:"date",editable:false},{xtype:"fieldcontainer",fieldLabel:"&nbsp;",style:"padding-left: 30px",layout:"hbox",defaultType:"numberfield",defaults:{flex:1,value:0,minValue:0,enforceMaxLength:true,maxLength:2,enableKeyEvents:true,stripCharsRe:/\D/,listeners:{blur:function(a){if(Ext.isEmpty(a.getValue())){a.setValue(0)}}}},items:[{name:"hours",maxValue:23,style:{marginRight:"5px"},valueToRaw:function(a){return a<10?Ext.String.leftPad(a,2,"0"):a>23?23:a}},{name:"minutes",maxValue:59,style:{marginLeft:"5px"},valueToRaw:function(a){return a<10?Ext.String.leftPad(a,2,"0"):a>59?59:a}}]}],initComponent:function(){this.callParent(arguments);this.down("datefield").setFieldLabel(this.label)}});Ext.define("Dsh.view.widget.common.SideFilterDateTime",{extend:"Ext.form.FieldSet",alias:"widget.side-filter-date-time",requires:["Dsh.view.widget.common.DateTimeField"],layout:{type:"vbox",align:"stretch"},style:{border:"none",padding:0,margin:0},defaults:{xtype:"datetime-field",style:{border:"none",padding:0,margin:0}},items:[{xtype:"panel",name:"header",baseCls:"x-form-item-label",style:"margin: 15px 0"},{label:Uni.I18n.translate("connection.widget.sideFilter.from","DSH","From"),name:"from"},{label:Uni.I18n.translate("connection.widget.sideFilter.to","DSH","To"),name:"to"}],initComponent:function(){this.callParent(arguments);this.down("panel[name=header]").update(this.wTitle)}});Ext.define("Dsh.view.widget.SideFilter",{extend:"Ext.panel.Panel",alias:"widget.dsh-side-filter",requires:["Uni.component.filter.view.Filter","Dsh.view.widget.common.SideFilterCombo","Dsh.view.widget.common.SideFilterDateTime"],cls:"filter-form",width:250,title:Uni.I18n.translate("connection.widget.sideFilter.title","DSH","Filter"),ui:"medium",items:[{xtype:"nested-form",ui:"filter",layout:{type:"vbox",align:"stretch"},defaults:{xtype:"side-filter-combo",labelAlign:"top"},items:[{itemId:"current-state",name:"state",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.currentState","DSH","Current state"),displayField:"localizedValue",valueField:"taskStatus",url:"/api/dsr/field/taskstatus",root:"taskStatuses"},{itemId:"latest-status",name:"latestStatus",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.latestStatus","DSH","Latest status"),displayField:"localizedValue",valueField:"successIndicator",url:"/api/dsr/field/connectiontasksuccessindicators",root:"successIndicators"},{itemId:"latest-result",name:"latestResult",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.latestResult","DSH","Latest result"),displayField:"localizedValue",valueField:"successIndicator",url:"/api/dsr/field/comsessionsuccessindicators",root:"successIndicators"},{itemId:"comport-pool",name:"comPortPool",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.comPortPool","DSH","Communication port pool"),displayField:"name",valueField:"id",url:"/api/dsr/field/comportpools",root:"comPortPools"},{itemId:"connection-type",name:"connectionType",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.connectionType","DSH","Connection type"),displayField:"name",valueField:"id",url:"/api/dsr/field/connectiontypepluggableclasses",root:"connectiontypepluggableclasses"},{itemId:"device-type",name:"deviceType",fieldLabel:Uni.I18n.translate("connection.widget.sideFilter.deviceType","DSH","Device type"),displayField:"name",valueField:"id",url:"/api/dsr/field/devicetypes",root:"deviceTypes"},{xtype:"side-filter-date-time",itemId:"started-between",name:"startedBetween",wTitle:Uni.I18n.translate("connection.widget.sideFilter.startedBetween","DSH","Started between")},{xtype:"side-filter-date-time",itemId:"finished-between",name:"finishedBetween",wTitle:Uni.I18n.translate("connection.widget.sideFilter.finishedBetween","DSH","Finished between")}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:Uni.I18n.translate("connection.widget.sideFilter.apply","DSH","Apply"),ui:"action",action:"applyfilter"},{text:Uni.I18n.translate("connection.widget.sideFilter.clearAll","DSH","Clear all"),action:"clearfilter"}]}]}]});Ext.define("Dsh.view.Communications",{extend:"Uni.view.container.ContentContainer",alias:"widget.communications-details",itemId:"communicationsdetails",overflowY:"auto",requires:["Dsh.view.widget.CommunicationsList","Dsh.view.widget.PreviewCommunication"],content:[{xtype:"panel",ui:"large",title:Uni.I18n.translate("workspace.dataCommunication.communication.title","DSH","Communications"),items:[{xtype:"preview-container",grid:{xtype:"communications-list",itemId:"communicationslist"},emptyComponent:{xtype:"no-items-found-panel",title:Uni.I18n.translate("workspace.dataCommunication.connections.empty.title","DSH","No connections found"),reasons:[Uni.I18n.translate("workspace.dataCommunication.connections.empty.list.item1","DSH","No connections in the system."),Uni.I18n.translate("workspace.dataCommunication.connections.empty.list.item2","DSH","No connections found due to applied filters.")]},previewComponent:{items:[{xtype:"preview_communication",itemId:"communicationdetails"},{style:{"margin-top":"32px"},xtype:"preview_connection",itemId:"connectiondetails"}]}}]}],side:[{xtype:"dsh-side-filter",itemId:"dshcommunicationssidefilter"}],initComponent:function(){this.callParent(arguments)}});Ext.define("Dsh.model.CommunicationTask",{extend:"Ext.data.Model",fields:["name","device","id","deviceConfiguration","deviceType","comScheduleName","comScheduleFrequency","urgency","currentState","alwaysExecuteOnInbound","latestResult","connectionTask",{name:"startTime",type:"date",dateFormat:"time"},{name:"successfulFinishTime",type:"date",dateFormat:"time"},{name:"nextCommunication",type:"date",dateFormat:"time"},{name:"title",persist:false,mapping:function(a){return a.name+" on "+a.device.name}},{name:"devConfig",persist:false,mapping:function(a){var b={};b.config=a.deviceConfiguration;b.devType=a.deviceType;return b}}],hasOne:[{model:"Dsh.model.ConnectionTask",name:"connectionTask"}]});Ext.define("Dsh.store.CommunicationTasks",{extend:"Ext.data.Store",requires:["Dsh.model.CommunicationTask"],model:"Dsh.model.CommunicationTask",proxy:{type:"ajax",url:"/api/dsr/communications",reader:{type:"json",root:"communicationTasks",totalProperty:"count"}}});Ext.define("Dsh.controller.Communications",{extend:"Ext.app.Controller",views:["Dsh.view.Communications","Dsh.view.widget.PreviewCommunication"],stores:["Dsh.store.CommunicationTasks"],refs:[{ref:"communicationPreview",selector:"#communicationdetails"},{ref:"connectionPreview",selector:"#connectiondetails"}],init:function(){this.control({"#communicationslist":{selectionchange:this.onSelectionChange}});this.getStore("Dsh.store.CommunicationTasks").load();this.callParent(arguments)},showOverview:function(){var a=Ext.widget("communications-details");this.getApplication().fireEvent("changecontentevent",a)},onSelectionChange:function(c,d){var f=this,a=d[0],e=a.get("connectionTask"),h=Ext.create("Dsh.model.ConnectionTask",e),g=f.getCommunicationPreview(),b=f.getConnectionPreview();g.loadRecord(a);g.setTitle(a.get("name")+" on "+a.get("device").name);if(e){b.setTitle(e.connectionMethod.name+" on "+e.device.name);b.show();b.loadRecord(h)}else{b.hide()}}});Ext.define("Dsh.view.ConnectionOverview",{extend:"Ext.container.Container",requires:["Dsh.view.widget.HeaderSection","Dsh.view.widget.Summary","Dsh.view.widget.CommunicationServers","Dsh.view.widget.QuickLinks","Dsh.view.widget.ReadOutsOverTime","Dsh.view.widget.Overview","Dsh.view.widget.Breakdown"],alias:"widget.connection-overview",itemId:"connection-overview",autoScroll:true,layout:{type:"vbox",align:"stretch"},style:{padding:"15px"},defaults:{style:{marginTop:"30px",paddingTop:"30px",borderTop:"3px dotted grey"}},initComponent:function(){var a=this;a.items=[{xtype:"header-section",wTitle:Uni.I18n.translate("connection.widget.headerSection.title","DSH","Connection overview"),style:"none"},{layout:"hbox",style:{marginTop:"30px",border:"none"},defaults:{style:{paddingRight:"50px"}},items:[{xtype:"summary",flex:3,wTitle:Uni.I18n.translate("connection.widget.summary.title","DSH","Connection summary"),router:a.router,parent:"connections",style:{paddingRight:"150px"}},{xtype:"communication-servers",itemId:"communication-servers",router:a.router,flex:1,style:{borderRight:"3px dotted grey"}},{xtype:"quick-links",itemId:"quick-links",flex:1,style:{paddingLeft:"50px"},data:[{link:Uni.I18n.translate("connection.widget.quicklinks.viewAll","DSH","View all connections"),href:a.router.getRoute("workspace/datacommunication/connections").buildUrl()},{link:Uni.I18n.translate("communication.widget.headerSection.title","DSH","Communication overview"),href:a.router.getRoute("workspace/datacommunication/communication").buildUrl()}]}]},{xtype:"overview",category:"Connection",parent:"connections",router:a.router},{xtype:"breakdown",parent:"connections",router:a.router}];this.callParent(arguments)}});Ext.define("Dsh.model.Counter",{extend:"Ext.data.Model",fields:[{name:"count",type:"int"},{name:"alias",type:"string"},{name:"displayName",type:"string"},{name:"total",type:"int"}],hasMany:{model:"Dsh.model.Counter",name:"counters"}});Ext.define("Dsh.model.Summary",{extend:"Ext.data.Model",requires:["Dsh.model.Counter"],fields:[{name:"total",type:"int"}],hasMany:{model:"Dsh.model.Counter",name:"counters"}});Ext.define("Dsh.model.BreakdownCounter",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"displayName",type:"string"},{name:"successCount",type:"int"},{name:"failedCount",type:"int"},{name:"pendingCount",type:"int"},{name:"total",type:"int",persist:false,convert:function(b,a){return a.get("successCount")+a.get("failedCount")+a.get("pendingCount")}}]});Ext.define("Dsh.model.Breakdown",{extend:"Ext.data.Model",requires:["Dsh.model.BreakdownCounter"],fields:[{name:"displayName",type:"string"},{name:"alias",type:"string"},{name:"total",type:"int"},{name:"totalSuccessCount",type:"int"},{name:"totalPendingCount",type:"int"},{name:"totalFailedCount",type:"int"}],hasMany:{model:"Dsh.model.BreakdownCounter",name:"counters"}});Ext.define("Dsh.model.connection.Overview",{extend:"Ext.data.Model",requires:["Dsh.model.Summary","Dsh.model.Counter","Dsh.model.Breakdown"],hasOne:{model:"Dsh.model.Summary",associationKey:"connectionSummary",name:"summary",getterName:"getSummary",setterName:"setSummary"},hasMany:[{model:"Dsh.model.Counter",name:"overviews"},{model:"Dsh.model.Breakdown",name:"breakdowns"}],proxy:{type:"ajax",url:"/api/dsr/connectionoverview"}});Ext.define("Dsh.model.Combine",{extend:"Ext.data.Model",fields:[{name:"localizedValue",type:"string"},{name:"breakdown",type:"string"}]});Ext.define("Dsh.store.CombineStore",{extend:"Ext.data.Store",storeId:"CombineStore",model:"Dsh.model.Combine",autoLoad:true,proxy:{type:"rest",url:"/api/dsr/field/breakdown",reader:{type:"json",root:"breakdowns"}}});Ext.define("Dsh.model.ConnectionResults",{extend:"Ext.data.Model",fields:[{name:"displayValue",type:"string"},{name:"alias",type:"string"},{name:"id",type:"int"},"data"],hasMany:[{model:"Dsh.model.Result",name:"data"}]});Ext.define("Dsh.store.ConnectionResultsStore",{extend:"Ext.data.Store",model:"Dsh.model.ConnectionResults",proxy:{type:"ajax",url:"/api/dsr/connectionheatmap",pageParam:false,startParam:false,limitParam:false,reader:{type:"json",root:"heatMap"}}});Ext.define("Dsh.controller.ConnectionOverview",{extend:"Ext.app.Controller",models:["Dsh.model.connection.Overview"],stores:["CommunicationServerInfos","Dsh.store.CombineStore","Dsh.store.ConnectionResultsStore"],views:["Dsh.view.ConnectionOverview"],refs:[{ref:"connectionOverview",selector:"#connection-overview"},{ref:"header",selector:"#header-section"},{ref:"summary",selector:"#summary"},{ref:"communicationServers",selector:"#communication-servers"},{ref:"overview",selector:"#overview"},{ref:"breakdown",selector:"#breakdown"}],init:function(){this.control({"#connection-overview #refresh-btn":{click:this.loadData}})},showOverview:function(){var a=this.getController("Uni.controller.history.Router");this.getApplication().fireEvent("changecontentevent",Ext.widget("connection-overview",{router:a}));this.loadData()},loadData:function(){var b=this,a=b.getModel("Dsh.model.connection.Overview");b.getConnectionOverview().setLoading();b.getCommunicationServers().reload();a.load(null,{success:function(c){b.getSummary().setRecord(c.getSummary());b.getOverview().bindStore(c.overviews());b.getBreakdown().bindStore(c.breakdowns());b.getHeader().down("#last-updated-field").setValue("Last updated at "+Ext.util.Format.date(new Date(),"H:i"))},callback:function(){b.getConnectionOverview().setLoading(false)}})}});Ext.define("Dsh.view.widget.ConnectionsList",{extend:"Ext.grid.Panel",alias:"widget.connections-list",requires:["Ext.grid.column.Date","Ext.form.field.ComboBox","Ext.grid.column.Template","Uni.grid.column.Action","Uni.view.toolbar.PagingTop","Uni.view.toolbar.PagingBottom","Dsh.view.widget.ActionMenu"],itemId:"connectionslist",store:"Dsh.store.ConnectionTasks",columns:{defaults:{sortable:false,menuDisabled:true},items:[{itemId:"Device",text:Uni.I18n.translate("connection.widget.details.device","DSH","Device"),dataIndex:"device",flex:1,renderer:function(a){return'<a href="#/devices/'+a.id+'">'+a.name+"</a>"}},{itemId:"currentState",text:Uni.I18n.translate("connection.widget.details.currentState","DSH","Current state"),dataIndex:"currentState",flex:1,renderer:function(a){return a?a.displayValue:""}},{itemId:"latestStatus",text:Uni.I18n.translate("connection.widget.details.latestStatus","DSH","Latest status"),dataIndex:"latestStatus",flex:1,renderer:function(a){return a?a.displayValue:""}},{itemId:"latestResult",text:Uni.I18n.translate("connection.widget.details.latestResult","DSH","Latest result"),dataIndex:"latestResult",name:"latestResult",flex:1,renderer:function(a){return a?a.displayValue:""}},{dataIndex:"taskCount",itemId:"taskCount",renderer:function(d){var c=d.numberOfSuccessfulTasks?'<tpl><span class="fa fa-check fa-lg" style="color: green; position: relative; vertical-align: 0% !important;"></span><span style="position: relative; left: 4px">'+d.numberOfSuccessfulTasks+"</span></tpl>":"",a=d.numberOfFailedTasks?'<tpl><span class="fa fa-times fa-lg" style="color: red; position: relative; left: 26px; vertical-align: 0% !important;"></span><span style="position: relative; left: 30px">'+d.numberOfFailedTasks+"</span></tpl>":"",b=d.numberOfIncompleteTasks?'<tpl><span class="fa fa-ban fa-lg" style="color: #333333; position: relative; left: 52px; vertical-align: 0% !important"></span><span  style="position: relative; left: 56px">'+d.numberOfIncompleteTasks+"</span></tpl>":"";return c+a+b},header:Uni.I18n.translate("connection.widget.details.commTasks","DSH","Communication tasks"),flex:2},{itemId:"startDateTime",text:Uni.I18n.translate("connection.widget.details.startedOn","DSH","Started on"),dataIndex:"startDateTime",xtype:"datecolumn",format:"m/d/Y h:i:s",flex:1},{itemId:"endDateTime",text:Uni.I18n.translate("connection.widget.details.finishedOn","DSH","Finished on"),dataIndex:"endDateTime",xtype:"datecolumn",format:"m/d/Y h:i:s",flex:1},{itemId:"action",xtype:"uni-actioncolumn"}]},dockedItems:[{itemId:"pagingtoolbartop",xtype:"pagingtoolbartop",dock:"top",store:"Dsh.store.ConnectionTasks",displayMsg:Uni.I18n.translate("connection.widget.details.displayMsg","DDSH","{0} - {1} of {2} connections"),displayMoreMsg:Uni.I18n.translate("connection.widget.details.displayMoreMsg","DSH","{0} - {1} of more than {2} connections"),emptyMsg:Uni.I18n.translate("connection.widget.details.emptyMsg","DSH","There are no connections to display")},{itemId:"pagingtoolbarbottom",xtype:"pagingtoolbarbottom",store:"Dsh.store.ConnectionTasks",dock:"bottom",itemsPerPageMsg:Uni.I18n.translate("connection.widget.details.itemsPerPage","DSH","Connections per page")}],addTooltip:function(){var d=this,a=d.getView(),e=Ext.create("Ext.tip.ToolTip",{target:a.el,delegate:"span.fa",trackMouse:true,renderTo:Ext.getBody(),listeners:{beforeshow:function c(j){var h,g=Ext.get(j.triggerElement).up("tr"),i=a.getRecord(g).get("taskCount"),f=i.numberOfFailedTasks+" "+Uni.I18n.translate("connection.widget.details.comTasksFailed","DSH","communication tasks failed"),l=i.numberOfSuccessfulTasks+" "+Uni.I18n.translate("connection.widget.details.comTasksSuccessful","DSH","communication tasks successful"),k=i.numberOfIncompleteTasks+" "+Uni.I18n.translate("connection.widget.details.comTasksNotCompleted","DSH","communication tasks not completed");(j.triggerElement.className.search("fa-ban")!==-1)&&(h=k);(j.triggerElement.className.search("fa-check")!==-1)&&(h=l);(j.triggerElement.className.search("fa-time")!==-1)&&(h=f);j.update(h)}}}),b=Ext.create("Ext.tip.ToolTip",{target:a.el,delegate:"td.x-grid-cell-headerId-latestResult",trackMouse:true,renderTo:Ext.getBody(),listeners:{beforeshow:function(){var f=Ext.get(b.triggerElement).up("tr"),g=a.getRecord(f).get("latestResult");if(g.retries){b.update(g.retries+" "+Uni.I18n.translate("connection.widget.details.retries","DSH","retries"))}},show:function(){var f=Ext.get(b.triggerElement).up("tr"),g=a.getRecord(f).get("latestResult");if(!g.retries){b.hide()}}}})},initComponent:function(){var a=this;a.on("afterrender",a.addTooltip);a.callParent(arguments)}});Ext.define("Dsh.view.widget.FilterPanel",{extend:"Ext.panel.Panel",alias:"widget.connections-filter-panel",border:true,header:false,collapsible:false,hidden:true,layout:{type:"vbox",align:"stretch"},items:[{xtype:"filter-toolbar",title:Uni.I18n.translate("","MDC","Filter"),emptyText:"None"},{xtype:"menuseparator"}],loadRecord:function(a){var c=this,b=0,d=a.getData();for(key in d){if(d[key]&&(d[key][0].length>0)){c.addFilterBtn(key,key,d[key]);++b}}b<1?c.hide():c.show();c.record=a},addFilterBtn:function(a,f,e){var c=this,d=c.down("filter-toolbar").getContainer(),b=d.down("button[name="+a+"]");if(b){b.setText(f+": "+e)}else{b=Ext.create("Skyline.button.TagButton",{text:f+": "+e,name:a,value:e});b.on("closeclick",function(g){c.record.set(g.name,"");c.record.save()});d.add(b)}}});Ext.define("Dsh.view.Connections",{extend:"Uni.view.container.ContentContainer",alias:"widget.connections-details",itemId:"connectionsdetails",overflowY:"auto",requires:["Dsh.view.widget.ConnectionsList","Dsh.view.widget.PreviewConnection","Dsh.view.widget.SideFilter","Dsh.view.widget.FilterPanel"],content:[{xtype:"panel",ui:"large",title:Uni.I18n.translate("workspace.dataCommunication.connections.title","DSH","Connections")},{xtype:"connections-filter-panel",itemId:"dshconnectionsfilterpanel"},{xtype:"preview-container",grid:{xtype:"connections-list",itemId:"connectionsdetails"},emptyComponent:{xtype:"no-items-found-panel",title:Uni.I18n.translate("workspace.dataCommunication.connections.empty.title","DSH","No connections found"),reasons:[Uni.I18n.translate("workspace.dataCommunication.connections.empty.list.item1","DSH","No connections in the system."),Uni.I18n.translate("workspace.dataCommunication.connections.empty.list.item2","DSH","No connections found due to applied filters.")]},previewComponent:{xtype:"preview_connection",itemId:"connectionpreview"}},{ui:"medium",itemId:"comtaskstitlepanel",title:""},{xtype:"container",itemId:"communicationcontainer"}],side:[{xtype:"dsh-side-filter",itemId:"dshconnectionssidefilter"}],initComponent:function(){this.callParent(arguments)}});Ext.define("Dsh.model.ConnectionTask",{extend:"Ext.data.Model",fields:[{name:"device",type:"auto"},{name:"deviceConfiguration",type:"auto"},{name:"deviceType",type:"auto"},{name:"devConfig",persist:false,mapping:function(a){var b={};b.config=a.deviceConfiguration;b.devType=a.deviceType;return b}},{name:"title",persist:false,mapping:function(a){return a.connectionMethod.name+" on "+a.device.name}},{name:"currentState",type:"auto"},{name:"latestStatus",type:"auto"},{name:"latestResult",type:"auto"},{name:"taskCount",type:"auto"},{name:"startDateTime",type:"date",dateFormat:"time"},{name:"endDateTime",type:"date",dateFormat:"time"},{name:"duration",type:"auto"},{name:"comPortPool",type:"auto"},{name:"direction",type:"auto"},{name:"connectionType",type:"auto"},{name:"comServer",type:"auto"},{name:"connectionMethod",type:"auto"},{name:"window",type:"auto"},{name:"connectionStrategy",type:"auto"},{name:"nextExecution",type:"date",dateFormat:"time"},"communicationTasks"],hasOne:[{model:"Dsh.model.CommTasks",name:"communicationTasks"}]});Ext.define("Dsh.model.CommTasks",{extend:"Ext.data.Model",fields:[{name:"count",type:"auto"},"communicationTasks"],hasMany:[{model:"Dsh.model.CommunicationTask",name:"communicationsTasks"}]});Ext.define("Dsh.model.Filter",{extend:"Ext.data.Model",proxy:Ext.create("Uni.data.proxy.QueryStringProxy",{root:"filter"}),fields:[{name:"deviceGroup",type:"auto"},{name:"state",type:"auto"},{name:"latestStatus",type:"auto"},{name:"latestResult",type:"auto"},{name:"comPortPool",type:"auto"},{name:"connectionType",type:"auto"},{name:"deviceType",type:"auto"},{name:"startedBetween",type:"auto"},{name:"finishedBetween",type:"auto"}]});Ext.define("Dsh.store.ConnectionTasks",{extend:"Ext.data.Store",requires:["Dsh.model.ConnectionTask"],model:"Dsh.model.ConnectionTask",autoLoad:false,remoteFilter:true,proxy:{type:"rest",url:"/api/dsr/connections",reader:{type:"json",root:"connectionTasks",totalProperty:"total"}}});Ext.define("Dsh.controller.Connections",{extend:"Ext.app.Controller",models:["Dsh.model.ConnectionTask","Dsh.model.CommTasks","Dsh.model.CommunicationTask","Dsh.model.Filter"],stores:["Dsh.store.ConnectionTasks","Dsh.store.CommunicationTasks"],views:["Dsh.view.Connections","Dsh.view.widget.PreviewConnection","Dsh.view.widget.CommunicationsList","Dsh.view.widget.PreviewCommunication"],refs:[{ref:"connectionsList",selector:"#connectionsdetails"},{ref:"connectionPreview",selector:"#connectionpreview"},{ref:"communicationList",selector:"#communicationsdetails"},{ref:"communicationContainer",selector:"#communicationcontainer"},{ref:"communicationPreview",selector:"#communicationpreview"},{ref:"commTasksTitle",selector:"#comtaskstitlepanel"},{ref:"filterPanel",selector:"#dshconnectionsfilterpanel"},{ref:"sideFilterForm",selector:"#dshconnectionssidefilter form"}],init:function(){this.control({"#connectionsdetails":{selectionchange:this.onSelectionChange},"#communicationsdetails":{selectionchange:this.onCommunicationSelectionChange},"#dshconnectionssidefilter button[action=applyfilter]":{click:this.applyFilter},"#dshconnectionsfilterpanel button[action=clear]":{click:this.clearFilter}});this.callParent(arguments)},showOverview:function(){var d=Ext.widget("connections-details");var b=this.getController("Uni.controller.history.Router");this.getSideFilterForm().loadRecord(b.filter);this.getApplication().fireEvent("changecontentevent",d);var a=this.getStore("Dsh.store.ConnectionTasks");var c=b.filter.getData();_.map(c,function(f,e){if(f){a.remoteFilter=true;a.addFilter(new Ext.util.Filter({property:e,value:f}))}});a.load()},onCommunicationSelectionChange:function(b,c){var d=this,a=c[0],e=d.getCommunicationPreview();a.data.devConfig={config:a.data.deviceConfiguration,devType:a.data.deviceType};a.data.title=a.data.name+" on "+a.data.device.name;e.setTitle(a.data.title);e.loadRecord(a)},onSelectionChange:function(b,c){var d=this,a=c[0],f=d.getConnectionPreview(),e=a.get("communicationTasks").communicationsTasks,g=Ext.create("Ext.data.Store",{model:"Dsh.model.CommunicationTask",data:e});f.loadRecord(a);f.setTitle(a.get("title"));d.getCommunicationContainer().removeAll(true);d.getCommunicationContainer().add({xtype:"preview-container",grid:{xtype:"communications-list",itemId:"communicationsdetails",store:g},emptyComponent:{xtype:"no-items-found-panel",title:Uni.I18n.translate("communication.widget.details.empty.title","DSH","No communications found"),reasons:[Uni.I18n.translate("communication.widget.details.empty.list.item1","DSH","No communications in the system."),Uni.I18n.translate("communication.widget.details.empty.list.item2","DSH","No communications found due to applied filters.")]},previewComponent:{xtype:"preview_communication",itemId:"communicationpreview"}});d.getCommTasksTitle().setTitle(Uni.I18n.translate("communication.widget.details.commTasksOf","DSH","Communication tasks of")+" "+a.get("title"));d.getCommunicationList().getSelectionModel().select(0)},applyFilter:function(){this.getSideFilterForm().updateRecord();this.getSideFilterForm().getRecord().save()},clearFilter:function(){this.getSideFilterForm().getRecord().destroy()}});Ext.define("Dsh.controller.history.Workspace",{extend:"Uni.controller.history.Converter",rootToken:"workspace",previousPath:"",currentPath:null,routeConfig:{workspace:{title:"Workspace",route:"workspace",disabled:true,items:{datacommunication:{title:"Data communication",route:"datacommunication",items:{communication:{title:"Communication overview",route:"communication",controller:"Dsh.controller.CommunicationOverview",action:"showOverview"},communications:{title:"Communications",route:"communications",controller:"Dsh.controller.Communications",action:"showOverview"},connection:{title:"Connection overview",route:"connection",controller:"Dsh.controller.ConnectionOverview",action:"showOverview"},connections:{title:"Connections",route:"connections",controller:"Dsh.controller.Connections",action:"showOverview",filter:"Dsh.model.Filter"}}}}}}});Ext.define("Dsh.controller.Main",{extend:"Ext.app.Controller",requires:["Ext.window.Window","Uni.controller.Navigation","Uni.controller.Configuration","Uni.controller.history.EventBus","Uni.model.PortalItem","Uni.store.PortalItems","Uni.store.MenuItems"],controllers:["Dsh.controller.history.Workspace","Dsh.controller.CommunicationOverview","Dsh.controller.ConnectionOverview","Dsh.controller.Connections"],config:{navigationController:null,configurationController:null},init:function(){this.initNavigation();this.initMenu()},initNavigation:function(){var a=this.getController("Uni.controller.Navigation"),b=this.getController("Uni.controller.Configuration");this.setNavigationController(a);this.setConfigurationController(b)},initMenu:function(){var b=this,a=b.getController("Uni.controller.history.Router"),c=b.getController("Dsh.controller.history.Workspace");Uni.store.MenuItems.add(Ext.create("Uni.model.MenuItem",{text:"Workspace",glyph:"workspace",portal:"workspace",index:30}));Uni.store.PortalItems.add(Ext.create("Uni.model.PortalItem",{title:"Data communication",portal:"workspace",route:"datacommunication",items:[{text:"Connections",href:a.getRoute("workspace/datacommunication/connections").buildUrl()},{text:"Connection overview",href:a.getRoute("workspace/datacommunication/connection").buildUrl()},{text:"Communications",href:a.getRoute("workspace/datacommunication/communications").buildUrl()},{text:"Communication overview",href:a.getRoute("workspace/datacommunication/communication").buildUrl()}]}))}});Ext.define("Dsh.model.Configuration",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"title",type:"string"}]});Ext.define("Dsh.model.Result",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"displayName",type:"string"},{name:"count",type:"int"}]});Ext.define("Dsh.model.TimeInfo",{extend:"Ext.data.Model",fields:[{name:"count",type:"int"},{name:"timeUnit",type:"int"}]});