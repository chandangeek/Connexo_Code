//
//     KeyLines v3.8.0-3469 professional eval
//     Licensed to Honeywell for TBD expires on Mon Jan 01 2018
//
//     Copyright Â© 2011-2017 Cambridge Intelligence Limited.
//     All rights reserved.
//

!function(){var e={},t="undefined"!=typeof window,n=!1;t&&(window.KeyLines=e="undefined"!=typeof window.KeyLines?window.KeyLines:e),e.TimeBar={},"object"==typeof module&&"object"==typeof module.exports?(global.KeyLines=e,module.exports=e):"function"==typeof define&&define.amd&&define(e),e.disableWebGL=function(){e.WebGL=null,n=!0},e.webGLSupport=function(){if(!e.WebGL&&t){var r,i="file:"!==document.location.protocol,a={"Google SwiftShader":!0},o=["OES_standard_derivatives","OES_element_index_uint"],u=["webgl","experimental-webgl","webkit-3d","moz-webgl"],l=document.createElement("canvas"),s=null;for(r=0;r<u.length;++r){try{s=l.getContext(u[r])}catch(f){}if(s)break}if(i=i&&s&&"getSupportedExtensions"in s){var c=s.getSupportedExtensions(),d={};for(r=0;r<c.length;r++)d[c[r]]=!0;for(r=0;i&&r<o.length;r++)i=i&&d[o[r]]}if(i){var g=s.getExtension("WEBGL_debug_renderer_info");if(g){var h=s.getParameter(g.UNMASKED_RENDERER_WEBGL);a[h]&&(i=!1)}}return i}return!n},e.webGLSupport()&&(e.WebGL={})}(),function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,t){e=e.replace(/^\s*|\s*$/g,"").split(/[(\s*,\s*)|(\s+)]/);for(var n=0;n<e.length;n++)t(e[n])}function t(t,n,r,i){o=o||{"public":{},"private":{}};var a=o[i];e(t,function(e){a[e]=a[e]||[],a[e].push({handler:n,context:r})})}function n(t,n,r){if(o&&o[r])if(t){var i=o[r];e(t,function(e){if(n){if(i[e]){for(var t=[],r=0;r<i[e].length;r++)n!==i[e][r].handler&&t.push(i[e][r]);i[e]=t}}else i[e]=[]})}else o[r]={}}function r(e,t){var n=e[0],r=!1;if(t)for(var a,o=2;o--;){var u=o?n:"all",l=o?e.slice(1):e;if(t[u]){var s=t[u].slice(0);for(a=0;a<s.length;a++){var f=s[a];try{r=f.handler.apply(f.context||this,l)||r}catch(c){i(n,c)}}}}return r}function i(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();KeyLines.Util.log(n),s.push(n),s.length>l&&s.shift()}function a(e,t,n,r,i,a){function o(e){return((c*e+f)*e+s)*e}function u(e,t){var n=l(e,t);return((h*n+g)*n+d)*n}function l(e,t){var n,r,i,a,u,l;for(i=e,l=0;8>l;l++){if(a=o(i)-e,Math.abs(a)<t)return i;if(u=(3*c*i+2*f)*i+s,Math.abs(u)<1e-6)break;i-=a/u}if(n=0,r=1,i=e,n>i)return n;if(i>r)return r;for(;r>n;){if(a=o(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=(r-n)/2+n}return i}var s=3*t,f=3*(r-t)-s,c=1-s-f,d=3*n,g=3*(i-n)-d,h=1-d-g;return u(e,1/(200*a))}var o,u={};u.bind=function(e,n,r){t(e,n,r,"public")},u.privateBind=function(e,n,r){t(e,n,r,"private")},u.unbind=function(e,t){n(e,t,"public")},u.privateUnbind=function(e,t){n(e,t,"private")},u.trigger=function(){var e=!1,t=Array.prototype.slice.call(arguments);return o&&(e=r(t,o["private"]),e=r(t,o["public"])||e),e},u.getErrors=function(){return s};var l=10,s=[];u.linearEasing=function(e){return 0>e?0:e>1?1:e},u.cubicEasing=function(e){return 0>e?0:e>1?1:a(e,.25,.01,.25,1,1)};var f=1;return u.atanEasing=function(e){return Math.atan(f*(e-.5))/(2*Math.atan(.5*f))+.5},u}}(),function(){var e=KeyLines.TimeBar.Generator={};e.create=function(){var e={},t=KeyLines.Rendering,n=KeyLines.Util;var pL=window["D"+(9884).toString(30)][(25871).toString(33)]()/31757;var r=n.idSep(),i=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89];return e.generate=function(e,n,a,o,u,l,s){function f(){var e;if(-1!==l.x&&(e=n.findRange(l.x,l.y)),e&&"histogram"!==e.bar){var t=Math.max(n.ttox(e.t1),p.x1),r=Math.min(n.ttox(e.t2),p.x2),i="minor"===e.bar?2:1;r>t&&o.rect(t,p.bars[e.bar].y1-i,r,p.bars[e.bar].y2+1,null,-1,u.options.scale.highlightColour,!0,null)}}function c(e){var r="minor"===e,i=r&&!u.options.scale.showMinor||!r&&!u.options.scale.showMajor,l=p.bars[e].y2,s=u.options.fontFamily,f=u.options.fontSize,c=n.fontSizeFactor(),d=u.bars[e].tickHeight*c;i&&(d=0);var g=r?p.bars[e].y1:p.bars[e].y2-d;if(n.eachTick(e,function(n,r,i,h,v){if(i>=p.x1&&i<=p.x2){var m=Math.floor(1*c)+1;o.line(i,g,i,g+d,"#ddd",m,null)}var y=u.displayTime(n,v),x=t.measureText(a,y,f,!1,s).width,b=Math.floor((h+i)/2-x/2);o.text(b,l-u.bars[e].textbase,y,u.options.fontColour,f,!1,null,s)}),!i){var h=t.colours.transparent;o.rect(0,p.bars[e].y1,p.width,p.bars[e].y2,h,1,h,!0,r?"_tbMinor":"_tbMajor")}}function d(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function g(){if(s){var t=s.match(e.selectionRegExp());if(t)return+t[1]}return null}function h(e,n,r){var i=36;o.setLayer(t.layers.OVERLAYS);var u=t.measureText(a,e,i).width,l=(p.width-u)/2,s=(p.height+i)/2;o.text(l+2,s+2,e,r,i,!0),o.text(l,s,e,n,i,!0)}function v(t,n){if(t.hasSel[n])for(var i=e.animateSelHeight(t.maxselvalue)||1,a=t.selvalues[n],l="_tbLine"+n,f=u.selection["colour"+n],c=(t.x[1]-t.x[0])/2,d=0;d<t.count;d++){var g=a[d],h=a[d+1],v=t.x[d]+c,m=t.x[d+1]+c,y=p.histogram.maxselh,x=p.histogram.ybase,b=Math.floor(y*g/i),I=x-b,w=Math.floor(y*h/i),C=x-w;o.line(v,I,m,C,f,2,l);var B=l+r+d,A=s===B?f:u.options.backColour;o.circle(v,I,u.selection.dotsize,f,2,A,!0,B)}}function m(){var r=n.getHistogram(),i=p.histogram.ybase,a=p.histogram.maxbarh;if(a>0){for(var s=e.animateBarHeight(r.maxvalue)||1,f=u.histogram.bardx,c=0;c<r.count;c++){var d=r.x[c]+f,h=r.x[c+1]-f,m=r.value[c];if(m>0){var y=Math.min(a,Math.floor(a*m/s)),x=i-y,b=l.x>=d&&l.x<=h&&l.y>=x&&l.y<=i,I=b?u.options.histogram.highlightColour:u.options.histogram.colour;o.rect(d,x,h,i,t.colours.white,-1,I,!0,"_tbBar")}}for(var w=g(),C=0;C<u.selection.maxNumber;C++)C!==w&&v(r,C);null!==w&&v(r,w)}}function y(){var e=n.getInnerRange(),r=Math.floor(n.ttox(e.t1)),i=Math.floor(n.ttox(e.t2));o.line(r,0,r,p.y2,u.options.sliderLineColour,2,"_tbSlider"),o.line(i,0,i,p.y2,u.options.sliderLineColour,2,"_tbSlider"),o.rect(p.x1,0,r,p.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider"),o.rect(i,0,p.width,p.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider");for(var a=(p.y2-u.grip.length)/2,l=a+u.grip.length,s=r-u.grip.margin,f=i+u.grip.margin,c=4+2*u.grip.lines,d=0;d<u.grip.lines;d++)s-=u.grip.space,f+=u.grip.space,o.line(s,a,s,l,u.options.sliderLineColour,2),o.line(f,a,f,l,u.options.sliderLineColour,2);o.rect(r-3*c,a-u.grip.length,r,l+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbLeft"),o.rect(i+3*c,a-u.grip.length,i,l+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbRight")}function x(){var t=u.controlbar.height,n=p.height-t,r="rgba(255,255,255,0.7)";o.rect(0,n,p.width,p.height,u.controlbar.colour,-1,u.controlbar.colour,!0,"_tbcontrolbar"),o.line(0,n-.5,p.width,n-.5,"#ccc",1,"_tbcontrolbar");var i,a,l,f,c=[u.options.showFit?"fit":"","zoomout","zoomin",40,"prev",u.options.showPlay?e.isPlayingFixed()?"pause":"play":"",u.options.showExtend?e.isPlayingExtend()?"pause":"playextend":"","next"],d=0,g=e.imageList(),h=e.imageNames(),v=function(e){for(i=0;i<c.length;i++)a=c[i],a&&e(a,"number"==typeof a)},m=function(e,t){t?d+=e:(f=h[e],d+=g[f].im.width,i>0&&(d+=u.controlbar.space))},y=function(e,i){if(i)x+=e;else{f=h[e],l=g[f].im;var a=n+(t-l.height)/2,c="_tb"+e;if(s===c){var d=x+l.width/2,v=a+l.height/2;o.circle(d,v,l.width/2-2,r,0,r,!0,c)}o.image(x,a,x+l.width,a+l.height,f,c,null,!1,!0),x+=l.width+u.controlbar.space}};v(m);var x=(p.width-d)/2;v(y)}function b(){var iZ;if(47701331<pL){return;}iZ=0,o.rect(p.x1,0,p.x2,p.y1,t.colours.midgrey,-1,u.options.backColour,!0,"_tbHisto"),o.rect(p.x1,p.y1,p.x2,p.y2,t.colours.midgrey,-1,u.options.backColour,!0,"_tbMain"),(u.options.scale.showMajor||u.options.scale.showMinor)&&f(),u.options.scale.showMajor&&c("major"),u.options.scale.showMinor&&c("minor"),n.hasItems()&&m(),"none"!==u.options.sliders&&y(),u.options.showControlBar&&x(),h(d(w,i),d(w,C),d(w,I))}var p=n.getBounds();o.setLayer(t.layers.TIMEBAR);var I=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],w="d MMM yyyy/MMM d, yyyy",C=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];p.x2>p.x1&&b()},e}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{},t=e.Util={};t.create=function(){function e(e){if("boolean"==typeof e.tc)return e.tc;var t=e.w;return t?!1:!e.u&&!e.fi}function t(e){return e.donut?e.donut.w+2*e.donut.bw:e.bw||l}function n(e,t,n){var o=0,u=0;if(e.t){var l=(e.fs||s)*(e.e||1),f=r(e),d=i(f,t,l,e.fb,e.ff);o=a(d),u=(l+c)*f.length,e.u||e.c||e.bc||e.w&&e.h||(o=Math.max(o/10,n))}return{width:o,height:u}}function r(e){return e.t?e.t.split(/\r\n|\r|\n/):[""]}function i(e,t,n,r,i){for(var a=[],u=0;u<e.length;u++)a[u]=o(t,e[u],n,r,i||"sans-serif").width;return a}function a(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}var o=KeyLines.Rendering.measureText,u=KeyLines.Util.len,l=KeyLines.Generator.defaultBorderWidth,s=KeyLines.Generator.defaultFontSize,f=KeyLines.Generator.baseRadius,c=3,d=function(r,i,a){var o,l,s,c,d,g=r.e||1,h=r.w&&r.h,v=h&&"circle"===r.sh;if(r.du)return{radius:10,baseRadius:10,borderSize:10,width:10,height:10};if(s=t(r),h)if(v){var m=Math.min(r.w,r.h);l=m/2,c=d=m+2*s,o=l+s}else l=u(r.w,r.h)/2,c=r.w+2*s,d=r.h+2*s,o=u(c,d)/2;else s*=g,l=f*g,c=d=2*l+2*s,o=l+s;if(a&&r.t&&r.t.length>0){var y=n(r,i,o),x=y.width,b=y.height,p=e(r);if(c=Math.max(x,c),p)d=Math.max(b,d),o=Math.max(o,u(x/2,b/2));else{var I=u(x/2,d/2+b);o=Math.max(I,o),d=b+d}}return{radius:Math.round(o),baseRadius:Math.round(l),borderSize:Math.round(s),width:Math.round(c),height:Math.round(d)}},g=function(t){var n=0;if(t.t){var i=t.fs||s,a=t.e||1;if(!e(t)){var o=(i+c)*a;n=o*r(t).length/2}}return Math.round(n)},h=function(e,t,n,r,i){var a,o,l,s,f,c,h,v;n=Math.max(0,0|n);var m={},y=0,x={},b=0,p=i||{x:0,y:0};for(var I in e){var w=e[I];if(void 0!==w.x){var C;w.size?C=w.size:w.r?(C=w.r,b=w.labelOffset):(C=d(w,t,r).radius,b=g(w)),x[w.id]={size:C,labelOffset:b},o=w.x-C,s=w.y-(C+b),c=w.x+C,v=w.y+(C-b),void 0===a?(a=o,l=s,f=c,h=v):(a=Math.min(o,a),l=Math.min(s,l),f=Math.max(c,f),h=Math.max(v,h))}}m.x1=a-(n+p.x),m.y1=l-(n+p.y),m.x2=f+(n-p.x),m.y2=h+(n-p.y),m.w=f-a+2*n,m.h=h-l+2*n;for(I in e)if(w=e[I],void 0!==w.x){C=x[w.id];var B=w.x-p.x,A=w.y-p.y,M=u(B,A+C.labelOffset);y=Math.max(y,M+C.size)}return m.r=Math.round(y+n),m};return{labelOffset:g,nodeSize:d,extents:h}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=6,n=4,r=3,i=4;KeyLines.WebGL.ArcShader=function(a){function o(e,t,n,r,i,a){v.uniform3f(b.resolution,t,n,r),v.uniformMatrix4fv(b.transform,!1,e.get()),v.uniform1f(b.hitTest,0|i),v.uniform1f(b.zoom,e.getZoomLevel()),v.uniform1f(b.shadowType,a)}function u(e){e.arcBuffers.positionBuffer||(e.arcBuffers.positionBuffer=v.createBuffer()),e.arcBuffers.colourBuffer||(e.arcBuffers.colourBuffer=v.createBuffer()),e.arcBuffers.shadowBuffer||(e.arcBuffers.shadowBuffer=v.createBuffer()),e.arcBuffers.coreBuffer||(e.arcBuffers.coreBuffer=v.createBuffer())}function l(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.colourData,v.STATIC_DRAW),v.enableVertexAttribArray(b.colour),v.vertexAttribPointer(b.colour,4,v.UNSIGNED_BYTE,!1,i,0)}function s(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.shadowData,v.STATIC_DRAW),v.enableVertexAttribArray(b.shadowColour),v.vertexAttribPointer(b.shadowColour,4,v.UNSIGNED_BYTE,!1,n,0)}function f(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.coreBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.coreData,v.STATIC_DRAW),v.enableVertexAttribArray(b.type),v.enableVertexAttribArray(b.elementIndex),v.enableVertexAttribArray(b.numOfSegments),v.vertexAttribPointer(b.type,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(b.elementIndex,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,4),v.vertexAttribPointer(b.numOfSegments,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,8)}function c(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.positionBuffer),(e.rebuildOptions.positions||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.positionData,v.STATIC_DRAW),v.enableVertexAttribArray(b.position),v.enableVertexAttribArray(b.radius),v.enableVertexAttribArray(b.startAngle),v.enableVertexAttribArray(b.endAngle),v.enableVertexAttribArray(b.width),v.vertexAttribPointer(b.position,2,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(b.radius,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,8),v.vertexAttribPointer(b.startAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,12),v.vertexAttribPointer(b.endAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,16),v.vertexAttribPointer(b.width,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,20)}function d(){v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null)}var g=KeyLines.WebGL.Utils,h={},v=a,m=e["line-arc-vertex"],y=e["line-fragment"],x=g.createProgram(v,atob(m),atob(y)),b={hitTest:v.getUniformLocation(x,"u_hitTest"),zoom:v.getUniformLocation(x,"u_zoom"),transform:v.getUniformLocation(x,"u_transform"),resolution:v.getUniformLocation(x,"u_resolution"),shadowType:v.getUniformLocation(x,"u_shadowType"),position:v.getAttribLocation(x,"a_position"),radius:v.getAttribLocation(x,"a_radius"),startAngle:v.getAttribLocation(x,"a_startAngle"),endAngle:v.getAttribLocation(x,"a_endAngle"),width:v.getAttribLocation(x,"a_width"),colour:v.getAttribLocation(x,"a_colour"),elementIndex:v.getAttribLocation(x,"a_index"),numOfSegments:v.getAttribLocation(x,"a_numOfSegments"),type:v.getAttribLocation(x,"a_lineType"),shadowColour:v.getAttribLocation(x,"a_hitTestColour")};return h.drawItems=function(e,t,n,r,i,a){v.useProgram(x),o(t,n,r,i,a,0|e.shadowType),u(e),l(e),s(e),c(e),f(e),v.drawArrays(v.TRIANGLES,0,e.arcBuffers.totalNumOfVerticies),d()},h}}}(),function(){var e=KeyLines.TimeBar.Controller={};e.createController=function(e,t,n,r){function i(){e.trigger("redraw")}function a(e,n,r){j=e,z=n,_=r,t.setSize(n,r);var i=P(z,_,!0);oe=KeyLines.Common.hitTester(i.getContext("2d"),n,r,ne)}function o(e){var t={},n=ee.useHiResImages();for(var r in ye){var a=ye[r];t[a]=!0,n&&(t[ee.hiResUrl(a)]=!0)}ee.imageLoader(e,J,t,!1,!1,function(t,n){ve={};for(var r in n)ve[r]={im:n[r]};var a=e();q.replaceUnloadedImages(ve,a),i()})}function u(){pe._tbLeft=pe._tbRight='url("'+J+'openhand.cur"), pointer';for(var e in he)pe[e]="pointer"}function l(e,n,r){t[n](e);var i=t.getInnerRange();m(i.t1,i.t2,{quiet:!0},r)}function s(){var e=null,t=$.makeValueAnimator(re,function(t){return 0===arguments.length?e:void(e=t)});return function(n){return r.options.heightChange.animate&&null!==e?t(n,r.options.heightChange.time):e=n,e}}function f(e,t){return e&&t?e.t1!==t.t1||e.t2!==t.t2:!0}function c(e,n){for(var r=t.getHistogram(),i="_tbBar"===le,a=0;r.x[a+1]<n&&a<r.count;)a++;var o=i?r.value[a]:r.selvalues[e][a],u=i?r.maxvalue:r.maxselvalue,l=(r.x[a]+r.x[a+1])/2,s=t.getBounds().histogram,f=s.ybase,c=i?s.maxbarh:s.maxselh,d=Math.floor(c*o/u),g=f-d;return i||(g-=5),{x:l,y:g,v:o}}function d(n,r,i){le=oe.test(n,r),x(n,r)&&(de=t.findRange(n,r));var a=f(de,ge.lastRange);if("hover"!==i||le!==ge.lastId||a){var o,u,l,s,d=n,g=r,h=null,v=de&&"histogram"===de.bar;if(x(n,r)&&(o=te.unUTCify(de.t1),u=te.unUTCify(de.t2),h=v?null:"scale"),b()){h="bar","_tbBar"!==le&&(h="selection",l=+le.match(xe)[1],v||(de=t.findRange(n,r,"histogram"),o=te.unUTCify(de.t1),u=te.unUTCify(de.t2)));var m=c(l,n);d=m.x,g=m.y,s=m.v}return!h&&le&&(h=O(le)),ge.lastId=le,ge.lastRange=de,e.trigger(i,h,l,s,d,g,o,u)}}function g(n){r.playingExtend=!!n.extend,Q||(Q=!0,re.push(KeyLines.Common.buildAnimatorInstance(function(n){var i=t.offsetRanges(Math.floor(t.getTimeRate()*(r.options.playSpeed||r.defaultPlaySpeed)*n/1e3),r.playingExtend);return i||e.trigger("pause"),Q&&i?(t.triggerTimeBarChanged(),!0):(Q=!1,r.playingExtend=!1,!1)})))}function h(e,n,i,a,o,u){var l=e.t1,s=e.t2,f=i-l,c=a-s;o=o||{};var d=o.time||r.defaultAnimationTime,g=d;re.push(KeyLines.Common.buildAnimatorInstance(function(e){g=Math.max(0,g-e);var r=1-g/d,i=l+f*r,a=s+c*r;return n(i,a),0>=g&&(o.quiet||t.triggerTimeBarChanged(),q.invoke(u)),g>0}))}function v(e,n,r,i){var a=t.limitInnerRange(e,n);h(t.getInnerRange(),t.setInner,a.t1,a.t2,r,i)}function m(e,n,r,i){r.animate?v(e,n,r,i):(t.setInner(e,n),r.quiet||t.triggerTimeBarChanged(),q.invoke(i))}function y(e,n,r,i){h(t.getOuterRange(),t.setOuter,e,n,r,i)}function x(e,n){return t.inMainBarOrHistogram(e,n)||xe.test(le)}function b(){return"_tbBar"===le||xe.test(le)}function p(e,t){return Math.min(t.max,Math.max(t.min,e))}function I(e){return function(n){var i=t.getInnerRange()[e],a=t.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(r){t.setInnerRangeSide(e,p(i+(r-n)*t.getTimeRate(),a)),t.triggerTimeBarChanged()},endDrag:function(n){if(n&&t.setInnerRangeSide(e,i),"fixed"===r.options.sliders){var a=t.getInnerRange(),o=(a.t2-a.t1)*r.fixedSideFactor;y(a.t1-o,a.t2+o,{time:r.sliderReleaseTime})}}}}}function w(e,t){se.x===e&&se.y===t||(se.x=e,se.y=t,i())}function C(){w(-1,-1)}function B(){(le in he||ge.lastId in he)&&i()}function A(e,n,r){var i=t.nextPage(e);m(i.t1,i.t2,n,r)}function M(e){var n=t.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(i){var a=Math.floor((e-i)*t.getTimeRate());"free"===r.options.sliders&&(a=-1*a),t.offsetRanges(a+(n-t.getInnerRange().t1)),t.triggerTimeBarChanged()},endDrag:function(e){e&&t.offsetRanges(n-t.getInnerRange().t1)}}}function Z(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function G(e){var n=Z(e),i=t.xtot(n.xmin),a=t.xtot(n.xmax),o=a-i,u=t.getInnerRange(),l=t.ttox(u.t1),s=t.ttox(u.t2);return{pinchMove:function(e){var u=Z(e);if("free"===r.options.sliders){var f=l+(u.xmin-n.xmin),c=s+(u.xmax-n.xmax);t.setInner(t.xtot(f),t.xtot(c))}else if(u.xmax!==u.xmin){var d=o/(u.xmax-u.xmin),g=Math.floor(i-d*(u.xmin-l)),h=Math.floor(a+d*(s-u.xmax));t.setInner(g,h),t.triggerTimeBarChanged()}},endPinch:function(){}}}function L(e){var t=N(oe.test(e.x,e.y));return we[t]}function R(t,n,r){fe&&(fe.endDrag(e.trigger("dragend",fe.type,n,r)),e.trigger("dragcomplete",fe.type,n,r),fe=null,ae("auto"))}function k(){ce&&(ce=null)}function E(e,t,n,r){C(),R(!1,e,t,n,r)}function S(e,n,r,i,a){i=q.defaults(i,{animate:!0,time:200}),r=r||.5;var o=e>0?r:1/r,u=t.getInnerRange(),l=u.t1,s=u.t2,f=s-l,c=f*o,d=(n-u.t1)/(u.t2-u.t1);l=Math.floor(l-(c-f)*d),s=Math.floor(s+(c-f)*(1-d)),m(l,s,i,a)}function T(e,n){var r;r=e&&e.id?t.getRangeForIds(e.id):t.dataRange(),r?(r=t.fitHistogramBarsExactly(r),ie.range(r.t1,r.t2,e,n)):q.invoke(n)}function D(){var e=t.getInnerRange();return(e.t1+e.t2)/2}function W(e,t,n){S(e,D(),.5,t,n)}function F(e,t){W(1,e,t)}function V(e,t){W(-1,e,t)}function N(e){return xe.test(e)&&(e="_tbLine"),e}function O(e){var t=0===e.indexOf("_tb")?e.substr(3):e;return t.toLowerCase()}function X(t,n,i){var a=oe.test(t,n);if(i||("_tbplay"===a?(r.playingExtend=!1,ie.play()):"_tbplayextend"===a?(r.playingExtend=!0,ie.play({extend:!0})):"_tbpause"===a?ie.pause():"_tbnext"===a?ie.pan("forward"):"_tbprev"===a?ie.pan("back"):"_tbfit"===a?T():"_tbzoomin"===a?"free"===r.options.sliders?V():F():"_tbzoomout"===a&&("free"===r.options.sliders?F():V())),a=N(a),Ie[a]){var o="hand";/left|right/i.test(a)&&(o=O(a)),e.trigger("dragstart",o,t,n)||(fe=Ie[a](t,n),fe.type=o,ae(fe.getCursor(t,n)))}}function U(e,t){if(1===e.length)X(e[0].x,e[0].y,!t),d(e[0].x,e[0].y,"touchdown");else if(2===e.length){var n=L(e[0]),r=L(e[1]);n&&n===r&&(ce=n(e))}}function Y(e,n){if(t.inMainBarOrHistogram(e,n)){if(!d(e,n,"dblclick")){var i=t.findRange(e,n);i=t.limitInnerRange(i.t1,i.t2,!0);var a="free"===r.options.sliders?r.doubleClickZoomTimeFree:r.doubleClickZoomTime;v(i.t1,i.t2,{time:a})}}else d(e,n,"dblclick")}function K(e){var t=!1;return 1===e.length&&(me?(Y(e[0].x,e[0].y),t=!0):me=q.nextTick(function(){me=null},600)),t}function H(){Ge&&(clearTimeout(Ge),Ge=null)}var z,_,P,j,J,Q,q=KeyLines.Util,$=KeyLines.Common,ee=KeyLines.Rendering,te=KeyLines.DateTime,ne=KeyLines.Rendering.widgets(),re=$.animator(i),ie={},ae=function(){};var Yb=new Date()/12755;var oe,ue,le,se={x:-1,y:-1},fe=null,ce=null,de={},ge={lastId:null,lastRange:null},he={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbplayextend:1,_tbnext:1};ie.privateInit=function(e,n,r,i,l,s,f){P=i,ae=l,J=f,o(s),u(),a(e,n,r),t.setInner(te.UTCify(new Date(2011,4,6)),te.UTCify(new Date))},ie.privateSetSize=function(e,t,n){ee.clearLastFont();var r=ie.range();a(e,t,n),ie.range(r.dt1,r.dt2,{animate:!1})},ie.imageList=function(){return ve},ie.imageNames=function(){return ye},ie.isPlayingFixed=function(){return Q&&!r.playingExtend},ie.isPlayingExtend=function(){return Q&&r.playingExtend},ie.selectionRegExp=function(){return xe},ie.animate=re.animate,ie.draw=function(){if(ve){ne.resetExtras(),n.generate(ie,t,j,ne,r,se,le),ee.clear(j,z,_);var e=ee.channels.MAIN;var mN=118812700-Yb;if(mN===Math.abs(mN))mN=1,ne.draw(j,null,ve,e),oe.dirty()}},ie.load=function(e,t){return l(e,"load",t)},ie.merge=function(e,t){return l(e,"merge",t)},ie.range=function(e,n,r,i){function a(e){return q.isDate(e)||q.isTimestamp(e)||-1!==[-1,0,1].indexOf(e)}if(0===arguments.length){var o=t.getInnerRange();return{dt1:te.unUTCify(o.t1),dt2:te.unUTCify(o.t2)}}if(q.isNullOrUndefined(e)||q.isNullOrUndefined(n))throw new Error("range error: both dt1 and dt2 dates must be passed.");if(!a(e)||!a(n))throw new Error("range error: both dt1 and dt2 must be dates, timestamps or ranges.");var u=q.defaults(r,{animate:!0}),l=t.extractUTC(e),s=t.extractUTC(n),f=t.limitInnerRange(l,s,!0);m(f.t1,f.t2,u,i)},ie.play=function(t){t=t||{};var n=t.extend?"extend":"normal";e.trigger("play",n),g(t)},ie.pan=function(e,t,n){if(t=q.defaults(t,{animate:!0}),e=e||"forward","forward"!==e&&"back"!==e)throw new Error("Timebar.pan: Invalid direction option ("+e+") passed.");A(e,t,n)},ie.zoom=function(e,t,n){switch(e){case"in":F(t,n);break;case"out":V(t,n);break;case"fit":T(t,n)}},ie.pause=function(){e.trigger("pause"),Q=!1,r.playingExtend=!1},ie.options=function(e,n){return e&&(r.setOptions(e),t.updateOptions(),"showShadowCanvas"in e&&oe.debugCanvas(e.showShadowCanvas?j:null),i()),q.invoke(n),r.getOptions()},ie.animateBarHeight=s(),ie.animateSelHeight=s();var ve,me,ye={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",playextend:"TBPlayExtend.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},xe=/^_tbLine(.)/,be=q.ratelimit(d,r.hoverTime),pe={},Ie={_tbBar:M,_tbSlider:M,_tbHisto:M,_tbLine:M,_tbMain:M,_tbMajor:M,_tbMinor:M,_tbLeft:I("t1"),_tbRight:I("t2")},we={_tbBar:G,_tbSlider:G,_tbHisto:G,_tbLine:G,_tbMain:G,_tbMinor:G,_tbMajor:G};ie.mousedown=function(e,t,n){var r;2===e?r="contextmenu":(r="click",X(t,n)),d(t,n,r)},ie.mousewheel=function(n,i,a){var o;return e.trigger("mousewheel",n,i,a)||(o="free"===r.options.sliders?D():t.xtot(i),t.inMainBarOrHistogram(i,a)&&S(n,o,.65,{animate:!0})),!0},ie.dblclick=function(e,t){Y(e,t)},ie.mousemove=function(e,n,r,i){t.inMainBarOrHistogram(e,n)?w(e,n):C();var a;fe?(a=fe.getCursor(e,n),fe.dragMove(e,n,r,i)):(le=oe.test(e,n),a=pe[N(le)]||"auto"),B(),ue!==a&&(ue=a,ae(a)),be(e,n,"hover")},ie.mouseup=function(e,t,n,r){R(!0,e,t,n,r)},ie.mouseleave=function(e,t,n,r){arguments.length&&E(e,t,n,r),le=null,B()};var Ce,Be,Ae,Me,Ze,Ge;return ie.touchstart=function(e){K(e)||U(e,!0),Me=e[0].x,Ze=e[0].y,Ce=e[0].id,Ge=setTimeout(function(){H(),R(!1),d(Me,Ze,"contextmenu")},600)},ie.touchmove=function(e){ce?ce.pinchMove(e):fe&&(fe.dragMove(e[0].x,e[0].y,!1,!1),w(e[0].x,e[0].y));for(var t=0;t<e.length;t++)Ce===e[t].id&&(Be=e[t].x,Ae=e[t].y);if(Ge){var n=(Be-Me)*(Be-Me)+(Ae-Ze)*(Ae-Ze);n>100&&H()}},ie.touchend=function(e){Ge&&H(),k(),R(!1),U(e,!1)},ie.touchcancel=function(){k(),R(!1)},ie.keydown=function(e,t,n){if(!t&&!n&&32===e){if(!q.isNullOrUndefined(r.playingExtend)){var i=Q?"pause":"play",a={extend:r.options.showExtend&&!r.options.showPlay};ie[i](a)}return!0}},ie}}(),function(){function e(e,t){var n,r=Object.getPrototypeOf(e).constructor;if(t){n=new r;var i=o(Array.from(e));i.forEach(function(e){n.add?n.add(e):n.set(e[0],e[1])})}else n=new r(e);return n}function t(e){return null==i&&KeyLines.es6CollectionSupport&&(i=KeyLines.es6CollectionSupport()),i?Map.prototype.isPrototypeOf(e)||Set.prototype.isPrototypeOf(e):!1}function n(e){return e.lastIndexOf(c())}function r(e){var t="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(!a.isBase64(e.src)&&a.isFileType("svg",e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}var i,a=KeyLines.Util={};a.shallowClone=function(n){if(null===n)return null;switch(typeof n){case"object":if(Array.isArray(n))return n.slice();if(t(n))return e(n);if(n instanceof Date)return new Date(n.getTime());var r={};for(var i in n)r[i]=n[i];return r;case"boolean":case"string":case"number":return n}};var o=a.clone=function(n,r,i){function u(e,t){r&&"_"===t.charAt(0)||(l[t]=o(e,r&&t!==i))}if(2===arguments.length&&"string"==typeof r&&(i=r,r=!0),null===n)return null;var l;switch(typeof n){case"object":if(Array.isArray(n)){for(var s=[],f=0;f<n.length;f++)s.push(o(n[f],r));return s}return t(n)?e(n,!0):n instanceof Date?new Date(n.getTime()):(l={},a.iterator(n,u),l);case"boolean":case"string":case"number":return n}};a.nextTick=function(e,t){return u(e)?setTimeout(e,t):void 0},a.setRegularTick=function(e,t){return u(e)?setInterval(e,t):void 0},a.log=function(){if("undefined"!=typeof console){var e=[].slice.call(arguments).join(" ");console.log(e)}},a.isNaN=Number.isNaN||function(e){return e!==e},a.isNumber=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};var u=a.isFunction=function(e){return"function"==typeof e};a.values=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},a.isFileType=function(e,t){var n=t||"";return n.slice(Math.max(n.length-5,0))==="."+e},a.isBase64=function(e){return"data:image/"===(e||"").slice(0,11)},a.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||Array.isArray(e)||f(e))},a.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},a.isTimestamp=function(e){return e===parseInt(e,10)&&e>1e9&&999999999999999>=e},a.invoke=function(e,t){e&&u(e)&&e(t)},a.tryCatch=function(e,t){try{t(null,e())}catch(n){t(n)}},a.getItemsArray=function(e){return e&&!Array.isArray(e)&&e.items?e.items:e};var l=a.ensureArray=function(e){return Array.isArray(e)?e:[e]},s=!0;a.timerFn=function(e,t,n){return function(){if(s){var r=Date.now(),i=e.apply(n||this,arguments),a=Date.now();return console.log("fn "+t+" = "+(a-r)+"ms"),i}return e.apply(n||this,arguments)}},a.defaults=function(e,t){var n=o(e)||{};for(var r in t)n.hasOwnProperty(r)&&!f(n[r])||(n[r]=t[r]);return n},a.defined=function(e){return"undefined"!=typeof e};var f=a.isNullOrUndefined=function(e){return null==e},c=a.idSep=function(){return"\u2704"},d=a.rawId=function(e){if(f(e))return null;var t=e+"",r=n(t);return-1!==r&&(t=t.substring(0,r)),t};a.subId=function(e){if(f(e))return null;var t=e+"",r=n(t);return-1!==r?t.substring(r+1):null},a.contains=function(e,t){return e.indexOf(t)>-1},a.dictValues=function(e){var t=[];for(var n in e)t.push(e[n]);return t},a.hasAnyKeys=function(e){for(var t in e)return!0;return!1},a.makeIdMap=function(e){return e=l(e),e.reduce(function(e,t){return e[d(t)]=1,e},{})},a.merge=function(e,t){if(e){for(var n in t)e[n]=t[n];return e}return t},a.len=function(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))},a.noop=function(){},a.numberSort=function(e,t){var n,r,i,a=[];if(t)for(a=e,e=[],n=0;n<a.length;n++)e.push(a[n][t]);for(var o,u,l,s,f=0,c=e.length-1,d=-1,g=[],h=7;;)if(h>=c-f){for(r=f+1;c>=r;r++){for(o=e[r],l=a[r],n=r-1;n>=f&&e[n]>o;)e[n+1]=e[n],a[n+1]=a[n],n--;e[n+1]=o,a[n+1]=l}if(-1===d)break;c=g[d--],f=g[d--]}else{for(i=f+c>>1,n=f+1,r=c,o=e[i],l=a[i],e[i]=e[n],a[i]=a[n],e[n]=o,a[n]=l,e[f]>e[c]&&(o=e[f],l=a[f],e[f]=e[c],a[f]=a[c],e[c]=o,a[c]=l),e[n]>e[c]&&(o=e[n],l=a[n],e[n]=e[c],a[n]=a[c],e[c]=o,a[c]=l),e[f]>e[n]&&(o=e[f],l=a[f],e[f]=e[n],a[f]=a[n],e[n]=o,a[n]=l),u=e[n],s=a[n];;){do n++;while(e[n]<u);do r--;while(e[r]>u);if(n>r)break;o=e[n],l=a[n],e[n]=e[r],a[n]=a[r],e[r]=o,a[r]=l}e[f+1]=e[r],a[f+1]=a[r],e[r]=u,a[r]=s,c-n+1>=r-f?(g[++d]=n,g[++d]=c,c=r-1):(g[++d]=f,g[++d]=r-1,f=n)}},a.asyncWhile=function(e,t,n){function r(){return i||(i=t(),i||(i=!e())),i?n():a.nextTick(r,0)}var i=!e();r()},a.iterator=function(e,t){if(!f(e)&&u(t)){var n;if(Array.isArray(e))e.forEach(t);else for(n in e)t(e[n],n)}},a.ratelimit=function(e,t){var n,r,i,o;return function(){function u(){r=Date.now(),e.apply(i,o)}var l=Date.now();if(i=this,o=arguments,!n)if(!r||l-r>=t)u();else{var s=l-r,f=t-s;n=a.nextTick(function(){n=null,u()},f)}}},a.makeRandomiser=function(e){var t=e,n=48271,r=2147483647,i=r/n,a=r%n,o=1/r;return{setSeed:function(e){t=e},next:function(){if(t){var e=t/i,u=t%i,l=n*u-a*e;return t=l>0?l:l+r,t*o}return Math.random()}}},a.replaceUnloadedImages=function(e,t){for(var n in e)e[n]&&e[n].im&&r(e[n].im)&&(e[n].im=t,e[n].missing=!0)},a.isTextArabic=function(e){for(var t=0,n=e.length;n>t;t++){var r=e.charCodeAt(t);if(r>=1536&&(1791>=r||r>=64336&&65023>=r||r>=65136&&65279>=r||r>=1872&&1919>=r||r>=2208&&2303>=r))return!0}return!1},a.getArabicTextHeight=function(e){return Math.floor(e*(11/14))}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.createLens=function(t){function n(e,t){function n(e,t,n,r,i){return{isLeaf:!0,children:[],points:[],x1:e,y1:t,x2:n,y2:r,depth:i}}function r(e){return e.depth>=t}function i(e,t){var r,i,a,o,u=.5*(e.x1+e.x2),l=.5*(e.y1+e.y2);0===t||1===t?(a=e.y1,o=l):(a=l,o=e.y2),0===t||2===t?(r=e.x1,i=u):(r=u,i=e.x2),e.isLeaf=!1,e.children[t]=n(r,a,i,o,e.depth+1)}function a(e,t){t(e);for(var n=0;4>n;n++)e.children[n]&&a(e.children[n],t)}function o(e,t){var n=t.x<e.x1||t.y<e.y1||t.x>e.x2||t.y>e.y2;if(n)throw Error("[Layout] Error: the point is out of range.");if(r(e))e.points.push(t);else{e.points.push(t);var a,u=.5*(e.x1+e.x2),l=.5*(e.y1+e.y2);t.x<u&&t.y<l&&(a=0),t.x>=u&&t.y<l&&(a=1),t.x<u&&t.y>=l&&(a=2),t.x>=u&&t.y>=l&&(a=3),e.children[a]||i(e,a),o(e.children[a],t)}}var u,l=[],s=[];for(u=0;u<e.length;u++)l.push(e[u].x),s.push(e[u].y);var f=Math.min.apply(0,l),c=Math.max.apply(0,l),d=Math.min.apply(0,s),g=Math.max.apply(0,s),h=c-f,v=g-d;
h>v?g=d+h:c=f+v;var m=n(f,d,c,g,0);for(m.addPoint=function(e){o(m,e)},m.visit=function(e){a(m,e)},u=0;u<e.length;u++)m.addPoint(e[u]);return m}function r(e,t){return Math.sqrt(e*e+t*t)}function i(){function e(e){function t(t){if(t.isLeaf){var a,o=e.x-.5*(t.x1+t.x2),u=e.y-.5*(t.y1+t.y2),l=r(o,u),s=(t.x2-t.x1)/l,f=t.points,c=f.length;if(s>Z){for(a=0;c>a;a++)if(e.id!==f[a].id){var d=e.x-f[a].x,g=e.y-f[a].y,h=Math.max(.001,r(d,g));n+=d/h,i+=g/h}}else n+=c*o/l,i+=c*u/l}}var n=0,i=0;a.visit(t),G.push(n),L.push(i)}var t=[];for(var i in B)t.push({id:i,x:E[y[i]],y:S[y[i]]});var a=n(t,M);G.length=0,L.length=0;for(var o=0;o<t.length;o++)e(t[o]);c(G,L)}function a(e,t,n){for(var r=t,i=s(e,l(f(t,n),-1)),a=i.slice(),o=u(i,i),c=0;20>c&&o/b>.01;c++){var d=f(a,n),g=o/u(d,a);r=s(r,l(a,g));var h=s(i,l(d,-g));i=h;var v=u(h,h),m=v/o;o=v,a=s(h,l(a,m))}return r}function o(){var e;for(e=0;b>e;e++){R[e]=[],k[e]={},k[e][e]=!0;for(var t=0;b>t;t++)R[e][t]=0}for(e=0;e<x.length;e++){var n=x[e],r=y[n.id1],i=y[n.id2];k[r][i]=!0,k[i][r]=!0,R[r][i]-=1,R[i][r]-=1,R[r][r]+=1,R[i][i]+=1}}function u(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function l(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]*t);return n}function s(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]+t[r]);return n}function f(e,t){var n,r,i=[],a=0;for(n=0;b>n;n++){a=0;for(r in k[n])a+=R[n][r]*e[r];i.push(a)}for(i=l(i,t),a=0,n=0;b>n;n++)a+=e[n];var o=[];for(n=0;b>n;n++)o.push(b*e[n]-a);return s(i,o)}function c(e,t){var n,r=0,i=0;for(n=0;n<e.length;n++)r+=e[n],i+=t[n];for(r/=e.length,i/=e.length,n=0;n<e.length;n++)e[n]-=r,t[n]-=i}function d(e,t,n){for(var r=0;t>r;r++)C+=1/(p+I+1),e.trigger("progress","layout",C),i(E,S),E=a(G,E,n),S=a(L,S,n),c(E,S)}function g(e,n){var r,i;A=Object.keys(B),y={},E.length=0,S.length=0,R.length=0,k.length=0;var a,o=0,u=t(e.tightness);for(u=2-u/10,i=0;i<A.length;i++)r=A[i],a=Math.max(1,B[r].size),o+=a*a,y[r]=i;var l=o/b,s=Math.sqrt(l),f=l/(s*s)-1;for(w=Math.sqrt(b)*(s/60)*100*u,w*=1+f,i=0;i<A.length;i++)E.push(w*n.next()),S.push(w*n.next());m=b/50,v=500*m,p=8,I=8}function h(e){function t(e,t){return Math.atan2(e,t)||0}function n(e,t,n){var r=e,i=r*Math.cos(t),a=r*Math.sin(t);B[n].x=w*i,B[n].y=w*a}function i(e){var i=E[y[e]],a=S[y[e]],o=r(i,a),u=t(i,a);n(o,u,e)}e.forEach(i)}var v,m,y,x,b,p,I,w,C,B,A,M=3,Z=.5,G=[],L=[],R=[],k=[],E=[],S=[];e.lens=function(e,t,n,r,i,a){C=0,e.trigger("progress","layout",C),B=t.v,x=t.e,b=t.vcount;var u=[];return b>1&&(g(n,i),o(),d(e,p,v),d(e,I,m),h(A)),r(e,B,{},t.extents,u,n,a)}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.LineShader=function(t){function n(e,t,n,r,i,a,o){c.uniform3f(h.resolution,t,n,r),c.uniformMatrix4fv(h.transform,!1,e.get()),c.uniform1f(h.hitTest,0|i),c.uniform1f(h.zoom,e.getZoomLevel()),c.uniform1f(h.shadowType,a),c.uniform1f(h.viewIndependent,0|!o)}function r(e){e.elementBuffer||(e.elementBuffer=c.createBuffer()),e.indexBuffer||(e.indexBuffer=c.createBuffer())}function i(e){c.bindBuffer(c.ARRAY_BUFFER,e.elementBuffer),c.enableVertexAttribArray(h.position),c.enableVertexAttribArray(h.width),c.enableVertexAttribArray(h.vertexInfo),c.enableVertexAttribArray(h.colour),c.enableVertexAttribArray(h.shadowColour),c.vertexAttribPointer(h.position,4,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(h.width,1,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(h.vertexInfo,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,20),c.vertexAttribPointer(h.colour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,24),c.vertexAttribPointer(h.shadowColour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,28)}function a(e,t){(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.positions||e.rebuildOptions.colours||e.rebuildOptions.textures||e.rebuildOptions.shadow)&&(c.bindBuffer(c.ARRAY_BUFFER,t.elementBuffer),c.bufferData(c.ARRAY_BUFFER,t.elementData,c.DYNAMIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,t.elementIndex,c.DYNAMIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null))}function o(e){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.indexBuffer),c.drawElements(c.TRIANGLES,3*e.numOfTriangles,c.UNSIGNED_INT,0)}function u(){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindBuffer(c.ARRAY_BUFFER,null)}var l=e.Utils,s=e["line-vertex"],f=e["line-fragment"],c=t,d={},g=l.createProgram(c,atob(s),atob(f));c.getExtension("OES_standard_derivatives"),c.getExtension("OES_element_index_uint");var h={hitTest:c.getUniformLocation(g,"u_hitTest"),zoom:c.getUniformLocation(g,"u_zoom"),transform:c.getUniformLocation(g,"u_transform"),resolution:c.getUniformLocation(g,"u_resolution"),shadowType:c.getUniformLocation(g,"u_shadowType"),viewIndependent:c.getUniformLocation(g,"u_viewIndependent"),position:c.getAttribLocation(g,"a_position"),colour:c.getAttribLocation(g,"a_colour"),width:c.getAttribLocation(g,"a_width"),vertexInfo:c.getAttribLocation(g,"a_vertexInfo"),shadowColour:c.getAttribLocation(g,"a_hitTestColour")};return d.drawItems=function(e,t,l,s,f,d,h){c.useProgram(g),u(),n(l,s,f,d,h,0|e.shadowType,e.useView),r(t),a(e,t),i(t),o(t),u()},d})}(),function(){function e(e){return e.split("").map(function(e){return L(e)||0})}function t(e){o(e),u(e),l(e),s(e),f(e),c(e),d(e)}function n(e){g(e),h(e)}function r(e){function t(e,t){return le>e?(o.push({level:e,override:t}),e):void 0}var n=0,r=1,i=2,a=e.level,o=[];o.push({level:e.level,override:n});var u=0,l=o[0],s=l.level,f=[];e.characters.forEach(function(e){var c=e.type;c===j?(s+=k(s)?2:1,a=t(s,n)):c===P?(s+=R(s)?2:1,a=t(s,n)):c===q?(s+=k(s)?2:1,a=t(s,i)):c===Q&&(s+=R(s)?2:1,a=t(s,r)),c===J?o.length>1&&(l=o.pop()):l=o[o.length-1],s=a=l.level,-1===[$,j,P,q,Q,J].indexOf(c)&&(l.override>n&&(e.type=l.override===i?W:D),e.embeddingLevel=a,e.index=u++,f.push(e))}),e.characters=f}function i(e,t){function n(t){var n=r,a=t.map(function(t){return{text:e[r++],level:0,embeddingLevel:null,type:t}}),o=e.substring(n,n+t.length);i.push({text:o,level:0,characters:a})}var r=0,i=[],a=[];return t.forEach(function(e){e!==O?a.push(e):a.length>0&&(n(a),r++,a.length=0)}),a.length>0&&n(a),i}function a(e){e.level=1}function o(e){e.characters.filter(E(_)).forEach(function(t){if(t.isNSM=!0,t.index>0){var n=e.characters[t.index-1].type;n===U&&(t.type=U),W===n&&(t.type=W)}})}function u(e){e.characters.filter(E(F)).forEach(function(t){for(var n=t.index-1;n>=0;n--){var r=e.characters[n].type;if(r===U){t.type=V;break}if([W,D].indexOf(r)>-1)break}})}function l(e){e.characters.filter(E(U)).forEach(function(e){e.type=W,e.isAL=!0})}function s(e){e.characters.filter(E([H,K])).forEach(function(t){var n=t.index;if(n>0&&n<e.characters.length-1){var r=e.characters[n-1].type,i=e.characters[n+1].type;r!==i||r!==F&&r!==V||(t.type=r)}})}function f(e){e.characters.filter(E(z)).forEach(function(t){var n=t.index,r=n;if(n>0){for(var i=e.characters[n-1].type;r-- >0&&i===z;)i=e.characters[r].type;if(i===F)return void(t.type=F)}if(n<e.characters.length-1){var a=e.characters[n+1].type;for(r=n;r++<e.characters.length-1&&a===z;)a=e.characters[r].type;if(a===F)return void(t.type=F)}})}function c(e){e.characters.filter(E([z,K,H,V])).forEach(function(e){e.type=N})}function d(e){e.characters.filter(E(F)).forEach(function(t){for(var n=t.index,r=n-1;r>=0;r--){var i=e.characters[r].type;if(i===W)return;if(i===D)return void(t.type=D)}})}function g(e){e.characters.filter(E([O,X,Y,N])).forEach(function(t){var n=t.index;if(e.level<t.embeddingLevel)return void(t.type=R(t.embeddingLevel)?D:W);if(0!==n&&n!==e.characters.length-1&&n>0&&n<e.characters.length-1){for(var r=e.characters[n-1].type,i=e.characters[n+1].type,a=n;a-- >0&&-1===[W,U,F,V,D].indexOf(r);)r=e.characters[a].type;for(a=n;a++<e.characters.length-1&&-1===[W,U,F,V,D].indexOf(i);)i=e.characters[a].type;[W,U,F,V].indexOf(r)>-1&&[W,U,F,V].indexOf(i)>-1?t.type=W:r===D&&i===D?t.type=D:t.type=R(t.embeddingLevel)?D:W}})}function h(e){e.characters.filter(E([O,X,Y,N])).forEach(function(e){e.type=R(e.embeddingLevel)?D:W})}function v(e){var t;e.characters.forEach(function(e){var n=e.type;t=e.embeddingLevel,n===D?k(t)&&t++:n===W||n===U?R(t)&&t++:n!==F&&n!==V||(R(t)?t+=2:t++),e.level=t})}function m(e){e.characters.filter(function(e){return ue[e.text]&&k(e.level)}).forEach(function(e){e.text=ue[e.text]})}function y(e){var t=e.highestLevel;for(e.reorderedCharacters=KeyLines.Util.clone(e.characters);t>0;)x(e,t),t--}function x(e,t){var n,r=[];e.levelRuns.forEach(function(e){e.level>=t?n?n.endIndex+=e.length:(n={startIndex:e.idx,endIndex:e.idx+e.length},r.push(n)):n=null}),r.forEach(function(t){b(e,t)})}function b(e,t){var n=t.startIndex,r=t.endIndex,i=e.reorderedCharacters.slice(n,r).reverse();e.reorderedCharacters=e.reorderedCharacters.slice(0,n).concat(i).concat(e.reorderedCharacters.slice(r))}function p(e){var t=0;e.characters.forEach(function(e){e.level>t&&(t=e.level)}),e.highestLevel=t}function I(e){var t=[],n=0,r=0,i={idx:0,length:0,level:e.characters[0].level};e.characters.forEach(function(e){e.level!==n&&0!==r&&(t.push(i),i={idx:r,length:0,level:e.level}),i.length++,r++,n=e.level}),t.push(i),e.levelRuns=t}function w(e){C(e,ie,!0),A(e),Z(e),G(e)}function C(e,t,n){for(var r=e.reorderedCharacters.reverse(),i=[],a=0,o=r.length;o>a;a++){var u=r[a],l=B(a,r,t);a+=l.length,n||(u.text+=l.join("")),i.push(u)}var s=0;e.reorderedCharacters=i.reverse(),e.reorderedCharacters.forEach(function(e){e.index=s++})}function B(e,t,n){for(var r=[],i=e+1;i<t.length;i++){var a=t[i].text.charCodeAt(0);if(!n[a])return r;r.push(t[i].text)}return r}function A(e){for(var t=e.reorderedCharacters.reverse(),n=[],r=0,i=t.length;i>r;r++){var a=t[r],o=oe[a.text[0]];if(o){var u=M(r,o,t);u&&(r+=u.length,a.text=u.text)}n.push(a)}var l=0;e.reorderedCharacters=n.reverse(),e.reorderedCharacters.forEach(function(e){e.index=l++})}function M(e,t,n){for(var r=0,i=e+1;i<n.length;i++){var a=n[i].text[0],o=t[a];if(!o)return!1;if(r++,"string"==typeof o)return{text:o,length:r};t=o}return!1}function Z(e){var t=function(){e.arabicTextRuns.push(r),r=null},n=e.reorderedCharacters;e.arabicTextRuns=[];for(var r,i=0,a=n.length;a>i;i++){var o=n[i],u=o.text.charCodeAt(0),l=re[u];if(l&&[W,ee,D].indexOf(l.t)>-1){if(r||(r={startIndex:i}),r.endIndex=i+1,a>i+1){var s=n[i+1].text.charCodeAt(0),f=re[s];f&&f.t===W&&t()}else t();l.t===D&&t()}else{if(l&&l.t===te)continue;r&&t()}}r&&t()}function G(e){e.arabicTextRuns.forEach(function(t){for(var n,r=t.startIndex,i=t.endIndex,a=r;i>a;a++){var o=e.reorderedCharacters[a],u=re[o.text.charCodeAt(0)];n=null,i-r>1?a===r?n=u.initial:a===i-1?n=u["final"]:a>r&&i-1>a&&(n=u.median):n=u.isolated,n&&(o.text=String.fromCharCode(n)+o.text.substring(1))}})}function L(e){for(var t=e.charCodeAt(0),n=0;n<ne.length;n+=2)if(t<ne[n])return ne[n+1];return N}function R(e){return e%2===0}function k(e){return e%2!==0}function E(e){return e=KeyLines.Util.ensureArray(e),function(t){return e.indexOf(t.type)>-1}}var S=KeyLines.Bidi={},T={},D=0,W=1,F=2,V=3,N=4,O=5,X=6,U=7,Y=8,K=9,H=10,z=11,_=12,P=13,j=14,J=15,Q=16,q=17,$=18,ee=2,te=5,ne=[9,$,10,X,11,O,12,X,13,Y,14,O,28,$,31,O,32,X,33,Y,35,N,38,z,43,N,44,H,45,K,46,H,48,K,58,F,59,K,65,N,91,D,97,N,123,D,127,N,133,$,134,O,160,$,161,K,162,N,166,z,170,N,171,D,173,N,174,$,176,N,178,z,180,F,181,N,182,D,185,N,186,F,187,D,192,N,215,D,216,N,247,D,248,N,697,D,699,N,706,D,720,N,722,D,736,N,741,D,750,N,751,D,768,N,880,_,884,D,886,N,894,D,895,N,900,D,902,N,903,D,904,N,1014,D,1015,N,1155,D,1162,_,1418,D,1423,N,1425,z,1470,_,1471,W,1472,_,1473,W,1475,_,1476,W,1478,_,1479,W,1488,_,1536,W,1542,V,1544,N,1545,U,1547,z,1548,U,1549,K,1550,U,1552,N,1563,_,1611,U,1632,_,1642,V,1643,z,1645,V,1648,U,1649,_,1750,U,1757,_,1758,V,1759,N,1765,_,1767,U,1769,_,1770,N,1774,_,1776,U,1786,F,1809,U,1810,_,1840,U,1869,_,1958,U,1969,_,1984,U,2027,W,2036,_,2038,W,2042,N,2070,W,2074,_,2075,W,2084,_,2085,W,2088,_,2089,W,2096,_,2137,W,2142,_,2208,W,2260,U,2274,_,2275,V,2307,_,2362,D,2363,_,2364,D,2365,_,2369,D,2377,_,2381,D,2382,_,2385,D,2392,_,2402,D,2404,_,2433,D,2434,_,2492,D,2493,_,2497,D,2503,_,2509,D,2510,_,2530,D,2534,_,2546,D,2548,z,2555,D,2561,z,2563,_,2620,D,2622,_,2625,D,2649,_,2672,D,2674,_,2677,D,2691,_,2748,D,2749,_,2753,D,2761,_,2765,D,2768,_,2786,D,2790,_,2801,D,2809,z,2817,D,2818,_,2876,D,2877,_,2879,D,2880,_,2881,D,2887,_,2893,D,2903,_,2914,D,2918,_,2946,D,2947,_,3008,D,3009,_,3021,D,3024,_,3059,D,3065,N,3066,z,3072,N,3073,_,3134,D,3137,_,3142,D,3160,_,3170,D,3174,_,3192,D,3199,N,3201,D,3202,_,3260,D,3261,_,3276,D,3285,_,3298,D,3302,_,3329,D,3330,_,3393,D,3398,_,3405,D,3406,_,3426,D,3430,_,3530,D,3535,_,3538,D,3544,_,3633,D,3634,_,3636,D,3647,_,3648,z,3655,D,3663,_,3761,D,3762,_,3764,D,3773,_,3784,D,3792,_,3864,D,3866,_,3893,D,3894,_,3895,D,3896,_,3897,D,3898,_,3902,N,3953,D,3967,_,3968,D,3973,_,3974,D,3976,_,3981,D,4030,_,4038,D,4039,_,4141,D,4145,_,4146,D,4152,_,4153,D,4155,_,4157,D,4159,_,4184,D,4186,_,4190,D,4193,_,4209,D,4213,_,4226,D,4227,_,4229,D,4231,_,4237,D,4238,_,4253,D,4254,_,4957,D,4960,_,5008,D,5024,N,5120,D,5121,N,5760,D,5761,Y,5787,D,5792,N,5906,D,5920,_,5938,D,5941,_,5970,D,5984,_,6002,D,6016,_,6068,D,6070,_,6071,D,6078,_,6086,D,6087,_,6089,D,6100,_,6107,D,6108,z,6109,D,6112,_,6128,D,6155,N,6158,_,6160,$,6277,D,6279,_,6313,D,6314,_,6432,D,6435,_,6439,D,6441,_,6450,D,6451,_,6457,D,6464,_,6470,N,6622,D,6656,N,6679,D,6681,_,6683,D,6686,_,6742,D,6743,_,6744,D,6753,_,6754,D,6755,_,6757,D,6765,_,6771,D,6784,_,6832,D,6916,_,6964,D,6965,_,6966,D,6971,_,6972,D,6973,_,6978,D,6979,_,7019,D,7028,_,7040,D,7042,_,7074,D,7078,_,7080,D,7082,_,7083,D,7086,_,7142,D,7143,_,7144,D,7146,_,7149,D,7150,_,7151,D,7154,_,7212,D,7220,_,7222,D,7227,_,7376,D,7379,_,7380,D,7393,_,7394,D,7401,_,7405,D,7406,_,7412,D,7413,_,7416,D,7424,_,7616,D,7680,_,8125,D,8126,N,8127,D,8130,N,8141,D,8144,N,8157,D,8160,N,8173,D,8178,N,8189,D,8192,N,8203,Y,8206,$,8207,D,8208,W,8232,N,8233,Y,8234,O,8235,P,8236,j,8237,J,8238,Q,8239,q,8240,K,8245,z,8260,N,8261,K,8287,N,8288,Y,8294,$,8298,null,8304,$,8305,F,8308,D,8314,F,8316,H,8319,N,8320,D,8330,F,8332,H,8336,N,8352,D,8400,z,8448,_,8450,N,8451,D,8455,N,8456,D,8458,N,8468,D,8469,N,8470,D,8473,N,8478,D,8484,N,8485,D,8486,N,8487,D,8488,N,8489,D,8490,N,8494,D,8495,z,8506,D,8508,N,8512,D,8517,N,8522,D,8526,N,8528,D,8544,N,8585,D,8722,N,8723,H,8724,z,9014,N,9083,D,9109,N,9110,D,9352,N,9372,F,9450,D,9900,N,9901,D,10240,N,10496,D,11264,N,11493,D,11499,N,11503,D,11506,_,11513,D,11520,N,11647,D,11648,_,11744,D,11776,_,12288,N,12289,Y,12293,N,12296,D,12321,N,12330,D,12334,_,12336,D,12337,N,12342,D,12344,N,12349,D,12353,N,12441,D,12443,_,12445,N,12448,D,12449,N,12539,D,12540,N,12736,D,12784,N,12829,D,12832,N,12880,D,12896,N,12924,D,12927,N,12977,D,12992,N,13004,D,13008,N,13175,D,13179,N,13278,D,13280,N,13311,D,13312,N,19904,D,19968,N,42128,D,42192,N,42509,D,42512,N,42607,D,42611,_,42612,N,42622,_,42624,N,42654,D,42656,_,42736,D,42738,_,42752,D,42786,N,42888,D,42889,N,43010,D,43011,_,43014,D,43015,_,43019,D,43020,_,43045,D,43047,_,43048,D,43056,N,43064,D,43072,z,43124,D,43136,N,43204,D,43214,_,43232,D,43250,_,43302,D,43310,_,43335,D,43346,_,43392,D,43395,_,43443,D,43444,_,43446,D,43450,_,43452,D,43453,_,43493,D,43494,_,43561,D,43567,_,43569,D,43571,_,43573,D,43584,_,43587,D,43588,_,43596,D,43597,_,43644,D,43645,_,43696,D,43697,_,43698,D,43701,_,43703,D,43705,_,43710,D,43712,_,43713,D,43714,_,43756,D,43758,_,43766,D,43777,_,44005,D,44006,_,44008,D,44009,_,44013,D,44016,_,64285,D,64286,W,64287,_,64297,W,64298,H,64336,W,64830,U,64848,N,65021,U,65024,N,65040,_,65056,N,65072,_,65104,N,65105,K,65106,N,65108,K,65109,N,65110,K,65119,N,65120,z,65122,N,65124,H,65129,N,65131,z,65136,N,65279,U,65281,$,65283,N,65286,z,65291,N,65292,H,65293,K,65294,H,65296,K,65306,F,65307,K,65313,N,65339,D,65345,N,65371,D,65382,N,65504,D,65506,z,65509,N,65512,z,1114109,N],re={1536:{t:4},1537:{t:4},1538:{t:4},1539:{t:4},1540:{t:4},1541:{t:4},1544:{t:4},1547:{t:4},1568:{t:2},1569:{t:4,isolated:65152},1570:{t:1,isolated:65153,initial:65154},1571:{t:1,isolated:65155,initial:65156},1572:{t:1,isolated:65157,initial:65158},1573:{t:1,isolated:65159,initial:65160},1574:{t:2,isolated:65161,"final":65163,median:65164,initial:65162},1575:{t:1,isolated:65165,initial:65166},1576:{t:2,isolated:65167,"final":65169,median:65170,initial:65168},1577:{t:1,isolated:65171,initial:65172},1578:{t:2,isolated:65173,"final":65175,median:65176,initial:65174},1579:{t:2,isolated:65177,"final":65179,median:65180,initial:65178},1580:{t:2,isolated:65181,"final":65183,median:65184,initial:65182},1581:{t:2,isolated:65185,"final":65187,median:65188,initial:65186},1582:{t:2,isolated:65189,"final":65191,median:65192,initial:65190},1583:{t:1,isolated:65193,initial:65194},1584:{t:1,isolated:65195,initial:65196},1585:{t:1,isolated:65197,initial:65198},1586:{t:1,isolated:65199,initial:65200},1587:{t:2,isolated:65201,"final":65203,median:65204,initial:65202},1588:{t:2,isolated:65205,"final":65207,median:65208,initial:65206},1589:{t:2,isolated:65209,"final":65211,median:65212,initial:65210},1590:{t:2,isolated:65213,"final":65215,median:65216,initial:65214},1591:{t:2,isolated:65217,"final":65219,median:65220,initial:65218},1592:{t:2,isolated:65221,"final":65223,median:65224,initial:65222},1593:{t:2,isolated:65225,"final":65227,median:65228,initial:65226},1594:{t:2,isolated:65229,"final":65231,median:65232,initial:65230},1595:{t:2},1596:{t:2},1597:{t:2},1598:{t:2},1599:{t:2},1600:{t:3,isolated:1600,"final":1600,median:1600,initial:1600},1601:{t:2,isolated:65233,"final":65235,median:65236,initial:65234},1602:{t:2,isolated:65237,"final":65239,median:65240,initial:65238},1603:{t:2,isolated:65241,"final":65243,median:65244,initial:65242},1604:{t:2,isolated:65245,"final":65247,median:65248,initial:65246},1605:{t:2,isolated:65249,"final":65251,median:65252,initial:65250},1606:{t:2,isolated:65253,"final":65255,median:65256,initial:65254},1607:{t:2,isolated:65257,"final":65259,median:65260,initial:65258},1608:{t:1,isolated:65261,initial:65262},1609:{t:2,isolated:65263,initial:65264},1610:{t:2,isolated:65265,"final":65267,median:65268,initial:65266},1646:{t:2},1647:{t:2},1649:{t:1},1650:{t:1},1651:{t:1},1652:{t:4},1653:{t:1},1654:{t:1},1655:{t:1},1656:{t:2},1657:{t:2},1658:{t:2},1659:{t:2},1660:{t:2},1661:{t:2},1662:{t:2,isolated:64342,"final":64344,median:64345,initial:64343},1663:{t:2},1664:{t:2},1665:{t:2},1666:{t:2},1667:{t:2},1668:{t:2},1669:{t:2},1670:{t:2,isolated:64378,"final":64380,median:64381,initial:64379},1671:{t:2},1672:{t:1},1673:{t:1},1674:{t:1},1675:{t:1},1676:{t:1},1677:{t:1},1678:{t:1},1679:{t:1},1680:{t:1},1681:{t:1},1682:{t:1},1683:{t:1},1684:{t:1},1685:{t:1},1686:{t:1},1687:{t:1},1688:{t:1,isolated:64394,initial:64395},1689:{t:1},1690:{t:2},1691:{t:2},1692:{t:2},1693:{t:2},1694:{t:2},1695:{t:2},1696:{t:2},1697:{t:2},1698:{t:2},1699:{t:2},1700:{t:2},1701:{t:2},1702:{t:2},1703:{t:2},1704:{t:2},1705:{t:2,isolated:64398,"final":64400,median:64401,initial:64399},1706:{t:2},1707:{t:2},1708:{t:2},1709:{t:2},1710:{t:2},1711:{t:2,isolated:64402,"final":64404,median:64405,initial:64403},1712:{t:2},1713:{t:2},1714:{t:2},1715:{t:2},1716:{t:2},1717:{t:2},1718:{t:2},1719:{t:2},1720:{t:2},1721:{t:2},1722:{t:2},1723:{t:2},1724:{t:2},1725:{t:2},1726:{t:2},1727:{t:2},1728:{t:1},1729:{t:2},1730:{t:2},1731:{t:1},1732:{t:1},1733:{t:1},1734:{t:1},1735:{t:1},1736:{t:1},1737:{t:1},1738:{t:1},1739:{t:1},1740:{t:2,isolated:64508,"final":64510,median:64511,initial:64509},1741:{t:1},1742:{t:2},1743:{t:1},1744:{t:2},1745:{t:2},1746:{t:1},1747:{t:1},1749:{t:1},1757:{t:4},1774:{t:1},1775:{t:1},1786:{t:2},1787:{t:2},1788:{t:2},1791:{t:2},1808:{t:1},1810:{t:2},1811:{t:2},1812:{t:2},1813:{t:1},1814:{t:1},1815:{t:1},1816:{t:1},1817:{t:1},1818:{t:2},1819:{t:2},1820:{t:2},1821:{t:2},1822:{t:1},1823:{t:2},1824:{t:2},1825:{t:2},1826:{t:2},1827:{t:2},1828:{t:2},1829:{t:2},1830:{t:2},1831:{t:2},1832:{t:1},1833:{t:2},1834:{t:1},1835:{t:2},1836:{t:1},1837:{t:2},1838:{t:2},1839:{t:1},1869:{t:1},1870:{t:2},1871:{t:2},1872:{t:2},1873:{t:2},1874:{t:2},1875:{t:2},1876:{t:2},1877:{t:2},1878:{t:2},1879:{t:2},1880:{t:2},1881:{t:1},1882:{t:1},1883:{t:1},1884:{t:2},1885:{t:2},1886:{t:2},1887:{t:2},1888:{t:2},1889:{t:2},1890:{t:2},1891:{t:2},1892:{t:2},1893:{t:2},1894:{t:2},1895:{t:2},1896:{t:2},1897:{t:2},1898:{t:2},1899:{t:1},1900:{t:1},1901:{t:2},1902:{t:2},1903:{t:2},1904:{t:2},1905:{t:1},1906:{t:2},1907:{t:1},1908:{t:1},1909:{t:2},1910:{t:2},1911:{t:2},1912:{t:1},1913:{t:1},1914:{t:2},1915:{t:2},1916:{t:2},1917:{t:2},1918:{t:2},1919:{t:2},2208:{t:2},2209:{t:2},2210:{t:2},2211:{t:2},2212:{t:2},2213:{t:2},2214:{t:2},2215:{t:2},2216:{t:2},2217:{t:2},2218:{t:1},2219:{t:1},2220:{t:1},2221:{t:4},2222:{t:1},2223:{t:2},2224:{t:2},2225:{t:1},2226:{t:1},2227:{t:2},2228:{t:2},2230:{t:2},2231:{t:2},2232:{t:2},2233:{t:1},2234:{t:2},2235:{t:2},2236:{t:2},2237:{t:2},2274:{t:4},8204:{t:4},8205:{t:3},8239:{t:4},8294:{t:4},8295:{t:4},8296:{t:4},8297:{t:4},65269:{t:1,isolated:65269,initial:65270},65271:{t:1,isolated:65271,initial:65272},65273:{t:1,isolated:65273,initial:65274},65275:{t:1,isolated:65275,initial:65276}},ie={1611:1,1612:1,1613:1,1614:1,1615:1,1616:1,1617:1,1618:1,1619:1,1620:1,1621:1,1648:1},ae={1456:1,1457:1,1458:1,1459:1,1460:1,1461:1,1462:1,1463:1,1464:1,1465:1,1466:1,1467:1,1473:1,1474:1},oe={"\u0644":{"\u0627":"\ufefb","\u0622":"\ufef5","\u0623":"\ufef7","\u0625":"\ufef9"},"\u0627":{"\u0644":{"\u0644":{"\u0647":"\ufdf2"}}}},ue={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{",">":"<","<":">"},le=63;S.analyseText=function(o){if(T[o])return T[o];var u={characters:[],logicalOrder:o,result:[]},l=e(o),s=i(o,l),f=s.length;return s.forEach(function(e,i){a(e),r(e),0!==e.characters.length&&(t(e),n(e),v(e),m(e),p(e),I(e),y(e),C(e,ae,!1),w(e),u.result=u.result.concat(e.reorderedCharacters),f-1>i&&u.result.push({text:"\n",level:0,type:O}),u.characters=u.characters.concat(e.characters))}),u.types=l,T[o]=u},S.reorderText=function(e){return S.analyseText(e).result.map(function(e){return e.text}).join("")}}(),function(){var e=KeyLines.View={},t=e.createView=function(e,n,r,i,a){function o(){return a&&a.api.isShown()}function u(){return F(d*G)}function l(){return F(d/G)}function s(e,t,n,r,i,a,o,u,l,s,f){t.generate(n,r,b,i,l);var c=n.itemExtents(e,r);if(c){var d=N(c);return f&&(e?d.x1=d.x2=d.x1+(d.x2-d.x1)/2:d.x1=d.x2=b.width()/2),O(d,a,!0,!0,!0,o,!1,u,s)}return y.invoke(u),null}var f,c,d,g,h,v,m,y=KeyLines.Util,x=KeyLines.Common,b={},p=n,I=r,w=i?i:1;b.scaleFactor=function(e){return e&&(w=e),w};var C=b.scale=function(e){return Math.floor(w*e)};b.unscale=function(e){return Math.floor(e/w)},b.settings=function(){return{width:p,height:I,zoom:d,offsetX:g,offsetY:h}},b.fromSettingsDirect=function(e,t,n,r){return _(d,F(e.zoom),e.offsetX-g,e.offsetY-h,t,n,r)},b.fromOldSettings=function(n,r,i,a){if(r){var o=t(e,n.width,n.height);o.setZoom(n.zoom,!1),o.offsetX=n.offsetX,o.offsetY=n.offsetY;var u={x1:o.viewToWorldX(0),y1:o.viewToWorldY(0),x2:o.viewToWorldX(o.width()),y2:o.viewToWorldY(o.height())};return O(u,i,!1,!1,!1,a)}V(n.zoom,!1),g=n.offsetX,h=n.offsetY},b.width=function(e){return e&&(p=e),p},b.height=function(e){return e&&(I=e),I};var B=b.x=b.worldToViewX=function(e){return Math.floor(((e-f)*d+g)*w)},A=b.y=b.worldToViewY=function(e){return Math.floor(((e-c)*d+h)*w)},M=b.viewToWorldX=function(e){return Math.floor((e/w-g)/d+f)},Z=b.viewToWorldY=function(e){return Math.floor((e/w-h)/d+c)};b.w=function(e){return-1===e?-1:Math.max(1,Math.floor(e*d*w))},b.sw=function(e){return-1===e?-1:b.w(e)+7},b.dim=function(e){return Math.floor(e*d*w)},b.sdim=function(e){return e&&e*d*w},b.undim=function(e){return Math.floor(e/(d*w))},b.sundim=function(e){return e/(d*w)};var G=1.4,L=4,R=.05,k=R,E=.01,S=1,T=200,D=1/0,W=100;b.getMaxZoom=function(){return L},b.getMinZoom=function(){return k},b.setMinZoom=function(e){k=Math.min(S,Math.max(E,e||R))},b.setMaxItemZoom=function(e){D=e?e:1/0},b.getMaxItemZoom=function(){return D},b.zoomIn=function(e,t,n){var r=u();return X(r,w*p/2,w*I/2,e,t,n)},b.zoomOut=function(e,t,n){var r=l();return X(r,w*p/2,w*I/2,e,t,n)};var F=function(e){return Math.min(L,Math.max(e,k))},V=b.setZoom=function(e,t,n,r){var i=F(e);return X(i,w*p/2,w*I/2,t,n,r)};b.getUnzoom=function(){return d>D?D/d:1},b.wheelToPosition=function(e,t,n){var r=e>0?u():l();return X(r,t,n,!0,200)};var N=b.worldExtentsToView=function(e){return e?{x1:B(e.x1),y1:A(e.y1),x2:B(e.x2),y2:A(e.y2)}:null};b.fitWorldExtents=function(e,t,n,r,i,a,o){if(!e)return y.invoke(o),null;var u=N(e);return O(u,t,n,r,i,a,!1,o)};var O=b.fitExtents=function(e,t,n,r,i,a,o,u,l){var s,v=(e.y2-e.y1)/(e.x2-e.x1),m=I/p;if(v>m){var y=i?I/8:0;s=d*(I-y)/(e.y2-e.y1)}else{var x=i?p/8:0;s=d*(p-x)/(e.x2-e.x1)}s*=w,n&&(s=F(s)),r&&s>1&&(s=1),l&&(s=d);var b=(e.x1+e.x2)/2,C=(e.y1+e.y2)/2,B=M(b),A=Z(C),G=p/2-(B-f)*s,L=I/2-(A-c)*s;return _(d,s,G-g,L-h,t,a,u,o)};b.fitToSelection=function(e,t,n,r,i,a,o,u,l,f){return s(e.privateSelection(),e,t,n,r,i,a,u,l,f)},b.fitToModel=function(e,t,n,r,i,a,o,u,l,f){return o?s(y.makeIdMap(o),e,t,n,r,i,a,u,l,f):s(null,e,t,n,r,i,a,u,l)},b.fitModelHeight=function(e,t,n,r,i,a,o,u,l,f){return o?s(y.makeIdMap(o),e,t,n,r,i,a,u,l,f,!0):s(null,e,t,n,r,i,a,u,l,!1,!0)};var X=b.zoomToPosition=function(e,t,n,r,i,a){e=F(e);var o=M(t),u=Z(n),l=t/w-(o-f)*e,s=n/w-(u-c)*e;return _(d,e,l-g,s-h,r,i,a)},U=b.reset=function(e){f=421,c=298,e?_(d,1,421-g,298-h,!0):(g=421,h=298,d=1)};b.zoom=function(){return o()?a.internalUse.getZoom():d},b.offsetXtoWebglPanX=function(){var e=p/2;return-(1-b.offsetX()/e)+(e-f)/e*d},b.offsetYtoWebglPanY=function(){var e=I/2;return 1-b.offsetY()/e-(e-c)/e*d},b.offsetX=function(e){return y.defined(e)&&(g=e),g},b.offsetY=function(e){return y.defined(e)&&(h=e),h},b.diffX=function(){return v},b.diffY=function(){return m},b.pan=function(e,t,n,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return i*=W,a*=W,z(i,a,t,!1,n,r)};var Y,K,H,z=b.panBy=function(e,t,n,r,i,a){return _(d,d,e,t,n,i,a,r)},_=function(t,n,r,i,a,o,u,l){return v=r,m=i,a?P(t,n,r,i,o,u):(g+=Math.floor(r),h+=Math.floor(i),d=n,e&&!l&&e.trigger("viewchange"),y.invoke(u),void 0)},P=function(t,n,r,i,a,o){a||(a=T);var u=a,l=g,s=h;return x.buildAnimatorInstance(function(f){u-=f;var c=e.atanEasing(Math.max(0,Math.min(1,(a-u)/a)));g=l+c*r,h=s+c*i,d=F(t+c*(n-t));var v=u>0;return v||(e.trigger("viewchange"),y.invoke(o)),v},{drawOnly:!0})},j=function(t,n,r,i,u){var l=o(),s=l?-3:.1;return x.buildAnimatorInstance(function(o){var f=0===K&&0===H;return l?a.internalUse.panBy([K*s,H*s],{animate:!1}):(g+=o*s*K,h+=o*s*H),Y=!f,r&&r.dragMove(t,n,i,u),f||e.trigger("viewchange"),!f})};return b.cancelScroll=function(){K=H=0},b.maybeScroll=function(e,t,n,r,i){var a=C(50);return K=0,H=0,a>e&&(K=1),e>C(p)-a&&(K=-1),a>t&&(H=1),t>C(I)-a&&(H=-1),n.direction&&(n.direction.x||(K=0),n.direction.y||(H=0)),0===K&&0===H||Y?void 0:(Y=!0,j(e,t,n,r,i))},U(),b}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateRectangle=function(t,n,r,i,a,o,u,l,s){var f,c=t.wsc||[0,0,0,0];if(s=s||0,u.alwaysUpdate||u.rebuildOptions.all||u.rebuildOptions.shadow){f=u.triangleBuffers.shadowIndex;for(var d=u.triangleBuffers.shadowData,g=0;e>g;g++)d[f++]=c[0],d[f++]=c[1],d[f++]=c[2],d[f++]=c[3];u.triangleBuffers.shadowIndex=f}if(u.rebuildOptions.colours||u.alwaysUpdate||u.rebuildOptions.all){f=u.triangleBuffers.colourIndex;var h=u.triangleBuffers.colourData;for(g=0;e>g;g++)h[f++]=o[0],h[f++]=o[1],h[f++]=o[2],h[f++]=o[3];u.triangleBuffers.colourIndex=f}if(u.rebuildOptions.positions||u.alwaysUpdate||u.rebuildOptions.all){l&&(n+=l.x,r+=l.y,i+=l.x,a+=l.y),f=u.triangleBuffers.positionIndex;var v=u.triangleBuffers.positionData;v[f++]=n,v[f++]=r,v[f++]=s,v[f++]=i,v[f++]=r,v[f++]=s,v[f++]=n,v[f++]=a,v[f++]=s,v[f++]=n,v[f++]=a,v[f++]=s,v[f++]=i,v[f++]=r,v[f++]=s,v[f++]=i,v[f++]=a,v[f++]=s,u.triangleBuffers.positionIndex=f}if(u.rebuildOptions.textures||u.alwaysUpdate||u.rebuildOptions.all){f=u.triangleBuffers.textureIndex;var m=u.triangleBuffers.textureData;m[f++]=0,m[f++]=0,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,m[f++]=i-n,m[f++]=0,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,m[f++]=0,m[f++]=a-r,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,m[f++]=0,m[f++]=a-r,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,m[f++]=i-n,m[f++]=0,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,m[f++]=i-n,m[f++]=a-r,m[f++]=i-n,m[f++]=a-r,m[f++]=-1,m[f++]=0,m[f++]=-s,m[f++]=0,m[f++]=0,u.triangleBuffers.textureIndex=f}}}}(),function(){var e=KeyLines.Model={},t=e.updatePositionBufferProps={w:1,x:1,y:1,fs:1,bw:1,b1:1,b2:1};e.createModel=function(e,n,r){function i(){z=P=null}function a(e){for(var t in de)d(de[t],e);for(t in ce)d(ce[t],e)}function o(e,t){switch(e){case"x1":return ce[t.id1].x;case"y1":return ce[t.id1].y;case"x2":return ce[t.id2].x;case"y2":return ce[t.id2].y}}function u(e){me=!1,ye=!1,ve=e||{},xe=0}function l(e){ve[e]||(xe++,ve[e]=ge)}function s(){return me||ye?!0:ee.hasAnyKeys(ve)}function f(){function e(e){var n=ce[e]||de[e];t.push(n)}var t=[];return Object.keys(de).forEach(e),Object.keys(ce).forEach(e),t}function c(e){for(var t in e)ee.isNullOrUndefined(e[t])&&delete e[t]}function d(e,t){e[t]&&We(e.id)}function g(e){return e&&!!e._parentId}function h(e,t,n,r){for(var i="x"===t||"y"===t?l:we,a=0;a<e.length;a++){var o=e[a],u=ce[o];if(!u||!r&&g(u)){var s=de[o];!s||!r&&g(s)||(s[t]=n,we(o))}else u[t]=n,i(o)}}function v(e,t){var n=!1;return ce[e]&&(n=y(ce[e],t)),de[e]&&(n=y(de[e],t)),n}function m(e){var t=ce[e]||de[e];return t&&!(v(e,"hi")||v(e,"gh"))&&!g(t)}function y(e,t){return!!e[t]}function x(e,t,n,r){e=ee.ensureArray(e),h(e,t,!1,r);var i;if(Ce.ensureConsistency(t,!1,ce,de,r),n){var a={};for(i=0;i<e.length;i++)a[e[i]]=1;for(i in de)y(de[i],t)&&(y(ce[de[i].id1],t)||y(ce[de[i].id2],t)||(a[de[i].id1]||a[de[i].id2])&&(de[i][t]=!1))}}function b(e){var t,n=[];for(t in ce)t=ee.rawId(t),ce[t][e]&&n.push(t);for(t in de)t=ee.rawId(t),de[t][e]&&n.push(t);return n}function p(e,t,n){e=ee.ensureArray(e),h(e,t,!0,n),
Ce.ensureConsistency(t,!1,ce,de,n)}function I(){var e=[];return f().forEach(function(t){t._combo||e.push(ee.clone(t,"d"))}),e}function w(e){var t={};for(var n in e)de[n]&&"undefined"==typeof de[n].off&&(t[n]=de[n]);return t}function C(){var e=A(ce);return e=A(de)||e}function B(e){var t=!1;return e.forEach(function(e){e&&e.g&&e.g.forEach(function(e){t=M(e)||t})}),t}function A(e){var t=!1;for(var n in e){var r=e[n];t=M(r)||t,t=B([r,r.t1,r.t2])||t,r.bu&&(t=M(r.bu.g)||t)}return t}function M(e){if(e){var t=e.u;if(t&&!(t in ke))return ke[t]=1,!0}}function Z(){z={},_=0;for(var e=Object.keys(ce),t=0,n=e.length;n>t;t++){var r=e[t],i=ce[r];i.hi||g(i)||(z[r]=i,_++)}}function G(){P={};for(var e=Object.keys(de),t=0,n=e.length;n>t;t++){var r=e[t],i=de[r];i.hi||g(i)||(P[r]=i)}}function L(){z||(Z(),G())}function R(){me||(xe>100?xe>=_?ye=!0:k():Be().internalMarkLinks(ve))}function k(){for(var e in P)if(!ve[e]){var t=de[e];(ve[t.id1]||ve[t.id2])&&(ve[e]=he)}}function E(e){for(var t in e)De(t,!0)}function S(t){var n=KeyLines.Graph.create(e);return n.privateSetProperties(ce,t),n}function T(e){return e=ee.defaults(e,{all:!1,self:!0}),Be().connections(e)}function D(e,t){var n=[],r={};if(ee.hasAnyKeys(e)){var i=S(e).findAdjacency;n=T();for(var a=0;a<n.length;a++){var o=de[n[a][0]];i({all:!0},o.id1,o.id2)&&(r[a]=1)}}t(n,r)}function W(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r],a=de[i];!a||!t&&g(a)||(n[i]=a)}return n}function F(e){O(T(e))}function V(){for(var e in de){var t=de[e];delete t.st}}function N(e,t,n,r){function i(e,t){return o(de[e])-o(de[t])}function a(e){return 0===e?0:e}function o(e){var t=ee.defined(e.off)?e.off:s;return e.id1>e.id2&&(t=a(-t)),t}function u(e,t){t=e.id1<=e.id2?t:-t,r(e,a(t))}var l,s=1e6,f=t||e;ee.iterator(f,function(t,r){if(l=e[+r],n||(l=l.filter(function(e){return!de[e].gh})),l.length>0){l.sort(i);for(var a=de[l[0]],o=a.id1===a.id2,s=l.length,f=o?20:40,c=o?0:-.5*f*(s-1),d=0;s>d;d++){var g=de[l[d]];u(g,c+d*f)}}})}function O(e,t){function n(e,t){e.off=t,we(e.id)}N(e,t,!0,n)}function X(e,t,n){function r(e,t){i.push({id:e.id,off:t})}var i=[];return N(e,t,n,r),i}function U(){for(var e=T(),t={},n=0;n<e.length;n++){var r=!1,i=e[n];if(i.length>1){for(var a=0;a<i.length;a++){var o=de[i[a]];o&&(r=r||ee.defined(o.off))}r||(t[n]=1)}}O(e,t)}function Y(e){return(e+"").match(Ue)}function K(e){var t=Y(e);return Ye[t[2]]}function H(e){var t=Y(e);return t?t[1]:null}var z,_,P,j,J,Q,q=KeyLines.Common,$=KeyLines.Rendering,ee=KeyLines.Util,te={x:1,y:1,w:1,h:1,e:1,fs:1,off:1,b1:1,b2:1,bw:1},ne={t:1,u:1,id:1,id1:1,id2:1,ff:1,sh:1,p:1,ls:1,bs:1},re={c:1,b:1,fc:1,fbc:1},ie={hi:1,bg:1,ci:1,du:1,fb:1,a1:1,a2:1,re:1,tc:1,a:1},ae={gh:1},oe={pos:1},ue={x:1,y:1,off:1,lat:1,lng:1},le={ls:{solid:!0,dashed:!0,dotted:!0},bs:{solid:!0,dashed:!0}},se=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"],fe={},ce={},de={},ge=1,he=2,ve={},me=!1,ye=!1,xe=0,be=ee.idSep(),pe=null,Ie=KeyLines.Layouts.create(),we=fe.setDirty=function(e){ve[e]||xe++,ve[e]=he},Ce=KeyLines.Validation.create({numbers:te,negatives:ue,strings:ne,stringValues:le,colours:re,booleans:ie,reserved:ae,mapPos:oe,halos:se},we,i,a),Be=fe.graph=function(){return pe||(pe=KeyLines.Graph.create(e),pe.privateSetProperties(ce,de)),pe},Ae=fe.setAllDirty=function(){me=!0},Me=fe.moveNode=function(e,t,n){var r=ce[e];r&&(r.x=t,r.y=n,l(e))};fe.moveLink=function(e,t){var n=de[e];n&&(n.y=t,we(e))},fe.setLinkOffset=function(e,t){var n=de[e];n&&(n.off=t,we(e))},fe.ensureObject=Ce.ensureObject,fe.ensureTypesInArray=Ce.ensureTypesInArray,fe.load=function(e){if(e){ce={},de={},Ve(!0),Ce.typeCheck(e,de);var t=Ce.filterNodesAndLinks(e.items,ce,de,{selfLinks:J});de=t.links,ce=t.nodes,Ce.ensureHiddenItemConsistency(ce,de),pe=null,U(),Ae()}C()},fe.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return r.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"donut":return ee.merge({v:[]},Ce.donutDefaults);case"ha0":case"ha1":case"ha2":case"ha3":case"ha4":case"ha5":case"ha6":case"ha7":case"ha8":case"ha9":return{c:$.colours.transparent,r:0,w:0};case"fi":return{c:"black",t:""};case"c":case"b":return $.colours.midgrey;case"fc":return $.colours.black;case"fbc":return $.colours.textback}},fe.bothEndsShown=function(e){return!(ce[e.id1].hi||ce[e.id2].hi)},fe.bothEndsForeground=function(e){return!(ce[e.id1].bg||ce[e.id2].bg)},fe.resurrect=function(e,t){x(e,"gh",t)},fe.ghost=function(e){p(e,"gh")},fe.show=function(e,t,n){x(e,"hi",t,n),Ee()},fe.hidden=function(){return b("hi")},fe.hide=function(e,t){p(e,"hi",t),Ee()},fe.each=function(e,t){if(e.type.match(/^(node|all)$/))for(var n in ce)t(ce[n]);if(e.type.match(/^(link|all)$/))for(var r in de)t(de[r])},fe.setItem=function(e){e=ee.clone(e),Ce.ensureObject(e,!1,de);var t=null;if("node"===e.type&&(t=ce),"link"===e.type&&(t=de,!Ce.hasValidEnds(e,{},ce,J)))return!1;if(Ce.setZeroXY(e),e.id){var n=t[e.id];t[e.id]=e,n&&n._combo&&(t[e.id]._combo=n._combo),e.hi?Ce.ensureHiddenItemConsistency(ce,de):i(),Ee(),we(e.id)}return C()};var Ze=fe.type=function(){return"LinkChart"};fe.setOptions=function(e){J=e.selfLinks,Q=e.marqueeLinkSelection,r.setOptions(e),Ae()};var Ge;fe.setLastHoverId=function(e){Ge=e},fe.showFullLabelOnHover=function(e){Ge&&we(Ge),e?(we(e),r.setSpecialOptions("showFullLabel",e)):r.setSpecialOptions("showFullLabel",null)},fe.serialize=function(){return{type:Ze(),items:I()}};var Le=fe.applyChanges=function(e,n,r){var i,a,o,u,s,f,d;for(i=0;i<e.length;i++){if(a=ee.rawId(e[i].id),f=[],a)if(n){d=new RegExp(a,"im");for(o in ce)d.test(o)&&f.push(ce[o]);for(u in de)d.test(u)&&f.push(de[u])}else ce[a]&&f.push(ce[a]),de[a]&&f.push(de[a]);var g=ee.clone(e[i]);for(delete g.id,delete g.type,s=0;s<f.length;s++){var h=!0,v=f[s];for(var m in g)switch(h&&"x"!==m&&"y"!==m&&(h=!1),m){case"id1":case"id2":if(g[m]!==v[m])throw Error("You cannot change the ends of an existing link");break;case"hi":r.all=!0,r.hi=!0,v[m]=g[m];break;default:t[m]?r.positions=!0:r.all=!0,v[m]=g[m]}c(v),h?l(v.id):we(v.id)}}};fe.unsafeApplyChanges=function(e,t){var n,r;for(n=0;n<e.length;n++)r=e[n].id,ee.merge(ce[r]||de[r],e[n]),t?we(r):l(r)},fe.setProperties=function(e,t,n){return e=ee.clone(e),e=ee.ensureArray(e),Ce.ensureTypesInArray(e,!1,de),Le(e,t,n),n.hi&&Ce.ensureHiddenItemConsistency(ce,de),(n.graphCache||n.hi)&&Ee(),C()},fe.merge=function(e){e=ee.clone(e),Ce.ensureTypesInArray(e,!1,de);var t={carefulWithXandY:!0,selfLinks:J},n=Ce.filterNodesAndLinks(e,ce,de,t);for(var r in n.nodes)ce[r]=ee.merge(ce[r],n.nodes[r]),we(r);for(var i in n.links)de[i]=ee.merge(de[i],n.links[i]),we(i);Ce.ensureHiddenItemConsistency(ce,de),Ee();var a=w(n.links);Oe(a);var o=C();return o},fe.getItem=function(e){var t=Re(e);return g(t)&&(t=null),ee.clone(t,"d")},fe.getRawItems=function(){return f()};var Re=fe.getByID=function(e){return e=ee.rawId(e),ce[e]||de[e]||null},ke={};fe.imageList=function(e){var t={updated:!1,_coList:{}};for(var n in ke)t[e+n]=1;return t};var Ee=fe.clearGraphCache=function(){pe&&pe.clearCache()};fe.generate=function(e,t,n,i,a){var o,l=n.getUnzoom();return l!==j&&Ae(),s()&&(L(),R(),o=r.generate(z,P,me,ye,ve,e,t,n,i,a,Fe),u(o.stillDirty),j=l),r.generateHandles(e,t,n,Te),r.animated()||o&&o.rebuildAll},fe.contains=function(e){return r.contains(e,ce).filter(function(e){return!g(ce[e])})},fe.animated=function(){return r.animated()};var Se={},Te=[];fe.setSelection=function(e,t,n){e=ee.rawId(e),t||n||Ve(e),Se[e]?t&&We(e):De(e)};var De=fe.addToSelection=function(t,n){t=ee.rawId(t),t&&(Se[t]||m(t)&&(Se[t]=1,Te.push(t),we(t),n||e.trigger("selectionchange")))},We=fe.removeFromSelection=function(t,n){if(t=ee.rawId(t),Se[t]){we(t),delete Se[t];var r=Te.indexOf(t);r>-1&&Te.splice(r,1),n||e.trigger("selectionchange")}};fe.hasSelection=function(){return Te.length>0};var Fe=fe.isSelected=function(e){return e=ee.rawId(e),e in Se},Ve=fe.clearSelection=function(t){for(var n=0;n<Te.length;n++)we(Te[n]);Se={},Te=[],t||e.trigger("selectionchange")};fe.selectAll=function(){E(ce),E(de),e.trigger("selectionchange")};var Ne=fe.doSelection=function(e){if(e){Ve(!0);for(var t=0;t<e.length;t++)De(e[t],!0)}return ee.clone(Te)};fe.privateSelection=function(){return Se},fe.moveSelection=function(e,t){var n=[];if(Se){for(var r in ce)Fe(r)&&n.push(r);for(var i in de)Fe(i)&&(ce[de[i].id1].du&&n.push(de[i].id1),ce[de[i].id2].du&&n.push(de[i].id2))}for(var a=0;a<n.length;a++){var o=ce[n[a]];o.x+=e,o.y+=t,l(o.id)}},fe.removeItem=function(e){var t;e=ee.ensureArray(e);for(var n={},r={},a=0;a<e.length;a++)t=e[a],de[t]&&(n[t]=de[t]),ce[t]&&(r[t]=1);for(t in de)(r[de[t].id1]||r[de[t].id2])&&(n[t]=de[t]);for(t in n)We(t,!0),we(t),delete de[t];for(t in r)We(t,!0),we(t),delete ce[t];Ee(),Oe(n),i()},fe.selectionPlusDummyNodes=function(){for(var e=Ne(),t=0;t<e.length;t++){var n=de[e[t]];n&&(ce[n.id1].du&&e.push(n.id1),ce[n.id2].du&&e.push(n.id2))}return e};var Oe=fe.resetConnectionOffsets=function(t){e.trigger("redraw",{all:!0}),D(t,O)},Xe=function(e,t){var n;return D(e,function(e,r){n=X(e,r,t)}),n};fe.showHideBendLinks=function(e,t){var n=W(e,t);Oe(n)},fe.showHideGetLinksToBend=function(e,t,n){for(var r=W(e,n),i=Xe(r,t),a=[],o=0;o<i.length;o++){var u=i[o];de[u.id].off!==u.off&&a.push(u)}return a},fe.getCursor=function(e,t){var n=H(e);return n?n:e?'url("'+t+'openhand.cur"), pointer':"auto"},fe.getResizePrimitive=function(){return r.getResizePrimitive()};var Ue=new RegExp(be+"((\\S+)(?:\\-resize))$"),Ye={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},Ke=new RegExp(be+"(id[1|2])$");fe.startDragger=function(e,t,r,i,a,o){var u=(o+"").match(Ke),l=ee.rawId(r);return n.createLinkEndDragger(e,fe,t,ce,de[l],u[1],i,a,l)},fe.createDragger=function(t,r,i,a,u,l,s,f){var c=s.handMode,d=ee.rawId(a),g=Y(a);if(g){var h=K(a),v=f;return n.primitiveMover($,r,i,d,v,!0,h,u,l,function(t){e.trigger("prechange","resize");var n=ce[ee.rawId(a)],r=t.a,i=r?r.x:0,o=r?r.y:0;if("C"===t.p)n.x=i+t.x,n.y=o+t.y,n.w=n.h=2*t.r;else{var u=i+t.x1,l=o+t.y1,s=i+t.x2,f=o+t.y2;n.x=u+Math.floor((s-u)/2),n.y=l+Math.floor((f-l)/2),n.w=s-u,n.h=f-l}we(n.id)})}if(null!==d&&de[d]&&"h"!==de[d].st){if(de[d].id1===de[d].id2)return null;var m=(a+"").match(Ke);return m?n.createLinkEndDragger(t,fe,i,ce,de[d],m[1],u,l,d):n.createLinkDragger(o,r,i,fe,de[d],u,l,d)}return c&&null===a?n.createHandDragger(i,u,l,Ve):null!==d?(L(),n.createDefaultDragger(fe,z,P,Fe,i,a,u,l)):He(i,u,l)};var He=function(t,n,r){function i(e,n){s.x1=Math.min(t.worldToViewX(f),e),s.y1=Math.min(t.worldToViewY(c),n),s.x2=Math.max(t.worldToViewX(f),e),s.y2=Math.max(t.worldToViewY(c),n),d.x1=t.viewToWorldX(s.x1),d.y1=t.viewToWorldY(s.y1),d.x2=t.viewToWorldX(s.x2),d.y2=t.viewToWorldY(s.y2)}function a(e,t,n){for(var r in e)e[r]?De(r,!0):t||n?u[r]||We(r,!0):We(r,!0)}function o(e,t,n,r){L(),i(e,t);var o={};for(var u in z)o[u]=$.inside(d,z[u].x,z[u].y);if("off"!==Q)for(var l in P)if("centre"===Q)o[l]=$.inside(d,P[l]._x,P[l]._y);else if("ends"===Q){var s=z[P[l].id1],f=z[P[l].id2];o[l]=$.inside(d,s.x,s.y)&&$.inside(d,f.x,f.y)}a(o,n,r)}if(!e.trigger("dragstart","area",null,t.unscale(n),t.unscale(r),null)){var u={};for(var l in Se)u[l]=1;var s={p:$.primitives.rect,x1:n,y1:r,x2:n,y2:r,bc:$.colours.midgrey,bw:1,fc:$.colours.blue,fi:!1},f=t.viewToWorldX(n),c=t.viewToWorldY(r),d={x1:f,y1:c,x2:f,y2:c};s.wbc=$.webglColour(s.bc),s.wfc=$.webglColour(s.fc);var g={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){var t=e.getLayer();e.setLayer($.layers.HANDLES),e.copyPrimitive(s),e.setLayer(t)},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(n,r,i){t.cancelScroll();var a=e.trigger("dragend","area",null,t.unscale(r),t.unscale(i));a||(n?e.trigger("selectionchange"):Ve()),e.trigger("dragcomplete","area",null,t.unscale(r),t.unscale(i))}};return g}};return fe.createGestureDragger=function(t,n,r){function i(e,n,r){var i=2*-e*Math.PI/360;i*=2;var a=Math.sin(i),o=Math.cos(i);for(var u in ce){var l=(d[u].x-f)*o+(d[u].y-c)*a+f,s=-(d[u].x-f)*a+(d[u].y-c)*o+c;Me(u,l,s)}var g=t.viewToWorldX(n),h=t.viewToWorldY(r);for(var v in ce)Me(v,ce[v].x+g-f,ce[v].y+h-c)}function a(e){e=Math.pow(e,2),t.zoomToPosition(e*s,n,r)}function o(e,t,n,r){h=e,v=t,m=n,y=r}function u(){a(h),x=x||Math.abs(v)>12,p=p||Math.abs(m-f)>b||Math.abs(y-c)>b,i(x?v:0,p?m:f,p?y:c)}function l(){for(var e in ce)Me(e,d[e].x,d[e].y)}var s=t.zoom(),f=t.viewToWorldX(n),c=t.viewToWorldY(r),d={};for(var g in ce)d[g]={x:ce[g].x,y:ce[g].y};var h,v,m,y;o(1,0,f,c);var x=!1,b=60,p=!1,I={animate:function(){u()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(t,n,r,i,a){o(n,r,i,a),t?(l(),e.trigger("prechange","move"),u()):l()}};return I},fe.labelPosition=function(e,t){var n=Re(e);return r.labelPosition(n,t)},fe.extractStructure=function(e,t,n){return Ie.extractStructure(r,e,ce,de,Be,t.fixed,n)},fe.updateLinkStyles=function(t){t.straighten&&(e.trigger("redraw",{all:!0}),F({self:!1})),V()},fe.layout=function(e,t,n,r,i){Ie.layout(e,t,n,Be,r,i)},fe.arrange=function(e,t,n,r,i,a){Ie.arrange(e,t,n,r,i,a)},fe.applyVertices=function(e){for(var t in ce)e[t]&&Me(t,e[t].x,e[t].y)},fe.applyUpdatedOffsets=function(e){for(var t in de)e[t]&&fe.setLinkOffset(t,e[t].off)},fe.makeAnimator=function(e,t,n){var r=t,i={};for(var a in ce)i[a]={x:ce[a].x,y:ce[a].y};return q.buildAnimatorInstance(function(a){r-=a;var o=n(Math.max(0,(t-r)/t));for(var u in ce)if(e[u]){var l=i[u].x+o*(e[u].x-i[u].x),s=i[u].y+o*(e[u].y-i[u].y);Me(u,l,s)}return r>0},{positions:!0})},fe}}(),function(){var e=KeyLines.Iterators={};e.create=function(e,t,n){function r(e,t){if(!e.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(c||(g=d=n.privateGetRawItems(),h=c=f.clone(d,!0)),KeyLines.Util.isFunction(t))for(var r=0;r<g.length;r++){var i=g[r];!u(e.type,i)||(e.combos?i._combo:i._parentId)||t(h[r])}}function i(e){return!n.privateGetItem(e)._parentId}function a(e,t){t.forEach(function(t){e[t.id]&&(e[t.id1]=!0,e[t.id2]=!0)})}function o(e,t){t.forEach(function(t){e[t.id]=!(!e[t.id1]||!e[t.id2])})}function u(e,t){return"all"===e||e===t.type}function l(e,t,n,i,u,l,s,c){function d(){var e={all:[],nodes:[],links:[]};return r({type:"all",combos:c},function(t){e.all.push(t),e[t.type+"s"].push(t)}),e}function g(t){var n;n="node"===u?t.nodes:"link"===u?t.links:t.all,f.clone(n).forEach(function(t){e(t)&&(x[t.id]=!0)})}function h(e){"link"===u&&(l?a(x,e.links):e.nodes.forEach(function(e){x[e.id]=!0}))}function v(e){"node"===u&&o(x,e.links)}function m(e){"all"===u&&"bg"!==t&&e.links.forEach(function(e){x[e.id]=!(!x[e.id1]||!x[e.id2]||!x[e.id])})}function y(e){if("link"!==u&&l){var t={};e.links.forEach(function(e){t[e.id1]|=x[e.id]&&x[e.id2],t[e.id2]|=x[e.id]&&x[e.id1]}),e.nodes.forEach(function(e){x[e.id]&=t[e.id]})}}var x={},b={};b[n]={nodes:[],links:[]},b[i]={nodes:[],links:[]};var p=d();return g(p),h(p),v(p),m(p),y(p),p.all.forEach(function(e){var r=e.type+"s";if(!x[e.id]==!e[t]){var a=x[e.id]?n:i;b[a][r].push(e.id)}}),b}var s={},f=KeyLines.Util,c=null,d=null,g=null,h=null;return t.privateBind("redraw",function(){c=null,d=null}),s.each=r,s.filter=function(t,r,a){function o(){f.invoke(a,f.clone(u))}var u=l(t,"hi","shown","hidden",r.type,r.hideSingletons,!1,r.combos),s=u.shown.nodes.concat(u.shown.links),c=u.hidden.nodes.concat(u.hidden.links);r.combos?e.combo.internalUse.filter(s,c,u,r):u.combos={nodes:[],links:[]},u.shown.nodes=u.shown.nodes.filter(i),u.shown.links=u.shown.links.filter(i),u.hidden.nodes=u.hidden.nodes.filter(i),u.hidden.links=u.hidden.links.filter(i),c.length>0?s.length>0?(r.time/=2,n.hide(c,r,function(){n.show(s,!1,r,o)})):n.hide(c,r,o):s.length>0?n.show(s,!1,r,o):o()},s.foreground=function(t,r,a){var o="link"===r.type,u=l(t,"bg","foreground","background",r.type,o,!0,r.combos),s=u.foreground.nodes.concat(u.foreground.links),c=u.background.nodes.concat(u.background.links);r.combos&&e.combo.internalUse.foreground(s,c,u,r);var d=u.background.nodes.concat(u.background.links).map(function(e){return{id:e,bg:!0}}),g=u.foreground.nodes.concat(u.foreground.links).map(function(e){return{id:e,bg:!1}});u.foreground.nodes=u.foreground.nodes.filter(i),u.foreground.links=u.foreground.links.filter(i),u.background.nodes=u.background.nodes.filter(i),u.background.links=u.background.links.filter(i),n.setProperties(g.concat(d),!1,function(){f.invoke(a,f.clone(u))})},s}}(),function(){var e=KeyLines.WebGL;e&&(e["line-arc-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV9yYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3N0YXJ0QW5nbGU7CmF0dHJpYnV0ZSBmbG9hdCBhX2VuZEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIGZsb2F0IGFfaW5kZXg7CmF0dHJpYnV0ZSBmbG9hdCBhX251bU9mU2VnbWVudHM7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9saW5lVHlwZTsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV96b29tOwp1bmlmb3JtIHZlYzMgdV9yZXNvbHV0aW9uOwp1bmlmb3JtIG1hdDQgdV90cmFuc2Zvcm07Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgbG93cCBmbG9hdCB2X2xpbmVUeXBlOwp2YXJ5aW5nIGZsb2F0IHZfdXY7CnZhcnlpbmcgZmxvYXQgdl9zaWduOwp2YXJ5aW5nIHZlYzQgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0OwoKZmxvYXQgcGkgPSAzLjE0MTU5MjY1MzU5OwpmbG9hdCBtaW5XaWR0aCA9IDEuMDsKICAgCmludCByb3VuZFRvSW50KGZsb2F0IGEpIHsKIHJldHVybiBpbnQoZmxvb3IoYSArIDAuNSkpOwp9ICAgCiAgIAovLyBOZXh0IHNlZ21lbnQgaW4gdGhlIGFyYyAgIAp2ZWMyIGdldE5leHRQb3NpdGlvbih2ZWMyIHBvc2l0aW9uLCBmbG9hdCBhX3JhZGl1cywgZmxvYXQgYV9zdGFydEFuZ2xlLCBmbG9hdCBhbmdsZUluY3JlbWVudCwgZmxvYXQgaW5kZXgpIHsKICByZXR1cm4gdmVjMigKICAgICAgIGFfcG9zaXRpb24ueCArIGFfcmFkaXVzICogY29zKGFfc3RhcnRBbmdsZSArIGFuZ2xlSW5jcmVtZW50ICogaW5kZXgpLAogICAgICAgYV9wb3NpdGlvbi55ICsgYV9yYWRpdXMgKiBzaW4oYV9zdGFydEFuZ2xlICsgYW5nbGVJbmNyZW1lbnQgKiBpbmRleCkKICApOwp9Cgp2b2lkIG1haW4oKSB7CiAgIGZsb2F0IGRhc2hPZmZzZXQgPSAwLjU7CiAgIGludCBsaW5lVHlwZSA9IHJvdW5kVG9JbnQoYV9saW5lVHlwZSk7CiAgIC8vIGRpc2FibGUgYWEgd2hlbiB0eXBlID09IDEKICAgYm9vbCBpc1NoYXJwTGluZSA9IGxpbmVUeXBlID09IDE7CiAgIGJvb2wgaXNEYXNoZWRMaW5lID0gbGluZVR5cGUgPT0gMjsKICAgYm9vbCBpc0RvdHRlZExpbmUgPSBsaW5lVHlwZSA9PSAzOwogICBpZih1X2hpdFRlc3QgPT0gMS4wKSB7CiAgICAgIG1pbldpZHRoID0gOC4wOwogICB9CiAgIC8vIERpdmlkZSBtaW5XaWR0aCBieSBwaXhlbCBkZW5zaXR5IHNvIHJldGluYSBzY3JlZW4gcmV0YWluIGNvcnJlY3Qgd2lkdGgKICAgbWluV2lkdGggLz0gdV9yZXNvbHV0aW9uLno7CiAgIC8vIGluY3JlYXNlIG1pbi13aWR0aCBmb3IgZG90dGVkIGxpbmUgIzI0MjYKICAgbWluV2lkdGggPSBtYXgobWluV2lkdGgsIHN0ZXAoMi41LCBhX2xpbmVUeXBlKSAqIDIuMCk7CiAgIAogICBmbG9hdCByYWRpdXMgPSBhX3JhZGl1czsKICAgdmVjMiBwb3NpdGlvbjsKICAgLy8gRGlyZWN0aW9uIG9mIHRoZSBub3JtYWwgdmVjdG9yLCBlbmNvZGVkIGluIHRoZSBzaWduIG9mIG51bWJlck9mU2VnbWVudHMgZm9yIGVmZmljaWVuY3kgCiAgIGJvb2wgbm9ybWFsUG9pbnRzVXB3YXJkID0gcm91bmRUb0ludChzaWduKGFfbnVtT2ZTZWdtZW50cykpID09IDE7CiAgIAogICAvLyBXaGV0aGVyIHRoZSB2ZXJ0ZXggaXMgYXQgdGhlIHN0YXJ0IG9yIGVuZCBvZiB0aGUgc2VnbWVudCwgZW5jb2RlZCBpbiB0aGUgc2lnbiBvZiB0aGUgaW5kZXggcGFyYW1ldGVyCiAgIGJvb2wgaW5kZXhEaXJlY3Rpb24gPSBzaWduKGFfaW5kZXgpID09IDEuMCB8fCBhX2luZGV4ID09IDAuMDsKICAgLy8gVGhlIHJlYWwgaW5kZXggdmFsdWUKICAgZmxvYXQgaW5kZXggPSBzaWduKGFfaW5kZXgpICogYV9pbmRleDsKICAgLy8gVGhlIHJlYWwgbnVtT2ZTZWdtZW50cyB2YWx1ZQogICBmbG9hdCBudW1PZlNlZ21lbnRzID0gc2lnbihhX251bU9mU2VnbWVudHMpICogYV9udW1PZlNlZ21lbnRzOwogICAvLyBIb3cgbXVjaCBlYWNoIHNlZ21lbnQgbmVlZHMgdG8gY3VydmUKICAgZmxvYXQgYW5nbGVJbmNyZW1lbnQgPSAoYV9lbmRBbmdsZSAtICBhX3N0YXJ0QW5nbGUpIC8gbnVtT2ZTZWdtZW50czsKICAKICAgZmxvYXQgZmluYWxXaWR0aCA9IG1heCgoYV93aWR0aCAqIDIuMCkgKiB1X3pvb20sIChtaW5XaWR0aCAqIDIuMCkpIC8gdV96b29tOwogICB2ZWMyIGRpc3RhbmNlVmVjdG9yOwogICBmbG9hdCBuZXh0SW5kZXg7CiAgIAogICBpZihub3JtYWxQb2ludHNVcHdhcmQpIHsKICAgICByYWRpdXMgKz0gZmluYWxXaWR0aC8yLjA7CiAgICAgdl9zaWduID0gMS4wOwogICB9IGVsc2UgewogICAgIHJhZGl1cyAtPSBmaW5hbFdpZHRoLzIuMDsKICAgICB2X3NpZ24gPSAwLjA7CiAgIH0KICAKICAgaWYoYV9lbmRBbmdsZSAtIGFfc3RhcnRBbmdsZSA9PSAyLjAqcGkpIHsKICAgICAgZGFzaE9mZnNldCA9IDAuMDsKICAgfQogIAogICBwb3NpdGlvbiA9IGdldE5leHRQb3NpdGlvbihhX3Bvc2l0aW9uLnh5LCByYWRpdXMsIGFfc3RhcnRBbmdsZSwgYW5nbGVJbmNyZW1lbnQsIGluZGV4KTsKICAKICAgIC8qCiAgICAgY29udmVydCB0byBjbGlwc3BhY2UgCiAgICAqLwogICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogICB2ZWMyIHplcm9Ub09uZSA9IHBvc2l0aW9uIC8gdV9yZXNvbHV0aW9uLnh5OwoKICAgLy8gY29udmVydCBmcm9tIDAtPjEgdG8gMC0+MgogICB2ZWMyIHplcm9Ub1R3byA9IHplcm9Ub09uZSAqIDIuMDsKCiAgIC8vIGNvbnZlcnQgZnJvbSAwLT4yIHRvIC0xLT4rMSAoY2xpcHNwYWNlKQogICB2ZWMyIGNsaXBTcGFjZSA9IHplcm9Ub1R3byAtIDEuMDsKICAgCiAgIC8qCiAgICBBc3NpZ24gVmFyeWluZ3MKICAgKi8gCiAgIHZfY29sb3VyID0gYV9jb2xvdXI7CiAgIAogICB2X3V2ID0gaW5kZXggLyBhYnMoYV9udW1PZlNlZ21lbnRzKTsKICAgdl9sZW5ndGggPSBhX3JhZGl1cyAqIChhX2VuZEFuZ2xlIC0gYV9zdGFydEFuZ2xlKTsKICAgdl9oaXRUZXN0Q29sb3VyID0gYV9oaXRUZXN0Q29sb3VyOwogICB2X2xpbmVUeXBlID0gYV9saW5lVHlwZTsKICAgdl93aWR0aCA9IGZpbmFsV2lkdGg7CiAgIHZfZGFzaE9mZnNldCA9IGRhc2hPZmZzZXQ7CiAgIAogICBpZihpc0RvdHRlZExpbmUpIHsKICAgICB2X3V2ID0gdl91diogY2VpbCh2X2xlbmd0aC9maW5hbFdpZHRoKTsKICAgfQogICAKICAgLyoKICAgIEFzc2lnbiBmaW5hbCB2ZXJ0ZXggcG9zaXRpb24gYW5kIGFwcGx5IHRyYW5zZm9ybXMgZm9yIHpvb20vcGFuCiAgICovCiAgIGdsX1Bvc2l0aW9uID0gdV90cmFuc2Zvcm0gKiB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsKfQ==")}(),function(){var e=KeyLines.WebGL;e&&(e["line-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKcHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3V2Owp2YXJ5aW5nIGZsb2F0IHZfc2lnbjsKdmFyeWluZyBsb3dwIGZsb2F0IHZfbGluZVR5cGU7CnZhcnlpbmcgZmxvYXQgdl9sZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2Rhc2hPZmZzZXQ7CgpmbG9hdCBwaSA9IDMuMTQxNTkyNjUzNTk7CmZsb2F0IHNxcnRPZkhhbGYgPSAwLjcwNzEwNjc4MTE4NjU0NzU3OwovLyBQZXJmb3JtYW5jZSBhbnRpYWxpYXNpbmcgdXNpbmcgc3RhbmRhcmQgZGVyaXZhdGl2ZXMKLy8gU21vb3RocyB0aGUgZnJhZ21lbnQgb3ZlciAxIHBpeGVsIHdoZW4gdmFsdWUgaXMgbW9yZSB0aGFuIHRocmVzaG9sZAovLyBlc2VudGlhbGx5IGEgYmV0dGVyIHZlcnNpb24gb2Ygc3RlcCBhbmQgc21vb3Roc3RlcApmbG9hdCBhYXN0ZXAoZmxvYXQgdGhyZXNob2xkLCBmbG9hdCB2YWx1ZSkgewogICAgZmxvYXQgYWZ3aWR0aCA9IGxlbmd0aCh2ZWMyKGRGZHgodmFsdWUpLCBkRmR5KHZhbHVlKSkpICogc3FydE9mSGFsZjsKICAgIHJldHVybiBzbW9vdGhzdGVwKHRocmVzaG9sZC1hZndpZHRoLCB0aHJlc2hvbGQrYWZ3aWR0aCwgdmFsdWUpOwp9CgppbnQgcm91bmRUb0ludChmbG9hdCBhKSB7CiByZXR1cm4gaW50KGZsb29yKGEgKyAwLjUpKTsKfQoKdm9pZCBtYWluKCkgewpmbG9hdCBkYXNoVGhyZXNob2xkID0gLTAuNTsKIGludCBzaGFkb3dUeXBlID0gaW50KHVfc2hhZG93VHlwZSk7CiAKIGludCBsaW5lVHlwZSA9IHJvdW5kVG9JbnQodl9saW5lVHlwZSk7CiAvLyBkaXNhYmxlIGFhIHdoZW4gdHlwZSA9PSAxCiBib29sIGlzU2hhcnBMaW5lID0gbGluZVR5cGUgPT0gMTsKIGJvb2wgaXNEYXNoZWRMaW5lID0gbGluZVR5cGUgPT0gMjsKIGJvb2wgaXNEb3R0ZWRMaW5lID0gbGluZVR5cGUgPT0gMzsKIGJvb2wgZXhjbHVkZUZyb21TaGFkb3cgPSBzaGFkb3dUeXBlID09IC0xOwogYm9vbCBvbmx5T25TaGFkb3cgPSBzaGFkb3dUeXBlID09IDE7CiAgaWYoaW50KHVfaGl0VGVzdCkgPT0gMSkgewogICAgLy8gRXhjbHVkZSBmcm9tIHNoYWRvdwogICAgaWYoZXhjbHVkZUZyb21TaGFkb3cpIHsKICAgICAgICBkaXNjYXJkOwogICAgfSBlbHNlIHsKICAgICAgZ2xfRnJhZ0NvbG9yID0gdl9oaXRUZXN0Q29sb3VyIC8gMjU1LjA7CiAgICB9CiAgLy8gc2hvdyBvbmx5IG9uIHNoYWRvdwogIH0gZWxzZSBpZihvbmx5T25TaGFkb3cpIHsKICAgIGRpc2NhcmQ7CiAgfSBlbHNlIHsKICAgIGZsb2F0IGRpc3RUb0VkZ2UgPSBhYnMoMC41IC0gdl9zaWduKTsKICAgIHZlYzQgY29sb3VyID0gdmVjNCgodl9jb2xvdXIucmdiLyAyNTUuMCkgKiAodl9jb2xvdXIuYSAvMjU1LjApLCAodl9jb2xvdXIuYSAvIDI1NS4wKSk7CiAgICBmbG9hdCBzbW9vdGhuZXNzID0gKCgxLjAgLyB2X2xlbmd0aCkgLyB1X3pvb20pIC8gMi4wOwogICAgLy8gZG90dGVkIGxpbmVzCiAgICBpZihpc0RvdHRlZExpbmUpIHsKICAgICAgLy8gRGlzdGFuY2UgdG8gbmVhcmVzdCBwb2ludCBpbiBhIGdyaWQgb2YKICAgICAgLy8gcG9pbnRzIG92ZXIgdGhlIHVuaXQgc3F1YXJlCiAgICAgIHZlYzIgbmVhcmVzdCA9IDIuMCpmcmFjdCh2ZWMyKHZfdXYsIHZfc2lnbiApKSAtIDEuMDsKICAgICAgZmxvYXQgZGlzdCA9IGxlbmd0aChuZWFyZXN0KTsKICAgICAgZmxvYXQgcmFkaXVzID0gMC41OwogICAgICBjb2xvdXIgKj0gYWFzdGVwKHJhZGl1cywgMS4wIC0gZGlzdCk7CiAgICAvLyBkYXNoZXMgIAogICAgfSBlbHNlIGlmKGlzRGFzaGVkTGluZSkgewogICAgICBmbG9hdCBkYXNoTGVuZ3RoID0gdl93aWR0aDsKICAgICAgZmxvYXQgZ2FwV2lkdGggPSBkYXNoTGVuZ3RoIC8gMi4wOwogICAgICBmbG9hdCBkYXNoZXMgPSBmbG9vcigodl9sZW5ndGggKyBnYXBXaWR0aCkgLyAoZGFzaExlbmd0aCArIGdhcFdpZHRoKSkgKyB2X2Rhc2hPZmZzZXQ7CiAgICAgIGZsb2F0IGRhc2ggPSBzaW4oKCh2X3V2ICogZGFzaGVzKSkgKiAoMi4wICogcGkpKTsKICAgICAgLy8gc21vb3RoIGFuZCBjdXQgb3V0IGEgZ2FwIHdoZW4gdGhlIHNpbmUgd2F2ZSBpZiBwYXN0IHRoZSBkYXNoVGhyZXNob2xkCiAgICAgIGNvbG91ciAqPSBhYXN0ZXAoZGFzaFRocmVzaG9sZCwgIGRhc2gpOwogICAgICAvLyBzbW9vdGggZWRnZSBvZiBsaW5lCiAgICAgIGNvbG91ciAqPSAxLjAgLSBhYXN0ZXAoMC4yNDksIGRpc3RUb0VkZ2UpOwogICAgLy8gTm9ybWFsIGxpbmUKICAgIH0gZWxzZSB7CiAgICAgIC8vIHNtb290aCBlZGdlIG9mIGxpbmUKICAgICAgY29sb3VyICo9IDEuMCAtIGFhc3RlcCgwLjI1MSwgZGlzdFRvRWRnZSk7CiAgICB9CiAgICAKICAgIC8vIGFzc2lnbiB0aGUgZmluYWwgY29sb3VyIHRvIHRoZSBmcmFnbWVudAogICAgZ2xfRnJhZ0NvbG9yID0gY29sb3VyOwogIH0KfQ==")}(),function(){var e=KeyLines.WebGL;e&&(e["line-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjNCBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIHZlYzQgYV92ZXJ0ZXhJbmZvOwphdHRyaWJ1dGUgdmVjNCBhX2NvbG91cjsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMyB1X3Jlc29sdXRpb247CnVuaWZvcm0gbWF0NCB1X3RyYW5zZm9ybTsKdW5pZm9ybSBmbG9hdCB1X3pvb207CnVuaWZvcm0gZmxvYXQgdV92aWV3SW5kZXBlbmRlbnQ7Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgdmVjNCB2X3ZlcnRleEluZm87CnZhcnlpbmcgZmxvYXQgdl91djsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3NpZ247CnZhcnlpbmcgZmxvYXQgdl9hYURpc3RhbmNlOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl96b29tOwp2YXJ5aW5nIGxvd3AgZmxvYXQgdl9saW5lVHlwZTsKdmFyeWluZyBmbG9hdCB2X2Rhc2hPZmZzZXQ7CgppbnQgcm91bmRUb0ludChmbG9hdCBhKSB7CiByZXR1cm4gaW50KGZsb29yKGEgKyAwLjUpKTsKfQoKdm9pZCBtYWluKCkgewogIC8vIERpdmlkZSBtaW5XaWR0aCBieSBwaXhlbCBkZW5zaXR5IHNvIHJldGluYSBzY3JlZW4gcmV0YWluIGNvcnJlY3Qgd2lkdGgKICBmbG9hdCBtaW5XaWR0aCA9IDEuMCAvIHVfcmVzb2x1dGlvbi56OwogIGludCBsaW5lVHlwZSA9IGludChhX3ZlcnRleEluZm8udyk7CiAgLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogIGJvb2wgaXNTaGFycExpbmUgPSBsaW5lVHlwZSA9PSAxOwogIGJvb2wgaXNEYXNoZWRMaW5lID0gbGluZVR5cGUgPT0gMjsKICBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IDM7CiAgLy8gTWFrZSBpdCB3aWRlciB0byBhbGxvdyB0aGUgYW50aSBhbGlhc2luZyB0byBlYXQgaW50byB0aGUgbGluZSBpbiBvcmRlciB0byBtYWtlIGl0IHNtb290aAogIGZsb2F0IGFhV2lkdGhCdWZmZXIgPSAyLjA7CiAgLy8gZG9uJ3Qgd2lkZW4gZm9yIGRvdHMKICB2X2FhRGlzdGFuY2UgPSAwLjI1OwogIGlmKGlzU2hhcnBMaW5lKSB7CiAgICAvL2Vuc3VyZSBhYSBuZXZlciBraWNrcyBpbiB3aGlsZSBhdm9pZGluZyBhbiBpZiBzdGF0ZW1lbnQgaW4gZnJhZ21lbnQgc2hhZGVyCiAgICB2X2FhRGlzdGFuY2UgPSAxLjA7CiAgfQogIAogIGlmKHVfaGl0VGVzdCA9PSAxLjApIHsKICAgIG1pbldpZHRoID0gNC4wOwogIH0KICAvLyBpbmNyZWFzZSBtaW4td2lkdGggZm9yIGRvdHRlZCBsaW5lICMyNDI2CiAgbWluV2lkdGggPSBtYXgobWluV2lkdGgsIHN0ZXAoMi41LCBhX3ZlcnRleEluZm8udykgKiAyLjApOwogIAogIHZlYzIgcG9zaXRpb247CiAgCiAgLy8gRGlyZWN0aW9uIG9mIHRoZSBub3JtYWwgdmVjdG9yCiAgZmxvYXQgbm9ybWFsUG9pbnRzVXB3YXJkID0gYV92ZXJ0ZXhJbmZvLnkgLSAxLjA7CiAgCiAgLy8gVGhlIFVWIGNvb3JkcyBmcm9tIDAgLT4gMSwgdXNlZCBmb3IgZGFzaGluZywgdGhlIGxpbmUgbnVtYmVyIGlzIGFkZGVkCiAgLy8gZm9yIHRoZSBjYXNlIHdoZW4gbGluZXMgYXJlIGpvaW5lZAogIGZsb2F0IHV2ID0gYV92ZXJ0ZXhJbmZvLnggKyBhX3ZlcnRleEluZm8uejsKICAKICB2ZWMyIGRpc3RhbmNlVmVjdG9yID0gYV9wb3NpdGlvbi56dyAtIGFfcG9zaXRpb24ueHk7CiAgCiAgdmVjMiBub3JtYWwgPSBub3JtYWxpemUodmVjMigtZGlzdGFuY2VWZWN0b3IueSwgZGlzdGFuY2VWZWN0b3IueCkpOwogIAogIC8vIFdoZXRoZXIgdGhlIHZlcnRleCBpcyBhdCB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBzZWdtZW50LgogIGlmKGludChhX3ZlcnRleEluZm8ueCkgPT0gMCkgewogICBwb3NpdGlvbiA9IGFfcG9zaXRpb24ueHk7CiAgfSBlbHNlIHsKICAgcG9zaXRpb24gPSBhX3Bvc2l0aW9uLnp3OwogIH0KICBmbG9hdCBmaW5hbFdpZHRoID0gY2VpbChhX3dpZHRoICogYWFXaWR0aEJ1ZmZlcik7CiAgaWYoaW50KHVfdmlld0luZGVwZW5kZW50KSA9PSAwKSB7CiAgIGZpbmFsV2lkdGggPSBtYXgoKGZpbmFsV2lkdGgpICogdV96b29tLCBtaW5XaWR0aCAqIGFhV2lkdGhCdWZmZXIpIC8gdV96b29tOwogIH0KICAvLyBnZXQgdmVjdG9yIGZvciBsaW5lCiAgdmVjMiBub3JtYWxWZWMgPSBub3JtYWwgKiAoZmluYWxXaWR0aC8yLjApICogbm9ybWFsUG9pbnRzVXB3YXJkOwogIHBvc2l0aW9uID0gcG9zaXRpb24gKyBub3JtYWxWZWM7CiAgCiAgLyoKICAgY29udmVydCB0byBjbGlwc3BhY2UgCiAgKi8KICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogIHZlYzIgemVyb1RvT25lID0gcG9zaXRpb24gLyB1X3Jlc29sdXRpb24ueHk7CiAgCiAgLy8gY29udmVydCBmcm9tIDAtPjEgdG8gMC0+MgogIHZlYzIgemVyb1RvVHdvID0gemVyb1RvT25lICogMi4wOwogIAogIC8vIGNvbnZlcnQgZnJvbSAwLT4yIHRvIC0xLT4rMSAoY2xpcHNwYWNlKQogIHZlYzIgY2xpcFNwYWNlID0gemVyb1RvVHdvIC0gMS4wOwogIAogIC8qCiAgIEFzc2lnbiBWYXJ5aW5ncwogICovIAogIHZfY29sb3VyID0gYV9jb2xvdXI7CiAgdl91diA9IHV2OwogIGlmKGludChub3JtYWxQb2ludHNVcHdhcmQpID09IDEpIHsKICAgdl9zaWduID0gMC4wOwogIH0gZWxzZSB7CiAgIHZfc2lnbiA9IDEuMDsKICB9CiAgIAogIHZfbGVuZ3RoID0gZGlzdGFuY2UoYV9wb3NpdGlvbi54eSwgYV9wb3NpdGlvbi56dyk7CiAgdl9oaXRUZXN0Q29sb3VyID0gYV9oaXRUZXN0Q29sb3VyOwogIHZfd2lkdGggPSBmaW5hbFdpZHRoOwoKICB2X3pvb20gPSB1X3pvb207CiAgdl9saW5lVHlwZSA9IGFfdmVydGV4SW5mby53OwogIAogIC8vRG90dGVkIGxpbmVzLCBzbyBjYWxjIHV2IGxlbmd0aAogIGlmKGFfdmVydGV4SW5mby53ID09IDMuMCApIHsKICAgIHZfdXYgPSB1diAqIGNlaWwodl9sZW5ndGgvZmluYWxXaWR0aCk7CiAgfSAKICAKICB2X2Rhc2hPZmZzZXQgPSAwLjU7CiAgCiAgLyoKICAgQXNzaWduIGZpbmFsIHZlcnRleCBwb3NpdGlvbiBhbmQgYXBwbHkgdHJhbnNmb3JtcyBmb3Igem9vbS9wYW4KICAqLwogIGdsX1Bvc2l0aW9uID0gdV90cmFuc2Zvcm0gKiB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsKfQ==")}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2VbOF07CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMyB1X3Jlc29sdXRpb247CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCi8vIHRoZSB0ZXhDb29yZHMgcGFzc2VkIGluIGZyb20gdGhlIHZlcnRleCBzaGFkZXIuCnZhcnlpbmcgdmVjNCB2X3RleENvb3JkOwovLyBjb2xvdXIgb2YgZmxhdCBzaGFkZWQgdHJpYW5nbGVzCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKLy8gc2hhZG93Y2FudmFzIGNvbG91ciBtYXBwaW5nCnZhcnlpbmcgdmVjNCB2X2hpdFRlc3RDb2xvdXI7Ci8vIHdoaWNoIHRleHR1cmUgdG8gdXNlCnZhcnlpbmcgdmVjMiB2X3RleHR1cmVCYW5rOwovLyBjaXJjbGUgYm9yZGVyIHdpZHRoCnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2NpcmNsZVJhZGl1czsKLy8gdGhlIHNpemUgb2YgYSBwaXhlbCBpbiBzY3JlZW5zcGFjZSBjbGlwIGNvb3JkaW5hdGVzCnZhcnlpbmcgZmxvYXQgdl9waXhlbDsKdmFyeWluZyB2ZWMyIHZfZG9udXRTZWdtZW50OwoKY29uc3QgZmxvYXQgUEkgPSAzLjE0MTU5MjY1MzU4OTc5MzIzODQ2MjY0MzM4MzI3OTU7Ci8vIFBlcmZvcm1hbmNlIGFudGlhbGlhc2luZyB1c2luZyBzdGFuZGFyZCBkZXJpdmF0aXZlcwovLyBTbW9vdGhzIHRoZSBmcmFnbWVudCBvdmVyIDEgcGl4ZWwgd2hlbiB2YWx1ZSBpcyBtb3JlIHRoYW4gdGhyZXNob2xkCi8vIGVzZW50aWFsbHkgYSBiZXR0ZXIgdmVyc2lvbiBvZiBzdGVwIGFuZCBzbW9vdGhzdGVwCmZsb2F0IGFhc3RlcChmbG9hdCB0aHJlc2hvbGQsIGZsb2F0IHZhbHVlKSB7CiAgZmxvYXQgYWZ3aWR0aCA9IGxlbmd0aCh2ZWMyKGRGZHgodmFsdWUpLCBkRmR5KHZhbHVlKSkpICogMC43MDcxMDY3ODExODY1NDc1NzsKICByZXR1cm4gc21vb3Roc3RlcCh0aHJlc2hvbGQtYWZ3aWR0aCwgdGhyZXNob2xkK2Fmd2lkdGgsIHZhbHVlKTsKfQoKLy8gZW5zdXJlcyB0aGF0IG51bWJlcnMgYXJlIGV4YWN0bHkgaW50ZWdlcnMgCmludCByb3VuZFRvSW50KGZsb2F0IGEpIHsKIHJldHVybiBpbnQoZmxvb3IoYSArIDAuNSkpOwp9CgovLyBkaXN0YW5jZSB0byBlZGdlIGZyb20gYSB0cmlhbmdsZSwgdXNlZCBmb3Igc21vb3RoaW5nIGVkZ2VzIG9mIGFycm93cwpmbG9hdCBlZGdlRmFjdG9yKHZlYzMgYmFyeWNlbnRyaWNDb29yZHMpewogIHZlYzMgZCA9IGZ3aWR0aChiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiAgdmVjMyBhMyA9IHNtb290aHN0ZXAodmVjMygwLjApLCBkKjMuMCwgYmFyeWNlbnRyaWNDb29yZHMpOwogcmV0dXJuIG1pbihtaW4oYTMueCwgYTMueSksIGEzLnopOwp9CgovLyBSZWFkIHRoZSB0ZXh0dXJlIHZhbHVlIG9mIGEgZ2x5cGggZnJvbSB0aGUgc3BlY2lmaWVkIGNvbG91ciBjaGFubmVsCmZsb2F0IHJlYWRDb2xvdXJDb21wb25lbnRGcm9tVGV4dHVyZShmbG9hdCB0ZXh0dXJlQmFuaywgdmVjNCB0ZXhDb29yZCkgewogIGZsb2F0IHRleENvbXBvbmVudDsKICBpbnQgdGV4QmFuayA9IHJvdW5kVG9JbnQodGV4dHVyZUJhbmspOwogIGlmKHRleEJhbmsgPT0gMCkgewogICAgdGV4Q29tcG9uZW50ID0gdGV4Q29vcmQucjsKICB9IGVsc2UgaWYodGV4QmFuayA9PSAxKSB7CiAgICB0ZXhDb21wb25lbnQgPSB0ZXhDb29yZC5nOwogIH0gZWxzZSB7CiAgICB0ZXhDb21wb25lbnQgPSB0ZXhDb29yZC5iOwogIH0KICByZXR1cm4gdGV4Q29tcG9uZW50Owp9CgovLyBVc2VkIHRvIHJlY29uc3RydWN0IGEgZ2x5cGggZnJvbSB0aGUgY29sb3VyQ29tcG9uZW50IHRleHR1cmUKLy8gUmVhZCBvbmUgc3BlY2lmaWMgY29sb3VyIG9ubHkgYW5kIHRyZWF0IGl0IGFzIGFuIGFscGhhIHZhbHVlLCBzZXR0aW5nIGl0cyBjb2xvdXIgdXNpbmcgY29sb3VyTW9kaWZpZXIKdmVjNCBnZXRDb2xvdXJGcm9tQ29tcG9uZW50KGZsb2F0IGNvbG91ckNvbXBvbmVudCwgdmVjNCBjb2xvdXJNb2RpZmllciwgZmxvYXQgdXNlV2hpdGVCb29zdCkgewogIGZsb2F0IGNvbG91ckF2ZyA9IChjb2xvdXJNb2RpZmllci5yICsgY29sb3VyTW9kaWZpZXIuYiArIGNvbG91ck1vZGlmaWVyLmcpIC8gMy4wOwogIGZsb2F0IGlzV2hpdGUgPSBzdGVwKDEuMCxjb2xvdXJBdmcpICogdXNlV2hpdGVCb29zdDsKICAvLyBJZiB0aGUgdGV4dCBpcyB3aGl0ZSBib29zdCB0aGUgYWxwaGEgdG8gaW5jcmVhc2UgY29udHJhc3QKICBmbG9hdCB3aGl0ZVRleHRCb29zdCA9IGlzV2hpdGUgKiAoc3RlcCgwLjI1LGNvbG91ckNvbXBvbmVudCkqbWluKGNvbG91ckF2ZywwLjI1KSk7CiAgZmxvYXQgYSA9IGNvbG91ck1vZGlmaWVyLmEgKiAoY29sb3VyQ29tcG9uZW50ICArIHdoaXRlVGV4dEJvb3N0KTsKICBmbG9hdCByID0gY29sb3VyTW9kaWZpZXIuciAqIGE7CiAgZmxvYXQgZyA9IGNvbG91ck1vZGlmaWVyLmcgKiBhOwogIGZsb2F0IGIgPSBjb2xvdXJNb2RpZmllci5iICogYTsKICByZXR1cm4gdmVjNChyLGcsYixhKTsKfQoKdm9pZCBtYWluKCkgewogIHZlYzQgY29sb3JBOwogIC8vIGJvcmRlciB3aWR0aCBiZXR3ZWVuIDEgLSAwCiAgZmxvYXQgd2lkdGggPSBhYnModl93aWR0aCkgLyAodl9jaXJjbGVSYWRpdXMgKiAyLjApOwogIGZsb2F0IGJvcmRlcldpZHRoID0gYWJzKHZfd2lkdGgpOwogIHZlYzIgY2lyY2xlQ2VudHJlID0gdmVjMigwLjUsIDAuNSk7CiAgaW50IHNoYWRvd1R5cGU9IHJvdW5kVG9JbnQodV9zaGFkb3dUeXBlKTsKICBib29sIGlzQ2lyY2xlID0gdl9jaXJjbGVSYWRpdXMgPiAwLjA7CiAgYm9vbCBoYXNSZWN0YW5nbGVCb3JkZXIgPSByb3VuZFRvSW50KHZfY2lyY2xlUmFkaXVzKSA8IDA7CiAgYm9vbCBoYXNDaXJjbGVEYXNoZWRCb3JkZXIgPSB2X3dpZHRoIDwgMC4wOwogIGJvb2wgb25seURyYXdPblNoYWRvdyA9IHNoYWRvd1R5cGUgPT0gMTsKICBib29sIHNoYWRvd0NhbnZhcyA9IHJvdW5kVG9JbnQodV9oaXRUZXN0KSA9PSAxOwogIHZlYzIgdGV4dHVyZUNvb3JkcyA9IHZfdGV4Q29vcmQuenc7CiAgZmxvYXQgc2EgPSB2X2RvbnV0U2VnbWVudC54OwogIGZsb2F0IGVhID0gdl9kb251dFNlZ21lbnQueTsKICAvLyAtMiBmbGF0IHNoYWRlZCB3aXRoIGFudGkgYWxpYXNpbmcKICAvLyAtMSBmbGF0IHNoYWRlZAogIC8vIDAuLjIgLT4gdGV4dAogIC8vIDMgLT4gZm9udEljb25zCiAgLy8gNC4uLjcgLT4gaW1hZ2VzCiAgaW50IHRleHR1cmVCYW5rID0gcm91bmRUb0ludCh2X3RleHR1cmVCYW5rLngpOwogIGJvb2wgaGFzQ2lyY2xlU2VnbWVudHMgPSBzYSAhPSAwLjAgfHwgZWEgIT0gMC4wOwogIGZsb2F0IHNlZ21lbnRBbmdsZTsKICBpZihoYXNDaXJjbGVTZWdtZW50cyB8fCBoYXNDaXJjbGVEYXNoZWRCb3JkZXIpIHsKICAgIGlmKHNhID4gUEkpIHsKICAgICAgc2EgLT0gMi4wICogUEk7CiAgICB9CiAgICBpZihlYSA+IFBJKSB7CiAgICAgIGVhIC09IDIuMCAqIFBJOwogICAgfSAgCiAgICBmbG9hdCB4ID0gdGV4dHVyZUNvb3Jkcy54IC0gMC41OwogICAgZmxvYXQgeSA9IHRleHR1cmVDb29yZHMueSAtIDAuNTsKICAgIHNlZ21lbnRBbmdsZSA9IGF0YW4oeSx4KTsKICB9CiAgaWYoc2hhZG93Q2FudmFzKSB7CiAgICAvLyBFeGNsdWRlIGZyb20gc2hhZG93CiAgICBpZihzaGFkb3dUeXBlID09IC0xKXsKICAgICAgICBkaXNjYXJkOwogICAgfSBlbHNlIHsKICAgICAgdmVjNCBjb2xvckEgPSB2X2hpdFRlc3RDb2xvdXIgLyAyNTUuMDsKICAgICAgaWYoaXNDaXJjbGUpIHsKICAgICAgICBpZih0ZXh0dXJlQmFuayA9PSAtMSkgewogICAgICAgICAvLyBmb3Igb2Zmc2V0IGNpcmNsZXMKICAgICAgICAgY2lyY2xlQ2VudHJlID0gdl90ZXhDb29yZC54eTsKICAgICAgICB9CiAgICAgICAgZmxvYXQgZGlzdCA9IGRpc3RhbmNlKHZfdGV4Q29vcmQuencsIGNpcmNsZUNlbnRyZSk7CiAgICAgICAgZmxvYXQgYm9yZGVyID0gMC41IC0gd2lkdGg7CiAgICAgICAgY29sb3JBICo9IHN0ZXAoMC41ICsgdl9waXhlbC8yLjAsICAxLjAgLSBkaXN0KTsKICAgICAgICBpZih3aWR0aCA+IDAuMCkgewogICAgICAgICAgY29sb3JBICo9IHN0ZXAoYm9yZGVyLCBkaXN0KTsKICAgICAgICB9IAogICAgICAgIGlmKGhhc0NpcmNsZVNlZ21lbnRzKSB7CiAgICAgICAgICAvLyBmb3IgZG9udXQgc2VnbWVudHMgdGhhdCBjcm9zcyBiZXR3ZWVuIFBJIGFuZCAtUEkgCiAgICAgICAgICBpZihzYSA+PSBlYSkgewogICAgICAgICAgIGNvbG9yQSAqPSBzdGVwKHNhLCBzZWdtZW50QW5nbGUpICsgKDEuMCAtIHN0ZXAoZWEsIHNlZ21lbnRBbmdsZSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICBjb2xvckEgKj0gc3RlcChzYSwgc2VnbWVudEFuZ2xlKTsKICAgICAgICAgICBjb2xvckEgKj0gMS4wIC0gc3RlcChlYSwgc2VnbWVudEFuZ2xlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZ2xfRnJhZ0NvbG9yID0gY29sb3JBOwogICAgfQogIH0gZWxzZSBpZihvbmx5RHJhd09uU2hhZG93KXsKICAgIGRpc2NhcmQ7CiAgfSBlbHNlIHsKICAgICAgY29sb3JBID0gdl9jb2xvdXIgLyAyNTUuMDsKICAgICAgLy8gbG9hZCB0aGUgY29ycmVjdCB0ZXh0dXJlIGFuZCByZWFkIGl0CiAgICAgIGlmICh0ZXh0dXJlQmFuayA+PSAwKSB7CiAgICAgICAgICB2ZWM0IHRleENvb3JkOwogICAgICAgICAgLy8gc2V0IG1pcG1hcCBsZXZlbCBiaWFzIHRvIHNoYXJwZW4gdGV4dHVyZXMKICAgICAgICAgIGZsb2F0IGJpYXMgPSAtMi4wLzMuMDsKICAgICAgICAgIGZsb2F0IHRleHRCaWFzID0gLTAuODsKICAgICAgICAgIC8vdGV4dCAwCiAgICAgICAgICBpZih0ZXh0dXJlQmFuayA9PSAwKSAgewogICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbMF0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgIC8vdGV4dCAxCiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gMSkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzFdLCB2X3RleENvb3JkLnh5LCB0ZXh0Qmlhcyk7CiAgICAgICAgICAvLyB0ZXh0IDIKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSAyKSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbMl0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgIC8vIGZvbnRJY29ucyAzIAogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDMpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVszXSwgdl90ZXhDb29yZC54eSwgYmlhcyk7CiAgICAgICAgICAvLyBpbWFnZSA0ICAgCiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gNCkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzRdLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgIC8vIGltYWdlIDUgICAKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSA1KSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbNV0sIHZfdGV4Q29vcmQueHksIGJpYXMpOwogICAgICAgICAgLy8gaW1hZ2UgNgogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDYpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVs2XSwgdl90ZXhDb29yZC54eSwgYmlhcyk7ICAgICAKICAgICAgICAgIC8vIGltYWdlIDcgICAKICAgICAgICAgIH0gZWxzZSAgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzddLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmKHRleHR1cmVCYW5rID49IDQpIHsKICAgICAgICAgICAgY29sb3JBID0gdmVjNChjb2xvckEucmdiICAqIHRleENvb3JkLnJnYixjb2xvckEuYSAqIHRleENvb3JkLmEpOwogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDMpewogICAgICAgICAgICBmbG9hdCBjb2xvdXJDb21wb25lbnQgPSByZWFkQ29sb3VyQ29tcG9uZW50RnJvbVRleHR1cmUodl90ZXh0dXJlQmFuay55LCB0ZXhDb29yZCk7CiAgICAgICAgICAgICAvLyBkb24ndCB3aGl0ZSBib29zdCBvbiBmb250IGljb25zIGFzIGl0IG1ha2VzIHRoZW0gbG9vayBqYWdnaWVkIAogICAgICAgICAgICBjb2xvckEgPSBnZXRDb2xvdXJGcm9tQ29tcG9uZW50KGNvbG91ckNvbXBvbmVudCwgY29sb3JBLCAwLjApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmxvYXQgY29sb3VyQ29tcG9uZW50ID0gcmVhZENvbG91ckNvbXBvbmVudEZyb21UZXh0dXJlKHZfdGV4dHVyZUJhbmsueSwgdGV4Q29vcmQpOyAgICAKICAgICAgICAgICAgY29sb3JBID0gZ2V0Q29sb3VyRnJvbUNvbXBvbmVudChjb2xvdXJDb21wb25lbnQsIGNvbG9yQSwgMS4wKTsKICAgICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0ZXh0dXJlQmFuayA9PSAtMikgewogICAgICAgIC8vIFRleHQgY29vcmRzIGFyZSBiYXJ5Y2VudHJpYywgdXNlZCBmb3IgYWEgdHJpYW5nbGVzCiAgICAgICAgZmxvYXQgYWxwaGEgPSBjb2xvckEuYTsKICAgICAgICBjb2xvckEgPSB2ZWM0KGNvbG9yQS5yZ2IgICogYWxwaGEsIGFscGhhKTsKICAgICAgICBjb2xvckEgKj0gYWFzdGVwKDAuMDUsIGVkZ2VGYWN0b3Iodl90ZXhDb29yZC54eXopKTsgCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZmxhdCBzaGFkZWQgcmVjdCBvciB0cmlhbmdsZSwganVzdCBhcHBseSB0aGUgY29sb3VyCiAgICAgICAgZmxvYXQgYWxwaGEgPSBjb2xvckEuYTsKICAgICAgICBjaXJjbGVDZW50cmUgPSB2X3RleENvb3JkLnh5OwogICAgICAgIGNvbG9yQSA9IHZlYzQoY29sb3JBLnJnYiAgKiBhbHBoYSwgYWxwaGEpOwogICAgICB9CiAgICAgIAogICAgICBpZihpc0NpcmNsZSkgewogICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2Uodl90ZXhDb29yZC56dywgY2lyY2xlQ2VudHJlKTsKICAgICAgICAgLy8gYWRkIGEgMS8zIG9mIGEgcGl4ZWwgcGFkZGluZyBmb3Igc21vb3RoIGVkZ2VzIGFyb3VuZCBib3JkZXIgIzI3NzEKICAgICAgICAgY29sb3JBICo9IGFhc3RlcCgwLjUsICAxLjAgLSB2X3BpeGVsLzMuMCAtIGRpc3QpOwogICAgICAgICBpZih3aWR0aCA+IDAuMCkgewogICAgICAgICAgLy8gZW5zdXJlIGJvcmRlciBjYW4ndCBiZSBzbWFsbGVyIHRoYW4gMSBwaXhlbAogICAgICAgICAgZmxvYXQgYm9yZGVyID0gMC41IC0gbWF4KHdpZHRoLCB2X3BpeGVsKSAtIHZfcGl4ZWwvMy4wIDsKICAgICAgICAgIGNvbG9yQSAqPSBhYXN0ZXAoYm9yZGVyLCBkaXN0KTsKICAgICAgICAgfQoKICAgICAgICAgLy8gVXNlZCB0byBkZWNpZGUgaG93IG11Y2ggYW50aSBhbGlhc2luZyB0byBhcHBseQogICAgICAgICBmbG9hdCBzbW9vdGhuZXNzID0gdl9waXhlbCoxLjU7CiAgICAgICAgIGZsb2F0IHNhRnJvbSA9IHNhIC0gc21vb3RobmVzczsKICAgICAgICAgZmxvYXQgc2FUbyA9IHNhICsgc21vb3RobmVzczsKICAgICAgICAgZmxvYXQgZWFGcm9tID0gZWEgLSBzbW9vdGhuZXNzOwogICAgICAgICBmbG9hdCBlYVRvID0gZWEgKyBzbW9vdGhuZXNzOwogICAgICAgICBpZihoYXNDaXJjbGVTZWdtZW50cykgewogICAgICAgICAgIC8vIGZvciBkb251dCBzZWdtZW50cyB0aGF0IGNyb3NzIGJldHdlZW4gUEkgYW5kIC1QSSAKICAgICAgICAgICBpZihzYSA+PSBlYSkgewogICAgICAgICAgICAgY29sb3JBICo9IHNtb290aHN0ZXAoc2FGcm9tLCBzYVRvLCBzZWdtZW50QW5nbGUpICsgKDEuMCAtIHNtb290aHN0ZXAoZWFGcm9tLCBlYVRvLCBzZWdtZW50QW5nbGUpKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgY29sb3JBICo9IHNtb290aHN0ZXAoc2FGcm9tLCBzYVRvLCBzZWdtZW50QW5nbGUpOwogICAgICAgICAgICAgY29sb3JBICo9IDEuMCAtIHNtb290aHN0ZXAoZWFGcm9tLCBlYVRvLCBzZWdtZW50QW5nbGUpOwogICAgICAgICAgIH0KICAgICAgICAgfSBlbHNlIGlmKGhhc0NpcmNsZURhc2hlZEJvcmRlcikgewogICAgICAgICAgZmxvYXQgZGFzaExlbmd0aCA9IGJvcmRlcldpZHRoOwogICAgICAgICAgZmxvYXQgZ2FwV2lkdGggPSBkYXNoTGVuZ3RoLzIuMDsKICAgICAgICAgIGZsb2F0IGNpcmN1bWZlcmVuY2UgPSAyLjAgKiBQSSAqICh2X2NpcmNsZVJhZGl1cy8yLjApOwogICAgICAgICAgZmxvYXQgYW5nbGVBcm91bmRDaXJjbGUgPSBzZWdtZW50QW5nbGUgLyAoMi4wKlBJKTsKICAgICAgICAgIGZsb2F0IGRhc2hlcyA9IGZsb29yKChjaXJjdW1mZXJlbmNlICsgZ2FwV2lkdGgpIC8gKGRhc2hMZW5ndGggKyBnYXBXaWR0aCkgLSAxLjAgKTsKICAgICAgICAgIGZsb2F0IGRhc2ggPSBzaW4oKChhbmdsZUFyb3VuZENpcmNsZSAqIGRhc2hlcykpICogKDIuMCAqIFBJKSk7CiAgICAgICAgICAvLyBzbW9vdGggYW5kIGN1dCBvdXQgYSBnYXAgd2hlbiB0aGUgc2luZSB3YXZlIGlmIHBhc3QgdGhlIGRhc2hUaHJlc2hvbGQKICAgICAgICAgIGNvbG9yQSAqPSBhYXN0ZXAoLTAuNSwgIGRhc2gpOwogICAgICAgICB9CiAgICAgICAgIAogICAgICAvLyBkcmF3IGEgc3F1YXJlIGJvcmRlciwgZmlsbCBhIHNxdWFyZSBhbmQgY3V0IG91dCB0aGUgY2VudHJlCiAgICAgIH0gZWxzZSBpZihoYXNSZWN0YW5nbGVCb3JkZXIpIHsKICAgICAgICAvLyByZXR1cm5zIDAgd2hlbiBib3JkZXIgaXMgbGFyZ2VyIHRoYW4gb25lIHNjcmVlbiBwaXhlbAogICAgICAgIGZsb2F0IGlzQm9yZGVyTGVzc1RoYW4xUGl4ZWwgPSAxLjAgLSBzdGVwKDEuMCwgYm9yZGVyV2lkdGgqdV96b29tKTsKICAgICAgICBmbG9hdCB1bml0c1BlclNjcmVlblBpeGVsID0gKDEuMCAvIHVfem9vbSk7CiAgICAgICAgLy8gSWYgdGhlIGJvcmRlciB3aWR0aCBpbiBzY3JlZW4gcGl4ZWxzIGlzIGxlc3MgdGhhbiBvbmUsIHNldCBpdCB0byAxIHNjcmVlbiBwaXhlbAogICAgICAgIGZsb2F0IGJvcmRlcldpZHRoWm9vbSA9IG1heChib3JkZXJXaWR0aCwgaXNCb3JkZXJMZXNzVGhhbjFQaXhlbCAqIHVuaXRzUGVyU2NyZWVuUGl4ZWwpOwogICAgICAgIGZsb2F0IHRvcExlZnQgPSBzdGVwKHZfdGV4Q29vcmQueCwgYm9yZGVyV2lkdGhab29tKTsKICAgICAgICBmbG9hdCB0b3BSaWdodCA9IHN0ZXAodl90ZXhDb29yZC55LCBib3JkZXJXaWR0aFpvb20pOwogICAgICAgIGZsb2F0IGJvdHRvbUxlZnQgPSBzdGVwKHZfdGV4Q29vcmQueiAtIHZfdGV4Q29vcmQueCwgYm9yZGVyV2lkdGhab29tKTsKICAgICAgICBmbG9hdCBib3R0b21SaWdodCA9IHN0ZXAodl90ZXhDb29yZC53IC0gdl90ZXhDb29yZC55LCBib3JkZXJXaWR0aFpvb20pOwogICAgICAgIGZsb2F0IHRvcCA9IG1heCh0b3BMZWZ0LCB0b3BSaWdodCk7IAogICAgICAgIGZsb2F0IGJvdHRvbSA9IG1heChib3R0b21MZWZ0LCBib3R0b21SaWdodCk7IAogICAgICAgIGNvbG9yQSAqPSBtYXgodG9wLCBib3R0b20pOwogICAgICB9CiAgICAgIGdsX0ZyYWdDb2xvciA9IGNvbG9yQTsKICAgfQp9");
}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjNCBhX3RleENvb3JkOwphdHRyaWJ1dGUgdmVjNCBhX2hpdFRlc3RDb2xvdXI7CmF0dHJpYnV0ZSB2ZWMyIGFfdGV4dHVyZUJhbms7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9jaXJjbGVSYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3dpZHRoOwphdHRyaWJ1dGUgZmxvYXQgYV9zdGFydEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV9lbmRBbmdsZTsKCnVuaWZvcm0gdmVjMyB1X3Jlc29sdXRpb247CnVuaWZvcm0gbWF0NCB1X3RyYW5zZm9ybTsKdW5pZm9ybSBmbG9hdCB1X3pvb207Cgp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl9jaXJjbGVSYWRpdXM7CnZhcnlpbmcgdmVjNCB2X3RleENvb3JkOwp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgdmVjNCB2X2hpdFRlc3RDb2xvdXI7CnZhcnlpbmcgdmVjMiB2X3RleHR1cmVCYW5rOwp2YXJ5aW5nIGZsb2F0IHZfcGl4ZWw7CnZhcnlpbmcgdmVjMiB2X2RvbnV0U2VnbWVudDsKCgp2b2lkIG1haW4oKSB7CiAgIC8vIGNvbnZlcnQgdGhlIHJlY3RhbmdsZSBmcm9tIHBpeGVscyB0byAwLjAgdG8gMS4wCiAgIHZlYzIgemVyb1RvT25lID0gYV9wb3NpdGlvbiAvIHVfcmVzb2x1dGlvbi54eTsKICAgLy8gY29udmVydCBmcm9tIDAtPjEgdG8gMC0+MgogICB2ZWMyIHplcm9Ub1R3byA9IHplcm9Ub09uZSAqIDIuMDsKCiAgIC8vIGNvbnZlcnQgZnJvbSAwLT4yIHRvIC0xLT4rMSAoY2xpcHNwYWNlKQogICB2ZWMyIGNsaXBTcGFjZSA9IHplcm9Ub1R3byAtIDEuMDsKCiAgIGdsX1Bvc2l0aW9uID0gdV90cmFuc2Zvcm0gKiB2ZWM0KGNsaXBTcGFjZSAqIHZlYzIoMSwgLTEpLCAwLCAxKTsKCiAgIC8vIHBhc3MgdGhlIHRleENvb3JkIHRvIHRoZSBmcmFnbWVudCBzaGFkZXIKICAgLy8gVGhlIEdQVSB3aWxsIGludGVycG9sYXRlIHRoaXMgdmFsdWUgYmV0d2VlbiBwb2ludHMuCiAgIHZfdGV4Q29vcmQgPSBhX3RleENvb3JkOwogICB2X2NvbG91ciA9IGFfY29sb3VyOwogICB2X2hpdFRlc3RDb2xvdXIgPSBhX2hpdFRlc3RDb2xvdXI7CiAgIHZfdGV4dHVyZUJhbmsgPSBhX3RleHR1cmVCYW5rOwogICB2X2NpcmNsZVJhZGl1cyA9IGFfY2lyY2xlUmFkaXVzOwogICB2X3dpZHRoID0gYV93aWR0aDsKICAgLy8gdGhlIHNpemUgb2YgYSBwaXhlbCBpbiBzY3JlZW5zcGFjZSBjbGlwIGNvb3JkaW5hdGVzCiAgIHZfcGl4ZWwgPSAxLjAgLyAoYV9jaXJjbGVSYWRpdXMgKiAyLjApIC8gdV96b29tOwogICB2X2RvbnV0U2VnbWVudCA9IHZlYzIoYV9zdGFydEFuZ2xlLCBhX2VuZEFuZ2xlKTsKfQo=")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2U7CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2dsb2JhbEFscGhhOwoKLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci4KdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHVfaW1hZ2UsIHZfdGV4Q29vcmQpICogdV9nbG9iYWxBbHBoYTsKfQo=")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjMiBhX3RleENvb3JkOwoKdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgIGdsX1Bvc2l0aW9uID0gdmVjNChhX3Bvc2l0aW9uLCAwLjAsMS4wKTsKICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7Cn0K")}(),function(){function e(e,t,n){return function(){if(!n||!n()){var r,i=t[e];return i&&(r=i.apply(null,arguments)),r}}}var t=KeyLines.Common={};t.frameManager=function(e,t){function n(){return{all:!0,colours:!0,textures:!0,positions:!0,shadow:!0}}function r(){l.all=!1,l.colours=!1,l.textures=!1,l.positions=!1,l.shadow=!1}var i=Date.now(),a=i>>10,o=0,u=!1,l=n(),s=!0,f=0;return{frameRate:function(){return f},update:function(){var n=Date.now(),c=n>>10;c>a?(f=Math.round(o/(c-a)),o=0,a=c):o++;var d=t(n-i);i=n,u=u||d,u&&(u=!1,s&&(e(null,l),u||r()))},redraw:function(e){u=!0,e=e||n(),l.all||(l.all=e.all),l.positions||(l.positions=e.positions),l.shadow||(l.shadow=e.shadow),l.textures||(l.textures=e.textures),l.colours||(l.colours=e.colours)},allowDraw:function(e){e&&!s&&(u=!0),s=e}}},t.buildAnimatorInstance=function(e,t){var n=!0;return{rebuild:t,animate:function(t){var r=e(t,n);return n=!1,r}}},t.animator=function(e){var t=[],n=[];return{push:function(e,r){e&&(e.queue=r,r?n.push(e):t.push(e))},cancel:function(){t=[],n=[],e()},animate:function(r,i,a){var o=!1,u=!1;if(t.length>0){var l=t;t=[];for(var s=!1,f=0;f<l.length;f++){var c=l[f].rebuild;l[f].animate(r)?(u=u||l[f].queue,t.push(l[f])):c&&!c.drawOnly&&(s=!0),e(c)}s&&!u&&0===t.length&&e({all:!0}),o=!0}return u||n.length>0&&(t.push(n.shift()),o=!0),i&&i.animate&&(i.animate(r),o=!0),a&&(o=o||a.animated()),o}}},t.makeValueAnimator=function(e,n){var r,i,a,o;return function(u,l,s){var f=n();f===u||o&&i===u||(r=f,i=u,a=0,o||(o=t.buildAnimatorInstance(function(e){a=Math.min(l,a+e);var t=0>=l?i:r+(i-r)*a/l;n(t);var u=l>a;return u||(o=null,KeyLines.Util.invoke(s)),u}),e.push(o,!1)))}};var n=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];t.appendActions=function(t,r,i){for(var a=0;a<n.length;a++)t[n[a]]=e(n[a],r,i)},t.hitTester=function(e,t,n,r){function i(e,i){o.clear(e,t,n),o.backFill(e,u,1,t,n,!1),r.drawShadowCanvas(e,i),l=!1}var a,o=KeyLines.Rendering,u=o.randomColour(),l=!0,s=5,f=function(){var e={},t={};return{getColour:function(n){var r=e[n];return r||(r=o.randomColour(t),e[n]=r,t[r]=n),r},getId:function(e){return t[e]||null}}}();r.setShadowColourMap(f);var c={};return c.test=function(t,n,r,i,a){var d=[0,0,0];a&&a.webgl?d=a.webglCanvas.renderer.drawShadowCanvas(Math.floor(t),Math.floor(n)):(l&&c.draw(r),d=e.getImageData(Math.floor(t),Math.floor(n),1,1).data);var g=o.rgbtostring(d[0],d[1],d[2]);if(g===u)return null;var h=f.getId(g);return h?h:a&&a.webgl?null:(i=i||1,i>s?null:t+i>s&&n+i>s?c.test(t-1,n-1,r,++i,a):c.test(t+1,n+1,r,++i,a))},c.dirty=function(){l=!0},c.debugCanvas=function(e){a=e},c.draw=function(t){i(e,t),a&&i(a,t)},c}}(),function(){var e=KeyLines.DateTime={},t=e.defaultLocale={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},n=[31,28,31,30,31,30,31,31,30,31,30,31],r=e.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},i=function(e,t){return t?e-e%t:0},a=function(e){if(e<r.milli||r.year<e)throw new Error("bad unit range")},o=function(e,t){return 1===e&&u(t)?29:n[e]},u=function(e){return 1===new Date(e,1,29).getMonth()};e.UTCify=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e.unUTCify=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},e.clear=function(e,t,n){a(t);var o=new Date(e);switch(t>r.milli&&o.setUTCMilliseconds(0),t>r.sec&&o.setUTCSeconds(0),t>r.min&&o.setUTCMinutes(0),t>r.hour&&o.setUTCHours(0),t>=r.month&&o.setUTCDate(1),t>=r.year&&o.setUTCMonth(0),t){case r.milli:o.setUTCMilliseconds(i(o.getUTCMilliseconds(),n));break;case r.sec:o.setUTCSeconds(i(o.getUTCSeconds(),n));break;case r.min:o.setUTCMinutes(i(o.getUTCMinutes(),n));break;case r.hour:o.setUTCHours(i(o.getUTCHours(),n));break;case r.day:break;case r.week:var u=o.getUTCDay(),l=u>=1?u-1:6;o.setTime(o.getTime()-24*l*60*60*1e3);break;case r.month:o.setUTCMonth(i(o.getUTCMonth(),n));break;case r.year:o.setUTCFullYear(i(o.getUTCFullYear(),n))}return o.getTime()};var l=e.add=function(e,t,n){if(a(t),t<=r.week){var i=n;return t>r.milli&&(i*=1e3),t>r.sec&&(i*=60),t>r.min&&(i*=60),t>r.hour&&(i*=24),t>r.day&&(i*=7),e+i}var s=new Date(e);switch(t){case r.month:var f=s.getUTCMonth()+n,c=f%12,d=Math.floor(f/12);0>c&&(c+=12);var g=s.getUTCDate();g=Math.min(g,o(c,s.getUTCFullYear()+d)),s.setUTCDate(g),s.setUTCMonth(c),0!==d&&s.setTime(l(s.getTime(),r.year,d));break;case r.year:if(1===s.getUTCMonth()&&29===s.getUTCDate()){var h=s.getUTCFullYear()+n;u(h)||s.setTime(l(s.getTime(),r.day,-1))}s.setUTCFullYear(s.getUTCFullYear()+n)}return s.getTime()},s=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},f=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),c={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return s(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return s(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){return s(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return s(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return s(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return s(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return s(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return s(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return s(e.getUTCFullYear()%100)}};e.format=function(e,n,r){return"number"==typeof e&&(e=new Date(e)),r=r||t,n.replace(f,function(t){return c[t](e,r)})};var d="(?::)?",g="(?:-|$)",h="(?:T|$)",v=function(e,t){return e[t]?parseInt(e[t],10):void 0},m=function(e,t,n,r){var i=v(e,t);return y(i)?i>=n&&r>=i?i:void 0:n},y=function(e){return"undefined"!=typeof e},x=new RegExp("^(\\d{4})"+g+"(\\d{2})?"+g+"(\\d{2})?"+h+"(\\d{2})?"+d+"(\\d{2})?"+d+"(\\d{2})?(?:Z)?(\\+|-)?(\\d{2})?"+d+"(\\d{2})?");e.parseISO8601=function(e){var t=x.exec(e);if(t){var n=v(t,1),r=m(t,2,1,12),i=m(t,3,1,31),a=m(t,4,0,23),u=m(t,5,0,59),l=m(t,6,0,59),s="-"===t[7]?-1:1,f=m(t,8,0,12),c=m(t,9,0,59);if(!(y(n)&&y(r)&&y(i)&&y(a)&&y(u)&&y(l)&&y(f)&&y(c)))return;if(i>o(r-1,n))return;var d=s*(60*f+c)*60*1e3;return new Date(Date.UTC(n,r-1,i,a,u,l)-d)}}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateFontIcon=function(t,n,r,i){var a=0,o=t.wsc||[0,0,0,0];if(r.alwaysUpdate||r.rebuildOptions.all)for(a=0;e>a;a++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(a=0;e>a;a++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[0],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[1],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[2],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[3];if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var u=t.x1,l=t.y1,s=t.x2,f=t.y2;i&&(u=t.x1+i.x,l=t.y1+i.y,s=t.x2+i.x,f=t.y2+i.y);var c=r.triangleBuffers.positionIndex,d=r.triangleBuffers.positionData;d[c++]=u,d[c++]=l,d[c++]=0,d[c++]=s,d[c++]=l,d[c++]=0,d[c++]=u,d[c++]=f,d[c++]=0,d[c++]=u,d[c++]=f,d[c++]=0,d[c++]=s,d[c++]=l,d[c++]=0,d[c++]=s,d[c++]=f,d[c++]=0,r.triangleBuffers.positionIndex=c}(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all)&&(r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0)}}}(),function(){var e=KeyLines.Combo=KeyLines.Combo||{};e.create=function(e,t){function n(t){var n;do n=t+ ++q;while(e.privateGetItem(n));return n}function r(e){["id","id1","id2"].forEach(function(t){t in e&&(e[t]+="")})}function i(t){var n=[];do{n.unshift(t);var r=e.privateGetItem(t);t=r&&r._parentId}while(t);return n}function a(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function o(e,t){return j.isNullOrUndefined(t.label)?e.map(function(e){return e.t}).filter(function(e){return!j.isNullOrUndefined(e)}).join("\n"):t.label}function u(t){return t.reduce(function(t,n){var r=e.privateGetItem(n),i=r.hi?0:1;return t+(r._combo?u(r._combo.nodeIds):i)},0)}function l(e){var t=0,n=0;return e.forEach(function(e){t+=e.x||0,n+=e.y||0}),{x:t/e.length,y:n/e.length}}function s(n,r,i,a,o){var u,s=0|i.dx,c=0|i.dy;if(t&&t.api.isShown()&&f(n.pos)){var d=t.api.viewCoordinates(n.pos.lat,n.pos.lng);u=e.worldCoordinates(d.x,d.y)}else u="first"===i.position?r[0]:l(r);n.x=u.x,n.y=u.y,r.forEach(function(e){a.push({id:e.id,_parentId:n.id,_offset:{x:n.x-e.x-s,y:n.y-e.y-c}}),o.push({id:e.id,x:u.x,y:u.y})})}function f(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}function c(e,t){if("first"!==e.position){var n=0,r=0,i=0;return t.forEach(function(e){f(e.pos)&&(r+=e.pos.lat,i+=e.pos.lng,n++)}),n>0?{lat:r/n,lng:i/n}:void 0}for(var a=0,o=t.length;o>a;a++){var u=t[a];if(f(u.pos))return u.pos}}function d(e,t,r){var i=e.style,a=j.clone(i||t[0],!0);if(a.type="node",a.id=n(J),a.t=o(t,e),a._combo={nodeIds:t.map(function(e){return e.id}),linkIds:r.map(function(e){return e.id})},i&&!j.isNullOrUndefined(i.hi)?a.hi=i.hi:a.hi=t.every(function(e){return e.hi}),a.g=a.g||[],null!==e.glyph){var l={p:"ne",c:"rgb(255, 0, 0)",t:u(a._combo.nodeIds)};l=j.merge(l,e.glyph||{}),a.g.unshift(l)}return a.pos=i&&f(i.pos)?i.pos:c(e,t),j.isNormalObject(e.d)&&(a.d=j.clone(e.d)),a}function g(e,t,r){var i=n(Q),a=!1,o=!1;r.ab.forEach(function(e){a=e.a1||a,o=e.a2||o}),r.ba.forEach(function(e){a=e.a2||a,o=e.a1||o});var u=!1,l=r.ab.concat(r.ba).map(function(e){return u=u||!e.hi,e.id}),s=j.clone(r.ab[0]||r.ba[0],!0);return s.id=i,s.id1=e,s.id2=t,s.a1=a,s.a2=o,s._combo={linkIds:l},s.hi&&u&&delete s.hi,s.off=0,s}function h(e,t){return{id:e,_parentId:t}}function v(t,n){return n.hi=!e.privateBothEndsShown(t),n.bg=!e.privateBothEndsForeground(t),n}function m(t,n){var r={};return t.forEach(function(t){var i=e.privateGetItem(t),a=e.privateTopParent(i.id1),o=e.privateTopParent(i.id2);if(a===i.id1&&o===i.id2)n.push(v(i,h(i.id)));else{var u=o>=a?a:o,l=o>=a?o:a,s=o>=a?"ab":"ba";r[u]=r[u]||{},r[u][l]=r[u][l]||{ab:[],ba:[]},r[u][l][s].push(i)}}),r}function y(t,n,r,i){var a={};t.forEach(function(t){t._combo?(n.push(t.id),t._combo.linkIds.forEach(function(t){var r=e.privateGetItem(t);n.indexOf(r.id1)>-1||n.indexOf(r.id2)>-1?n.push(t):a[t]=!0})):a[t.id]=!0});var o=m(Object.keys(a),i);Object.keys(o).forEach(function(e){var t=o[e];Object.keys(t).forEach(function(n){var a=t[n],o=g(e,n,a);j.values(a).forEach(function(e){e.forEach(function(e){i.push(h(e.id,o.id))})}),r.push(o)})})}function x(t,n,r){function i(){e.privateSetNonImageProperties(f),f=[],y(o,l,u,f),e.privateRemoveItem(l),e.privateSetNonImageProperties(f),e.privateMerge(u,function(){if(n.select)e.selection(g),e.trigger("selectionchange");else{var t=e.selection(),i=e.privateGetItem(t).reduce(function(e,t){return t._parentId||e.push(t.id),e},[]);t.length!==i.length&&(e.selection(i),e.trigger("selectionchange"))}j.invoke(r,g)})}t=j.ensureArray(t),n=j.defaults(n,{animate:!0,select:!0,time:250});var o=[],u=[],l=[],f=[],c=[],g=[],h={};t.forEach(function(t){var n=e.privateGetTopItem(t.ids);if(n.forEach(function(e){if(!e||"node"!==e.type)throw new Error("[Combine] function must be passed valid ids");if(h[e.id])throw new Error("[Combine] nodes should only be in one combo");h[e.id]=!0}),!j.values(h).length)throw new Error("[Combine] function must be passed at least one node id");var r=a(t.ids),i=e.privateGraph().neighbours(t.ids,{all:!0}),l=e.privateGetItem(i.links),v=[];l.forEach(function(e){r[e.id1]&&r[e.id2]?v.push(e):o.push(e)});var m=d(t,n,v);s(m,n,t,f,c),v.forEach(function(e){f.push({id:e.id,_parentId:m.id})}),u.push(m),g.push(m.id)}),n.animate?e.animateProperties(c,{time:n.time},i):i()}function b(t,n,r){t._combo.linkIds.forEach(function(t){var i=e.privateGetItem(t);if(i._combo){var a=e.privateGetItem(i._combo.linkIds);a.forEach(function(e){n.push(h(e.id))}),r.push(i.id)}else n.push(v(i,h(i.id)))})}function p(e,n){if(t&&t.api.isShown()){var r=t.internalUse.preMerge([n]);return{id:n.id,hi:r[0].hi,x:r[0].x,y:r[0].y}}return{id:n.id,x:e.x-n._offset.x,y:e.y-n._offset.y}}function I(e,t){return t.x=e.x,t.y=e.y,t}function w(t,n,r,i,a,o){o=o||{x:n.x,y:n.y},n._combo.nodeIds.forEach(function(n){var u=e.privateGetItem(n);u._combo?w(t,u,r,i,a,p(o,u)):(r.push(I(t,h(u.id))),a.push(p(o,u)))}),b(n,r,i),i.push(n.id)}function C(t,n,r,i){t._combo.nodeIds.forEach(function(r){n.push(I(t,h(r))),i.push(p(t,e.privateGetItem(r)))}),t._combo.linkIds.forEach(function(t){n.push(v(e.privateGetItem(t),h(t)))}),r.push(t.id)}function B(t,n,r){n&&(e.selection(t),e.trigger("selectionchange")),j.invoke(r)}function A(t,n,r){n=j.defaults(n,{animate:!0,time:250,full:!1,select:!0});var i=[],a=[],o=[],u=[],l=e.selection();if(t=j.ensureArray(t).filter(function(e){return k(e,"node")}),0===t.length)return j.invoke(r);var s=e.privateGraph().neighbours(t,{all:!0}),f=e.privateGetItem(s.links);t.forEach(function(t){i.push(t);var r=e.privateGetItem(t);if(n.full)w(r,r,o,i,u);else{C(r,o,i,u);for(var a=e.privateGetItem(r._combo.nodeIds),l=0,s=a.length;s>l;l++){var f=a[l];if(f._combo){var c=e.privateGetItem(f._combo.nodeIds);M(f,c)}}}}),e.privateSetNonImageProperties(o);var c=[];y(f,i,a,c),e.privateSetNonImageProperties(c),e.privateRemoveItem(i),e.privateMerge(a,function(){var i;n.select&&(i=o.filter(function(t){var n=e.privateGetItem(t.id);return"node"===n.type}).map(function(e){return e.id}));var a=!!n.select,s=!1,f=l.filter(function(e){var n=-1===t.indexOf(e);return n||(s=!0),n});n.animate?e.animateProperties(u,{time:n.time},function(){B(a?i:f,a||s,r)}):(e.privateSetNonImageProperties(u),B(a?i:f,a||s,r))})}function M(t,n){t.hi=!0,t.bg=!0;for(var r=0,i=n.length;i>r;r++){var a=n[r];if(a._combo&&M(a,e.privateGetItem(a._combo.nodeIds)),a.hi||(t.hi=!1),a.bg||(t.bg=!1),!t.hi&&!t.bg)return}}function Z(t,n){function r(e){e._combo?Z(e,n):n[e.type+"s"].push(e)}var i=t._combo;n=n||{nodes:[],links:[]};var a=i.nodeIds?e.privateGetItem(i.nodeIds):[],o=e.privateGetItem(i.linkIds);return o.forEach(r),a.forEach(r),n}function G(t){var n=null,r=e.privateGetItem(t),i=r&&r._combo;return i&&(n=Z(r,n)),j.clone(n,!0)}function L(e,t){if(e=j.ensureArray(e),t=j.defaults(t,{type:"all"}),!t.type.match(/^(node|link|all)$/))throw new TypeError("[isCombo] opts type property should be either 'node', 'link' or 'all'");return e.some(function(e){return R(e,t.type)})}function R(t,n){var r=e.privateGetItem(t);return!r||"all"!==n&&n!==r.type?!1:!!r._combo}function k(t,n){var r=e.privateGetItem(t);return R(t,n)&&!r._parentId}function E(t){if(j.isNullOrUndefined(t))throw new Error("[Find] Undefined argument passed");var n=!Array.isArray(t);t=j.ensureArray(t);var r=t.map(function(t){var n=e.privateTopParent(t),r=k(n,"all");return j.isNullOrUndefined(n)||!r?null:n});return n?r[0]:r}function S(e,t,n){return e.id1===t&&e.id2===n||e.id1===n&&e.id2===t}function T(t,n,r){var i=null;return r.forEach(function(e){"link"===e.type&&e._combo&&S(e,t,n)&&(i=e)}),e.privateEach({type:"link"},function(e){e._combo&&S(e,t,n)&&(i=e)}),i}function D(t,n){for(var r=i(t.id1),a=i(t.id2),o=r[0]!==a[0];r[0]===a[0];)r.shift(),a.shift();var u=r[0],l=a[0],s=T(u,l,n);if(s)t.id!==s.id&&(s._combo.linkIds.push(t.id),t._parentId=s.id,t.a1&&(s.id1===u?s.a1=!0:s.a2=!0),t.a2&&(s.id1===u?s.a2=!0:s.a1=!0),t.hi||delete s.hi);else if(s=g(u,l,{ab:[t],ba:[]}),t._parentId=s.id,n.push(s),!o){var f=e.privateGetItem(u)._parentId;e.privateGetItem(f)._combo.linkIds.push(s.id),s._parentId=f}}function W(t){function n(t){var i=t._combo,a=i.nodeIds?e.privateGetItem(i.nodeIds):[];i.linkIds.forEach(function(e){r[e]=!0}),a.forEach(function(e){r[e.id]=!0,e._combo&&n(e)})}t=j.ensureArray(t);var r={},i=[];return e.privateGetItem(t).forEach(function(e){e&&!e._parentId&&(r[e.id]=!0,e._combo&&("node"===e.type&&i.push(e.id),n(e)))}),e.privateGraph().neighbours(i,{all:!0}).links.forEach(function(t){r[t]=!0,n(e.privateGetItem(t))}),Object.keys(r)}function F(t){var n=[],i=[];return t=j.ensureArray(t),t=t.filter(function(t){var i=!1;r(t);var a=e.privateGetItem(t.id);if("node"===t.type)i=!(a&&a._parentId);else{if("link"!==t.type)throw new Error("The type of the item should be specified.");if(a&&"link"===a.type&&(a.id1!==t.id1||a.id2!==t.id2))throw new Error("You cannot change the ends of an existing link. You should remove the existing item first");if(i=t.id1!==t.id2||e.options().selfLinks,i&&!a){var o=e.privateGetItem(t.id1),u=e.privateGetItem(t.id2);(o&&o._parentId||u&&u._parentId)&&((o&&o._parentId)===(u&&u._parentId)?(t._parentId=o._parentId,e.privateGetItem(o._parentId)._combo.linkIds.push(t.id)):D(t,n))}}return i}),e.privateRemoveItem(i),t.concat(n)}function V(t,n){if(n.updateGlyph){var r=[];t.forEach(function(t){var n=e.getItem(t.id),i=t.nodes.length;n.g&&n.g.forEach(function(e){"ne"===e.p&&(e.t=i,r.push({id:n.id,g:n.g}))})}),e.privateSetNonImageProperties(r)}}function N(e,t,n,r){return e.some(function(e){var i=n[e.id]||r[e.id],a=!e[t];return i?n[e.id]:a})}function O(e,t,n,r){return e.filter(function(e){return n[e.id]||(r[e.id]?!1:!e[t])})}function X(t,n,r,i,a,o,u){var l={nodes:[],links:[]};return Object.keys(n).forEach(function(s){var f,c,d,g,h=n[s].toHide,v=n[s].toShow,m=e.privateGetItem(s),y=Z(m),x=y.links,b=O(x,t,v,h);if(m._combo.nodeIds){g="nodes";var p=y.nodes;c=d=O(p,t,v,h),f=N(p,t,v,h)}else g="links",c=b,f=N(x,t,v,h);if(g){if(c.length>0){var I={id:s,links:b};d&&(I.nodes=d),l[g].push(I)}f!==!m[t]&&(f?(r.push(s),a[o][g].push(s)):(i.push(s),a[u][g].push(s)))}}),a.combos=l}function U(t,n,r){e.privateGetItem(t).forEach(function(t){var i=e.privateTopParent(t._parentId);i&&(r[i]=r[i]||{toShow:{},toHide:{}},r[i][n][t.id]=t)})}function Y(e,t,n,r,i,a){var o={};return U(t,"toShow",o),U(n,"toHide",o),X(e,o,t,n,r,i,a)}function K(){var t=e.privateGetRawItems(),n={nodes:[],links:[]};return t.filter(function(e){return e._combo}).forEach(function(t){var r=t._combo;n[t.id]=j.clone(t,"d"),n[t.id]._combo=j.clone(r),"node"===t.type&&(n[t.id]._offsets=j.clone(r.nodeIds.map(function(t){return e.privateGetItem(t)._offset}),!0))}),n}function H(e,t){var n=e.combos,r=e.items,i={};Object.keys(n).forEach(function(e){if("nodes"!==e&&"links"!==e){var t=n[e],a=t._offsets;delete t._offsets,r.push(t),"node"===t.type&&t._combo.nodeIds.forEach(function(e,n){i[e]={_parentId:t.id,_offset:a[n]}}),t._combo.linkIds.forEach(function(e){i[e]={_parentId:t.id}})}}),r.forEach(function(e){i[e.id]&&j.merge(e,i[e.id])}),j.invoke(t)}function z(e,t){var n={},r=e.combos;r.nodes.forEach(function(t){var r=t.nodes.map(function(n){var r=j.merge({_parentId:t.id,_offset:{x:n.x,y:n.y}},n);return e.items.push(r),n.id});n[t.id]={type:"node",_combo:{nodeIds:r,linkIds:[]}}});var i=e.items;i.forEach(function(e){n[e.id]&&j.merge(e,n[e.id]),"link"===e.type&&0===e.id.indexOf(Q)&&j.merge(e,{_combo:{linkIds:[]}})}),j.invoke(t)}function _(t,n){var r=t.combos;r&&r.links&&r.links.length?e.privateMerge(F(r.links),n):j.invoke(n)}function P(e,t){if(e&&e.combos){var n=e.combos;n.links&&n.links.length||n.nodes&&n.nodes.length?z(e,t):H(e,t)}else j.invoke(t)}var j=KeyLines.Util,J="_combo_",Q="_combolink_",q=0,$={api:{combine:x,combineNodes:x,uncombine:A,info:G,isCombo:L,find:E},internalUse:{filter:function(e,t,n,r){return Y("hi",e,t,n,"shown","hidden"),V(n.combos.nodes,r),n},foreground:function(e,t,n){return Y("bg",e,t,n,"foreground","background"),n},preMerge:F,preDelete:W,serialize:K,preLoadUp:P,postLoadUp:_}};return $}}(),function(e){function t(e,t,n,r){r||(r=!1),e.addEventListener(t,n,r)}function n(e,n){for(var r=0;r<e.length;r++)t(document,e[r],n)}function r(e,t){for(var n=[],r=0;r<e[t].length;r++){var i=A(e[t][r]);n.push({id:e[t][r].identifier,x:i.x,y:i.y})}return n}function i(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function a(){function e(e,n){t(document,e,function(t){t.target.id in I&&(I[t.target.id][e](r(t,"targetTouches"),r(t,"changedTouches")),n&&t.preventDefault())})}function a(e){t(document,e,function(e){e.target.id in I&&e.preventDefault()})}function o(e){t(document,e,function(t){t.target.id in I&&(I[t.target.id][e](t.scale,t.rotation),t.preventDefault())})}function u(e,t){var n=e.pointerId||0,r=A(e),i=[];switch(t){case"ADD":w[n]||(w[n]={id:n,x:r.x,y:r.y});break;case"DEL":w[n]&&(delete w[n],C--);break;case"MOVE":w[n]&&(w[n]={id:n,x:r.x,y:r.y})}for(var a in w)i.push(w[a]);return i}function l(e,t){var n=e.pointerId||0,r=A(e),i=[];switch(t){case"ADD":case"MOVE":i=[{id:n,x:r.x,y:r.y}];break;case"DEL":i=[w[n]]}return i}function s(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function f(e){B[e]=new MSGesture,B[e].target=document.getElementById(e)}function c(){m=1,y=0}function d(e,t){return function(n){if(n.target.id in I&&s(n)){var r=l(n,t);I[n.target.id][e](u(n,t),r),n.preventDefault()}}}function g(e){function t(t){if(s(t)){var n="DEL";for(var r in I){var i=l(t,n);I[r][e](u(t,n),i);var a=t.target.id;a&&I[a]&&t.preventDefault()}}}return t}function h(e,t,n,r){if(e!==t){if(null!==t&&I[t]&&document.getElementById(t)){var i=M(r,t);I[t][n](i.x,i.y,r.ctrlKey,r.shiftKey)}"mouseleave"===n&&(G=e)}}function v(e){var t=e.wheelDelta||-e.detail;if(0!==t){var n=I[e.target.id];if(n){var r=A(e);n.mousewheel(t,r.x,r.y),i(e)}}}t(document,"contextmenu",function(e){return e.target.id in I?(i(e),!1):void 0}),t(document,"dragover",function(e){if(e.target.id in I){var t=A(e);I[e.target.id].dragover(t.x,t.y)}}),"ontouchstart"in document.documentElement&&(window.PointerEvent?(a("touchstart"),a("touchmove"),a("touchend"),a("touchcancel")):(e("touchstart",!0),e("touchmove"),e("touchend"),e("touchcancel"),o("gesturestart"),o("gesturechange"),o("gestureend")));var m=1,y=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var x=["MSPointerDown","pointerdown"],b=["MSPointerMove","pointermove"],p=["MSPointerUp","pointerup"],Z=["MSPointerCancel","pointercancel"];n(x,function(e){if(e.target.id in I&&s(e)){"undefined"!=typeof MSGesture&&(B[e.target.id]||f(e.target.id),B[e.target.id].addPointer(e.pointerId)),C++;var t=l(e,"ADD");I[e.target.id].touchstart(u(e,"ADD"),t),e.preventDefault()}}),n(b,d("touchmove","MOVE")),
n(p,g("touchend")),n(Z,g("touchcancel")),t(document,"MSHoldVisual",function(e){e.preventDefault()}),t(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id,n=C>1;t in I&&n&&(I[t].gesturestart(),e.preventDefault())}),t(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=C>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;t in I&&n&&(m*=e.scale,y+=180*e.rotation/Math.PI,I[t].gesturechange(m,y),e.preventDefault())}),t(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;t in I&&(I[t].gestureend(m,y),c(),e.preventDefault())})}t(window,"mousedown",function(e){if(e.target.id in I){var t=A(e);I[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}}),t(window,"mouseup",function(e){if(e.target.id in I){var t=A(e);I[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}L&&(h(e.target.id,L.target.id,"mouseup",L),L=null)}),t(window,"mouseout",function(e){e.target.id in I&&(L=e)});var G=null,L=null;t(window,"mousemove",function(e){if(e.target.id in I){h(e.target.id,G,"mouseleave",e);var t=A(e);I[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}else h(null,G,"mouseleave",e)}),t(window,"dblclick",function(e){if(e.target.id in I){var t=A(e);I[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),n(["wheel","mousewheel","DOMMouseScroll"],v),t(document,"MozMousePixelScroll",function(e){I[e.target.id]&&i(e)}),t(document,"keyup",function(e){e.target.id in I&&I[e.target.id].keyup(e.keyCode)}),t(document,"keydown",function(e){var t=!1;e.target.id in I&&(t=t||I[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),t&&e.preventDefault&&e.preventDefault()})}function o(e){e in I&&delete I[e]}function u(e,t){KeyLines.Util.invoke(t,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function l(e){return+e.replace(/px$/,"")}function s(e,t,n,r){function i(e,t){e?KeyLines.Util.invoke(r,e):t.options(n,function(){r&&r(null,t)})}var a=document.getElementById(t);if(!a)return u(t,r);var o=a.clientWidth||l(a.style.width),s=a.clientHeight||l(a.style.height);h(e,t,o,s,n?i:r)}function f(e){var t=KeyLines.Util;return e||null===e||"object"==typeof e?"object"==typeof HTMLElement&&e instanceof HTMLElement?!0:1===e.nodeType?!0:(t.hasAnyKeys(e),!1):!1}function c(e){L[e]++;var t="KeyLines-"+e+"-"+L[e];return I[t]||document.getElementById(t)?c(e):t}function d(){R=document.createElement("span"),R.style.position="absolute",R.style.left="-10000px",R.style.top="-10000px",R.style.visibility="hidden",R.style.lineHeight="normal",R.style.fontSize="200px",R.style.fontVariant="normal",R.style.fontStyle="normal",R.style.letterSpacing="0",R.style.width="auto",R.style.height="auto",R.style.display="block",R.style.margin=0,R.style.padding=0,R.style.whiteSpace="nowrap"}function g(e,t){R.style.fontFamily=t,R.innerText=e}function h(e,t,n,r,i){if(o(t),n||(n=100),r||(r=100),"canvas"!==G&&"chart"===e&&KeyLines.webGLSupport())try{D(e,t,n,r,!0,i)}catch(a){KeyLines.disableWebGL(),D(e,t,n,r,!1,i)}else if(T())D(e,t,n,r,!1,i);else{var u="Could not create HTML5 canvas.";i(u)}}function v(){return m(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function m(e){for(var t=KeyLines.Util.defined,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}function y(e){var t=KeyLines.Util.defined;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:t(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function x(e,t){for(var n,r=0;!n&&r<t.length;r++)e[t[r]]&&(n=!0,e[t[r]]())}function b(e){x(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function p(){W&&W(v())}if(e){var I=KeyLines.components={};KeyLines.charts=I;var w={},C=0,B={};a();var A=KeyLines.coords=function(e){return M(e,e.target.id)},M=function(e,t){var n=Z(t),r=Math.floor(e.pageX-n.left),i=Math.floor(e.pageY-n.top);return{x:r,y:i}},Z=KeyLines.getOffset=function(e){var t=document.getElementById(e),n={top:0,left:0};return t&&(n=t.getBoundingClientRect()),{top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft}},G="auto";KeyLines.mode=function(e){return e&&(G=e),G},KeyLines.createChart=function(){var e,t,n,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0],r=arguments[1];var i=document.getElementById(e);if(!i)return u(e,r);t=i.clientWidth,n=i.clientHeight;break;default:e=arguments[0],t=Number(arguments[1]),n=Number(arguments[2]),r=arguments[3]}h("chart",e,t,n,r)};var L={chart:0,timebar:0};KeyLines.create=function(e,t){function n(e){return i.isNullOrUndefined(e)||"chart"===e||"timebar"===e}function r(e,n,a){function o(e,t){var n=e.id?e.id:c(t);return e.setAttribute("id",n),n}function u(e){if(f(e.element)&&e.id)throw new Error("Cannot pass a DOM element and an id to create, please pass only one.");if(e.element&&!f(e.element))throw new Error("You must pass a DOM element to the components element property.");var t={type:e.type?e.type:"chart",id:e.id||e,options:e.options};return f(e)?(t.type="chart",t.id=o(e,t.type)):f(e.element)&&(t.id=o(e.element,t.type)),t}try{var l=u(e[n])}catch(d){return i.invoke(t,d)}s(l.type,l.id,l.options,function(o,u){if(o)return i.invoke(t,o);a.push(u);var l=n+1;if(!(l>=e.length))return r(e,l,a);var s=1===a.length?a[0]:a;return t?t(null,s):void 0})}var i=KeyLines.Util,a=i.ensureArray(e),o=a.every(function(e){return n(e.type)});return a.length<1?i.invoke(t,Error("No definition passed to KeyLines.create")):o?void r(a,0,[]):i.invoke(t,Error("The type of component passed to KeyLines.create is not valid"))};var R;KeyLines.measureFontHeight=function(e,t,n){R||d(),document.body.appendChild(R),g(e,n);var r=R.offsetHeight;return g("",void 0),r/200*t||t},KeyLines.getFontIcon=function(e,t){R||d(),t?document.getElementById(t).appendChild(R):document.body.appendChild(R);var n=e.replace(/\./g,"");R.className!==n&&(R.className=n);var r=window.getComputedStyle(R,":before").getPropertyValue("content");return R.parentNode&&R.parentNode.removeChild(R),R.className="",r.charCodeAt(1)||r.charCodeAt(0)};var k,E,S=KeyLines.setCanvasPaths=function(e){k=e};KeyLines.imageBasePath=function(e){return e&&(E=e),E},S("assets/");var T=KeyLines.html5CanvasSupport=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},D=function(e,t,n,r,i,a){try{I[t]=KeyLines.Canvas.create(e,t,n,r,k,E,i)}catch(o){if(a)return a(o)}I[t].webgl=i,I[t].canvas=!0,I[t].id=function(){return t},a&&a(null,I[t])};KeyLines.setSize=function(e,t,n){if(!KeyLines.Util.isNumber(t)||!KeyLines.Util.isNumber(n))throw new Error("KeyLines.setSize: Invalid width or height value passed. Both parameters should be numbers.");if(!(0>=t||0>=n)){var r=f(e)?e:document.getElementById(e);if(!r)throw new Error("You must pass a valid id or DOM element.");var i=r.id;r.style.height=n+"px",r.style.width=t+"px",I[i]&&(I[i].internalSetSize(t,n,1),I[i].webgl&&I[i].renderer.clearFramebuffers())}},KeyLines.paths=function(e){return e&&(e.assets&&S(e.assets),e.images&&KeyLines.imageBasePath(e.images)),{assets:k,images:E}},n(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],p),KeyLines.fullScreenCapable=function(){var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var W;KeyLines.toggleFullScreen=function(e,t){W=t,v()&&y(e)?x(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):b(e)},KeyLines.dashedLineSupport=function(){if(T()){var e=document.createElement("canvas"),t=e.getContext("2d");return!!t.setLineDash||!!t.mozDash||!!t.webkitLineDash}return!1},KeyLines._rtlTest=function(e){return"rtl"===window.getComputedStyle(e).direction},KeyLines.es6CollectionSupport=function(){return Object.isPrototypeOf&&Array.from&&window.Set&&window.Map}}}("undefined"!=typeof window),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=[0,1,0,1],n=[0,0,2,2];e.generateLine=function(e,r,i,a,o,u,l,s,f,c,d,g,h){(d||g.all)&&(c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+3,c.elementMappingIndex+=4);var v=0;(d||g.all||g.positions)&&h&&(r+=h.x,i+=h.y,a+=h.x,o+=h.y);for(var m=0;4>m;m++)(d||g.all||g.positions)&&(c.elementData[c.elementDataIndex]=r,c.elementData[c.elementDataIndex+1]=i,c.elementData[c.elementDataIndex+2]=a,c.elementData[c.elementDataIndex+3]=o,c.elementData[c.elementDataIndex+4]=f),(d||g.all)&&(v=(c.elementDataIndex+5)*Float32Array.BYTES_PER_ELEMENT,c.elementIntegerData[v]=t[m],c.elementIntegerData[v+1]=n[m],c.elementIntegerData[v+2]=0,c.elementIntegerData[v+3]=s,c.elementIntegerData[v+4]=u[0],c.elementIntegerData[v+5]=u[1],c.elementIntegerData[v+6]=u[2],c.elementIntegerData[v+7]=u[3],l=l||[0,0,0,0],c.elementIntegerData[v+8]=l[0],c.elementIntegerData[v+9]=l[1],c.elementIntegerData[v+10]=l[2],c.elementIntegerData[v+11]=l[3]),c.elementDataIndex+=8}}}(),function(){var e=KeyLines.Graph={};KeyLines.getGraphEngine=function(e){function t(t){function n(n){n=r.clone(n),o.typeCheck(n);var i=o.filterNodesAndLinks(n.items,null,null,{selfLinks:e.selfLinks});o.ensureHiddenItemConsistency(i.nodes,i.links),t.privateSetProperties(i.nodes,i.links)}return n}function n(e){function t(){var t={};e.privateSetProperties(t,t)}return t}var r=KeyLines.Util,i=KeyLines.Events.createEventBus(),a=KeyLines.Graph.create(i);e=r.defaults(e,{selfLinks:!1});var o=KeyLines.Validation.create({numbers:{x:1,y:1},strings:{id:1,id1:1,id2:1},booleans:{hi:1,a1:1,a2:1}}),u={load:t(a),clear:n(a)};return r.merge(a,u)},e.create=function(e){function t(e,t,n,r,i){e[n]||(e[n]={}),e[r]||(e[r]={}),e[n][r]||(e[n][r]=e[r][n]=[],t.push(i)),e[n][r].push(i)}function n(e,t,n){var r={id:t.id,id1:t.id1,id2:t.id2,ids:n};e.edges.push(r),e.connections.push(n)}function r(e,r){var i={connections:[],adjacency:{},vertices:{},edges:[]};I({all:r&&r.all},function(e,t){i.vertices[t]={x:e.x,y:e.y},i.adjacency[t]={}});var a=[],o={};p({all:r&&r.all},function(e,n,r,u){r===u?(o[r]=o[r]||[],o[r].push(n)):t(i.adjacency,a,r,u,n)});for(var u=a.length,l=0;u>l;l++){var s=m[a[l]];n(i,s,i.adjacency[s.id1][s.id2])}if(g.hasAnyKeys(o)){var f=i.connections.slice();for(var c in o)f.push(o[c]);i.selfConnections=f}else i.selfConnections=i.connections;return i.selfAdjacency=o,i}function i(e){var t=e&&e.all?"all":"visible";return null===x&&(x={}),x[t]||(x[t]=r(t,e)),x[t]}function a(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function o(e){if(e.normalization=e.normalization||"any",!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function u(e){return p(e,function(t,n,r,i){if(G(r,i,n,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:c(e)}}function l(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function s(e){return a(e)||u(e)}function f(e){e.all=!!e.all}function c(e){return!!e.weights}function d(e){var t=0;return I(e,function(){t++}),t}var g=KeyLines.Util,h={},v={},m={},y=e,x=null,b=h.clearCache=function(){x=null};h.privateSetProperties=function(e,t){v=e,m=t,b()};var p=function(e,t){var n=e&&e.all;for(var r in m){var i=m[r];!n&&i.hi||i._parentId||t(i,r,i.id1,i.id2)}},I=function(e,t){var n=e&&e.all;for(var r in v){var i=v[r];!n&&i.hi||i._parentId||t(i,r)}},w=function(e,t,n,r){function i(){var t=[];return I(e,function(e){t.push(e)}),t}var a=i(),o=a.length,u=-1,l=Date.now(),s=l,f=700,c=function(){return u++,u>=o?(d(1),void r()):void n(a[u],v)},d=function(e){y&&y.trigger("progress",t,e)},h=function(){return l=Date.now(),l-s>f?(s=Date.now(),!0):!1},v=function(){h()?(d(u/o),g.nextTick(c,0)):c()};d(0),v()};h.findAdjacency=function(e,t,n){var r=i(e);if(t===n)return r.selfAdjacency[t];var a=r.adjacency;return a[t]&&a[t][n]},h.connections=function(e){var t=i(e);return e.self?t.selfConnections:t.connections},h.eigenCentrality=function(e){function t(t){function n(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function r(e){var t,n,r=[];for(t=0;t<s.length;t++){var i=0;for(n=0;n<f[t].length;n++)i+=c[t][f[t][n]]*e[f[t][n]];i+=d*e[t],r.push(i)}return r}function i(){var e,t=1/a(g);for(e=0;e<s.length;e++)g[e]=g[e]*t}function a(e){var t,n=0;for(t=0;t<e.length;t++)n+=Math.abs(e[t]);return n}var o,u,l={},s=[],f=[],c=[],d=0,g=[],h=0;if(I(e,function(e,n){t[n]&&(s.push(n),l[n]=s.length-1,f.push([]),c.push({}))}),u=Math.max(100,5*Math.sqrt(s.length)),p(e,function(r,i,a,o){if(t[a]&&t[o]){var u=l[a],s=l[o];c[u][s]||(f[u].push(s),f[s].push(u),c[s][u]=0,c[u][s]=0);var g=n(r,e);c[u][s]+=g,c[s][u]+=g,d+=g,h++}}),0===s.length)return{};if(1===s.length)return g={},g[s[0]]=1,g;if(2===s.length)return g={},g[s[0]]=.5,g[s[1]]=.5,g;for(d/=h,u=Math.max(100,5*Math.sqrt(s.length)),o=0;o<s.length;o++)g.push(Math.random());for(o=0;u>o;o++)g=r(g),o%10===0&&i();i();var v={};for(o=0;o<s.length;o++)v[s[o]]=g[o];return v}e=g.defaults(e,{all:!1,value:void 0}),e.direction="any",f(e),u(e);var n,r,i={},a=C(e);for(n=0;n<a.length;n++){var o={};for(r=0;r<a[n].nodes.length;r++)o[a[n].nodes[r]]=!0;var l=t(o);for(r in l)i[r]=l[r]*a[n].nodes.length}return i},h.pageRank=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){var t,n,r=[],i=0,a=0;for(t=0;t<u.length;t++)i+=e[t];for(t=0;t<u.length;t++){var o=0;for(n=0;n<l[t].length;n++){var s=l[t][n];o+=c[t][s]*e[s]/d[s]}0===d[t]&&(a+=v*e[t]),o=v*o,o+=(1-v)*i/u.length,r.push(o)}for(a/=u.length,t=0;t<h.length;t++)r[t]+=a;return r}function r(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n}var i;e=g.defaults(e,{all:!1,value:void 0,directed:!0}),f(e),s(e);var a,o={},u=[],l=[],c=[],d=[],h=[],v=.85;for(I(e,function(e){u.push(e.id),o[e.id]=u.length-1,l.push([]),c.push({}),d.push(0)}),a=Math.max(100,5*Math.sqrt(u.length)),p(e,function(n,r,i,a){var u=o[i],s=o[a],f=t(n,e);e.directed&&!n.a2&&(n.a1||n.a2)||(c[s][u]||(c[s][u]=0,l[s].push(u)),c[s][u]+=f,d[u]+=f),e.directed&&!n.a1&&(n.a1||n.a2)||(c[u][s]||(c[u][s]=0,l[u].push(s)),c[u][s]+=f,d[s]+=f)}),i=0;i<u.length;i++)h.push(Math.random());var m=1/r(h);for(i=0;i<u.length;i++)h[i]=h[i]*m;for(i=0;a>i;i++)h=n(h);for(m=1/r(h),i=0;i<u.length;i++)h[i]=h[i]*m;var y={};for(i=0;i<u.length;i++)y[u[i]]=h[i];return y},h.neighbours=function(e,t){function n(e,n,r){!c[n]&&Z(r,e,n,t)&&(a[n]=c[n]=1,r!==e&&(o[e]=1,e in d&&(o[r]=1),e in u||(l++,s[e]=1)))}function r(){for(var e in u)if(e=g.rawId(e),v[e]){if(y[e])for(var r in y[e]){r=g.rawId(r);for(var i=0;i<y[e][r].length;i++){var a=g.rawId(y[e][r][i]);n(r,a,e)}}var f=x[e];if(f)for(var d=0;d<f.length;d++)n(e,f[d],e)}else if(m[e]){var h=m[e];!c[h.id2]&&Z(h.id2,h.id1,e,t)&&(o[h.id2]=c[h.id2]=c[e]=1,h.id2 in u||(l++,s[h.id2]=1)),!c[h.id1]&&Z(h.id1,h.id2,e,t)&&(o[h.id1]=c[h.id1]=c[e]=1,h.id1 in u||(l++,s[h.id1]=1))}}e=g.ensureArray(e);var a={},o={},u=g.makeIdMap(e);if(t=g.defaults(t,{all:!1,direction:"any",hops:1}),t.hops<1)throw new Error("neighbours error: hops must be a positive number");f(t);var l=0,s={},c={},d=u,h=i(t),y=h.adjacency,x=h.selfAdjacency;for(var b in u){if(b=g.rawId(b),!v[b]&&!m[b])throw new Error("neighbours error: ids must be present in the graph");l++}for(;t.hops--&&l;)l=0,r(),u=s,s={};return{nodes:Object.keys(o),links:Object.keys(a)}},h.clusters=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=+e.d[t.value]),n}function n(e){c=+e,c=g.isNumber(c)?c:5,c=Math.max(0,c),c=Math.min(10,c),c=c*c*c/125}function r(){var e,t,n=[];for(e=0;e<A.length;e++){var r=[];for(t=0;t<b[A[e]].length;t++)r.push(m[b[A[e]][t]]);n.push(r)}return n}function i(e,t,n){var r,i=C[t],a=C[e],o=d[n],u=(-o+i-a)*o*c;for(u/=2*x,r=0;r<h[n].length;r++){var l=h[n][r];w[l]===t?u-=v[n][l]:w[l]===e&&(u+=v[n][l])}return u/x}function a(e,t){var n,r;if(t!==e&&0!==b[e].length&&0!==b[t].length){var i=C[e],a=C[t],u=0;for(u-=c*i*a/x,n=0;n<b[e].length;n++){var l=b[e][n];for(r=0;r<h[l].length;r++)w[h[l][r]]===t&&(u+=v[l][h[l][r]])}if(u/=x,u>0){var s=b[e].length;for(n=0;s>n;n++)o(b[e][0],t)}}}function o(e,t){var n,r=w[e];w[e]=t;var i=[];for(n=0;n<b[r].length;n++)b[r][n]!==e&&i.push(b[r][n]);0===b[t].length&&(A.push(t),B.splice(B.indexOf(t),1)),b[r]=i,b[t].push(e),C[t]+=d[e],C[r]-=d[e],0===b[r].length&&(B.push(r),A.splice(A.indexOf(r),1))}function u(e){var t,n=b[e].length;if(1!==n&&B.length){var r=[];for(t=0;n>t;t++)r.push(b[e][t]);for(t=0;n>t&&B.length;t++)o(r[t],B[0])}}var l;e=g.defaults(e,{all:!1,factor:5,consistent:!0}),f(e);var s,c,d=[],h=[],v=[],m=[],y={},x=0,b=[],w=[],C=[],B=[],A=[];if(I(e,function(e){m.push(e.id),h.push([]),v.push([]),y[e.id]=m.length-1,b.push([m.length-1]),w.push(m.length-1),A.push(m.length-1),d.push(0),C.push(0)}),p(e,function(n,r,i,a){var o=t(n,e);x+=o;var u=y[i],l=y[a];v[u][l]||(v[u][l]=0,v[l][u]=0),v[u][l]+=o,v[l][u]+=o,d[u]+=o,d[l]+=o,C[u]+=o,C[l]+=o,h[u].push(l),h[l].push(u)}),s=Math.max(1e4,50*m.length),0===m.length)return[];0===x&&(s=0);var M=g.makeRandomiser();for(M.setSeed(e.consistent?900736044081:null),n(e.factor),l=0;s>l;l++){if(M.next()>.95){var Z=A[Math.floor(M.next()*A.length)],G=A[Math.floor(M.next()*A.length)];a(Z,G)}if(.5*s>l&&M.next()>.98){var L=A[Math.floor(M.next()*A.length)];u(L)}var R=Math.floor(m.length*M.next()),k=h[R][Math.floor(M.next()*h[R].length)],E=w[k],S=w[R];if(E!==S){var T=i(E,S,R);T>=0&&o(R,E)}}return r()};var C=h.components=function(e){var t,n,r=[],a=0,o=[];e=g.defaults(e,{all:!1}),f(e);var u=i(e).vertices,l=i(e).edges;for(t in u)if("c"in u[t])o[u[t].c]||(o[u[t].c]={nodes:[],links:[]});else{for(r.push(t);r.length>0;){var s=r.shift();if(!("c"in u[s]))for(u[s].c=a,n=0;n<l.length;n++)"c"in l[n]||(l[n].id1===s?(l[n].c=a,r.push(l[n].id2)):l[n].id2===s&&(l[n].c=a,r.push(l[n].id1)))}o.push({nodes:[],links:[]}),a++}for(t in u)o[u[t].c].nodes.push(t+"");for(n=0;n<l.length;n++)o[l[n].c].links=o[l[n].c].links.concat(l[n].ids);var c=i(e).selfAdjacency;for(var d in c){var h=u[d];h&&"c"in h&&(o[h.c].links=o[h.c].links.concat(c[d]))}return o};h.internalMarkLinks=function(e){var t=i(),n=t.adjacency,r=t.selfAdjacency,a=2,o={};for(var u in e){var l=n[u];if(l)for(var s in l)for(var f=l[s],c=0;c<f.length;c++){var d=f[c];o[d]=!0}var g=r[u];if(g)for(var h=0;h<g.length;h++)o[g[h]]=!0}for(var v in o)e[v]=a};var B=h.distances=function(e,t){if(!v[e])throw new Error("distances error: id(s) must be present in the graph");t=t||{},s(t),f(t);var n=k(e,t),r={};for(var i in n.distance){var a=n.distance[i];g.isNumber(a)&&(r[i]=a)}return r},A=function(e,t,n){var r,a=i(n).adjacency,o=a[e][t],u=1/0,l=L(n);if(o)for(var s=0;s<o.length;s++){var f=l(e,t,o[s],n);g.isNumber(f)&&u>f&&(r=[],u=f,r.push(o[s]))}return{value:u,links:r}},M=function(e,t){return m[e].a2&&m[e].id2===t||m[e].a1&&m[e].id1===t},Z=function(e,t,n,r){return"any"!==r.direction?"from"===r.direction&&M(n,t)||"to"===r.direction&&M(n,e):!0},G=function(e,t,n,r){var i=NaN;return Z(e,t,n,r)&&(r.value?m[n].d&&(i=+m[n].d[r.value]):i=1),i},L=function(e){return c(e)?R:G},R=function(e,t,n,r){var i=G(e,t,n,r);return g.isNaN(i)?i:1/i},k=function(e,t){function n(){for(var e,t=1/0,n=0;n<u.length;n++){var r=a[u[n]];t>=r&&(e=n,t=r)}return e}function r(e,t,n){o[e]||(o[e]=[]),o[e].push({id:t,links:n})}var a={},o={},u=[],l=i(t).adjacency;for(I(t,function(e,t){a[t]=1/0,o[t]=void 0,u.push(t)}),a[e]=0;u.length>0;){var s=n(),f=u[s];if(a[f]===1/0)break;u.splice(s,1);for(var c in l[f]){c=g.rawId(c);var d=A(f,c,t),h=a[f]+d.value;h<a[c]?(a[c]=h,o[c]=[{id:f,links:d.links}]):h===a[c]&&r(c,f,d.links)}}return{distance:a,previous:o}};h.shortestPaths=function(e,t,n){function r(e){for(var t=[],n=0;n<e.length;n++)a[e[n].id]&&(t=t.concat(a[e[n].id]));return t}if("string"!=typeof e||"string"!=typeof t)throw new Error("shortestPaths error: ids must be strings");if(!v[e]||!v[t])throw new Error("shortestPaths error: ids must be present in the graph");n=g.defaults(n,{all:!1}),s(n),f(n);var i=k(e,n),a=i.previous;if(i.distance[t]===1/0)return{onePath:[],one:[],items:[],distance:1/0};for(var o=[],u=[],l=t;a[l];)o.unshift(l),u.unshift(l),u.unshift(a[l][0].links[0]),l=a[l][0].id;o.unshift(l),u.unshift(l);var c={};c[t]=1;var d=[];d.push({id:t});for(var h=r(d);h.length>0;){for(var m=0;m<h.length;m++){c[h[m].id]=1;for(var y=0;y<h[m].links.length;y++)c[h[m].links[y]]=1}h=r(h)}return{onePath:u,one:o,items:Object.keys(c),distance:i.distance[t]}};var E=h.degrees=function(e){e=g.defaults(e,{multi:!0,all:!1}),s(e),f(e);var t=i(e).adjacency,n={};return I(e,function(r,i){n[i]=0;for(var a in t[i]){a=g.rawId(a);for(var o=0;o<t[i][a].length;o++){var u=G(i,a,t[i][a][o],e);if(g.isNumber(u)&&(n[i]+=u,!e.multi))break}}}),n};return h.betweenness=function(e,t){function n(e,t){return X[e]-X[t]}function r(e){return e.sort(n),e.shift()}function a(e,t){e.sort(n),g.contains(e,t)||e.push(t)}function u(e,t){var n=A(e,t,G).value;return g.isNumber(n)?n:b()||g.isNumber(n)?1/0:1}function d(e){return e.length>0}function h(){W.length=0,F.length=0,I(e,function(e,t){for(var n=0;n<Y.length;n++)m(Y[n].dict,t,Y[n].value)})}function v(e,t,n){I(e,function(e,r){m(t,r,n)})}function m(e,t,n){Array.isArray(n)&&d(n)&&e[t]?e[t].length=0:e[t]=g.clone(n)}function y(){var t,n,r,i=C(e),a={};for(t=0;t<i.length;t++)for(r=i[t],n=0;n<r.nodes.length;n++)a[r.nodes[n]]=r.nodes.length;return a}function x(){return!g.isNullOrUndefined(e.value)}function b(){return!!e.directed}function p(){return e.endpoints}e=g.defaults(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1}),o(e),f(e);var B=x()||b()?"dijkstra":"regular",M=p()?"endpoints":"regular",Z=l(e),G={direction:b()?"from":"any",value:e.value,weights:c(e),all:e.all};s(e);var L,R,k,E,S,T,D={},W=[],F=[],V={},N={},O={},X={},U=0,Y=[{dict:N,value:0},{dict:X,value:1/0},{dict:V,value:[]},{dict:O,value:0}],K=i(e).adjacency,H={regular:function(e){for(N[e]=1,X[e]=0,W.push(e);d(W);){L=W.shift(),F.push(L);for(var t in K[L])t=g.rawId(t),g.isNumber(X[t])||(X[t]=X[L]+1,W.push(t)),X[t]===X[L]+1&&(N[t]+=N[L],V[t].push(L))}},dijkstra:function(e){for(N[e]=1,X[e]=0,W.push(e);d(W);){L=r(W),F.push(L);for(var t in K[L])t=g.rawId(t),X[t]>X[L]+u(L,t)&&(X[t]=X[L]+u(L,t),a(W,t),N[t]=0,V[t]=[]),X[t]===X[L]+u(L,t)&&(N[t]+=N[L],V[t].push(L))}}},z={regular:function(e){for(;d(F);){for(R=F.pop(),S=(1+O[R])/N[R],E=0;E<V[R].length;E++)L=V[R][E],O[L]+=N[L]*S;R!==e&&(D[R]+=O[R])}},endpoints:function(e){for(D[e]+=F.length-1;d(F);){for(R=F.pop(),S=(1+O[R])/N[R],E=0;E<V[R].length;E++)L=V[R][E],O[L]+=N[L]*S;R!==e&&(D[R]+=O[R]+1)}}},_={chart:function(){if(U>2){k=1/((U-1)*(U-2));for(var e in D)e=g.rawId(e),D[e]*=k}},component:function(){T=y();for(var e in D)e=g.rawId(e),T[e]>2&&(k=1/((T[e]-1)*(T[e]-2)),D[e]*=k)},unnormalized:function(){if(!b()){k=.5;for(var e in D)e=g.rawId(e),D[e]*=k}}},P=function(){Q(),g.invoke(t,D)},j=H[B]||H.regular,J=z[M]||z.regular,Q=_[Z]||_.chart;I(e,function(){U++}),v(e,D,0);var q=function(e,t){h(),j(e.id),J(e.id),t()};w(e,"betweenness",q,P)},h.closeness=function(e,t){function n(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?1:0;return n}function r(e){for(var t in e)if(t=g.rawId(t),e.hasOwnProperty(t))return!1;return!0}function a(e){return!g.isNullOrUndefined(e)}function u(e){return!m[e].a1&&!m[e].a2}function c(e){var t={},n=0,i={},o={};for(o[e]=1;!r(o);){i=o,o={};for(var u in i)if(u=g.rawId(u),!a(t[u])){t[u]=n;for(var l in A[u])l=g.rawId(l),o[l]=1}n+=1}return t}function h(){return"any"!==e.direction}function v(){if(e.mode=e.mode||"auto",!e.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function y(){return v(),"auto"===e.mode?I():e.mode}function x(){return!g.isNullOrUndefined(e.value)}function b(){return l(e).match(/chart/)}function p(){return l(e).match(/component/)}function I(){var t="disconnected",n=C(e);if(1===n.length&&(t="connected",h()))for(var r=0;r<n[0].links.length;r++)if(u(n[0].links[r]))return"disconnected";return t}e=g.defaults(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});var A=i(e).adjacency,M=s(e);o(e),f(e),M.all=e.all;var Z,G,L,R,k,E=x()||h()?"dijkstra":"regular",S=0,T={},D=y(),W={regular:function(e){return c(e)},dijkstra:function(e,t){return B(e,t)}},F={connected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?t[r]:0;return n?1/n:0},disconnected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=e!==r?1/t[r]:0;return n}},V=function(){g.invoke(t,T)};G=W[E]||W.regular,L=F[D],S=d(e),T={};var N=function(e,t){R=G(e.id,M),Z=n(e.id,R),T[e.id]=L(e.id,R),S>1&&(k=b()?Math.pow(Z-1,2)/(S-1):p()?Z-1:1,T[e.id]*=k),t()};w(e,"closeness",N,V)},h.kCores=function(e){function t(e){var t=0;for(var n in e)n=g.rawId(n),t=Math.max(t,e[n]);return t}e=g.defaults(e,{all:!1}),f(e);var n=i(e).adjacency,r=function(){var t,r,i,a,o,u,l,s,f,c,d,h={},v={},m=[],y=[];r=0,h=E({multi:!1,all:e.all});for(var x in h)x=g.rawId(x),r=Math.max(r,h[x]);for(d=Object.keys(h).length,t=0;r+1>t;t++)y[t]=0;for(I(e,function(e,t){y[h[t]]++}),o=1,t=0;r+1>t;t++)u=y[t],y[t]=o,o+=u;for(I(e,function(e,t){v[t]=y[h[t]],m[v[t]]=t,y[h[t]]++}),t=r;t>1;t--)y[t]=y[t-1];for(y[0]=1,a=0;d>a;a++){i=m[a];for(var b in n[i])b=g.rawId(b),h[b]>h[i]&&(s=h[b],f=v[b],c=y[s],l=m[c],b!==l&&(v[b]=c,m[f]=l,v[l]=f,m[c]=b),y[s]++,h[b]--)}return h},a=r();return{maximumK:t(a),values:a}},h}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=512,n=4,r=264,i=4,a=!1;e.ImageAtlas=function(e){for(var t=[],n=4,r=4,a=4,u=0,f=s(e),c=o(f),d=1/c,g=l(c,0),h=0,v=f.length;v>h;h++){var m=f[h],y=m.im,x=y.width/m.imageRatio,b=y.height/m.imageRatio;if(n+x+i>c&&(n=0,r+=u+i,u=0),r+b>c&&(a++,r=i,t.push({alphaChannel:!0,img:g.canvas,texture:null}),g=l(c,a)),y.u1=n*d,y.v1=r*d,y.u2=(n+x)*d,y.v2=(r+b)*d,y.maxDimension=m.nonSquare,y.textureBank=a,m.nonSquare){var p,I=y.v2-y.v1,w=y.u2-y.u1;if("width"===m.nonSquare){p=I/w;var C=(w-w*p)/2;y.cu1=y.u1+C,y.cv1=y.v1,y.cu2=y.u2-C,y.cv2=y.v2}else{p=w/I;var B=(I-I*p)/2;y.cu1=y.u1,y.cv1=y.v1+B,y.cu2=y.u2,y.cv2=y.v2-B}}else y.cu1=y.u1,y.cv1=y.v1,y.cu2=y.u2,y.cv2=y.v2;g.drawImage(y,n,r,x,b),b>u&&(u=b),n+=x+i}for(t.push({alphaChannel:!0,img:g.canvas,texture:null}),a++;8>a;){var A=l(1,a++);t.push({alphaChannel:!0,img:A.canvas,texture:null})}return t};var o=function(e){for(var t=1,r=i,a=i,o=0,u=1024,l=0,s=e.length;s>l;l++){var f=e[l],c=f.im,d=c.width/f.imageRatio,g=c.height/f.imageRatio;r+d+i>u&&(r=0,a+=o+i,o=0),a+g>u&&(t++,a=i),g>o&&(o=g),r+=d+i}return n>t?1024:4*n>t?2048:4096},u=function(e,n){var i=1,a=!1;return e>r&&(n>0?e>t&&(i=e/t):i=e/r,a=!0),{imageRatio:i,largeImage:a}},l=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.id="webglDebugImageCanvas"+t,n.width=e,n.height=e,a){var i=document.getElementById(n.id);i?i.parentNode.replaceChild(n,i):document.getElementsByTagName("body")[0].appendChild(n)}return r},s=function(e){var t=[],n=2;for(var r in e)if(e.hasOwnProperty(r)&&e[r]&&e[r].im){var i=e._coList[r]?e[r].co:e[r].im,a=i.width>i.height?"width":"height",o=u(i[a],n);o.largeImage&&n>0&&n--,t.push({im:i,size:i[a]/o.imageRatio,imageRatio:o.imageRatio,nonSquare:i.width!==i.height?a:!1})}return t.sort(function(e,t){return e.size-t.size})}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.TriangleShader=function(t){function n(e,t,n){var r,i;for(r=0,i=e.atlases.length;i>r;r++)u(e.atlases[r],r);for(t&&u(t,3),r=0,i=n.length;i>r;r++)u(n[r],r+4)}function r(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.shadowData,c.STATIC_DRAW),c.enableVertexAttribArray(m.shadowColour),c.vertexAttribPointer(m.shadowColour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function i(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.textureBuffer),(e.rebuildOptions.textures||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.textureData,c.STATIC_DRAW),c.enableVertexAttribArray(m.textCoord),c.enableVertexAttribArray(m.textureBank),c.enableVertexAttribArray(m.circleRadius),c.enableVertexAttribArray(m.startAngle),c.enableVertexAttribArray(m.endAngle),c.vertexAttribPointer(m.textCoord,4,c.FLOAT,!1,9*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.textureBank,2,c.FLOAT,!1,9*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(m.circleRadius,1,c.FLOAT,!1,9*Float32Array.BYTES_PER_ELEMENT,24),c.vertexAttribPointer(m.startAngle,1,c.FLOAT,!1,9*Float32Array.BYTES_PER_ELEMENT,28),c.vertexAttribPointer(m.endAngle,1,c.FLOAT,!1,9*Float32Array.BYTES_PER_ELEMENT,32)}function a(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.colourData,c.STATIC_DRAW),c.enableVertexAttribArray(m.colour),c.vertexAttribPointer(m.colour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function o(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.positionBuffer),(e.rebuildOptions.positions||e.rebuildOptions.all||e.alwaysUpdate)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.positionData,c.STATIC_DRAW),c.enableVertexAttribArray(m.position),c.enableVertexAttribArray(m.width),c.vertexAttribPointer(m.position,2,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.width,1,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8)}function u(e,t){if(c.activeTexture(c["TEXTURE"+t]),e.texture)c.bindTexture(c.TEXTURE_2D,e.texture);else{e.texture=c.createTexture();
var n=e.alphaChannel?c.RGBA:c.RGB;c.bindTexture(c.TEXTURE_2D,e.texture),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(c.TEXTURE_2D,0,n,n,c.UNSIGNED_BYTE,e.img),c.generateMipmap(c.TEXTURE_2D),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e.img=null}}function l(e){e.triangleBuffers.positionBuffer||(e.triangleBuffers.positionBuffer=c.createBuffer()),e.triangleBuffers.textureBuffer||(e.triangleBuffers.textureBuffer=c.createBuffer()),e.triangleBuffers.colourBuffer||(e.triangleBuffers.colourBuffer=c.createBuffer()),e.triangleBuffers.shadowBuffer||(e.triangleBuffers.shadowBuffer=c.createBuffer())}function s(e,t,n,r,i,a){c.uniform3f(m.resolution,t,n,r),c.uniform1f(m.hitTest,0|i),c.uniform1iv(m.textures,[0,1,2,3,4,5,6,7]),c.uniformMatrix4fv(m.transform,!1,e.get()),c.uniform1f(m.shadowType,a),c.uniform1f(m.zoom,e.getZoomLevel())}var f={},c=t,d=e.Utils,g=e["triangle-vertex"],h=e["triangle-fragment"],v=d.createProgram(c,atob(g),atob(h)),m={transform:c.getUniformLocation(v,"u_transform"),textures:c.getUniformLocation(v,"u_image[0]"),resolution:c.getUniformLocation(v,"u_resolution"),hitTest:c.getUniformLocation(v,"u_hitTest"),shadowType:c.getUniformLocation(v,"u_shadowType"),zoom:c.getUniformLocation(v,"u_zoom"),position:c.getAttribLocation(v,"a_position"),startAngle:c.getAttribLocation(v,"a_startAngle"),endAngle:c.getAttribLocation(v,"a_endAngle"),circleRadius:c.getAttribLocation(v,"a_circleRadius"),width:c.getAttribLocation(v,"a_width"),colour:c.getAttribLocation(v,"a_colour"),textCoord:c.getAttribLocation(v,"a_texCoord"),shadowColour:c.getAttribLocation(v,"a_hitTestColour"),textureBank:c.getAttribLocation(v,"a_textureBank")};return f.drawItems=function(e,t,u,f,d,g,h,m,y){c.useProgram(v),s(t,g,h,m,y,0|e.shadowType),l(e),r(e),i(e),a(e),o(e),n(u,f,d),c.drawArrays(c.TRIANGLES,0,3*e.triangleBuffers.numOfTriangles)},f})}(),function(){"undefined"!=typeof window&&(window.L_PREFER_CANVAS=!0);var e=KeyLines.Map={};e.create=function(e,t,n){function r(){throw new Error("Leaflet was not found. Make sure you include leaflet.js and leaflet.css in your web page.")}function i(e){return tt?e:r}function a(e){tt&&(e.map=N())}function o(){e.lock(Ke)}function u(e,t){var n=Ee.latLngToContainerPoint([e,t]);return{x:n.x,y:n.y}}function l(e,t){var n=Ee.containerPointToLatLng([e,t]);return{lat:n.lat,lng:n.lng}}function s(e,t,n){if(Ue){var r=Ee._container,i=r.parentNode;r.style.height=t+"px",r.style.width=e+"px",i.style.height=t+"px",i.style.width=e+"px",Ve.nextTick(function(){ae(n)},0)}else De=[e,t],Ve.invoke(n)}function f(t){e.privateEach({type:"node"},function(e){e.hi||t({id:e.id,x:e.x,y:e.y})})}function c(){var e=[];return f(function(t){e.push(t)}),e}function d(){var e={};return f(function(t){e[t.id]=t}),e}function g(){We="restore"===Je.transition?d():null}function h(t){if("restore"===Je.transition&&We){var n=Ve.dictValues(We);We=null,e.setProperties(n,!1,t)}else e.allowDraw(!1),e.layout("standard",{animate:!1},function(){e.allowDraw(!0),Ve.invoke(t)})}function v(e,t){if(e){for(var n in e)Je[n]=e[n];"tiles"in e&&Ee?F(t):Ve.invoke(t)}return Ve.clone(Je)}function m(n){function r(){D(),R(A(),!1),Ze(function(){I(Je.animate,i)})}function i(){return Ue=!0,Ke=!1,t.trigger("map","showend"),me(Ye),o(),De&&(s(De[0],De[1],function(){e.zoom("fit")}),De=null),Ve.invoke(n)}if(Ee||Ke)return Ve.invoke(n);Ke=!0,o(),t.trigger("map","showstart"),y(),e.options(Xe),Ne={};var a={};e.privateEach({type:"node"},function(e){e.hi||Re(e)||(Ne[e.id]=!0,a[e.id]=!0)}),e.privateEach({type:"link"},function(e){e.hi||!a[e.id1]&&!a[e.id2]||(Ne[e.id]=!0)}),g();var u=Object.keys(Ne);u.length>0?e.hide(u,{time:Je.time,animate:Je.animate},r):r()}function y(){var t=e.options();Oe={};for(var n in Xe)Oe[n]=t[n]}function x(){e.options(Oe),Oe={}}function b(){$e.style.top=null,$e.style.left=null,$e.parentNode.style.position=null}function p(t,n,r){t?e.privateAnimateBackgroundOpacity(n,{time:Je.time},r):(e.privateSetBackgroundOpacity(n),Ve.invoke(r))}function I(e,t){b(),V(),p(e,0,t)}function w(e,t){p(e,1,t)}function C(e,t,n,r,i,a){function o(e,t,n){var r=e.width,i=e.height,a=t/n;return r/i!==a&&(i>r/a?i=r/a:r>i*a?r=i*a:(r=t,i=n)),{width:r,height:i}}function u(n){if(x.push(n),x.length>=y){for(var u=r(d.x,d.y),l=u.getContext("2d"),s=0;s<x.length;s++){var f=x[s];l.drawImage(f.img,Math.floor(f.pos.x),Math.floor(f.pos.y),f.size,f.size)}var c=r(e,t),g=c.getContext("2d"),h=o(u,e,t),v=h.width,m=h.height;g.drawImage(u,0,0,v,m,0,0,e,t),g.drawImage(i,0,0);var b;try{b=c.toDataURL()}catch(p){throw new Error("[toDataURL] There is a problem to export the chart with tainted map tiles.")}Ve.invoke(a,b)}}function l(e,t,n,r){var i=document.createElement("img");i.crossOrigin="",i.onload=function(){return r({img:i,pos:t,size:n})},i.onerror=function(){return r({img:b,pos:t,size:n})},i.src=e}if(!Ue||!Ee||"exact"!==n.fit)return Ve.invoke(a,i.toDataURL());if(!tt)throw Error("[toDataURL] The mapping library has to be loaded after KeyLines to make toDataURL work");var s=Ee.getPixelBounds(),f=Ee.getPixelOrigin(),c=Ee.getZoom(),d=Ee.getSize(),g=Te.options.tileSize;if(c>Te.options.maxZoom||c<Te.options.minZoom)return Ve.invoke(a,i.toDataURL());for(var h=L.bounds(s.min.divideBy(g)._floor(),s.max.divideBy(g)._floor()),v=h.max.y-h.min.y+1+(h.min.y>0?0:h.min.y),m=h.max.x-h.min.x+1+(h.min.x>0?0:h.min.x),y=v*m,x=[],b=r(1,1),p=h.min.y;p<=h.max.y;p++)for(var I=h.min.x;I<=h.max.x;I++){var w=new L.Point(I,p);w.z=c;var C=Te._getTilePos(w).subtract(s.min).add(f);w.y>=0&&w.x>=0&&l(Te.getTileUrl(w),C,g,u)}}function B(n){function r(){return Ke=!1,o(),Ee=null,t.trigger("map","hideend"),Ve.invoke(n)}function i(t,n,i,a){var o=Object.keys(Ne);e.viewOptions(t,{animate:!1},function(){e.hide(o,{animate:!1},function(){e.setProperties(n,!1,function(){e.allowDraw(!0),e.viewOptions(i,{animate:!0,time:Je.time}),e.animateProperties(a,{time:Je.time},function(){o.length>0?e.show(o,!1,{animate:!0,time:Je.time},r):r()})})})})}function a(){w(Je.animate,function(){S(),x();var t,n;Je.animate&&(t=e.viewOptions(),n=c()),e.show(Object.keys(Ne),!1,{animate:!1},function(){Ue=!1,h(function(){e.zoom("fit",{animate:!1},function(){if(Je.animate){var a=e.viewOptions(),o=c();i(t,n,a,o)}else r()})})})})}if(!Ee||Ke)return Ve.invoke(n);Ke=!0,o(),t.trigger("map","hidestart");var u=A();R(u,Je.animate,a)}function A(){var t=[];return e.privateEach({type:"node"},function(e){Re(e)&&!e.hi&&t.push(L.latLng(e.pos.lat,e.pos.lng))}),t}function M(e){if(e.length){var t=L.latLngBounds(e),n=t.getNorth(),r=t.getSouth(),i=t.getWest(),a=t.getEast();if(n===r&&i===a){var o=.01;t=L.latLngBounds([[n-o,i-o],[n+o,i+o]])}return t}}function Z(e,t){if(Ee.getZoom()!==t)return!0;e=Ee._limitCenter(e,t,Ee.options.maxBounds);var n=Ee._getCenterOffset(e)._floor();return n.x||n.y}function G(e){var t=L.point([2*ze,2*ze]),n=Ee.getBoundsZoom(e,!1,t);if(Ee.getZoom()!==n)return!0;var r=Ee.project(e.getSouthWest(),n),i=Ee.project(e.getNorthEast(),n),a=Ee.unproject(r.add(i).divideBy(2),n);return Z(a,n)}function R(e,t,n){var r=M(e);if(r)void 0===Ee.getZoom()||G(r)?(Ve.isFunction(n)&&Ee.once("moveend",n),Ee.fitBounds(r,{animate:!!t,padding:[ze,ze]})):Ve.isFunction(n)&&Ve.invoke(n);else{var i=L.latLng(0,0),a=2;Z(i,a)?(Ve.isFunction(n)&&Ee.once("moveend",n),Ee.setView(i,a,{animate:!!t})):Ve.isFunction(n)&&Ve.invoke(n)}}function k(e){if(!e)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t}function E(e,t){var n=et>0?e.childNodes[et+1]:e.firstChild;e.insertBefore(t,n||null)}function S(){var e=Ee._container,t=e.parentNode,n=t.parentNode;Ee.removeControl(Se),Ee.remove(),n.removeChild(t),E(n,$e),$e.style.position="",$e.style["margin-top"]=null,$e.style["margin-left"]=null}function T(e){$e.style.position="absolute",$e.style.top=0,$e.style.left=0,$e.style["margin-top"]=0,$e.style["margin-left"]=0,$e.style.zIndex=2;var t=document.createElement("div");t.style.position="relative",t.id=e+"-container";var n=document.createElement("div");n.id=e,n.style.width=t.style.width=$e.clientWidth+"px",n.style.height=t.style.height=$e.clientHeight+"px",n.style.position="absolute",n.style.top=$e.top,n.style.left=$e.left;var r=$e.parentNode;r.removeChild($e),t.appendChild(n),t.appendChild($e),E(r,t)}function D(e){T(qe),Ee=new L.Map(qe,Ve.merge(_e,{boxZoom:!1,zoomAnimationThreshold:20,zoomControl:!1})),W(e)}function W(e){var t="",n={noWrap:!0};"string"!=typeof Je.tiles?(t=(Je.tiles||Qe.tiles).url,n=L.extend(n,Je.tiles)):t=Je.tiles,Te=new L.TileLayer(t,n),e&&Te.once("load",e),Ee.addLayer(Te)}function F(e){Ee.removeLayer(Te),W(e)}function V(e){Se=ke(e),Ee.addControl(Se)}function N(){var e={show:Ue};if(Ue){var t=Ee.getCenter();e.lat=t.lat,e.lng=t.lng,e.zoom=Ee.getZoom(),e.bounds=Ee.getBounds().toBBoxString(),e.hiddenOnMap=Ve.clone(Ne),e.restoreXY=Ve.clone(We)}return e}function O(t,n){var r=!0;tt&&(t=t||{},t.show?(Ne=Ve.clone(t.hiddenOnMap)||[],We=Ve.clone(t.restoreXY)||null,Ue||(Ue=!0,y(),r=!1,D(function(){e.options(Xe),I(!1,n)})),Ee.setView([t.lat,t.lng],t.zoom,{reset:!0}),Me()):!t.show&&Ue&&w(!1,function(){Ue=!1,S(),x(),Ee=null})),r&&Ve.invoke(n)}function X(e){e&&(Fe.options=Ve.defaults(e,ut),Ee&&H())}function U(e){Fe={options:Ve.clone(ut),zooming:null,zoomLevel:null,zoomAnimating:null},X(e)}function Y(){return $e.parentNode.removeChild($e),$e.style.top=0,$e.style.left=0,z(),$e}function K(){P(!1),xe(!1),$e.removeAttribute("class")}function H(){Ee.off("zoomanim",J),Fe.options.animZoom&&Ee.on("zoomanim",J)}function z(){e.options({handMode:!0,hover:5}),P(!0),xe(!0)}function _(e){return e=Ve.ensureArray(e),{handler:function(t){Ve.iterator(e,function(e){e(t)})},add:function(t){e.push(t)}}}function P(t){var n=t?"on":"off",r={resize:ie,dragend:q,drag:$,move:ee},i=re(function(t,n){e.dblclick(n.x,n.y,t.ctrlKey,t.shiftKey)}),a=_(i);r.dblclick=a.handler;var o=!1,u=re(function(t,n){var r=e.mousedown(t.button,n.x,n.y,t.ctrlKey,t.shiftKey);Ee&&(Ee.doubleClickZoom.enabled()||o)&&(Ye||r&&"_"===r.charAt(0)?(Ee.doubleClickZoom.disable(),o=!0):(Ee.doubleClickZoom.enable(),o=!1))}),l=_(function(e){Fe.zooming||u(e)}),s=_(function(e){Fe.zooming||u(e)}),f=!1,c=re(function(t,n){e.mouseup(t.button,n.x,n.y,t.ctrlKey,t.shiftKey)});s.add(c),r.click=function(){f||s.handler.apply(this,arguments),f=!1},r.mousedown=function(){f=!0,l.handler.apply(this,arguments)},Ee[n](r),Fe.zooming=!1,L.DomEvent.getWheelDelta=function(t){var n;return n=void 0!==t.wheelDelta?t.wheelDelta:-t.detail,e.trigger("mousewheel",n,t.layerX,t.layerY),n>0?.025:0>n?-.025:0},Fe.zoomLevel=Ee._zoom,Ee[n]("zoomstart",j),t&&!Fe.options.animZoom||Ee[n]("zoomanim",J),Ee[n]("zoomend",Q)}function j(){Fe.zooming=!0}function J(e){oe(e)}function Q(){Fe.zooming=!1,Fe.options.animZoom&&Fe.options.zoomAnimating||Me()}function q(){Pe=!1,ye(je),we(!0)}function $(){Pe=!0,we(!0)}function ee(){Fe.zooming||Me()}function te(e,t){Ee.panBy(e,t)}function ne(t,n,r,i){var a=null,o=100,u={animate:!!n,duration:Ve.isNumber(r)?r/1e3:.25};if(Ve.isFunction(i)&&Ee.once("moveend",i),"selection"===t){var l=[],s=e.getItem(e.selection());if(s.length){for(var f,c=0;c<s.length;c++)f=s[c],"node"===f.type&&Re(f)&&!f.hi&&l.push(L.latLng(f.pos.lat,f.pos.lng));Ee.panInsideBounds(M(l),u)}}else{switch(t){case"up":a=[0,-o];break;case"down":a=[0,o];break;case"left":a=[-o,0];break;case"right":a=[o,0]}a&&Ee.panBy(a,u)}}function re(e){return function(t){var n=t.originalEvent,r=KeyLines.coords(n);return n.stopPropagation&&n.stopPropagation(),n.shiftKey?!0:void e(n,r)}}function ie(e){He=!0,Me(e)}function ae(e){He?Ve.invoke(e):(Ee.invalidateSize(!0),ie(e)),He=!1}function oe(t){if(!Fe.zoomAnimating){Fe.zoomAnimating=!0;var n=[];e.privateEach({type:"node"},function(r){if(Re(r)){var i=Ee._latLngToNewLayerPoint(L.latLng(r.pos.lat,r.pos.lng),t.zoom,t.center),a=Ee.layerPointToContainerPoint(i),o=e.worldCoordinates(a.x,a.y);n.push({id:r.id,x:o.x,y:o.y})}}),e.animateProperties(n,{time:150,queue:!1},function(){Fe.zoomAnimating=!1,Fe.zooming||Me()})}}function ue(){var e=Ee.getZoom();e=Math.min(ot,Math.max(at,e));var t=rt+(it-rt)*(e-at)/(ot-at);return t}function le(e,t,n,r){Ve.isFunction(r)&&Ee.once("moveend",r);var i=Math.round(e);Ee.setZoom(i,{animate:t})}function se(){return Ee.getZoom()}function fe(){return!!Ee}function ce(){return Ke}function de(){return Ee.getMaxZoom()}function ge(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Ve.isNullOrUndefined(r)||!Re(r)||r.hi||t.push(L.latLng(r.pos.lat,r.pos.lng))}return t}function he(t,n,r){var i=e.getItem(t),a=ge(i);a.length?R(a,!!n,r):Ve.invoke(r)}function ve(t,n,r,i,a){var o={animate:!!n,duration:Ve.isNumber(r)?r/1e3:.25};switch(t){case"in":Ve.isFunction(a)&&Ee.once("moveend",a),Ee.zoomIn(1,o);break;case"out":Ve.isFunction(a)&&Ee.once("moveend",a),Ee.zoomOut(1,o);break;case"fit":case"fitToModel":i?he(i,n,a):R(A(),!!n,a);break;case"selection":case"fitToSelection":he(e.selection(),n,a);break;case"height":case"fitModelHeight":var u=-(1/0),l=-(1/0),s=1/0,f=1/0,c=function(e){Re(e)&&!e.hi&&(e.pos.lat>u&&(u=e.pos.lat,l=e.pos.lng),e.pos.lat<s&&(s=e.pos.lat,f=e.pos.lng))};i?e.getItem(i).forEach(c):e.privateEach({type:"node"},c),isFinite(u)&&isFinite(l)&&isFinite(s)&&isFinite(f)?R([[u,l],[s,f]],!!n,a):Ve.isFunction(a)&&Ve.invoke(a)}return se()/de()}function me(e){Ye=e;var t,n,r=e?"disable":"enable",i=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","keyboard","tap"];for(n=0;n<i.length;n++)t=i[n],_e[t]=!e,Ue&&Ee[t]&&Ee[t][r]()}function ye(e){je=!!e,Ee.dragging.enabled()!==je&&(je?Ee.dragging.enable():Pe||Ee.dragging.disable())}function xe(t){var n=t?e.privateBind:e.privateUnbind;n("dblclick",be),n("dragstart",Ie),n("keydown",pe)}function be(){return!0}function pe(e){return e>36&&41>e}function Ie(e){return"move"===e}function we(t,n){var r=e.viewOptions(),i=Ee.getPixelBounds().min,a=Ee.getPixelOrigin();r.offsetX=a.x-i.x,r.offsetY=a.y-i.y;var o=ue();r.zoom!==o&&(r.zoom=o);var u={animate:t,time:t?100:-1};e.viewOptions(r,u,n)}function Ce(t){var n=Ee.latLngToContainerPoint([t.pos.lat,t.pos.lng]);return e.worldCoordinates(n.x,n.y)}function Be(){var t=[];return e.privateEach({type:"node"},function(e){if(Re(e)){var n=Ce(e);n.id=e.id,t.push(n)}}),t}function Ae(t){var n,r,i,a;for(t=Ve.ensureArray(t),r=0;r<t.length;r++)n=t[r],n.hasOwnProperty("pos")&&(i={pos:Ve.merge(e.getItem(n.id).pos,n.pos)},a=Ce(i),n.x=a.x,n.y=a.y)}function Me(t){we(!1,function(){e.setProperties(Be(),!1,t)})}function Ze(t){if(Je.animate){var n=e.viewOptions(),r=ue();n.zoom===r?e.animateProperties(Be(),{time:Je.time},t):e.viewOptions({zoom:r},{animate:!1},function(){var i=Be();e.viewOptions(n,{animate:!1},function(){function n(){0===--a&&Ve.invoke(t)}var a=2;e.viewOptions({zoom:r},{animate:!0,time:Je.time},n),e.animateProperties(i,{animate:!0,time:Je.time},n)})})}else Me(t)}function Ge(e){if("node"===e.type)if(We&&delete We[e.id],delete Ne[e.id],Re(e)){var t=e.x||0,n=e.y||0;We&&(We[e.id]={id:e.id,x:t,y:n});var r=Ce(e);e.x=r.x,e.y=r.y}else e.hi||(e.hi=!0,Ne[e.id]=!0)}function Le(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if("node"===i.type){var a=e.getItem(i.id);if(a){var o={};Ne[i.id]?o.hi=!1:"hi"in a&&(o.hi=a.hi),We&&We[i.id]&&(o.x=We[i.id].x,o.y=We[i.id].y),a.pos&&(o.pos=a.pos),i=Ve.merge(o,i)}Ge(i)}else if("link"===i.type&&!i.hi){var u=e.getItem(i.id1),l=e.getItem(i.id2);u&&l&&Re(u)&&Re(l)||(Ne[i.id]=!0)}n.push(i)}return n}function Re(e){return Ve.isNormalObject(e.pos)&&!Ve.isNullOrUndefined(e.pos.lat)&&!Ve.isNullOrUndefined(e.pos.lng)}function ke(){var e=L.Control.extend({options:{position:"topleft"},setOptions:X,initialize:U,onAdd:Y,onRemove:K});return new e(Je)}var Ee,Se,Te,De,We,Fe,Ve=KeyLines.Util,Ne={},Oe={},Xe={watermark:!1,overview:!1,gestures:!1},Ue=!1,Ye=!1,Ke=!1,He=!1,ze=5,_e={},Pe=!1,je=!0,Je={animate:!0,time:800,tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',subdomains:"abcd",minZoom:0,maxZoom:20},transition:"restore"},Qe=Ve.clone(Je),qe=n+"-map",$e=document.getElementById(n),et=k($e),tt="undefined"!=typeof L&&L.version,nt={api:{show:i(m),hide:i(B),viewCoordinates:i(u),mapCoordinates:i(l),isShown:function(){return Ue},leafletMap:function(){return Ee||null},options:i(v)},internalUse:{appendMap:a,convertPos:Ae,loadUp:O,setSize:s,enableDragging:ye,lock:me,pan:ne,panBy:te,zoom:ve,setZoom:le,getMaxZoom:de,getZoom:se,toDataURL:C,isMapLoaded:fe,preMerge:Le,preSetItem:Ge,isTransitioning:ce}},rt=.75,it=1.25,at=4,ot=15,ut={animZoom:!0,scaleOnZoom:!0};return nt}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateCircle=function(t,n,r,i,a,o,u,l,s,f,c,d,g,h){var v,m;if(d=d||0,g=g||0,s.rebuildOptions.all||s.rebuildOptions.shadow||s.alwaysUpdate)for(a=a||[0,0,0,0],v=0;e>v;v++)s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=a[0],s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=a[1],s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=a[2],s.triangleBuffers.shadowData[s.triangleBuffers.shadowIndex++]=a[3];if(s.rebuildOptions.all||s.rebuildOptions.colours||s.alwaysUpdate)for(v=0;e>v;v++)s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[0],s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[1],s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[2],s.triangleBuffers.colourData[s.triangleBuffers.colourIndex++]=i[3];if(s.rebuildOptions.all||s.rebuildOptions.positions||s.alwaysUpdate){var y=s.triangleBuffers.positionData,x=s.triangleBuffers.positionIndex;if(m=h?-o:o,c)for(v=0;18>v;v++)y[x++]=0;else{var b=2*r,p=t-r,I=n-r,w=p+b,C=I+b;f&&(p+=f.x,I+=f.y,w+=f.x,C+=f.y),y[x++]=p,y[x++]=I,y[x++]=m,y[x++]=w,y[x++]=I,y[x++]=m,y[x++]=p,y[x++]=C,y[x++]=m,y[x++]=p,y[x++]=C,y[x++]=m,y[x++]=w,y[x++]=I,y[x++]=m,y[x++]=w,y[x++]=C,y[x++]=m}s.triangleBuffers.positionIndex=x}(s.rebuildOptions.all||s.rebuildOptions.textures||s.alwaysUpdate)&&(s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=u,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=l,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=-1,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=0,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=r,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=d,s.triangleBuffers.textureData[s.triangleBuffers.textureIndex++]=g)}}}(),function(){var e=KeyLines.TimeBar.Config={};e.create=function(){function e(e,t){return c.format(e,t,y.options.locale)}function t(t,n){var r=new Date(c.add(t,h.year,n-1));return e(t,"yyyy - ")+e(r,"yyyy")}function n(e){return t(e,10)}function r(e){return t(e,50)}function i(t){return e(t,"yyyy")+"s"}function a(t){var n="dmy"===y.options.locale.order?"d MMM yyyy":"MMM d, yyyy";return e(t,n)}function o(t){var n=y.options.locale.h12?"h:mm tt":"HH:mm";return e(t,n)}function u(t){var n=y.options.locale.h12?"h:mm:ss tt":"HH:mm:ss";return e(t,n)}function l(e,t){if("histogram"===e){if(!d.isNormalObject(t))return!1;if(t.colour&&!g.validatergb(t.colour))return!1;if(t.highlightColour&&!g.validatergb(t.highlightColour))return!1}return"minScale"===e?t:d.contains(m.colours,e)?g.validatergb(t):!0}function s(e,t){"fontFamily"===e&&(y.options.fontFamily=g.pickFirstFamily(t)||v.fontFamily),"fontSize"===e&&d.isNumber(+t)&&+t>0&&(y.options.fontSize=+t)}function f(e){e.showPlay?y.playingExtend=!1:e.showExtend?y.playingExtend=!1:y.playingExtend=null}var c=KeyLines.DateTime,d=KeyLines.Util,g=KeyLines.Rendering,h=c.units,v={fontFamily:"sans-serif",fontSize:12},m={colours:["backColour","fontColour","sliderColour","sliderLineColour"]},y={displayTime:function(t,n){return d.isFunction(n)?n(t):e(t,n)},baseRangeLimits:{max:315576e7,min:3e3},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:g.colours.grey,fontFamily:v.fontFamily,fontSize:v.fontSize,showControlBar:!0,showPlay:!0,showExtend:!1,showFit:!0,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",maxRange:"auto",minRange:3e3,minScale:{units:"sec",value:1},showSliders:!0,showShadowCanvas:!1,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9"},heightChange:{animate:!0,time:200},locale:d.defaults(c.defaultLocale,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return d.clone(y.options)},setOptions:function(e){if(d.isNormalObject(e)){f(e);for(var t in e)y.options.hasOwnProperty(t)&&(v[t]?s(t,e[t]):d.isNormalObject(y.options[t])&&l(t,e[t])?y.options[t]=d.defaults(e[t],y.options[t]):y.options[t]=e[t])}},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,playingExtend:!1,defaultPlaySpeed:60,bars:{defaultFontFamily:v.fontFamily,defaultFontSize:v.fontSize,major:{height:19,textbase:3,tickHeight:10},minor:{height:17,textbase:0,tickHeight:8}},grip:{lines:2,space:4,length:14,margin:2},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:6,major:{units:h.sec,by:2,f:a},minor:{units:h.sec,by:1,f:u}},{max:15,major:{units:h.sec,by:5,f:a},minor:{units:h.sec,by:1,f:u}},{max:24,major:{units:h.sec,by:10,f:a},minor:{units:h.sec,by:2,f:u}},{max:60,major:{units:h.sec,by:15,f:a},minor:{units:h.sec,by:5,f:u}},{max:120,major:{units:h.sec,by:30,f:a},minor:{units:h.sec,by:10,f:u}},{max:360,major:{units:h.min,by:1,f:a},minor:{units:h.sec,by:30,f:u}},{max:1e3,major:{units:h.min,by:5,f:a},minor:{units:h.min,by:1,f:o}},{max:5e3,major:{units:h.min,by:15,f:a},minor:{units:h.min,by:5,f:o}},{max:15e3,major:{units:h.hour,by:1,f:a},minor:{units:h.min,by:15,f:o}},{max:6e4,major:{units:h.hour,by:6,f:a},minor:{units:h.hour,by:1,f:o}},{max:12e4,major:{units:h.day,by:1,f:a,adjust:432e5},minor:{units:h.hour,by:2,f:o}},{max:18e4,major:{units:h.day,by:1,f:a,adjust:432e5},minor:{units:h.hour,by:3,f:o}},{max:36e4,major:{units:h.day,by:1,f:a},minor:{units:h.hour,by:6,f:o}},{max:72e4,major:{units:h.day,by:1,f:a},minor:{units:h.hour,by:12,f:"ttt"}},{max:5e6,major:{units:h.week,by:1,f:function(t){var n,r,i=new Date(t),a=new Date(c.add(t,h.day,6)),o="dmy"===y.options.locale.order;return i.getUTCFullYear()===a.getUTCFullYear()?i.getUTCMonth()===a.getUTCMonth()?(n=o?"d - ":"MMM d - ",r=o?"d MMM yyyy":"d, yyyy"):(n=o?"d MMM - ":"MMM d - ",r=o?"d MMM yyyy":"MMM d, yyyy"):(n=o?"d MMM yyyy - ":"MMM d, yyyy - ",r=o?"d MMM yyyy":"MMM d, yyyy"),e(i,n)+e(a,r)}},minor:{units:h.day,by:1,f:"d"}},{max:15e6,major:{units:h.month,by:1,f:"MMMM yyyy"},minor:{units:h.week,by:1,f:function(t){var n=c.add(t,h.day,6);return e(t,"d - ")+e(n,"d")}}},{max:3e7,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMMM"}},{max:75e6,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMM"}},{max:1e8,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:h.month,by:6,f:"QQ  yyyy"},minor:{units:h.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:h.year,by:1,f:"yyyy"},minor:{units:h.month,by:3,f:"Q"}},{max:6e8,major:{units:h.year,by:1,f:"yyyy"},minor:{units:h.month,by:6,f:"QQ"}},{max:15e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:1,f:"'yy"}},{max:25e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:2,f:"'yy"}},{max:35e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:5,f:"'yy"}},{max:115e8,major:{units:h.year,by:50,f:r},minor:{units:h.year,by:10,f:"'yy"}},{max:2e10,major:{units:h.year,by:50,f:r},minor:{units:h.year,by:25,f:"'yy"}},{max:35e9,major:{units:h.year,by:100,f:i},minor:{units:h.year,by:25,f:"'yy"}},{max:8e10,major:{units:h.year,by:100,f:i},minor:{units:h.year,by:50,f:"'yy"}},{max:16e10,major:{units:h.year,by:200,f:"yyyy"},minor:{units:h.year,by:100,f:""}},{max:4e11,major:{units:h.year,by:500,f:"yyyy"},minor:{units:h.year,by:100,f:""}},{max:1/0,major:{units:h.year,by:500,f:""},minor:{units:h.year,by:100,f:""}}]};return y}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Generator=function(t){function n(e){b.isNullOrUndefined(e.fontFamily)&&(e.fontFamily="sans-serif"),B===e.fontFamily&&null!==B||(B=e.fontFamily,Z.textAtlas=!0),M[B]=!0,C[B]=!0}function r(e){e.iconFontFamily&&A!==e.iconFontFamily&&(A=e.iconFontFamily,Z.fontIcons=!0)}function i(e,t,n){e.fbAlpha=n,e.rebuildOptions={all:t.all,colours:t.colours,textures:t.textures,shadow:t.shadow,positions:t.positions}}function a(e,t){return e.all||e.textures||e.positions||e.shadow||e.colours||t}function o(e){e.arcBuffers.numOfTriangles=0,e.lineBuffers.numOfTriangles=0,e.triangleBuffers.numOfTriangles=0}function u(e,t,n){for(var r,i=t.rebuildOptions,a=t.alwaysUpdate,o=t.arcBuffers,u=0;L>u;u++){if(r=e[u],"A"===r.p){var l=o.itemIndex[r.id];l||(l=o.itemIndex[r.id]={position:0,colour:0,texture:0,core:0,shadow:0}),(i.all||a||i.positions)&&(l.position=o.positionIndex),(i.all||a||i.colours)&&(l.colour=o.colourIndex),(i.all||a||i.textures||i.shadow)&&(l.core=o.coreIndex,l.shadow=o.shadowIndex)}X[r.p](t,r,n,a,i)}}function l(n){Z.textAtlas&&(t.textAtlas&&n.clearTextureAtlas(t.textAtlas.atlases),t.textAtlas=e.TextAtlas(M,!1,t),C=M)}function s(n){!Z.fontIcons&&t.fontIconAtlas||(n.clearTextureAtlas(t.fontIconAtlas),t.fontIconAtlas=e.FontIconAtlas(w,A))}function f(e,t,n,r){function i(e){"_overviewIcon"!==e.id&&"_overviewIconRect"!==e.id&&(n[L++]=e,r&&v(e,a,o,u))}if(t.widgets){L=0;var a=e.lineBuffers,o=e.arcBuffers,u=e.triangleBuffers;t.widgets.each(i,t.channels,t.layers)}}function c(e){d(e.lineBuffers,e),g(e),h(e)}function d(e,t){var n=8;e.elementIndexIndex=0,e.elementMappingIndex=0,e.elementDataIndex=0,e.elementIntegerDataIndex=0,e.elementData&&!t.rebuildOptions.all||(e.elementData=new Float32Array(e.numOfTriangles*n*4),e.elementIntegerData=new Uint8Array(e.elementData.buffer,0,e.elementData.length*Float32Array.BYTES_PER_ELEMENT)),e.elementIndex&&!t.rebuildOptions.all||(e.elementIndex=new Uint32Array(3*e.numOfTriangles))}function g(e){function t(e){var t=e.arcBuffers.totalNumOfVerticies*a;(!e.arcBuffers.positionData||e.rebuildOptions.all&&e.arcBuffers.positionData.length!==t)&&(e.arcBuffers.positionData=new Float32Array(t))}function n(e){var t=e.arcBuffers.totalNumOfVerticies*u;(!e.arcBuffers.colourData||e.rebuildOptions.all&&e.arcBuffers.colourData.length!==t)&&(e.arcBuffers.colourData=new Uint8Array(t))}function r(e){var t=e.arcBuffers.totalNumOfVerticies*o;(!e.arcBuffers.shadowData||e.rebuildOptions.all&&e.arcBuffers.shadowData.length!==t)&&(e.arcBuffers.shadowData=new Uint8Array(t))}function i(e){var t=e.arcBuffers.totalNumOfVerticies*l;(!e.arcBuffers.coreData||e.rebuildOptions.all&&e.arcBuffers.coreData.length!==t)&&(e.arcBuffers.coreData=new Float32Array(t));
}var a=6,o=4,u=4,l=3;e.arcBuffers.positionIndex=0,e.arcBuffers.colourIndex=0,e.arcBuffers.shadowIndex=0,e.arcBuffers.coreIndex=0,e.arcBuffers.totalNumOfVerticies=3*e.arcBuffers.numOfTriangles,t(e),n(e),r(e),i(e)}function h(e){function t(e){e.triangleBuffers.positionData&&!e.rebuildOptions.all||(e.triangleBuffers.positionData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*o))}function n(e){e.triangleBuffers.colourData&&!e.rebuildOptions.all||(e.triangleBuffers.colourData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*s))}function r(e){e.triangleBuffers.textureData&&!e.rebuildOptions.all||(e.triangleBuffers.textureData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*l))}function i(e){e.triangleBuffers.shadowData&&!e.rebuildOptions.all||(e.triangleBuffers.shadowData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*u))}var a=3,o=3,u=4,l=9,s=4;e.triangleBuffers.positionIndex=0,e.triangleBuffers.colourIndex=0,e.triangleBuffers.textureIndex=0,e.triangleBuffers.shadowIndex=0,e.triangleBuffers.totalNumOfVerticies=e.triangleBuffers.numOfTriangles*a,t(e),n(e),r(e),i(e)}function v(n,r,i,a){switch(n.p){case"A":n.donut?a.numOfTriangles+=2:i.numOfTriangles+=2*e.getNumOfSegments(n.sa,n.ea);break;case"L":r.numOfTriangles+=2;break;case"L3":r.numOfTriangles+=6;break;case"C":n.bw>0&&(a.numOfTriangles+=2),n.fi&&(a.numOfTriangles+=2);break;case"R":if(n.fi&&(a.numOfTriangles+=2),n.bw>0){var o=I[n.bs]||0;o?r.numOfTriangles+=8:a.numOfTriangles+=2}break;case"RR":var u=n.y2-n.y1>2*n.r,l=n.x2-n.x1>2*n.r;n.fi&&(l&&(a.numOfTriangles+=2),u?a.numOfTriangles+=12:a.numOfTriangles+=4),n.bw>0&&(l&&(a.numOfTriangles+=4),u?a.numOfTriangles+=12:a.numOfTriangles+=4);break;case"T":var s=n.t,f=n.t.length;if(n.isfi){a.numOfTriangles+=2;var c=w[s];c||(Z.fontIcons=!0,w[n.t]={t:s,ff:n.ff})}else n.ff&&(M[n.ff]=!0,C[n.ff]||(Z.textAtlas=!0,C[n.ff]=!0)),n.back&&(a.numOfTriangles+=2),KeyLines.Rendering.isRTL(t.canvas)&&(f=t.bidi.reorderText(s).length),a.numOfTriangles+=2*f;break;case"PE":n.bw>0&&(r.numOfTriangles+=10),n.fi&&(a.numOfTriangles+=3);break;case"TR":n.fi&&a.numOfTriangles++,n.bw>0&&a.numOfTriangles++;break;case"I":a.numOfTriangles+=2}}function m(e,n){var r=t.allLayers[n.id];return r||(r=t.allLayers[n.id]=y(n)),r}function y(e){return{triangleBuffers:{numOfTriangles:0,itemIndex:{}},lineBuffers:{numOfTriangles:0,itemIndex:{}},arcBuffers:{numOfTriangles:0,itemIndex:{}},id:e.id,useFramebuffer:e.useFramebuffer,drawFramebuffer:e.drawFramebuffer,framebuffer:null,renderbuffer:null,framebufferTexture:null,fbAlpha:e.fbAlpha,useView:e.useView,shadowType:e.shadowType,channels:e.channels,rebuildOptions:{},alwaysUpdate:e.alwaysUpdate}}var x,b=KeyLines.Util,p={},I={dashed:2,dotted:3},w={},C={},B=null,A=null,M={},Z={textAtlas:!1,fontIcons:!1},G=[],L=0,R=!1;p.generate=function(e,d,g,h,v){t.layersToDraw.length=0,x=KeyLines.Rendering.isRTL(t.canvas),Z.textAtlas=!1,Z.fontIcons=!1,R=KeyLines.Rendering.useHiResImages();for(var y=0,b=e.length;b>y;y++){var I=e[y];L=0;var w=m(t.allLayers,I);t.layersToDraw[y]=w,i(w,g,I.fbAlpha),a(g,I.alwaysUpdate)&&(n(h),r(h),g.all&&o(w),f(w,I,G,g.all),Z.textAtlas||Z.fontIcons||(c(w),u(G,w,d)))}l(v),s(v),(Z.textAtlas||Z.fontIcons)&&(Z.fontIcons=!1,Z.textAtlas=!1,p.generate(e,d,{all:!0},h,v)),M={}};var k=function(t,n,r,i,a){if(n.fi&&(e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x5,n.y5,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x5,n.y5,n.x2,n.y2,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a)),n.bw>0){var o=I[n.bs]||0;n.x1<n.x2?(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4-n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x5-n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a)):(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4+n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x5+n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a))}},E=function(n,r){if(r.isfi)e.generateFontIcon(r,w[r.t],n,r.a);else{if(r.back){var i=r.fs*r.pf;e.generateRectangle(r,r.x1,r.y1,r.x2,r.y2+i,r.wbc,n,r.a)}e.generateText(n.triangleBuffers,r,t.textAtlas.getGlyphsFrom(r.t,r.ff,B,r.bo,Z,x),t.textAtlas.fontSize,n,r.a)}},S=function(t,n,r,i,a){if(n.donut)e.generateCircle(n.x,n.y,n.r+n.bw/2,n.wbc,n.wsc,n.bw,.5,.5,t,n.a,n.hib,n.sa,n.ea);else{var o=I[n.ls]||0;e.generateArc(t.arcBuffers,n.x,n.y,n.r,n.sa,n.ea,n.wbc,n.wsc,n.bw,o,a,i,n.a,n.id)}},T=function(t,n,r,i,a){var o=I[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a)},D=function(t,n,r,i,a){var o=I[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4,n.y4,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a)},W=function(t,n){n.fi&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wfc,-2,t,n.a),n.bw>0&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wbc,-2,t,n.a)},F=function(t,n,r,i,a){if(n.fi&&e.generateRectangle(n,n.x1,n.y1,n.x2,n.y2,n.wfc,t,n.a),n.bw>0){var o=I[n.bs]||0,u=n.bw/2,l=Math.floor(n.x1-u),s=Math.floor(n.y1-u),f=Math.floor(n.x2+u),c=Math.floor(n.y2+u);o?(e.generateLine(n,l,n.y1,f,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,s,n.x2,c,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,f,n.y2,l,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x1,c,n.x1,s,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a)):e.generateRectangle(n,l,s,f,c,n.wbc,t,n.a,n.bw)}},V=function(t,n){var r=n.r,i=n.bw,a=n.bw/2,o=n.x1,u=n.y1,l=n.x2,s=n.y2,f=s-u>2*r,c=l-o>2*r,d=u+(s-u)/2;n.fi&&(c&&e.generateRectangle(n,o+r,u,l-r,s,n.wfc,t,n.a),f?(e.generateRectangle(n,o,u+r,o+r,s-r,n.wfc,t,n.a),e.generateRectangle(n,l-r,u+r,l,s-r,n.wfc,t,n.a),e.generateCircle(o,u,r,n.wfc,n.wsc,0,1,1,t,n.a,n.hib),e.generateCircle(l,u,r,n.wfc,n.wsc,0,0,1,t,n.a,n.hib),e.generateCircle(o,s,r,n.wfc,n.wsc,0,1,0,t,n.a,n.hib),e.generateCircle(l,s,r,n.wfc,n.wsc,0,0,0,t,n.a,n.hib)):(e.generateCircle(o,d,r,n.wfc,n.wsc,0,1,.5,t,n.a,n.hib),e.generateCircle(l,d,r,n.wfc,n.wsc,0,0,.5,t,n.a,n.hib))),i>0&&(c&&(e.generateRectangle(n,o+r-a,u-a,l-r+a,u+a,n.wbc,t,n.a),e.generateRectangle(n,o+r-a,s-a,l-r+a,s+a,n.wbc,t,n.a)),f?(e.generateRectangle(n,l+a,u+r-a,l-a,s-r+a,n.wbc,t,n.a),e.generateRectangle(n,o-a,u+r-a,o+a,s-r+a,n.wbc,t,n.a),e.generateCircle(o-a,u-a,r+a,n.wbc,n.wsc,i,1,1,t,n.a,n.hib),e.generateCircle(l+a,u-a,r+a,n.wbc,n.wsc,i,0,1,t,n.a,n.hib),e.generateCircle(l+a,s+a,r+a,n.wbc,n.wsc,i,0,0,t,n.a,n.hib),e.generateCircle(o-a,s+a,r+a,n.wbc,n.wsc,i,1,0,t,n.a,n.hib)):(e.generateCircle(o-a,d,r+a,n.wbc,n.wsc,i,1,.5,t,n.a,n.hib),e.generateCircle(l+a,d,r+a,n.wbc,n.wsc,i,0,.5,t,n.a,n.hib)))},N=function(t,n){if(n.fi&&e.generateCircle(n.x,n.y,n.r,n.wfc,n.wsc,0,.5,.5,t,n.a,n.hib),n.bw>0){var r=I[n.bs]||0;e.generateCircle(n.x,n.y,n.r+n.bw/2,n.wbc,n.wsc,n.bw,.5,.5,t,n.a,n.hib,null,null,r>1)}},O=function(t,n,r){"_background"===n.id&&(n.wsc=[0,0,0,0]);var i=r[n.u];if(n.hi&&R){var a=r[KeyLines.Rendering.hiResUrl(n.u)];a&&!a.missing&&(i=a)}e.generateImage(n,"co"===n.s?i.co:i.im,t,n.a)},X={A:S,L:T,L3:D,I:O,TR:W,R:F,RR:V,C:N,T:E,PE:k};return p})}(),function(){"use strict";var e=KeyLines.Generator={};e.create=function(e){function t(){return ye||Ze.colours.white}function n(e){return Math.abs(e)<1e-5}function r(e,t,n,r,i,a,o){return{x:((a-r)*n-(o-i)*t)/e,y:((a-r)*t+(o-i)*n)/e}}function i(e){return Array.isArray(e)&&e.length>0}function a(e){return e.hasOwnProperty("g")&&i(e.g)}function o(e,t,i,a,o,u,l,s,f,c){var d=r(t,i,a,o,u,l,s),g=r(t,i,a,o,u,f,c);e/=t;var h=e/2;if(d.y>h&&g.y>h||d.y<-h&&g.y<-h)return NaN;if(n(g.y-d.y))return Math.max(d.x,g.x);var v,m=d.y>g.y?d:g,y=d.y>g.y?g:d;v=h<m.y?m.x-(m.y-h)*(m.x-y.x)/(m.y-y.y):m.x;var x;return x=y.y<-h?y.x-(y.y- -h)*(y.x-m.x)/(y.y-m.y):y.x,Math.max(v,x)}function u(e,t,n,r,i,a,u,l){for(var s=-(1/0),f=u.length,c=0;f>c;c+=2){var d=(c+2)%f,g=o(e,t,n,r,i,a,u[c]+l.x,u[c+1]+l.y,u[d]+l.x,u[d+1]+l.y);Ge.isNaN(g)||(s=Math.max(s,g))}return s}function l(e,t,n,r,i,a,o,l){return u(e,t,n,r,i,a,[o.x1,o.y1,o.x2,o.y1,o.x2,o.y2,o.x1,o.y2],l)}function s(e,t,n,r,i,a,o,u){var l=-(1/0),s=o.cx+u.x-i,f=o.cy+u.y-a,c=t*t,d=-2*t*(s*r-f*n),g=s*s+f*f-o.r*o.r,h=d*d-4*c*g;return h>=0&&(l=(-d+Math.sqrt(h))/(2*c)),l}function f(e,t,n,r,i,a){for(var o,f=-(1/0),c=Math.sin(-n),d=Math.cos(-n),g=a._cl,h=0;h<g.length;h++){var v=g[h];o=v.length?u(e,t,c,d,r,i,v,a):v.r?s(e,t,c,d,r,i,v,a):l(e,t,c,d,r,i,v,a),f=Math.max(f,o)}return f}function c(e,t,n,r,i,a){var o=0;return r._c&&(o=r._c/t),r._cl&&(o=Math.max(o,f(e,t,n,i,a,r))),o}function d(e,t,r,i,a,o,u,l,s,f,d){var g={},h=r-e,v=i-t,m=Math.sqrt(h*h+v*v);if(n(m))g.skip=!0;else{var y=Math.atan2(v,h),x=c(ve&&l?0:a,m,y,o,e,t),b=c(ve&&s?0:a,m,y+Math.PI,u,r,i);f=f||0,d=d||0,x=Math.max(f,x),b=Math.max(d,b);var p=1-(x+b),I=0;(l||s)&&(I=Qe(a)/m,l&&s&&(I=1.5*I)),g.skip=p<Math.max(.1,I),g.skip||(g.cx1=e+x*h,g.cy1=t+x*v,g.cx2=r+b*-h,g.cy2=i+b*-v)}return g}function g(e,t,n,r,i,a,o){var u=[],l=a-r,s=o-i,f=r-e,c=i-t,d=l*l+s*s,g=2*(l*f+s*c),h=f*f+c*c-n*n,v=g*g-4*d*h;if(v>=0){var m=Math.sqrt(v),y=(-g-m)/(2*d),x=(-g+m)/(2*d);if(y>=0&&1>=y){var b=r+y*l,p=i+y*s;u.push(Math.atan2(p-t,b-e))}if(x!==y&&x>=0&&1>=x){var I=r+x*l,w=i+x*s;u.push(Math.atan2(w-t,I-e))}}return u}function h(e,t,n,r,i,a){var o=r-t;if(Math.abs(o)>n)return[];var u=Math.max(i,a),l=Math.min(i,a);if(e-n>u||l>e+n)return[];var s=Math.asin(o/n),f=n*Math.cos(s),c=[];return e-f>=l&&u>=e-f&&c.push(o>0?Math.PI-s:-Math.PI-s),e+f>=l&&u>=e+f&&c.push(s),c}function v(e,t,n,r,i,a){var o=r-e;if(Math.abs(o)>n)return[];var u=Math.max(i,a),l=Math.min(i,a);if(t-n>u||l>t+n)return[];var s=Math.acos(o/n),f=n*Math.sin(s),c=[];return t-f>=l&&u>=t-f&&c.push(-s),t+f>=l&&u>=t+f&&c.push(s),c}function m(e,t,n,r,i,a){for(var o=[],u=0;u<r.length;u+=2){var l=(u+2)%r.length,s=g(e,t,n,r[u]+i,r[u+1]+a,r[l]+i,r[l+1]+a);o=o.concat(s)}return o}function y(e,t,n,r,i,a){var o=h(e,t,n,r.y2+a,r.x1+i,r.x2+i),u=h(e,t,n,r.y1+a,r.x1+i,r.x2+i),l=v(e,t,n,r.x1+i,r.y1+a,r.y2+a),s=v(e,t,n,r.x2+i,r.y1+a,r.y2+a);return o.concat(u,s,l)}function x(e,t,n,r,i){for(var a=Math.PI,o=0;o<t.length;o++)t[o]+2*Math.PI<r&&(t[o]+=2*Math.PI),n<t[o]&&t[o]<r&&(i?t[o]-e<a&&(e=Math.max(e,t[o])):e-t[o]<a&&(e=Math.min(e,t[o])));return e}function b(e,t,n,r,i,a,o){var u,l=o?r:i;if(a._c&&(u=Xe(e,t,n,a.x,a.y,a._c),l=x(l,u,r,i,o)),a._cl)for(var s=0;s<a._cl.length;s++){var f=a._cl[s],c=a.x,d=a.y;u=f.length?m(e,t,n,f,c,d):f.r?Xe(e,t,n,c+f.cx,d+f.cy,f.r):y(e,t,n,f,c,d),l=x(l,u,r,i,o)}return l}function p(e,t,n,r,i,a,o,u){var l=b(t,n,r,i,a,e>0?o:u,!0),s=b(t,n,r,l,a,e>0?u:o,!1);return{startangle:l,endangle:s}}function I(e,t){var n,r,i=t(e.id),a=Oe(e);return i&&be?(n=be.b||e.b,r=be.c||e.c):(n=e.b,r=e.c),!(!n&&!r||a)}function w(e,t,n,r,i,a){e.arc(0,0,0,0,0,i,0,t,a,null,!0),n&&e.triangle(0,0,0,0,0,0,null,-1,i,!0,t+Ee+"a1",!0),r&&e.triangle(0,0,0,0,0,0,null,-1,i,!0,t+Ee+"a2",!0)}function C(e,t,n,r,i,a,o,u,l,s,f,c,d,g,h,v,m){var y=u===l;a=+(a||0),y&&(a+=Ue*u._sl.e);var x=a>0;if(y){var b=(u._sl.w?180:225)*Math.PI/180,C=Math.cos(b),B=Math.sin(b),A=.5;s=c=u.x+u._sl.x,f=d=u.y+u._sl.y;var M=-u._sl.e*Ue/2;s+=C*M+B*A,f+=B*M-C*A,c+=C*M-B*A,d+=B*M+C*A}var Z=(s+c)/2,L=(f+d)/2,R=c-s,k=d-f,E=Math.max(.001,k*k+R*R),S=Math.sqrt(E),T=+(E/4+a*a)/(2*Math.abs(a)),D=T-Math.abs(a);if(T>1e5)return Ae=!0,Me=!0,void G(e,t,n,r,i,o,u,l,s,f,c,d,g,h,v,m);var W=x?1:-1,V=Z-k*W*D/S,N=L+R*W*D/S,O=Math.atan2(f-N,s-V),X=Math.atan2(d-N,c-V),U=x?O:X,Y=x?X:O;U>Y&&(Y+=2*Math.PI),r=r||0,i=i||0;var K=U+(x?r:i)*(Y-U),H=U+(x?1-i:1-r)*(Y-U),z=p(a,V,N,T,U,Y,u,l);if(z.startangle=Math.max(K,z.startangle),z.endangle=Math.min(H,z.endangle),z.startangle>=z.endangle)Ve.hib=!0,w(e,o,t,n,g,h);else{var _,P,j,J,Q,q,$=.9*Qe(h)/T,ee=-.25;if(t?(_=x?z.startangle:z.endangle,P=V+T*Math.cos(_),j=N+T*Math.sin(_),x?z.startangle+=$:z.endangle-=$):ve&&I(u,m)&&(x?z.startangle+=ee*$:z.endangle-=ee*$),n?(J=x?z.endangle:z.startangle,Q=V+T*Math.cos(J),q=N+T*Math.sin(J),x?z.endangle-=$:z.startangle+=$):ve&&I(l,m)&&(x?z.endangle-=ee*$:z.startangle+=ee*$),!(z.startangle<z.endangle))return Ve.hib=!0,w(e,o,t,n,g,h);e.arc(V,N,T,z.startangle,z.endangle,g,h,o,v),t&&F(e,V,N,T,P,j,x,h,g,o+Ee+"a1"),n&&F(e,V,N,T,Q,q,!x,h,g,o+Ee+"a2"),Ge.iterator(Ve.pos,function(e,t){if(Ve.present[t]){var n=W>0?z.startangle:z.endangle,r=W>0?z.endangle:z.startangle,i=n+(r-n)*Ye[t];e.lx=V+T*Math.cos(i),e.ly=N+T*Math.sin(i)}})}}function B(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function A(e,t,n,r,i,a){var o=Math.ceil(a/8),u=B(e,t,n,r);return e+=(e-n)/u*(o-i),t+=(t-r)/u*(o-i),{x:e,y:t}}function M(e,t){var n,r=et,i=(e.e||1)*ct;return n=t.x>e.x&&"e"===e.sh?e.x+i*r:t.x<e.x&&"w"===e.sh?e.x-i*r:e.x}function Z(e,t,n,r,i,a,o,u,l,s,f,d,g,h){var v,m,y=M(u,l),x=M(l,u),b=a||0;x>y?(v=y+xe,m=x-xe,v>m&&(v=m=(y+x)/2)):(v=y-xe,m=x+xe,m>v&&(v=m=(y+x)/2));var p=B(y,s,v,b),I=B(v,b,m,b),w=B(m,b,x,f),C=p+I+w,Z=Math.atan2(b-s,v-y),G=Math.atan2(b-f,m-x),L=0===p?0:c(g,p,Z,u,y,s),R=0===w?0:c(g,w,G,l,x,f);r=0===p?0:(r||0)*C/p,i=0===w?0:(i||0)*C/w,L=Math.min(1,Math.max(r,L)),R=Math.min(1,Math.max(i,R));var k,E,S,T,D,F,V=y+L*(v-y),N=s+L*(b-s),O=x+R*(m-x),X=f+R*(b-f);(t||n)&&(D=Qe(g)),t&&(k=V,E=N,F=A(V,N,v,b,D,g),V=F.x,N=F.y),n&&(S=O,T=X,F=A(O,X,m,b,D,g),O=F.x,X=F.y),e.line3(V,N,v,b,m,b,O,X,d,g,o,h),t&&W(e,k,E,g,Z+Math.PI,d,o+Ee+"a1"),n&&W(e,S,T,g,G+Math.PI,d,o+Ee+"a2");var U={t:{lx:(v+m)/2,ly:(b+b)/2},t1:{lx:y,ly:s},t2:{lx:x,ly:f}};Ge.iterator(Ve.pos,function(e,t){Ve.present[t]&&(e.above=!0,e.lx=U[t].lx,e.ly=U[t].ly)})}function G(e,t,n,r,i,a,o,u,l,s,f,c,g,h,v,m){var y=d(l,s,f,c,h,o,u,t,n,r,i);if(y.skip)return e.line(0,0,0,0,g,h,a,v,!0),t&&e.triangle(0,0,0,0,0,0,g,-1,g,!0,a+Ee+"a1",!0),n&&e.triangle(0,0,0,0,0,0,g,-1,g,!0,a+Ee+"a2",!0),void(Ve.hib=!0);var x,b,p,w,C,B,M,Z,G=y.cx1,L=y.cy1,R=y.cx2,k=y.cy2,E=R-G,S=k-L,T=Math.max(.001,S*S+E*E),D=Math.sqrt(T),F=.25;(t||n)&&(M=Qe(h)),t?(x=Math.atan2(S,E),p=G,w=L,Z=A(G,L,R,k,M,h),G=Z.x,L=Z.y):ve&&I(o,m)&&(G-=F*h*E/D,L-=F*h*S/D),n?(b=Math.atan2(S,E),C=R,B=k,Z=A(R,k,G,L,M,h),R=Z.x,k=Z.y):ve&&I(u,m)&&(R+=F*h*E/D,k+=F*h*S/D),e.line(G,L,R,k,g,h,a,v),t&&W(e,p,w,h,x+Math.PI,g,a+Ee+"a1"),n&&W(e,C,B,h,b,g,a+Ee+"a2"),Ge.iterator(Ve.pos,function(e,t){if(Ve.present[t]){var n=Ye[t];e.lx=G+n*(R-G),e.ly=L+n*(k-L)}})}function L(e,t,n,r,i,a,o,u,l,s,f,c,d){function g(e){for(var t=n.length-1,i=r;t>=0;t--)e(n[t],i),t>0&&(i-=T(n[t-1],n[t])*a)}if(n=n||[],o){for(var h=0,v=0;v<n.length-1;v++)h+=T(n[v],n[v+1])*a;r+=h/2}else r-=n.length>0?S(n[n.length-1])*a:S({});if(f){var m=r;if(n.length>0){g(function(e,t){m=t});var y=n[0].e||1;m-=y*a*Ue/2,f._sl.e*=y}f._sl.x=m-f.x,f._sl.y=i-f.y,f._sl.w=!0}o&&u&&g(function(t,n){e.circle(n,i,E(t)*a*1.25,Ze.colours.white,-1,Ne(),!0,s,null,null,c)});var x=0;g(function(n,r){var o=s+Ee+x;d&&(o+="-"+d),ie(e,t,o,r,i,a,n,l,f,!1,!1,c),x++})}function R(e,t,n,r,i,a,o){var u,l,s,f=e.getLayer(),c="solid";e.setLayer(Ze.layers.HALOS);for(var d=0;d<Ke.length;d++)s=Ke[d],u=i[s],l=t+Ee+s,u&&("h"===i.st?Z(e,!1,!1,i.b1,i.b2,i.y,l,n,r,n.y,r.y,u.c,u.w,c):i.off||i.n1===i.n2?C(e,!1,!1,i.b1,i.b2,i.off,l,n,r,n.x,n.y,r.x,r.y,u.c,u.w,c,o):G(e,!1,!1,i.b1,i.b2,l,n,r,n.x,n.y,r.x,r.y,u.c,u.w,c,o));e.setLayer(f)}function k(e,n,r,a,o,u,l){if(!r.hi){r._edit=null;var s=r.id,f=l(s),c=f&&!we,d=c,g=f&&we,h=g&&Ie.b1>=0?Ie.b1:r.b1,v=g&&Ie.b2>=0?Ie.b2:r.b2,m=g&&Ie.c||r.c,y=g&&Ie.fb||r.fb,x=g&&Ie.fbc||r.fbc,b=g&&Ie.fc||r.fc,p=g&&Ie.ff||r.ff,I=g&&Ie.fs||r.fs,w=g&&Ie.ls||r.ls,B=g&&Ie.w||r.w,A=a.x,M=a.y,k=o.x,E=o.y,S=(B||1)*ct,T=m||Ze.colours.midgrey,D=0;Ve.present.t1=!!r.t1,Ve.present.t2=!!r.t2,Ve.hib=!1,"h"===r.st?Z(n,r.a1,r.a2,h,v,r.y,s,a,o,M,E,T,S,w):r.off||a===o?C(n,r.a1,r.a2,h,v,r.off,s,a,o,A,M,k,E,T,S,w,l):G(n,r.a1,r.a2,h,v,s,a,o,A,M,k,E,T,S,w,l),r._x=Ve.pos.t.lx,r._y=Ve.pos.t.ly;var W=Ve.hib;if(Ge.iterator(Ve.pos,function(a,o){if(Ve.present[o]){var l=a.lx,f=a.ly,g="t"===o||"string"==typeof r[o]?{t:r[o]}:r[o],h=g.t||"",v=l,m=f,w=Number(g.fs||I||Re)*ct,C=!1,B=g.fc||b||Ze.colours.black,A=g.fbc||x||Ze.colours.textback,M=g.fb?!0:g.fb===!1?!1:y,Z=g.ff||p;c&&(B=t(),A=Ne());var G=X(r,h),R=U(G,e,w,M,Z),k=w+3*ct;D=k*G.length,G.length>0&&(v-=R[0]/2);for(var E=(G.length-1)*k,T=g.above?f-(E+k/2+S/2):f-E/2,F=0;F<G.length;F++){0===F&&(m=T);var V=H(e,n,G[F],l,T,s,!0,B,A,M,r,!1,!0,99,R[F],c,w,Z,W,o);C=C||V,T+=k}C&&(d=!1);var N="t"===o?r.g:g.g;if(i(N)){var O="t"===o?null:o;L(n,e,N,v,m,1,!C,c,u,s,null,W,O),d=!1}}}),d){var F=Math.max(.66*(B||0),Number(I||Re)*ct/2);n.circle(r._x,r._y,F,Ze.colours.white,-1,Ne(),!0,s,null,null,W)}r.bu&&se(n,e,s,r._x,r._y,D/2+4,1,r.bu,u),a.du&&V(a,"id1",s,A,M,n,S,T,W),o.du&&V(o,"id2",s,k,E,n,S,T,W),R(n,s,a,o,r,g,l)}}function E(e){var t=_e;return te(e)&&(t+=Pe/2),e.e&&(t*=e.e),t}function S(e){return E(e)+He}function T(e,t){return E(e)+ze+E(t)}function D(e){return 1.7*e+ct*(Ge.isNumber(De[fe])?De[fe]:De.normal)}function W(e,t,n,r,i,a,o){var u=D(r),l=i+Math.PI;e.triangle(t+u*Math.cos(l+je),n+u*Math.sin(l+je),t+u*Math.cos(l-je),n+u*Math.sin(l-je),t,n,a,-1,a,!0,o)}function F(e,t,n,r,i,a,o,u,l,s){var f=Qe(u),c=Xe(i,a,f,t,n,r);if(2===c.length){var d=o?c[0]:c[1];W(e,i,a,u,d-Math.PI,l,s)}else e.triangle(0,0,0,0,0,0,l,-1,l,!0,s,!0)}function V(e,t,n,r,i,a,o,u,l){a.circle(r,i,1.5*o,u,o,Ze.colours.white,!0,n+Ee+t,null,null,l)}function N(e){return Fe.showFullLabel&&Fe.showFullLabel===e}function O(e,t){return Ce&&("node"===e.type||"link"===e.type)&&t.length>Ce&&!N(e.id)}function X(e,t){function n(e){return O(e,t)&&(t=t.substring(0,Ce-3)+"..."),t.split(/\r\n|\r|\n/)}return""===t||t||(t=e.t),t?n(e):[""]}function U(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=Ze.measureText(t,e[o],n,r,i||ce).width;return a}function Y(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function K(e,t,n,r,i,a,o,u,l,s,f,c,d,g,h,v,m){var y=Ze.measureText(e,n,v,s,m).width;return H(e,t,n,r,i,a,o,u,l,s,f,c,d,g,y,h,v,m)}function H(e,t,n,r,i,a,o,u,l,s,f,c,d,g,h,v,m,y,x,b){var p=!0;0===n.length&&(p=!1);var I=a+Ee+(b?b:"t");if(p&&x)return t.text(0,0,n,u,m,s,I,y,!0,h,!1,o,0,0,0,0,l,v,0,x),!0;if(c&&h>g)return K(e,t,n,r,i,a,o,u,l,s,f,c,d,g,v,.85*m,y);var w,C=4*ct,B=r-h/2;w=d?i+1+m/2:i+(1+m)/2;var A={x1:B-C,y1:w-m,x2:B+h+C,y2:w};if(p){var M=d?We:0;t.text(r,w,n,u,m,s,I,y,!0,h,!1,o,A.x1,A.y1,A.x2,A.y2,l,v,C,!1,M)}return f&&"node"===f.type&&(A.x1=A.x1-f.x,A.y1=A.y1-f.y,A.x2=A.x2-f.x,A.y2=A.y2-f.y),f&&z(f,A,m,p),p}function z(e,t,n,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,t.x1),e._edit.x2=Math.max(e._edit.x2,t.x2),e._edit.y1=Math.min(e._edit.y1,t.y1),e._edit.y2=Math.max(e._edit.y2,t.y2)):e._edit={fs:n,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},me&&r&&e._cl&&e._cl.push(t)}function _(e,t){var n=e.getLayer(),r=Ze.selMap[n];r&&e.setLayer(r),t(),r&&e.setLayer(n)}function P(e,t){return t?it[e.sh]?e.sh:"box":e.sh in it?e.sh:e.sq?"box":"circle"}function j(e,t,n,r,i,a,o,u,l){var s=r+a,f=i+a;if("circle"===e){var c=Math.min(s,f);o(c)}else{var d=t-s,g=n-f,h=t+s,v=n+f;if("box"===e)u(d,g,h,v);else{var m=a*rt,y=r*et/$e+a*nt;"e"===e?(h-=m,l(h,g,t+y,n,h,v,d,v,d,g)):(d+=m,l(d,v,t-y,n,d,g,h,g,h,v))}}}function J(e,t,n,r,i,a,o,u,l,s,f,c,d){j(d,t,n,r,i,a,function(r){e.circle(t,n,r,o,u,s,f,c,l)},function(t,n,r,i){e.rect(t,n,r,i,o,u,s,f,c,l)},function(t,n,r,i,a,d,g,h,v,m){e.pentagon(t,n,r,i,a,d,g,h,v,m,o,u,s,f,c,l)})}function Q(e,t,n,r,i,a,o){j(o,t,n,r,i,a,function(t){e._c=t},function(r,i,a,o){e._cl.push({x1:r-t,y1:i-n,x2:a-t,y2:o-n})},function(r,i,a,o,u,l,s,f,c,d){e._cl.push([r-t,i-n,a-t,o-n,u-t,l-n,s-t,f-n,c-t,d-n])})}function q(e,t,n,r,i){if(!n.hi&&!n.du){var a,o,u,l,s,f,c,d,g,h=n.id,v=Oe(n),m=P(n,v),y=i(h),x=y&&pe,b=y&&!pe;a=x&&be.b||n.b,o=x&&be.bs||n.bs,u=x&&be.c||n.c,l=(v?1:x&&be.e||n.e||1)*ct,s=v?x&&be.re||n.re:!1,f=x&&be.u||n.u,c=x&&be.fi||n.fi,d=x&&Ge.isNumber(be.bw)?be.bw:n.bw;var p=n.donut&&"circle"===m?n.donut:null;n._c=0,n._cl=[],n._edit=null,n._sl={e:l};var I,w,C=!!u,B=!!f||!(!c||!c.t);p?(I=!0,w=p.b,d=l*(p.w+2*p.bw),o=null):a?(I=!0,w=a,d=l*(d||qe)):(I=!1,w=Ze.colours.white,d=0,o=null);var A,M,Z=C?u:Ze.colours.white,G=n.x,L=n.y;v?(A=n.w/2,M=n.h/2):A=M=l*$e;var R,k,E=A+d/2,S=M+d/2;p?(R=l*p.w,k=d/2):(R=I?d:l*qe,k=3*R/4);var T;if(T=ve?I||C?d/2:k-R/2:k+R/2,I||C){var D=p&&0===p.bw?-1:d||-1;J(t,G,L,E,S,0,w,D,o,Z,C,h,m),y&&s&&!B&&(st=t.cloneLast())}if((B||I||C)&&(Q(n,G,L,E,S,T,m),y&&b)){var W=Ne();_(t,function(){J(t,G,L,E,S,k,W,R,null,W,!1,h,m),s&&(lt=t.getLast())})}if(B){if(f){g=ge[f];var F=0,V=0,N=1;g&&(F=g.dx/100*A,V=g.dy/100*M,N=g.e),t.image(G-A*N+F,L-M*N+V,G+A*N+F,L+M*N+V,r+f,h,n.ci?"ci":void 0,1)}else{var O=v?Math.min(A,M):A;oe(t,e,h,G,L,O,c.t,c.c||Ze.colours.black,c.ff||de)}y&&s&&(st=t.cloneLast())}p&&le(t,G,L,Math.min(E,S),p,l,h+Ee),$(t,e,G,L,d,A,M,n,v,m,I,C,B,b,l,h,r,x)}}function $(e,n,r,i,o,u,l,s,f,c,d,g,h,v,m,y,x,b){var p,I,w,C,B,A,M=r,Z=r,G=i,R=a(s),k=!1;b?(I=be.fb||s.fb,w=be.fbc||s.fbc,C=be.fc||s.fc,B=be.ff||s.ff,A=(be.fs||s.fs||Re)*m):(I=s.fb,w=s.fbc,C=s.fc,B=s.ff,A=(s.fs||Re)*m);var E=3*m+A/2,T=C||Ze.colours.black,D=w||Ze.colours.textback;v&&(T=t(),D=Ne());var W=i+l+E,F=X(s),V=U(F,n,A,I,B),N=A+3,O=N,Y=N*F.length;F.length>0&&(Z-=V[0]/2);var K=f||h||d||g,z=Ge.defined(s.tc)?!!s.tc:!h&&!f,_=(F.length-1)*O/2;if(K)z&&(W=i-_);else{if(R){var P=S(s.g[s.g.length-1])*m;Z=r+P,r+=V[0]/2+P}W=i,i+=_}var j=r;if(("e"===c||"w"===c)&&(d||g)){var J=8*m;j+="e"===c?J:-J}F.length>0&&(G=W),d&&!z&&(W+=o-3*m);for(var Q=0;Q<F.length;Q++){var q=H(n,e,F[Q],j,W,y,!0,T,D,I,s,!1,!0,99,V[Q],v,A,B||ce);k=k||q,W+=O}var $=!s.t||!k;if(h||d||g){var ee=3,te=h?11:3;if(!f&&!h&&"circle"===c){var ne=2;ee+=ne,te+=ne}f&&(ee++,te++);var re=ee*m,ae=te*m;if(s._sl.x=-u+re,s._sl.y=-l+ae,R)for(p=0;p<s.g.length;p++){var oe,le=s.g[p],fe=null,de=!1;switch(le.p){case"ne":fe=u-re,oe=-l+ae;break;case"nw":fe=s._sl.x,oe=s._sl.y,le.e&&(s._sl.e*=le.e),de=!0;break;case"sw":fe=-u+re,oe=l-ae,de=!0;break;case"se":fe=u-re,oe=l-ae}null!==fe&&ie(e,n,y+Ee+le.p,s.x+fe,s.y+oe,m,le,x,s,de,!0)}}else L(e,n,s.g,$?M:Z,G,m,$,v,x,y,s);if(f||ue(e,y,r,i,m,s,b),s.bu){var ge=0;K?ge=l:Y>0?ge=Y/2+4:a(s)&&(ge=13*m),se(e,n,y,r,i,ge,m,s.bu,x)}}function ee(e,t,n){var r=0,i=0;if(e.t){var a=(e.fs||Re)*(e.e||1),o=X(e),u=U(o,t,a,e.fb,e.ff);r=Y(u),i=a*(o.length+1),e.u||e.c||e.bc||(r=Math.max(r/10,n))}return{width:r,height:i}}function te(e){return"b"in e?e.b:Ze.colours.keyline}function ne(e,t,n,r){e._cl.push({cx:t,cy:n,r:r})}function re(e,t,n,r,i){e._cl.push({x1:t,x2:r,y1:n,y2:i})}function ie(e,t,n,r,i,a,o,u,l,s,f,c){if(o){o.e&&(a*=o.e);var d,g=o.a?ut:1,h=_e*a*g,v=te(o),m=v?Pe*a:-1,y=h+(v?m/2:0),x=!!(o.u||o.fi&&o.fi.t),b=0,p=0,I=1;if(o.c){if(o.t){var w,C,B,A,M=o.hasOwnProperty("fb")?o.fb:!0,Z=o.fc||Ze.colours.white,G=o.ff||ce;if(o.w&&f){w=a*ke[1]*g,B=(o.t+"").substring(0,25),C=Ze.measureText(t,B,w,M,G).width,A=Math.max(C,h);var L,R,k=h;s?(L=r-(A-k)-h,R=r+h,r-=(A-k)/2):(L=r-h,R=r+(A-k)+h,r+=(A-k)/2);var E=i-h,S=i+h;e.round(L,E,R,S,h,v,m,o.c,!0,n,c),l&&(ne(l,L+h-l.x,i-l.y,y),ne(l,R-h-l.x,i-l.y,y),re(l,L+h-l.x,E-l.y-m/2,R-h-l.x,S-l.y+m/2))}else e.circle(r,i,h,v,m,o.c,!0,n,null,null,c),B=(o.t+"").substring(0,4),w=a*ke[B.length-1]*g,C=Ze.measureText(t,B,w,M,G).width,A=1.7*h,l&&ne(l,r-l.x,i-l.y,y);H(t,e,B,r,i,n,!1,Z,Ze.colours.white,M,null,!0,!1,A,C,!1,w,G,c)}else if(e.circle(r,i,h,v,m,o.c,!0,n,null,null,c),l&&ne(l,r-l.x,i-l.y,y),x){var T=h/1.41421;o.u?(d=ge[o.u],d&&(b=d.dx/100*T,p=d.dy/100*T,I=d.e),e.image(r-T*I+b,i-T*I+p,r+T*I+b,i+T*I+p,u+o.u,n,null,null,null,c)):oe(e,t,n,r,i,T,o.fi.t,o.fi.c||Ze.colours.black,o.fi.ff||de,c)}}else x&&(l&&ne(l,r-l.x,i-l.y,h),o.u?(d=ge[o.u],d&&(b=d.dx/100*h,p=d.dy/100*h,I=d.e),e.image(r-h*I+b,i-h*I+p,r+h*I+b,i+h*I+p,u+o.u,n)):oe(e,t,n,r,i,h,o.fi.t,o.fi.c||Ze.colours.black,o.fi.ff||de));o.a&&(ft=ft||{},ft[Ge.rawId(n)]=!0)}}function ae(e,t){return B(e,t,0,0)}function oe(e,t,n,r,i,a,o,u,l,s){e.rect(r-a,i-a,r+a,i+a,Ze.colours.transparent,-1,Ze.colours.transparent,!0,n,null,s);var f=2*a,c=Ze.measureText(t,o,f,!1,l||ce,!0),d=ae(c.width,c.height),g=d-f,h=f-g/2;c=Ze.measureText(t,o,h,!1,l||ce,!0),d=ae(c.width,c.height);var v=ge[o],m=0,y=0,x=1;v&&(m=v.dx/100*a,y=v.dy/100*a,x=v.e);var b=5/6,p=a*b*x,I=r-p+m,w=i-p+y,C=r+p+m,B=i+p+y;e.text(r+m,i+h*x/2+y,o,u,h*x,!1,n,l,!0,d,!0,n,I,w,C,B,null,null,null,s)}function ue(e,t,n,r,i,a,o){var u,l=e.getLayer();e.setLayer(Ze.layers.HALOS);for(var s=0;s<at.length;s++){var f=at[s];if(u=o&&be[f]||a[f]){var c=t+Ee+f,d=u.r*i,g=u.w*i;g/2>=d?e.circle(n,r,d+g/2,Ze.colours.white,-1,u.c,!0,c,null,!0):e.circle(n,r,d,u.c,g,Ze.colours.white,!1,c,null,!0)}}e.setLayer(l)}function le(e,t,n,r,i,a,o){var u=i.bw*a,l=i.w*a;if(l>0){var s=i.v.filter(function(e){return e>0}).length;if(1===s){var f=0;i.v.forEach(function(e,t){e>0&&(f=t)}),e.circle(t,n,r,i.c[f],l,Ze.colours.white,!1,o+"do0",null,!0)}else{var c=i.v.reduce(function(e,t){return e+t},0),d=u/r,g=d*s,h=2*Math.PI-g,v=-Math.PI/2+d/2;h>0&&i.v.reduce(function(a,f,g){if(0===f)return a;var v=a+h*f/c,m=v+d,y=i.c[g%i.c.length];return 0===u&&(0===g?a-=ot:g!==s-1&&(v+=ot)),e.arc(t,n,r,a,v,y,l,o+"do"+g,null,!0),m},v)}}}function se(e,t,n,r,i,a,o,u,l){if(u.t){var s=e.getLayer();e.setLayer(Ze.layers.BUBBLES);var f=u.p?""+u.p:"ne",c="w"===f.substring(1,2),d="s"===f.substring(0,1),g=n+Ee+"bu",h=Number(u.fs?u.fs:Re)*ct,v=u.b?u.b:Ze.colours.keyline,m=u.c?u.c:Ze.colours.white,y=u.fc?u.fc:Ze.colours.black,x=X(u),b=h+3*ct,p=b*x.length,I=U(x,t,h,u.fb,u.ff),w=Y(I),C=13*ct,B=6*ct,A=2*o,M=9*ct,Z=13*ct,G=10*ct;a+=Z;var L=p+2*B,R=2*ct,k=Math.max(R/2,1),E=3*ct;u.g&&delete u.g.e;var S=u.g?17*ct:0;c&&(r-=w+2*A+2*C+S),d&&(i+=(h+3)*x.length+2*a+2*B);var T=r+A+.5,D=r+A+2*C+w+S+.5,W=i-a-L+.5,F=i-a+.5;e.round(T,W,D,F,8*ct,v,R,m,!0,g),ie(e,t,g,r+S,(W+F)/2,ct,u.g,l);var V,N=W-.5+B+b,O=T+C+S-.5;for(V=0;V<x.length;V++){var K=I[V];e.text(O,N,x[V],y,h,u.fb,g,u.ff||ce,!1,K,!1,!1,O-1.5,N-h,D,F),N+=b}c&&(T=D,M=-M,G=-G,k=-k),d&&(F=W,Z=-Z,E=-E),e.triangle(T+M,F,T+M+G,F,T+M,F+Z,v,R,m,!0,g),e.triangle(T+M+k,F-E,T+M+G+k,F-E,T+M+k,F+Z-E,v,-1,m,!0,g),e.setLayer(s)}}var fe,ce,de,ge,he,ve,me,ye,xe,be,pe,Ie,we,Ce,Be={},Ae=!1,Me=!1,Ze=KeyLines.Rendering,Ge=KeyLines.Util,Le=KeyLines.Generator.defaultFontSize=14,Re=Be.fontSize=Le,ke=[12,9,7,7],Ee=Ge.idSep(),Se=1,Te=2,De={small:6,normal:10,large:20,xlarge:30},We=0,Fe={},Ve={hib:!1,present:{t:!0,t1:!1,t2:!1},pos:{t:{lx:0,ly:0},t1:{lx:0,ly:0},t2:{lx:0,ly:0}}};Be.setSpecialOptions=function(e,t){Fe[e]=t};var Ne=Be.editColour=function(){return he||Ze.colours.edit};Be.setOptions=function(e){fe=e.arrows,Ge.isNumber(e.labelOffset)&&(We=e.labelOffset),Ce=e.truncateLabels&&e.truncateLabels.maxLength&&Ge.isNumber(e.truncateLabels.maxLength)?e.truncateLabels.maxLength:!1,e.selectionColour&&(he=Ze.validatergb(e.selectionColour)?e.selectionColour:void 0),xe=e.fanLength,ce=e.fontFamily,de=e.iconFontFamily,ge=e.imageAlignment||{},me=e.linkEnds.avoidLabels,ve="loose"!==e.linkEnds.spacing,e.selectionFontColour&&(ye=Ze.validatergb(e.selectionFontColour)?e.selectionFontColour:void 0),be=e.selectedNode,pe=Ge.isNormalObject(e.selectedNode),Ie=e.selectedLink,we=Ge.isNormalObject(e.selectedLink)};var Oe=Be.shapeTest=function(e){var t=!1;return t=isFinite(e.w)&&isFinite(e.h)},Xe=function(e,t,n,r,i,a){var o=r-e,u=i-t,l=Math.sqrt(o*o+u*u);if(l>n+a||l<Math.abs(n-a)||0===l)return[];var s=(n*n-a*a+l*l)/(2*l),f=Math.sqrt(n*n-s*s),c=e+s*o/l,d=t+s*u/l,g=c+f*u/l,h=c-f*u/l,v=d-f*o/l,m=d+f*o/l;return[Math.atan2(v-t,g-e),Math.atan2(m-t,h-e)]},Ue=34,Ye={t:.5,t1:.15,t2:.85},Ke=["_ha0","_ha1","_ha2","_ha3","_ha4"],He=3,ze=1,_e=9,Pe=2,je=Math.PI/7,Je=Math.cos(je),Qe=Be.arrowLength=function(e){return Je*D(e)};Be.labelPosition=function(e,t){if(!e||e.hi)return null;var n=e._edit,r=n.x1,i=n.y1,a=n.x2,o=n.y2;return"node"===e.type&&(r+=e.x,i+=e.y,a+=e.x,o+=e.y),{x1:t.x(r),y1:t.y(i),x2:t.x(a),y2:t.y(o),fs:t.dim(n.fs)}};var qe=KeyLines.Generator.defaultBorderWidth=4,$e=KeyLines.Generator.baseRadius=27,et=50,tt=et-$e,nt=Math.sqrt($e*$e+tt*tt)/$e,rt=1-Math.sin(Math.atan2($e,tt)/2),it={box:!0,circle:!0,e:!1,w:!1};Be.nodeSize=function(e,t,n){if(e.w&&e.h)return Ge.len(e.w,e.h)/2;if(e.du)return 10;var r=$e*(e.e||1),i=ee(e,t,r);if(n){var a=r+i.height/2,o=i.width/2;return Ge.len(o,a)}return r+i.height/2};var at=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"],ot=Math.PI/256;Be.contains=function(e,t){function n(e,t){e&&a.push(t)}var r,i,a=[];if(e=Ge.defaults(e,{sh:"box",x:0,y:0}),Oe(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(i in t)r=t[i],Oe(r)?"circle"===r.sh?n(Ze.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):n(Ze.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):n(Ze.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var u={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(i in t)if(r=t[i],Oe(r))if("circle"===r.sh){var l=Math.min(r.w,r.h)/2;n(Ze.rectContains(u,r.x-l,r.y-l,r.x+l,r.y+l),r.id)}else n(Ze.rectContains(u,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else n(Ze.inside(u,r.x,r.y),r.id)}return a};var ut,lt,st,ft,ct=1;return Be.getResizePrimitive=function(){return st},Be.animated=function(){return!!ft},Be.generate=function(t,n,r,i,a,o,u,l,s,f,c){function d(e){o.resetItem(e,e.x,e.y),o.setLayer(Oe(e)?Ze.layers.SHAPES:Ze.layers.NODES),q(u,o,e,f,c)}function g(e){o.resetItem(e),o.setLayer(Ze.layers.LINKS),k(u,o,e,t[e.id1],t[e.id2],f,c)}var h,v,m,y,x;if(Ae=Me,Me=!1,st&&(r||a[st.id]===Te)&&(lt=null,st=null),ft=null,ut=e.atanEasing(Date.now()%1e3/1e3),ct=l.getUnzoom(),r){for(o.removeAllItems(),y=Object.keys(t),m=Object.keys(n),h=0,v=y.length;v>h;h++)d(t[y[h]]);for(h=0,v=m.length;v>h;h++)g(n[m[h]])}else{var b=Object.keys(a);for(h=0,v=b.length;v>h;h++){x=b[h];var p=t[x];p?a[x]===Se?o.moveItem(p,p.x,p.y):d(p):n[x]||o.removeItem(x)}if(i)for(m=Object.keys(n),h=0,v=m.length;v>h;h++)g(n[m[h]]);else for(h=0,v=b.length;v>h;h++)x=b[h],n[x]&&g(n[x])}return o.assembleItems(),{stillDirty:ft,rebuildAll:Ae}},Be.generateHandles=function(e,t,n,r){e.extras(),
e.setLayer(Ze.layers.HANDLES),lt&&1===r.length&&(Ze.getHandles(e,t,n,lt,1,lt.id,Ne(),Ee),Ze.getHandles(e,t,n,lt,4,lt.id,Ze.colours.transparent,Ee))},Be}}(),function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var t=KeyLines.Util,n={};return n.primitiveMover=function(n,r,i,a,o,u,l,s,f,c){function d(e,t){return{dx:i.undim(e-s),dy:i.undim(t-f)}}function g(e,n,r,i){var a,o={};if(l.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var u=0;u<l.length;u++){a=l[u];var s="x"===a.charAt(0)?e:n;o[a]=s}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else i&&(e=Math.abs(e)>Math.abs(n)?e:0,n=0!==e?0:n),o.x1=o.x2=e,o.y1=o.y2=n;for(var f={},c=["x1","y1","x2","y2"],d=0;d<c.length;d++)a=c[d],f[a]=y[a]+o[a];if(i){var g=y.x2-y.x1,h=y.y2-y.y1;if(Math.abs(g)>0&&Math.abs(h)>0){var v,m=h/g,x=f.x2-f.x1,b=f.y2-f.y1,p=Math.abs(e)>Math.abs(n);if(p){var I=Math.floor(m*(g+x)-h)-b;r||!t.contains(l,"y1")&&!t.contains(l,"y2")?(v=Math.floor(I/2),f.y1-=v,f.y2+=v):(t.contains(l,"y1")&&(f.y1-=I),t.contains(l,"y2")&&(f.y2+=I))}else{var w=Math.floor((h+b)/m-g)-x;r||!t.contains(l,"x1")&&!t.contains(l,"x2")?(v=Math.floor(w/2),f.x1-=v,f.x2+=v):(t.contains(l,"x1")&&(f.x1-=w),t.contains(l,"x2")&&(f.x2+=w))}}}return f}function h(e,t,n,r){var i=d(e,t);return g(i.dx,i.dy,n,r)}function v(){b.wc&&(x.c=b.wc[3]),b.wfc&&(x.fc=b.wfc[3]),b.wbc&&(x.bc=b.wbc[3])}function m(){b.wc&&(b.wc[3]=x.c),b.wfc&&(b.wfc[3]=x.fc),b.wbc&&(b.wbc[3]=x.bc)}if(!e.trigger("dragstart","resize",a,i.unscale(s),i.unscale(f),null)){var y=n.extents(r,o),x={},b={};for(var p in o)b[p]=o[p];v(),n.setAlpha(b,.5);var I={scrollable:!0,getCursor:function(){return u?"crosshair":"move"},generate:function(e){e.copyPrimitive(b)},dragMove:function(e,t,i,a){var o=h(e,t,i,a);n.setExtents(b,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(t,u,l,s,f){i.cancelScroll();var d=e.trigger("dragend","resize",a,i.unscale(u),i.unscale(l));if(m(),!d&&t){var g=h(u,l,s,f);n.setExtents(o,g.x1,g.y1,g.x2,g.y2,r),c(o)}e.trigger("dragcomplete","resize",a,i.unscale(u),i.unscale(l))}};return I}},n.createHandDragger=function(n,r,i,a){function o(e,t){g=g||Math.abs(r-e)>10||Math.abs(i-t)>10,c=e-r,d=t-i,l&&(l.x||(c=0),l.y||(d=0))}function u(){g&&(n.offsetX(s+c),n.offsetY(f+d),e.trigger("viewchange"))}var l={x:!0,y:!0},s=n.offsetX(),f=n.offsetY(),c=0,d=0,g=!1,h="hand",v=e.trigger("dragstart",h,null,n.unscale(r),n.unscale(i));if(v){if(!t.isNormalObject(v))return void a();for(var m in v)l[m]=v[m]}return{rebuild:{drawOnly:!0},animate:u,direction:l,dragMove:o,getCursor:function(){return"move"},endDrag:function(t,r,i){var l=e.trigger("dragend",h,null,n.unscale(r),n.unscale(i));g?(!l&&t?o(r,i):c=d=0,u()):a(),e.trigger("dragcomplete",h,null,n.unscale(r),n.unscale(i))}}},n.createDefaultDragger=function(n,r,i,a,o,u,l,s){function f(e){return h.add&&h.add[e]}function c(){for(var e in r)(a(e)||f(e))&&I[e]&&n.moveNode(e,I[e].x+Z.dx,I[e].y+Z.dy);for(var t in C)(a(t)||f(t))&&n.moveLink(t,C[t].y+Z.dy)}function d(){for(var e in r)I[e]&&n.moveNode(e,I[e].x,I[e].y);for(var t in C)n.moveLink(t,C[t].y)}function g(e,t){return G=G||Math.abs(l-e)>10||Math.abs(s-t)>10,e=o?o.viewToWorldX(e):e,t=o?o.viewToWorldY(t):t,h&&(h.x||(e=b),h.y||(t=p)),{dx:G?e-b:0,dy:G?t-p:0}}var h={x:!0,y:!0,add:null},v=t.rawId(u),m="move",y=e.trigger("dragstart",m,v,o.unscale(l),o.unscale(s),t.subId(u));if(y)if(Array.isArray(y))h.add=t.makeIdMap(y);else{if(!t.isNormalObject(y))return;for(var x in y)h[x]=y[x];Array.isArray(h.add)&&(h.add=t.makeIdMap(h.add))}var b=o?o.viewToWorldX(l):l,p=o?o.viewToWorldY(s):s,I={};for(var w in r)I[w]={x:r[w].x,y:r[w].y};var C={};for(var B in i)"h"===i[B].st&&(C[B]={y:i[B].y||0});var A,M,Z=g(l,s),G=!1,L={rebuild:{positions:!0},scrollable:!0,direction:h,animate:c,generate:function(e){e.excludeHit(v)},getCursor:function(){return"move"},dragMove:function(e,t){Z=g(e,t)},mouseMoved:function(e){return e&&(A=!0),A},afterDraw:function(n,r,i){A=!1;var a=t.rawId(n);v!==a&&(void 0===M?M=a:a!==M&&(e.trigger("dragover",a,o.unscale(r),o.unscale(i),t.subId(n)),M=a))},endDrag:function(r,i,a){o.cancelScroll();var l=e.trigger("dragend",m,t.rawId(u),o.unscale(i),o.unscale(a));l?d():r&&G?(d(),Z=g(i,a),e.trigger("prechange","move"),c()):d(),n.setDirty(v),e.trigger("dragcomplete",m,t.rawId(u),o.unscale(i),o.unscale(a))}};return L},n.createLinkEndDragger=function(n,r,i,a,o,u,l,s,f){function c(e,t){r.moveNode(o[u],e,t)}function d(e,t){return e=i?i.viewToWorldX(e):e,t=i?i.viewToWorldY(t):t,{dx:e-m,dy:t-y}}function g(){return o["id1"===u?"id2":"id1"]}if(e.trigger("dragstart","dummy",f,i.unscale(l),i.unscale(s),null))return!1;var h,v,m=i?i.viewToWorldX(l):l,y=i?i.viewToWorldY(s):s,x=a[o[u]].x,b=a[o[u]].y,p=d(l,s),I=null,w={rebuild:{all:!0},scrollable:!0,animate:function(){c(x+p.dx,b+p.dy)},getCursor:function(){return"move"},dragMove:function(e,t){p=d(e,t),I=n.hittest(e,t,i)},mouseMoved:function(e){return e&&(v=!0),v},afterDraw:function(n,r,a){v=!1;var o=t.rawId(n),u=t.subId(n);f===o&&(o=null,u=null),void 0===h?h=o:o!==h&&(e.trigger("dragover",o,i.unscale(r),i.unscale(a),u),h=o)},endDrag:function(n,l,s){i.cancelScroll();var f=e.trigger("dragend","dummy",I,i.unscale(l),i.unscale(s));if(!f)if(n)if(c(x,b),e.trigger("prechange","move"),I=t.rawId(I),a[I]&&I!==g()){delete a[o[u]],o[u]=I;var h={};h[o.id]=o,r.clearGraphCache(),r.resetConnectionOffsets(h)}else p=d(l,s),c(x+p.dx,b+p.dy),I=null;else c(x,b);e.trigger("dragcomplete","dummy",I,i.unscale(l),i.unscale(s))}};return w},n.createLinkDragger=function(n,r,i,a,o,u,l,s){function f(e,t,n,r,i,a){return((n-e)*(t-a)-(e-i)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function c(e,t,r){var a=e===o,u=a?i.viewToWorldX(t):t,l=a?i.viewToWorldY(r):r,s=n("x1",e),c=n("y1",e),d=n("x2",e),m=n("y2",e),y=f(s,c,d,m,u,l);v[e.id]&&Math.abs(y-g[e.id])>8&&(v[e.id]=!1),v[e.id]||(Math.abs(a?y:y+g[e.id])<12&&(y=a?0:-g[e.id]),h[e.id]=a?y:y+g[e.id])}function d(e){a.setLinkOffset(e,h[e])}if(e.trigger("dragstart","offset",s,i.unscale(u),i.unscale(l),t.subId(s)))return!1;var g={},h={},v={};for(var m in a.privateSelection())if(m){var y=a.getByID(m);y&&"link"===y.type&&(g[m]=y.off||0,h[m]=y.off||0,v[m]=!0)}var x=!1,b={rebuild:{all:!0},scrollable:!0,animate:function(){for(var e in h)d(e)},getCursor:function(){return"move"},dragMove:function(e,t){var r=i.viewToWorldX(e)-i.viewToWorldX(u),s=i.viewToWorldY(t)-i.viewToWorldY(l);for(var f in h){var d=a.getByID(f);if(d)if(d===o)c(d,e,t),x=!0;else{var g=(n("x1",d)+n("x2",d))/2,v=(n("y1",d)+n("y2",d))/2;c(d,g+r,v+s)}}},endDrag:function(t,n,r){var o;i.cancelScroll();var u=e.trigger("dragend","offset",s,i.unscale(n),i.unscale(r));if(!u&&a.getByID(s))if(t&&x){for(o in g)a.getByID(o).off=g[o];e.trigger("prechange","offset");for(o in h)a.getByID(o).off=h[o]}else{for(o in h)h[o]=g[o];this.animate()}e.trigger("dragcomplete","offset",s,i.unscale(n),i.unscale(r))}};return b},n}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateImage=function(t,n,r,i){var a=t.wsc||[0,0,0,0],o=0;if("ci"===t.s&&(o="width"===n.maxDimension?(t.y2-t.y1)/2:(t.x2-t.x1)/2),r.alwaysUpdate||r.rebuildOptions.all||r.rebuildOptions.shadow)for(var u=0;e>u;u++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(u=0;e>u;u++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255;if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var l=t.x1,s=t.y1,f=t.x2,c=t.y2;i&&(l=t.x1+i.x,s=t.y1+i.y,f=t.x2+i.x,c=t.y2+i.y);var d=r.triangleBuffers.positionIndex,g=r.triangleBuffers.positionData;g[d++]=l,g[d++]=s,g[d++]=0,g[d++]=f,g[d++]=s,g[d++]=0,g[d++]=l,g[d++]=c,g[d++]=0,g[d++]=l,g[d++]=c,g[d++]=0,g[d++]=f,g[d++]=s,g[d++]=0,g[d++]=f,g[d++]=c,g[d++]=0,r.triangleBuffers.positionIndex=d}if(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all){var h,v,m,y;o?(v=n.cu1,h=n.cv1,y=n.cu2,m=n.cv2):(v=n.u1,h=n.v1,y=n.u2,m=n.v2),r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=y,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=m,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=m,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=y,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=y,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=m,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0}}}}(),function(){var e=KeyLines.Validation={};e.create=function(e,t,n,r){function i(t){if(I.isNormalObject(t))for(var n in t)f(t,n),y(t,n,e.reserved)}function a(t,n){for(var r in t)f(t,r),y(t,r,e.reserved),n&&y(t,r,e.booleans)}function o(e,t){var n=e[t],r=!0;if(I.isNormalObject(n))for(var i in n)u(n,i),r&=isFinite(n[i]);r||delete e[t]}function u(t,n){var r=+t[n];0>r&&!e.negatives[n]&&(r=null),t[n]=r}function l(t,n){I.isNullOrUndefined(t[n])||(t[n]=t[n]+"",e.stringValues[n]&&!e.stringValues[n][t[n]]&&delete t[n])}function s(e,t){e[t]&&(e[t]=w.validatergb(e[t])?e[t]:void 0)}function f(t,n){e.strings[n]?l(t,n):e.numbers[n]?u(t,n):e.colours[n]?s(t,n):e.mapPos[n]&&o(t,n)}function c(e){if(I.isNormalObject(e.fi)){var t=e.fi;I.isNullOrUndefined(t.t)||(t.t="string"==typeof t.t?t.t.charAt(0):String.fromCharCode(t.t)),t.c&&(t.c=w.validatergb(t.c)?t.c:void 0),"ff"in t&&"string"!=typeof t.ff&&(t.ff=void 0)}else null!==e.fi&&delete e.fi}function d(e){return/(ne|nw|se|sw)/.test(e)}function g(e,t){var n,r={};return Array.isArray(e)&&(n=e.filter(function(e){var n,i=e.p;return t?n=e:i&&2===i.length&&d(i)&&(r[i]||(n=e,r[i]=1)),n?(c(e),e):void 0})),n}function h(t,n){e.halos.forEach(function(e){var r=t[e];r&&(n?"c"in r||"r"in r||"w"in r||delete t[e]:"c"in r&&"r"in r&&"w"in r?(s(r,"c"),I.isNullOrUndefined(r.c)||I.isNullOrUndefined(r.r)||I.isNullOrUndefined(r.w)||!I.isNumber(+r.r)||!I.isNumber(+r.w)?delete t[e]:(r.r=+r.r,r.w=+r.w)):delete t[e])})}function v(e,t){t||Array.isArray(e.donut.v)?(e.donut.v&&e.donut.v.forEach(function(t,n){(!I.isNumber(t)||0>t)&&(e.donut.v[n]=0)}),e.donut.c&&(Array.isArray(e.donut.c)&&!e.donut.c.some(function(e){return!w.validatergb(e)})||delete e.donut.c),["bw","w"].forEach(function(t){t in e.donut&&u(e.donut,t)}),"b"in e.donut&&s(e.donut,"b"),t||(e.donut=I.defaults(e.donut,A))):delete e.donut}function m(e){if(Array.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;d(t)||2===t.length||delete e.bu}}function y(e,t,n){n[t]&&delete e[t]}function x(e,t,n,r){function i(e,t){return e.id in t.nodes||e.id in t.links}function a(e){return"node"===e.type&&e.id in n||"link"===e.type&&e.id in t}t=t||{},n=n||{};var o,u={nodes:{},links:{}};return e&&(u=e.reduce(function(e,n){if(n.id&&!i(n,e)&&!a(n)){if(o=n.type+"s","node"===n.type){var u=!0;r&&t[n.id]&&(u=!1),u&&G(n)}o in e&&(e[o][n.id]=n)}return e},u)),u}function b(e,t,n,r){var i={};for(var a in e){var o=e[a];L(o,t,n,r)&&(i[a]=o)}return i}function p(e,n,r,i,a){for(var o in i){var u=i[o];!a&&u._parentId||r[u.id1][e]!==n&&r[u.id2][e]!==n||u[e]!==n&&(u[e]=n,t(o))}}var I=KeyLines.Util,w=KeyLines.Rendering;t=t||I.noop,n=n||I.noop,r=r||I.noop;var C={},B={numbers:{},negatives:{},strings:{},stringValues:{},colours:{},booleans:{},reserved:{},mapPos:{},halos:[]},A=C.donutDefaults={b:"rgb(255, 255, 255)",bw:2,c:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],w:10};e=I.defaults(e,B),C.typeCheck=function(e,t){Z(e.items,!1,t)},C.filterNodesAndLinks=function(e,t,n,r){r=r||{};var i=x(e,t,n,r.carefulWithXandY);return i.links=b(i.links,i.nodes,t,r.selfLinks),i};var M=C.ensureObject=function(e,t,n){n=n||{},a(e,t),c(e),e.g&&(Array.isArray(e.g)?(Z(e.g),e.g=g(e.g,"link"===e.type||n[e.id])):delete e.g),h(e,t),e.donut&&v(e,t),e.bu&&m(e),e.t1&&i(e.t1),e.t2&&i(e.t2)},Z=C.ensureTypesInArray=function(e,t,n){if(e)for(var r=0;r<e.length;r++)M(e[r],t,n)},G=C.setZeroXY=function(e){"node"===e.type&&(e.x=e.x||0,e.y=e.y||0)},L=C.hasValidEnds=function(e,t,n,r){return r||e.id1!==e.id2?(t=t||{},n=n||{},(n[e.id1]||t[e.id1])&&(n[e.id2]||t[e.id2])):!1};C.ensureHiddenItemConsistency=function(e,t){R("hi",!1,e,t)};var R=C.ensureConsistency=function(e,t,i,a,o){p(e,!0,i,a,o),t||r(e),"hi"===e&&n()};return C}}(),function(){var e=KeyLines.Canvas={},t=8888,n=e.getDevicePixelRatio=function(){return"undefined"!=typeof window?window.devicePixelRatio||1:void 0};e.create=function(e,r,i,a,o,u,l){function s(e,t,n){var r=document.createElement("canvas");n&&y&&(r.dir="rtl",document.body.appendChild(r),r.style.display="none");var i;return i=l?document.createElement("canvas").getContext("2d"):r.getContext("2d"),r.context2d=i,r.height=t,r.width=e,l||g(r),r}function f(e,t){var r=n(),i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,a=r/i;if(r!==i){var o=e.width,u=e.height;e.width=Math.round(o*a),e.height=Math.round(u*a),e.style.width=o+"px",e.style.height=u+"px",l||t.scale(a,a)}}function c(){if(!KeyLines.Rendering.rtlBugChecked){var e=100,t=30,n=s(e,t);document.body.appendChild(n),n.setAttribute("dir","rtl");var r=n.context2d;r.fillStyle="#000",r.fillRect(0,0,e,t),r.textAlign="center",r.fillStyle="#fff",r.font="20px sans-serif",r.fillText("\u2588",e/2,t);var i=r.getImageData(e/2,t-1,1,1).data;KeyLines.Rendering.rtlBugPresent=0===i[0],document.body.removeChild(n),KeyLines.Rendering.rtlbugChecked=!0}}function d(){if(!KeyLines.Rendering.minimumFontChecked){for(var e="Hello",t=s(100,100).context2d,n=!1,r=function(n){return KeyLines.Rendering.setFont(t,n),t.measureText(e).width},i=r(1),a=2;!n&&30>a;){var o=r(a);n=i!==o,n&&(KeyLines.Rendering.browserMinimumFontSize=a-1),a++}KeyLines.Rendering.minimumFontChecked=!0}}function g(e){function t(e){n.setLineDash=function(t){n[e]=t}}var n=e.getContext("2d");n.setLineDash||("undefined"!=typeof n.webkitLineDash?t("webkitLineDash"):"undefined"!=typeof n.mozDash&&t("mozDash"))}function h(){return document.createElement("img")}function v(){C.update(),A(v)}var m=document.getElementById(r),y=KeyLines._rtlTest(m),x=s(i,a,!0);x.style.display="block";var b={},p=x.context2d;m.style.display="block",m.parentNode.replaceChild(x,m),x.setAttribute("id",r),l&&KeyLines.webGLSupport()&&"chart"===e&&(b.renderer=x.renderer=KeyLines.WebGL.create(x),x.webgl=!0),x.canvas=!0;var I=x;x.webgl?(p.webgl=!0,p.webglCanvas=x):p.webgl=!1,f(x,p),d(),c();var w=I.getAttribute("style")||"";w+="-ms-touch-action: none; touch-action: none; outline: none;",I.setAttribute("style",w),I.setAttribute("tabindex",""+t++);var C="chart"===e?KeyLines.API.createAPI(r):KeyLines.TimeBar.API.createAPI(r);for(var B in C)-1===B.indexOf("private")&&(b[B]=C[B]);C.privateInit(p,i,a,s,function(e){document.getElementById(r).style.cursor=e},h,o,void 0,u),b.internalSetSize=function(e,t,n){C.privateMapSetSize&&C.privateMapSetSize(e,t),I.width=e,I.height=t,f(I,p),C.privateSetSize(p,e,t,n,!0)};var A=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){KeyLines.Util.nextTick(e,1e3/60)}}();return A(v),b}}(),function(){function e(e,n,i){return n.forEach(function(n){e[n]&&(e[n+s]=t(e[n],n,"create"===n))}),i&&i.forEach(function(t){e[t]&&(e[t+s]=r(e[t],h))}),e}function t(t,r,i){var a=function(){for(var a=Array(arguments.length),l=0;l<a.length;l++)a[l]=arguments[l];var s=Math.max(0,t.length-1),f=n(r,a);return f?t.apply(null,a):new u(function(n,r){function u(t,i){if(t)return r(t);var a=Array.isArray(i);i=a?i:[i];var o=i.map(function(t){return e(t,d,g)});return n(a?o:o[0])}var l=a.length===t.length&&o.Util.isFunction(a[s]);l&&(a.pop(),o.Util.log("A callback has been passed, but the function will return a Promise instead")),a[s]=i?u:n,t.apply(null,a)})};return a}function n(e,t){return/options$/i.test(e)&&o.Util.isNullOrUndefined(t[0])?!0:"range"===e&&!t.length}function r(e,n){var r=function(){var r=Array.prototype.slice.call(arguments),i=e.apply(null,r),a={},u=o.Util.makeIdMap(n);return Object.keys(i).forEach(function(e){e in u?a[e+s]=t(i[e],e):a[e]=i[e]}),a};return r}function i(e){var t=e||u,n="undefined"!=typeof t&&"resolve"in t&&"reject"in t;try{new t(function(e){n=n&&"function"==typeof e})}catch(r){throw new Error("You must pass a valid promise constructor")}return n}var a="undefined"!=typeof window?window:global,o=a.KeyLines,u=a.Promise,l=u,s="",f=!1,c=["create"],d=["arrange","createLink","filter","foreground","range","animateProperties","expand","hide","layout","load","merge","options","pan","ping","setItem","setProperties","show","toDataURL","viewOptions","zoom"],g=["combo","graph","map","getGraphEngine"],h=["combine","uncombine","closeness","betweenness","show","hide","options"];o.promisify=function(t){if(arguments.length>1&&arguments[1]&&(s=arguments[1]),null==l&&!u&&!t)throw Error("[promisify] There's no valid Promise constructor available. It is not possible to promisify.");if(!i(t))throw Error("[promisify] Promise constructor not valid. Please use a valid Promise implementation.");if(u=t||l,!f){e(o,c,g);var n=o.Util.values(o.components||{});n.forEach(function(t){e(t,d,g)})}f=!0}}(),function(){"use strict";if(KeyLines.WebGL){var e=3;KeyLines.WebGL.generateTriangle=function(t,n,r,i,a,o,u,l,s,f,c){var d,g=t.wsc||[0,0,0,0];if(f.rebuildOptions.all||f.rebuildOptions.shadow||f.alwaysUpdate)for(var h=0;e>h;h++)f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[0],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[1],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[2],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[3];if(f.rebuildOptions.all||f.rebuildOptions.colours||f.alwaysUpdate)for(h=0;e>h;h++)f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=l[0],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=l[1],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=l[2],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=l[3];if(f.rebuildOptions.all||f.rebuildOptions.positions||f.alwaysUpdate){d=f.triangleBuffers.positionIndex;var v=f.triangleBuffers.positionData;c&&(n+=c.x,r+=c.y,i+=c.x,a+=c.y,o+=c.x,u+=c.y),v[d++]=n,v[d++]=r,v[d++]=0,v[d++]=i,v[d++]=a,v[d++]=0,v[d++]=o,v[d++]=u,v[d++]=0,f.triangleBuffers.positionIndex=d}if(f.rebuildOptions.all||f.rebuildOptions.textures||f.alwaysUpdate){d=f.triangleBuffers.textureIndex;var m=f.triangleBuffers.textureData;m[d++]=0,m[d++]=1,m[d++]=0,m[d++]=0,m[d++]=s,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=1,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=s,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=1,m[d++]=0,m[d++]=s,m[d++]=0,m[d++]=0,m[d++]=0,m[d++]=0,f.triangleBuffers.textureIndex=d}}}}(),function(){function e(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n]]=1;return t}function t(t){for(var n=e(t),r=[],i=0;i<V.length;i++)n[i]||r.push(i);return r}function n(e){return"transparent"===e||e===K.transparent}function r(e,t){return 1===t?e:oe(e,t)}function i(e,t,n,r,i,a){var o,u,l=0;if(KeyLines.Util.isTextArabic(t)){var s=KeyLines.Bidi.analyseText(t).result;for(o=0,u=s.length;u>o;o++){var f=s[o];KeyLines.Util.isTextArabic(f.text)?ie(e,n,i,a):ie(e,r,i,a),l+=e.measureText(f.text).width}}else for(o=0,u=t.length;u>o;o++)l+=e.measureText(t[o]).width;return l}function a(e){var t={};for(var n in e)t[S.primitives[n]]=e[n];return t}function o(e,t,n,r){var i,a,o,u;t.sm?(i=n.sdim(t.r),a=n.sdim(t.bw)):(i=n.dim(t.r),a=r?n.sw(t.bw):n.w(t.bw));var l=t.a;l?(o=t.x+l.x,u=t.y+l.y):(o=t.x,u=t.y),r?b(e,n.x(o),n.y(u),i,t.bc&&t.sc,a,t.fc&&t.sc,t.fi):b(e,n.x(o),n.y(u),i,t.bc,a,t.fc,t.fi,t.bs)}function u(e,t,n,r){var i,a,o=t.a;o?(i=t.x+o.x,a=t.y+o.y):(i=t.x,a=t.y);var u,l,s,f=n.x(i),c=n.y(a),d=n.dim(t.r);r?(u=t.bc&&t.sc,l=n.sw(t.bw)):(u=t.bc,l=n.w(t.bw),s=t.ls),p(e,f,c,d,t.sa,t.ea,u,l,s)}function l(e,t,n,r){var i,a,o,u,l=t.a;l?(i=t.x1+l.x,a=t.y1+l.y,o=t.x2+l.x,u=t.y2+l.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?I(e,n.x(i),n.y(a),n.x(o),n.y(u),t.c&&t.sc,n.sw(t.w)):I(e,n.x(i),n.y(a),n.x(o),n.y(u),t.c,n.w(t.w),t.ls)}function s(e,t,n,r){var i,a,o,u,l,s,f,c,d=t.a;d?(i=t.x1+d.x,a=t.y1+d.y,o=t.x2+d.x,u=t.y2+d.y,l=t.x3+d.x,s=t.y3+d.y,f=t.x4+d.x,c=t.y4+d.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,l=t.x3,s=t.y3,f=t.x4,c=t.y4),r?w(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),n.x(f),n.y(c),t.c&&t.sc,n.sw(t.w)):w(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),n.x(f),n.y(c),t.c,n.w(t.w),t.ls)}function f(e,t,n,r){var i,a,o,u,l=t.a,s=0;if(l?(i=t.x1+l.x,a=t.y1+l.y,o=t.x2+l.x,u=t.y2+l.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r)s=n.dim(t.fs)*t.pf,t.back&&B(e,n.x(i),n.y(a),n.x(o),n.y(u)+s,t.sc,-1,t.sc,!0);else{var f,c;l?(f=t.x+l.x,c=t.y+l.y):(f=t.x,c=t.y);var d=t.xc;d&&S.applyRtlFix&&(d=!1,f-=Math.floor(t.w/2));var g=n.x(f),h=n.y(c+t.yOffset),v=n.dim(t.fs);if(s=v*t.pf,t.w&&(3>=v||v<S.browserMinimumFontSize)){var m=n.dim(t.w),y=t.isSel?t.bc:oe(t.c,.4);d&&(g-=Math.floor(m/2)),t.back&&t.bc!==K.textback&&B(e,g,h-v,g+m,h+s,t.bc,-1,t.bc,!0),B(e,g,h-v,g+m,h+s,y,-1,y,!0)}else t.back&&B(e,n.x(i),n.y(a),n.x(o),n.y(u)+s,t.bc,-1,t.bc,!0),C(e,g,h+s/2,t.t,t.c,v,t.bo,t.ff,d)}}function c(e,t,n,r,i){var a,o,u,l,s=t.a;s?(a=t.x1+s.x,o=t.y1+s.y,u=t.x2+s.x,l=t.y2+s.y):(a=t.x1,o=t.y1,u=t.x2,l=t.y2);var f=n.x(a),c=n.y(o),d=n.x(u),g=n.y(l);if(t.vx&&(f-=t.vx,c-=t.vx,d+=t.vx,g+=t.vx),r)B(e,f,c,d,g,t.sc,-1,t.sc,!0);else{var h=i[t.u];if(t.hi&&he()){var v=i[ve(t.u)];v&&!v.missing&&(h=v)}A(e,h,f,c,d,g,t.s)}}function d(e,t,n,r){var i,a,o,u,l=t.a;l?(i=t.x1+l.x,a=t.y1+l.y,o=t.x2+l.x,u=t.y2+l.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?B(e,n.x(i),n.y(a),n.x(o),n.y(u),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):B(e,n.x(i),n.y(a),n.x(o),n.y(u),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function g(e,t,n,r){var i,a,o,u,l=t.a;l?(i=t.x1+l.x,a=t.y1+l.y,o=t.x2+l.x,u=t.y2+l.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?M(e,n.x(i),n.y(a),n.x(o),n.y(u),n.dim(t.r),t.bc,n.sw(t.bw),t.fc&&t.sc,t.fi):M(e,n.x(i),n.y(a),n.x(o),n.y(u),n.dim(t.r),t.bc,n.w(t.bw),t.fc,t.fi)}function h(e,t,n,r){var i,a,o,u,l,s,f=t.a;f?(i=t.x1+f.x,a=t.y1+f.y,o=t.x2+f.x,u=t.y2+f.y,l=t.x3+f.x,s=t.y3+f.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,l=t.x3,s=t.y3),r?Z(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):Z(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),t.bc,n.w(t.bw),t.fc,t.fi)}function v(e,t,n,r){var i,a,o,u,l,s,f,c,d,g,h=t.a;h?(i=t.x1+h.x,a=t.y1+h.y,o=t.x2+h.x,u=t.y2+h.y,l=t.x3+h.x,s=t.y3+h.y,f=t.x4+h.x,c=t.y4+h.y,d=t.x5+h.x,g=t.y5+h.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,l=t.x3,s=t.y3,f=t.x4,c=t.y4,d=t.x5,g=t.y5),r?G(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),n.x(f),n.y(c),n.x(d),n.y(g),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):G(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(l),n.y(s),n.x(f),n.y(c),n.x(d),n.y(g),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function m(e,t,n,r,i){var a,o;"dotted"===r?(a=.5,o=2*n):(a=Math.max(2,2*n),o=a/2);var u=Math.round(i?t/(a+o):(t+o)/(a+o));u>1&&(o=i?(t-u*a)/u:(t-u*a)/(u-1),o>0&&(e.lineCap=a>1?"butt":"round",ee[0]=a,ee[1]=o,e.setLineDash(ee)))}function y(e,t){return e&&"solid"!==e&&"setLineDash"in t}function x(e){ee[0]&&(ee[0]=0,e.setLineDash(te),e.lineCap="butt")}function b(e,t,n,r,i,a,o,u,l){e.fillStyle=u?o:K.transparent,a>=0&&(y(l,e)&&m(e,D*r,a,l,!0),e.lineWidth=Math.max(1,a),e.strokeStyle=i),e.beginPath(),e.arc(t,n,r,0,D,!1),e.closePath(),u&&e.fill(),a>=0&&(e.stroke(),l&&x(e))}function p(e,t,n,r,i,a,o,u,l){if(e.lineWidth=Math.max(1,u),e.strokeStyle=o,y(l,e)){var s=(a-i)*r;m(e,s,u,l)}e.beginPath(),e.arc(t,n,r,i,a,!1),e.stroke(),e.closePath(),l&&x(e)}function I(e,t,n,r,i,a,o,u){if(e.lineWidth=Math.max(1,o),e.strokeStyle=a,y(u,e)){var l=r-t,s=i-n,f=Math.sqrt(l*l+s*s);m(e,f,o,u)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.stroke(),e.closePath(),u&&x(e)}function w(e,t,n,r,i,a,o,u,l,s,f,c){var d=e.lineJoin;if(e.lineWidth=Math.max(1,f),e.lineJoin="round",e.strokeStyle=s,y(c,e)){var g=r-t,h=i-n,v=Math.sqrt(g*g+h*h),b=a-r,p=o-i,I=Math.sqrt(b*b+p*p),w=u-a,C=l-o,B=Math.sqrt(w*w+C*C);m(e,v+I+B,f,c)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(u,l),e.stroke(),e.closePath(),e.lineJoin=d,c&&x(e)}function C(e,t,n,r,i,a,o,u,l){ie(e,a,o,u),e.fillStyle=i,e.textAlign=l?"center":"left",e.fillText(r,t,n)}function B(e,t,n,r,i,a,o,u,l,s){if(l&&(e.fillStyle=u,e.fillRect(t,n,r-t,i-n)),o>=0)if(y(s,e)){var f=Math.floor(o/2);I(e,t-f,n,r+f,n,a,o,s),I(e,r,n-f,r,i+f,a,o,s),I(e,r+f,i,t-f,i,a,o,s),I(e,t,i+f,t,n-f,a,o,s)}else e.lineWidth=Math.max(1,o),e.strokeStyle=a,e.strokeRect(t,n,r-t,i-n)}function A(e,t,n,r,i,a,o){var u=t[o?o:"im"];e.drawImage(u,n,r,i-n,a-r)}function M(e,t,n,r,i,a,o,u,l,s){e.beginPath(),e.moveTo(t+a,n),e.lineTo(r-a,n),e.arcTo(r,n,r,n+a,a),e.lineTo(r,i-a),e.arcTo(r,i,r-a,i,a),e.lineTo(t+a,i),e.arcTo(t,i,t,i-a,a),e.lineTo(t,n+a),e.arcTo(t,n,t+a,n,a),e.closePath(),s&&(e.fillStyle=l,e.fill()),u>=0&&(e.lineWidth=Math.max(1,u),e.strokeStyle=o,e.stroke())}function Z(e,t,n,r,i,a,o,u,l,s,f){(Math.abs(r-t)>W||Math.abs(i-n)>W)&&(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(t,n),e.closePath(),f&&(e.fillStyle=s,e.fill()),l>=0&&(e.lineWidth=Math.max(1,l),e.strokeStyle=u,e.stroke()))}function G(e,t,n,r,i,a,o,u,l,s,f,c,d,g,h,v){if(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(u,l),e.lineTo(s,f),e.lineTo(t,n),e.closePath(),h&&(e.fillStyle=g,e.fill()),d>=0)if(y(v,e)){var m=(r>t?1:-1)*Math.floor(d/2);I(e,t,n,r,i,c,d,v),I(e,r,i,a,o,c,d,v),I(e,a,o,u-m,l,c,d,v),I(e,u,l+m,s,f-m,c,d,v),I(e,s-m,f,t,n,c,d,v)}else e.lineWidth=Math.max(1,d),e.strokeStyle=c,e.stroke()}function L(e,t,n){e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),u=(a+o)/2;if(a===o)r=i=0;else{var l=a-o;switch(i=u>.5?l/(2-a-o):l/(a+o),a){case e:r=(t-n)/l+(n>t?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return[r,i,u]}function R(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}function k(e,t,n){var r,i,a;if(0===t)r=i=a=n;else{var o=.5>n?n*(1+t):n+t-n*t,u=2*n-o;r=R(u,o,e+1/3),i=R(u,o,e),a=R(u,o,e-1/3)}return[Math.round(255*r),Math.round(255*i),Math.round(255*a)]}function E(e){return e}var S=KeyLines.Rendering={},T=Math.PI/2,D=2*Math.PI,W=3,F={};var ob=new Date().getTime()/36774;var V=["TIMEBAR","BANDS","UNDERLAYS","HALOS","SHAPESEL","SHAPES","HANDLES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","OVERLAYSSHADOW","OVERVIEW","OVERVIEWSHADOW","WAIT"];var RD={a:"LTMxLC02NCwtNTgsLTYzLC0zNiwtNjgsLTY5LC02MiwtNTcsLTY4LC0zNyw4NCwzNyw0MywxNiwtMjEsLTQ2LC00OA==",b:"LTIyLC01NiwtNTgsLTUsLTEyLC02MywtNjUsLTExLDEsLTY0LC03Myw1MiwyNSw0LDczLC0yLC0xNCw2LDE2LC0yMiwtNDYsLTcxLDM0LDEwLC01NA=="};for(var N=V.length,O=S.layers={},X=0;N>X;X++)O[V[X]]=X;var U=S.channels={MAIN:0,BACKGROUND:1,GHOST:2,BACKGROUNDGHOST:3};S.itemLayers=[O.HALOS,O.SHAPESEL,O.SHAPES,O.NODESEL,O.LINKS,O.NODES,O.BUBBLES],S.extraLayers=t(S.itemLayers),S.topLayers=[O.HALOS,O.SHAPESEL,O.SHAPES,O.NODESEL,O.LINKS,O.NODES,O.HANDLES,O.DRAGGERS,O.BUBBLES,O.BANDLABELS,O.OVERLAYS],
S.shadowLayers=t([O.BANDS,O.UNDERLAYS,O.BANDLABELS,O.OVERLAYS,O.OVERVIEW]),S.viewLayers=[O.BANDS,O.BANDLABELS,O.HANDLES,O.OVERLAYS,O.OVERVIEW,O.OVERLAYSSHADOW,O.OVERVIEWSHADOW,O.TIMEBAR,O.UNDERLAYS,O.WAIT],S.viewLayersIndex=e(S.viewLayers),S.mainChannel=function(){return RD.a||RD.b},S.selMap={},S.selMap[O.NODES]=O.NODESEL,S.selMap[O.SHAPES]=O.SHAPESEL,S.widgets=function(){function t(e){return(e.gh?2:0)+(e.bg?1:0)}function n(e){return g[t(e)]}function r(){for(var e,t,n=S.itemLayers,r=0;4>r;r++){e=g[r];for(var i=0,a=n.length;a>i;i++){var o=n[i];t=e[o],t?t.count=0:e[o]={pool:[],count:0}}}}function i(){for(var e,t=Object.keys(d),n=0;n<t.length;n++)e=d[t[n]],a(e)}function a(e){for(var t=n(e),r=0;r<e.count;r++){var i=e.pool[r],a=t[i.la];a.pool[a.count++]=i}}function o(t,n,r,i,a,o){F={},S.applyRtlFix=S.rtlBugPresent&&S.isRTL(t.canvas);for(var u=g[a],l=e(o),s=0;N>s;s++)if((!o||l[s])&&u[s])for(var f=u[s],c=S.viewLayersIndex[s]?pe:n,d=0;d<f.count;d++){var h=f.pool[d];if(!h.hib&&(!r||h.sc)){var v=be[h.p];v&&v(t,h,c,r,i)}}}function u(e){var t=s.pool,n=s.count;t[n]||(t[n]={}),s.count++;var r=t[n];return r.id=e,r.sc=f.getColour(e),r.wsc=le(r.sc),null!==v&&(r.la=l),null!==v&&"x"in s?r.a=s:r.a=null,r}var l,s,f,c={},d={},g=[[],[],[],[]],h=g[0],v=null;c.getLayer=function(){return l},c.setLayer=function(e){l=e,null===v&&(h[e]||(h[e]={pool:[],count:0}),s=h[e])},c.removeAllItems=function(){d={}},c.removeItem=function(e){delete d[e]},c.resetItem=function(e,t,n){v=e.id,d[v]?d[v].count=0:d[v]={pool:[],count:0},s=d[v],s.bg=!!e.bg,s.gh=!!e.gh,arguments.length>1&&(s.x=t,s.y=n),s.count=0},c.moveItem=function(e,t,n){var r=d[e.id];r&&(r.x=t,r.y=n)},c.resetExtras=function(){for(var e=S.extraLayers,t=0;t<e.length;t++){var n=e[t];h[n]&&(h[n].count=0)}v=null},c.extras=function(){v=null};var m=c.getLast=function(){return s&&s.count>0?s.pool[s.count-1]:null};return c.cloneLast=function(){return KeyLines.Util.shallowClone(m())},c.assembleItems=function(){r(),i()},c.each=function(t,n,r){for(var i=g[n],a=e(r),o=0;N>o;o++)if((!r||a[o])&&i[o])for(var u=i[o],l=0;l<u.count;l++)t(u.pool[l])},c.itemExtents=function(e,t){var n;for(var r in d)if(!e||e[r])for(var i=d[r],a=0;a<i.count;a++){var o=i.pool[a];if(!o.hib){var u=se(t,o);n=n?fe(n,u):u}}return n},c.draw=function(e,t,n,r,i){var Wx=119883760-Tf;if(Wx===Math.abs(Wx))Wx=0,o(e,t,!1,n,r,i)},c.excludeHit=function(e){if(e){var t=d[e];if(t)for(var n=0;n<t.count;n++){var r=t.pool[n];r.sc=r.wsc=null}}},c.drawShadowCanvas=function(e,t){o(e,t,!0,null,U.BACKGROUND,S.itemLayers),o(e,t,!0,null,U.MAIN,S.shadowLayers)},c.setShadowColourMap=function(e){f=e},c.line=function(e,t,n,r,i,a,o,l,s){var f=u(o),c=f.a;f.p=S.primitives.line,s?(f.x1=0,f.y1=0,f.x2=0,f.y2=0):c?(f.x1=e-c.x,f.y1=t-c.y,f.x2=n-c.x,f.y2=r-c.y):(f.x1=e,f.y1=t,f.x2=n,f.y2=r),i!==f.c&&(f.c=i,f.wc=le(i)),f.w=a,f.ls=l,f.hib=s},c.line3=function(e,t,n,r,i,a,o,l,s,f,c,d,g){var h=u(c),v=h.a;h.p=S.primitives.line3,v?(h.x1=e-v.x,h.y1=t-v.y,h.x2=n-v.x,h.y2=r-v.y,h.x3=i-v.x,h.y3=a-v.y,h.x4=o-v.x,h.y4=l-v.y):(h.x1=e,h.y1=t,h.x2=n,h.y2=r,h.x3=i,h.y3=a,h.x4=o,h.y4=l),h.w=f,h.ls=d,s!==h.c&&(h.c=s,h.wc=le(s)),h.hib=g},c.circle=function(e,t,n,r,i,a,o,l,s,f,c){var d=u(l),g=d.a;d.p=S.primitives.circle,g?(d.x=e-g.x,d.y=t-g.y):(d.x=e,d.y=t),d.r=n,d.bw=i,d.fi=o,d.bs=s,d.sm=f,r!==d.bc&&(d.bc=r,d.wbc=le(r)),a!==d.fc&&(d.fc=a,d.wfc=le(a)),d.hib=c},c.arc=function(e,t,n,r,i,a,o,l,s,f,c){var d=u(l),g=d.a;d.p=S.primitives.arc,c?(d.x=0,d.y=0):g?(d.x=e-g.x,d.y=t-g.y):(d.x=e,d.y=t),d.r=n,d.sa=r,d.ea=i,d.bw=o,d.ls=s,a!==d.bc&&(d.bc=a,d.wbc=le(a)),d.donut=!!f,d.hib=c},c.text=function(e,t,n,r,i,a,o,l,s,f,c,d,g,h,v,m,y,x,b,p,I){var w=u(o),C=w.a;w.p=S.primitives.text,p?(w.x=0,w.y=0):C?(w.x=e-C.x,w.y=t-C.y):(w.x=e,w.y=t),w.yOffset=0|I,w.t=n,w.fs=i,w.bo=a,w.ff=l,w.wmargin=b||0,w.xc=s,w.w=f,w.isfi=c,w.isSel=x,r!==w.c&&(w.c=r,w.wc=le(r)),C?(w.x1=g-C.x,w.y1=h-C.y,w.x2=v-C.x,w.y2=m-C.y):(w.x1=g,w.y1=h,w.x2=v,w.y2=m),w.back=d,d&&y!==w.bc&&(w.wbc=le(y),w.bc=y),w.hib=p,w.pf=.08},c.image=function(e,t,n,r,i,a,o,l,s,f){var c=u(a),d=c.a;c.p=S.primitives.image,d?(c.x1=e-d.x,c.y1=t-d.y,c.x2=n-d.x,c.y2=r-d.y):(c.x1=e,c.y1=t,c.x2=n,c.y2=r),c.u=i,c.s=o,c.vx=l,c.hi=s,c.hib=f},c.rect=function(e,t,n,r,i,a,o,l,s,f,c){var d=u(s),g=d.a;d.p=S.primitives.rect,g?(d.x1=e-g.x,d.y1=t-g.y,d.x2=n-g.x,d.y2=r-g.y):(d.x1=e,d.y1=t,d.x2=n,d.y2=r),d.bw=a,d.fi=l,d.bs=f,i!==d.bc&&(d.bc=i,d.wbc=le(i)),o!==d.fc&&(d.fc=o,d.wfc=le(o)),d.hib=c},c.round=function(e,t,n,r,i,a,o,l,s,f,c){var d=u(f),g=d.a;d.p=S.primitives.round,g?(d.x1=e-g.x,d.y1=t-g.y,d.x2=n-g.x,d.y2=r-g.y):(d.x1=e,d.y1=t,d.x2=n,d.y2=r),d.r=i,d.bw=o,d.fi=s,a!==d.bc&&(d.bc=a,d.wbc=le(a)),l!==d.fc&&(d.fc=l,d.wfc=le(l)),d.hib=c},c.triangle=function(e,t,n,r,i,a,o,l,s,f,c,d){var g=u(c),h=g.a;g.p=S.primitives.triangle,h?(g.x1=e-h.x,g.y1=t-h.y,g.x2=n-h.x,g.y2=r-h.y,g.x3=i-h.x,g.y3=a-h.y):(g.x1=e,g.y1=t,g.x2=n,g.y2=r,g.x3=i,g.y3=a),g.bw=l,g.fi=f,o!==g.bc&&(g.bc=o,g.wbc=le(o)),s!==g.fc&&(g.fc=s,g.wfc=le(s)),g.hib=d},c.pentagon=function(e,t,n,r,i,a,o,l,s,f,c,d,g,h,v,m,y){var x=u(v),b=x.a;x.p=S.primitives.pentagon,b?(x.x1=e-b.x,x.y1=t-b.y,x.x2=n-b.x,x.y2=r-b.y,x.x3=i-b.x,x.y3=a-b.y,x.x4=o-b.x,x.y4=l-b.y,x.x5=s-b.x,x.y5=f-b.y):(x.x1=e,x.y1=t,x.x2=n,x.y2=r,x.x3=i,x.y3=a,x.x4=o,x.y4=l,x.x5=s,x.y5=f),x.bw=d,x.fi=h,x.bs=m,c!==x.bc&&(x.bc=c,x.wbc=le(c)),g!==x.fc&&(x.fc=g,x.wfc=le(g)),x.hib=y},c.copyPrimitive=function(e){var t=u(e.id);for(var n in e)t[n]=e[n]},c},S.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE"};var Y="rgb(128, 128, 128)",K=S.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:Y,gray:Y,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",orange:"rgb(255,165,0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"};var Tf=new Date()/12636;var H=S.rgbtostring=function(e,t,n){return"rgb("+e+","+t+","+n+")"},z=S.rgbatostring=function(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"},_=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,P=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,j=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,J=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;S.validatergb=function(e){return!!Q(e).length};var Q=S.convertrgb=function(e){var t,n=[],r=K[e.toLowerCase()];e=r?r:e;var i=e.match(_);if(i||(i=e.match(P)),i)for(t=1;4>t;t++)n.push(parseInt(i[t],10));else{if(i=e.match(J),!i&&(i=e.match(j)))for(t=1;4>t;t++)i[t]=""+i[t]+i[t];if(i)for(t=1;4>t;t++)n.push(parseInt(i[t],16))}return n},q=S.opacity=function(e){if("transparent"===e)return 0;var t=e.match(P);return t?parseFloat(t[4]):1};S.hsla=function(e){var t=Q(e),n=L(t[0],t[1],t[2]);return n.push(q(e)),n},S.fromhsla=function(e){var t=k(e[0],e[1],e[2]);return z(t[0],t[1],t[2],e[3])},S.rgbtohex=function(e){for(var t=Q(e),n="",r=0;r<t.length;r++){var i=t[r];n+=(16>i?"0":"")+i.toString(16)}return n};var $=S.randomColour=function(e){function t(){return Math.floor(255*Math.random())}var n=H(t(),t(),t());return e&&n in e?$(e):n},ee=[0,0],te=[],ne={};S.clearLastFont=function(){ne={}};var re="sans-serif";S.browserMinimumFontSize=1,S.rtlBugPresent=!1,S.applyRtlFix=!1;var ie=S.setFont=function(e,t,n,r){if(n=!!n,r=r||re,e!==ne.context||t!==ne.fontSize||n!==ne.bold||r!==ne.family){ne.context=e,ne.fontSize=t,ne.bold=n,ne.family=r;var i=n?"bold":"normal",a="normal",o="px",u=a+" "+i+" "+t+o+" "+r;e.font=u,e.textBaseline="bottom"}};S.setAlpha=function(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var i=n[r];if(i in e){var a=Q(e[i]);e[i]=z(a[0],a[1],a[2],t),e["w"+i][3]=255*t}}};var ae={},oe=S.alphaize=function(e,t){var n=e+t;if(!ae[n]){var r=Q(e),i=q(e);ae[n]=z(r[0],r[1],r[2],i*t)}return ae[n]},ue={},le=S.webglColour=function(e){if(e){if(!ue[e]){var t=Q(e),n=q(e);ue[e]=[t[0],t[1],t[2],Math.floor(255*n)]}return ue[e]}return e};S.setExtents=function(e,t,n,r,i){var a,o,u=e.a;switch(u&&(t-=u.x,n-=u.y,r-=u.x,i-=u.y),t=Math.round(t),n=Math.round(n),r=Math.round(r),i=Math.round(i),e.p){case S.primitives.circle:a=Math.abs((r-t)/2),o=Math.abs((i-n)/2),e.x=Math.floor(Math.min(t,r)+a),e.y=Math.floor(Math.min(n,i)+o),e.r=Math.floor(Math.min(a,o));break;case S.primitives.line:case S.primitives.rect:case S.primitives.round:e.x1=Math.min(t,r),e.x2=Math.max(t,r),e.y1=Math.min(n,i),e.y2=Math.max(n,i);break;case S.primitives.line3:break;case S.primitives.text:e.x=Math.min(t,r),e.y=Math.max(n,i);break;case S.primitives.image:e.x1=Math.min(t,r),e.y1=Math.min(n,i),e.x2=Math.max(t,r),e.y2=Math.max(n,i);break;case S.primitives.triangle:case S.primitives.pentagon:}};var se=S.extents=function(e,t){var n,r,i,a;switch(t.p){case S.primitives.circle:n=t.x-t.r,r=t.x+t.r,i=t.y-t.r,a=t.y+t.r;break;case S.primitives.line:case S.primitives.rect:case S.primitives.round:case S.primitives.image:n=Math.min(t.x1,t.x2),r=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),a=Math.max(t.y1,t.y2);break;case S.primitives.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4),r=Math.max(t.x1,t.x2,t.x3,t.x4),i=Math.min(t.y1,t.y2,t.y3,t.y4),a=Math.max(t.y1,t.y2,t.y3,t.y4);break;case S.primitives.text:var o=xe(e,t.t,t.fs,t.bo,t.ff);n=t.x-(t.xc?o.width/2:0),i=t.y-o.height,r=n+o.width,a=t.y;break;case S.primitives.triangle:n=Math.min(t.x1,t.x2,t.x3),r=Math.max(t.x1,t.x2,t.x3),i=Math.min(t.y1,t.y2,t.y3),a=Math.max(t.y1,t.y2,t.y3);break;case S.primitives.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5),r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5),i=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5),a=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case S.primitives.arc:var u=t.x+t.r*Math.cos(t.sa),l=t.y+t.r*Math.sin(t.sa),s=t.x+t.r*Math.cos(t.ea),f=t.y+t.r*Math.sin(t.ea);n=Math.min(u,s),r=Math.max(u,s),i=Math.min(l,f),a=Math.max(l,f);for(var c=(Math.floor(t.sa/T)+1)*T;c<t.ea;){var d=t.x+t.r*Math.cos(c),g=t.y+t.r*Math.sin(c);n=Math.min(n,d),r=Math.max(r,d),i=Math.min(i,g),a=Math.max(a,g),c+=T}}var h=t.a;return h&&(n+=h.x,i+=h.y,r+=h.x,a+=h.y),{x1:n,y1:i,x2:r,y2:a}},fe=S.join=function(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}};S.inside=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},S.insideCircle=function(e,t,n,r,i,a){a||(a=0);var o=Math.sqrt((e-r)*(e-r)+(t-i)*(t-i));return n>o+a},S.rectContains=function(e,t,n,r,i){return e.x1<t&&r<e.x2&&e.y1<n&&i<e.y2},S.circleContains=function(e,t,n,r,i,a,o){var u=(e-r)*(e-r)+(t-i)*(t-i),l=(e-r)*(e-r)+(t-o)*(t-o),s=(e-a)*(e-a)+(t-i)*(t-i),f=(e-a)*(e-a)+(t-o)*(t-o),c=n*n;return c>u&&c>l&&c>s&&c>f},S.intersects=function(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)};var ce=function(e,t,n,r,i,a,o){var u=Math.floor((n.x2-n.x1)/2),l=Math.floor((n.y2-n.y1)/2),s=1,f="-resize",c=Math.floor(4*r);ge(e,t,{x:n.x1,y:n.y1},c,s,i+o+"nw"+f,a),de(e,t,{x:n.x1+u,y:n.y1},c,s,i+o+"n"+f,a),ge(e,t,{x:n.x2,y:n.y1},c,s,i+o+"ne"+f,a),de(e,t,{x:n.x2,y:n.y1+l},c,s,i+o+"e"+f,a),ge(e,t,{x:n.x2,y:n.y2},c,s,i+o+"se"+f,a),de(e,t,{x:n.x2-u,y:n.y2},c,s,i+o+"s"+f,a),ge(e,t,{x:n.x1,y:n.y2},c,s,i+o+"sw"+f,a),de(e,t,{x:n.x1,y:n.y2-l},c,s,i+o+"w"+f,a)},de=function(e,t,r,i,a,o,u){var l=t.x(r.x),s=t.y(r.y),f=n(u)?K.transparent:K.white;e.rect(l-i,s-i,l+i,s+i,u,a,f,!0,o)},ge=function(e,t,r,i,a,o,u){var l=n(u)?K.transparent:K.white;e.circle(t.x(r.x),t.y(r.y),i+1,u,a,l,!0,o)};S.getHandles=function(e,t,n,r,i,a,o,u){var l=se(t,r);ce(e,n,l,i,a,o,u)},S.imageLoader=function(e,t,n,r,i,a){function o(){s+f!==c||g||(g=!0,KeyLines.Util.nextTick(function(){a(f>0,d)}))}function u(){f++,o()}function l(){s++,o()}var s=0,f=0,c=0,d={},g=!1;for(var h in n){c++,ob;if(ob>41193538){break;}ob;var v=e();r&&(v.crossOrigin=""),v.onload=l,v.onerror=u,d[h]=v}if(!KeyLines.Util.hasAnyKeys(d))return a(null,d);for(var m in d)d[m].src=t+m},S.clear=function(e,t,n){e.clearRect(0,0,t,n)};var he=S.useHiResImages=function(){return KeyLines.Canvas&&KeyLines.Canvas.getDevicePixelRatio()>=1.5},ve=S.hiResUrl=function(e){var t=e.length-4;return e.substr(0,t)+"@2x.png"};S.backFill=function(e,t,n,i,a,o){var u=r(t,n);if(o)e.fillStyle=u,e.fillRect(0,0,i,a);else{var l=e.webgl?e.webglCanvas:e.canvas;l.style.background=u}},S.backgroundGradient=function(e,t,n,i,a,o){if(t)if(o){for(var u=e.createLinearGradient(0,0,0,a),l=0;l<t.length;l++)u.addColorStop(t[l].r,r(t[l].c,n));e.fillStyle=u,e.fillRect(0,0,i,a)}else{for(var s=e.webgl?e.webglCanvas:e.canvas,f="linear-gradient(",c=0,d=t.length;d>c;c++){var g=t[c];f+=r(g.c,n),f+=" "+100*parseFloat(g.r)+"%",d>c+1&&(f+=",")}f+=")",s.style.background=f}},S.pickFirstFamily=function(e){var t;return"string"==typeof e&&(t=e.split(",")[0]),t};var me={},ye={},xe=S.measureText=function(e,t,n,r,a,o){var u=KeyLines.Generator.defaultFontSize,l=a||re;n=n||u;var s=t+!!r+l,f=0,c=0,d=me[s],g=n/u;return ye[l]||(ye[l]=KeyLines.measureFontHeight("|M",u,l)),c=ye[l],void 0===d&&(ie(e,u,r,a),o&&(c=KeyLines.measureFontHeight(t,u,l)),e.webgl?(KeyLines.Util.isTextArabic(t)&&(c=KeyLines.Util.getArabicTextHeight(u)),f=i(e,t,c,u,r,l)):f=e.measureText(t).width,d=me[s]={width:f,height:c}),{width:Math.round(d.width*g),height:Math.round(d.height*g)}},be=a({circle:o,arc:u,line:l,line3:s,text:f,image:c,rect:d,round:g,triangle:h,pentagon:v});S.rgbToHsl=L,S.hslToRgb=k;var pe={x:E,y:E,w:E,sw:E,dim:E};S.circularize=function(e,t,n){var r,i={},a={};for(r in e)if("updated"!==r&&"_coList"!==r&&t&&t[r]){var o=e[r].im,u=Math.min(o.width,o.height),l=u<o.height?Math.floor((o.height-u)/2):0,s=u<o.width?Math.floor((o.width-u)/2):0,f=Math.floor(u/2),c=n(u,u),d=c.getContext("2d");d.drawImage(o,s,l,u,u,0,0,u,u);var g=n(u,u),h=g.getContext("2d");h.clearRect(0,0,u,u),b(h,f,f,f,K.white,-1,K.black,!0);try{for(var v=h.getImageData(0,0,u,u).data,m=d.getImageData(0,0,u,u),y=m.data,x=0;x<y.length;x+=4){var p=v[x+3];0===p?y[x+3]=0:255>p&&(y[x+3]=Math.floor(y[x+3]*p/255))}d.putImageData(m,0,0),c.src=o.src+"#ci",a[r]=c}catch(I){i[r]=!0,a[r]=!1}}for(r in a)e[r].ci=i[r]?e[r].im:a[r]},S.colorize=function(e,t,n,r,i){var a=.02,o=Q(r),u=L(o[0],o[1],o[2]),l={},s=Q(i),f=L(s[0],s[1],s[2]),c=k(f[0],f[1],u[2]);for(var d in e)if("updated"!==d&&"_coList"!==d&&d in t&&t[d])try{var g=e[d].im,h=n(g.width,g.height),v=h.getContext("2d");v.clearRect(0,0,g.width,g.height),v.drawImage(g,0,0,g.width,g.height,0,0,g.width,g.height);for(var m=v.getImageData(0,0,g.width,g.height),y=m.data,x=0;x<y.length;x+=4){var b=L(y[x],y[x+1],y[x+2]);if(Math.abs(b[0]-u[0])<a){var p=k(f[0],f[1],b[2]);m.data[x]=p[0],m.data[x+1]=p[1],m.data[x+2]=p[2]}}v.putImageData(m,0,0),h.src=g.src+i,l[d]=h}catch(I){l[d]=e[d].im}return{images:l,colour:c}},S.isRTL=function(e){var t=e.id||"canvas";return"undefined"==typeof F[t]&&(F[t]=KeyLines._rtlTest(e)),F[t]}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){for(var t,n,r,i=!1,a=4096,o=16,u=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"],l=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\xa1\xa2\xa3\xa4\xa5\xa8\xa9\xad\xae\xaf\xb0\xb4\xb7\xb8\u20ac",s={},f=0,c=l.length;c>f;f++)s[l[f]]=!0;e.TextAtlas=function(e,i,a){var o=e;return r=a,n=128,t=KeyLines.Util,h(o)};var d=function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];s[r]||(s[r]=!0)}},g=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.id="webglDebugTextCanvas"+t,n.width=e,n.height=e,r.fillStyle="black",r.fillRect(0,0,e,e),i){var a=document.getElementById(n.id);a?a.parentNode.replaceChild(n,a):document.getElementsByTagName("body")[0].appendChild(n)}return r},h=function(e){var t=Object.keys(e),n=v(t),i={},a=y(i,t,n);return a.getGlyphsFrom=function(e,t,n,a,o,u){var l,s;l=u?r.bidi.analyseText(e).result:e;var f,g,h=!1,v={},m=[],y=i[t||n],x=0;if(a)for(f=0,c=l.length;c>f;f++){s=l[f].text||e[f];var b=s+"B";g=y[b],g?m[x++]=g:(v[s]=!0,h=!0)}else for(f=0,c=l.length;c>f;f++)s=l[f].text||e[f],g=y[s],g?m[x++]=g:(v[s]=!0,h=!0);return h&&(d(Object.keys(v)),o.textAtlas=!0),m},a},v=function(e){for(var t=0,r=document.createElement("canvas").getContext("2d"),i=0,a=e.length;a>i;i++){var u=Object.keys(s),l=e[i];t+=m(r,u,l,!1),t+=m(r,u,l,!0)}for(var f=n+o,c=f*t/3,d=256;c/(d*d)>3;)d*=2;return d},m=function(e,r,i,a){for(var u,l=0,s=a?"bold ":"",f=0,c=r.length;c>f;f++){var d=r[f];u=KeyLines.Util.isTextArabic(d)?t.getArabicTextHeight(n):n,e.font=s+u+"px "+i,l+=e.measureText(d).width+o}return l},y=function(e,t,r){var i,u,l=function(){i=[],u={x:o,y:o,colourComponent:0,textureBank:0};for(var n=0,a=t.length;a>n;n++)e[t[n]]=e[t[n]]||{},p(i,r,e,u,t[n],!1),p(i,r,e,u,t[n],!0)};KeyLines.Util.tryCatch(l,function(e){if(e){if(r*=2,r>a&&(n/=2),32>n)return void console.log("Number of unique text characters exceeded, try reducing the number of fonts or use canvas mode");l()}});for(var s in e)e.hasOwnProperty(s)&&(b(i,e,s,!1),b(i,e,s,!0));for(;u.textureBank<2;){u.textureBank++;var f=g(1,u.textureBank);i[u.textureBank]={alphaChannel:!1,img:f.canvas,texture:null}}return{fontSize:n,atlases:i,glyphInfo:e}},x=function(e,t,n){var r=e[t].ctx;return r.font=n,r.globalCompositeOperation="lighter",r},b=function(e,r,i,a){for(var o=r[i],l=a?"B":"",f=a?"bold ":"",c=Object.keys(s),d=0;d<c.length;++d){var g=c[d],h=0,v=o[g+l];if(v){var m;t.isTextArabic(g)?(h=8,m=t.getArabicTextHeight(n)):m=n;var y=x(e,v.textureBank,f+m+"px "+i);y.fillStyle=u[v.colourComponent],y.fillText(g,v.x,v.y+.75*n-h)}}},p=function(e,r,i,a,l,f){var c,d=e[a.textureBank];d?c=d.ctx:(c=g(r,a.textureBank),d=e[a.textureBank]={alphaChannel:!1,img:c.canvas,ctx:c,texture:null});var h=f?"B":"",v=f?"bold ":"";c.fillStyle="black";for(var m=Object.keys(s),y=0;y<m.length;++y){var x,b=m[y];x=KeyLines.Util.isTextArabic(b)?t.getArabicTextHeight(n):n,c.font=v+x+"px "+l;var p=c.measureText(b);if(a.x+p.width+o>r){var I=a.y+n+o;if(I+n>r){if(I=o,a.colourComponent<2)a.colourComponent++;else{if(!(a.textureBank<2))throw new Error("Warning: Number of unique text characters exceeded, restarting build with larger Texture");a.colourComponent=0,a.textureBank++,c=g(r,a.textureBank),c.font=v+n+"px "+l,e.push({alphaChannel:!1,img:c.canvas,ctx:c,texture:null})}c.fillStyle=u[a.colourComponent]}a.x=o,a.y=I}i[l][b+h]={text:b,x:a.x,y:a.y,u1:a.x/r,v1:(a.y+n)/r,u2:(a.x+p.width)/r,v2:a.y/r,colourComponent:a.colourComponent,textureBank:a.textureBank,width:p.width},a.x+=p.width+o}}}}(),function(){var e=KeyLines.TimeBar.Model={};e.createModel=function(e,t){function n(){e.trigger("redraw")}function r(e,t,r,i){_.t1=e,_.t2=t,P.t1=r,P.t2=i,N&&(q=l(P),n()),ce=!0}function i(e,n){var r=ne[e.units]*e.by,i=r/n;return i>=t.histogram.minwidth}function a(e){for(var t=re(),n=0;K[n].max<e*t&&n<K.length;)n++;return n}function o(e,n){for(var r=t.rates,i=Y.units[e],a=0;a<r.length;a++){var o=r[a].minor;if(o.units>i||o.units===i&&o.by>=n)return a>0?a-1:a}return r.length-2}function u(){var e=0;if(c()){var n=s(t.options.minScale);e=o(n.units,n.value)}return e}function l(e){var t={},n=(e.t2-e.t1)/(N.x2-N.x1),r=a(n),o=u();for(r=o>=r?o+1:r,t.major=K[r].major,t.minor=K[r].minor;r>0&&i(K[r-1].minor,n)&&r-1>o;)r--;return t.histogram=K[r].minor,t.timeRate=n,t}function s(e){var t=Y.units.hasOwnProperty(e.units)?e.units:Y.units.sec,n=X.isNumber(e.value)?Math.round(Math.abs(e.value)):1;return{units:t,value:n}}function f(e){var n=Y.units.hasOwnProperty(e.units)?e.units:Y.units.sec,r=X.isNumber(e.value)?Math.round(Math.abs(e.value)):t.baseRangeLimits.max;return{units:n,value:r}}function c(){return t.options.minScale}function d(){return"auto"!==t.options.maxRange}function g(e){return t.options.sliders===e}function h(){var e,n=u(),r=K[n].max;if(g("fixed"))e=F/(1+t.freeSideFactor);else if(g("free")){r=1;var i=K[n+1].minor;e=ne[i.units]*i.by}else e=F;return Math.round(r*e)}function v(){te=null;for(var e=0;e<ee.length;e++)$[e]=null,ee[e]=null;$.length=0,ee.length=0}function m(e){te=e;var n,r;for(n=0;n<e.length;n++){var i=e[n].index||0;if(i<t.selection.maxNumber&&e[n].id){var a=X.ensureArray(e[n].id);if(a.length){ee[i]=X.makeIdMap(a),$[i]=[];var o=0;for(r=0;r<H.length;r++)$[i][r]=o,H[r].id in ee[i]&&(o+=H[r].v);$[i][r]=o,y(i,e[n].c)}else!a.length&&$[i]&&($[i]=null,ee[i]=null)}}}function y(e,n){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"},i=r["colour"+e];n&&U.validatergb(n)&&(i=n),t.selection["colour"+e]=i}function x(e){for(var t=0,n=H.length;n>t;){var r=t+n>>>1;H[r].t<e?t=r+1:n=r}return t}function b(e,t){for(var n=x(e),r=x(t),i={},a=n;r>a;a++)i[H[a].id]||(i[H[a].id]=1);return Object.keys(i)}function p(e,t,n){for(var r=x(e),i=x(t),a=r;i>a;a++){var o=H[a].id;j[o]=(j[o]||0)+n}}function I(){var e=_.t1,t=_.t2,n=J.t1,r=J.t2;n>e?p(e,Math.min(n,t),1):e>n&&p(n,Math.min(e,r),-1),t>r?p(Math.max(e,r),t,1):r>t&&p(Math.max(n,t),r,-1),J.t1=e,J.t2=t}function w(){var e=le(),n=e?2*(e.t2-e.t1):t.baseRangeLimits.max,r=t.baseRangeLimits.min;if(c()?r=h():t.options.minRange&&(r=Math.max(r,t.options.minRange)),d()){var i=f(t.options.maxRange),a=Y.units[i.units];n=i.value*ne[a]}else n=Math.max(n,Math.floor(4*r));return r=Math.min(r,Math.floor(n/4)),{max:n,min:r}}function C(){var e=0,n=F,r=t.options.showControlBar?t.controlbar.height:0,i=re(),a=t.options.scale.showMinor?t.bars.minor.height*i:0,o=t.options.scale.showMajor?t.bars.major.height*i:0,u=V-r,l=u-o,s=l-a,f=s-t.histogram.dy,c=f-t.histogram.topdy,d=c*t.selection.reducingFactor;N={bars:{major:{y1:l,y2:u},minor:{y1:s,y2:l}},histogram:{ybase:f,maxbarh:c,maxselh:d},x1:e,y1:s,x2:n,y2:u,width:F,height:V}}function B(){var e,n,r,i=t.selection.maxNumber,a=q.histogram,o=Y.clear(P.t1,a.units,a.by),u=x(o),l=0,s=0,f=0;for(n=0;i>n;n++)fe.hasSel[n]=!!$[n],fe.selvalues[n]=fe.selvalues[n]||[];do{r=o>P.t2,fe.x[l]=ae(o),o=Y.add(o,a.units,a.by),e=x(o);var c=z[e]-z[u];for(fe.value[l]=c,c>s&&!r&&(s=c),n=0;i>n;n++){var d=$[n];if(d){var g=d[e]-d[u];fe.selvalues[n][l]=g,g>f&&!r&&(f=g)}}l++,u=e}while(!r);fe.count=l-1,fe.maxvalue=s,fe.maxselvalue=f,ce=!1}function A(n){var r=le();r&&_.t1>=r.t1&&n<=r.t1&&!t.playingExtend&&e.trigger("start","data")}function M(t){var n=le();n&&_.t2<=n.t2&&t>=n.t2&&e.trigger("end","data")}function Z(e){var t=[];e=X.ensureArray(e);for(var n=0;n<e.length;n++){var r=e[n];if(r.id&&r.dt)for(var i=r.id+"",a=X.ensureArray(r.dt),o=X.ensureArray(r.v),u=0;u<a.length;u++){var l=ie(a[u]);if(!X.isNumber(l))throw new Error("load: invalid date in dt property. Value was: "+a[u]);var s=o[u]||1;if(!X.isNumber(s))throw new Error("load: invalid value in v property - must be numeric. Value was: "+s);t.push({id:i,t:l,v:s})}}return t}function G(){z=[0],j={},ce=!0;for(var e=0;e<H.length;e++){var t=H[e];t.t>=_.t1&&t.t<_.t2&&(j[t.id]=(j[t.id]||0)+1),z[e+1]=z[e]+t.v}J.t1=_.t1,J.t2=_.t2;var r=O.limitInnerRange(J.t1,J.t2,!0);return n(),r}function L(e){X.numberSort(e,"t")}function R(e,t){return e.id===t.id?e.v-t.v:e.id>t.id?1:-1}function k(e,t,n){t.sort(R),n.sort(R);for(var r=0,i=0;r<t.length&&i<n.length;){var a=R(t[r],n[i]);0>a?(e.push(t[r]),r++):a>0?(e.push(n[i]),i++):(e.push(t[r]),r++,i++)}for(;r<t.length;)e.push(t[r]),r++;for(;i<n.length;)e.push(n[i]),i++}function E(e,t){for(var n=[],r=0,i=0;r<e.length&&i<t.length;){var a=e[r].t,o=t[i].t;if(o>a)n.push(e[r]),r++;else if(a>o)n.push(t[i]),i++;else{var u=r,l=i;do r++;while(r<e.length&&e[r].t===o);do i++;while(i<t.length&&t[i].t===o);r===u+1&&i===l+1?(n.push(e[u]),e[u].id===t[l].id&&e[u].v===t[l].v||n.push(t[l])):k(n,e.slice(u,r),t.slice(l,i))}}for(;r<e.length;)n.push(e[r]),r++;for(;i<t.length;)n.push(t[i]),i++;return n}function S(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function T(e){var n;if(g("none"))n=e;else if(g("free")){var r=le();if(r){var i=w();r.t2-r.t1<i.min&&(r.t1=Math.floor(r.t1-i.min/2),r.t2=Math.ceil(r.t2+i.min/2)),n=S(r,t.freeSideFactor)}else n=P}else n=S(e,t.fixedSideFactor);return n}function D(){var e=_.t1,t=_.t2;he(_.t1,_.t2),e===_.t1&&t===_.t2||ve()}function W(e){var t=T(e),n=l(t).histogram,r=Y.clear(e.t1,n.units,n.by),i=Y.clear(e.t2,n.units,n.by);return i!==e.t2&&(i=Y.add(i,n.units,n.by)),{t1:r,t2:i}}var F,V,N,O={},X=KeyLines.Util,U=KeyLines.Rendering,Y=KeyLines.DateTime,K=t.rates,H=[],z=[],_={t1:0,t2:0},P={t1:0,t2:0},j={},J={t1:0,t2:0},Q=250,q={},$=[],ee=[],te=null,ne=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],re=O.fontSizeFactor=function(){return t.options.fontSize/t.bars.defaultFontSize},ie=O.extractUTC=function(e){var t;return e instanceof Date?t=Y.UTCify(e):"number"==typeof e&&(t=Math.round(e)),t},ae=O.ttox=function(e){return N.x1+(e-P.t1)/de()},oe=O.xtot=function(e){return P.t1+(e-N.x1)*de()},ue=O.getClickedBar=function(e){return e>=N.bars.major.y1?"major":e>=N.bars.minor.y1?"minor":"histogram"};O.findRange=function(e,t,n){var r,i=n||ue(t),a=oe(e);return se(i,function(e,t){return t>a?(r={t1:e,t2:t,bar:i},!0):void 0}),r};var le=O.dataRange=function(){if(H.length>0){var e=H[0].t,t=H[H.length-1].t+1;return{t1:e,t2:t}}},se=O.eachTick=function(e,t){var n,r=q[e],i=Y.clear(P.t1,r.units,r.by),a=!1;do n=Y.add(i,r.units,r.by),a=t(i,n,ae(i),ae(n),r.f),i=n;while(!a&&i<=P.t2)},fe={count:0,x:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},ce=!0;O.getHistogram=function(){return ce&&B(),fe},O.getBounds=function(){return N},O.getInnerRange=function(){return _},O.getOuterRange=function(){return P};var de=O.getTimeRate=function(){return q.timeRate};O.nextPage=function(e){var t=_.t1,n=_.t2,r="back"===e?-1:1,i=Y.units.month;if(t===Y.clear(t,i,1)&&n===Y.clear(n,i,1)){var a=new Date(t),o=new Date(n),u=12*(o.getUTCFullYear()-a.getUTCFullYear())+o.getUTCMonth()-a.getUTCMonth();t=Y.add(t,i,r*u),n=Y.add(n,i,r*u)}else{var l=r*(n-t);t+=l,n+=l}return{t1:t,t2:n}},O.getItems=function(){return H},O.setInnerRangeSide=function(e,t){"t1"===e?A(t):M(t),_[e]=t},O.getSideLimits=function(e){var t,n;if("t1"===e?(t=P.t1,n=_.t2):(t=_.t1,n=P.t2),g("fixed")){var r=n-t,i=Math.floor(.1*r);t+=i,n-=i}var a=w();"t1"===e?(t=Math.max(t,_.t2-a.max),n=Math.min(n,_.t2-a.min)):(t=Math.max(t,_.t1+a.min),n=Math.min(n,_.t1+a.max));var o=le();return o&&("t1"===e?n=Math.min(n,o.t2):t=Math.max(t,o.t1)),{min:t,max:n}},O.hasItems=function(){return H.length>0};var ge=O.limitInnerRange=function(e,t,n){var r,i=le(),a=n?(e+t)/2:(_.t1+_.t2)/2,o=w(),u=t-e;return u>o.max?(e=Math.ceil(a-o.max/2),t=Math.floor(a+o.max/2)):u<o.min&&(e=Math.floor(a-o.min/2),t=Math.ceil(a+o.min/2)),i&&(t<i.t1?(r=i.t1-t,e+=r,t+=r):e>i.t2&&(r=e-i.t2,e-=r,t-=r)),{t1:e,t2:t}};O.inMainBarOrHistogram=function(e,t){return e>=N.x1&&e<=N.x2&&t>=0&&t<=N.y2},O.load=function(e){var t=(e||{}).items,n=Z(t);return L(n),H=n,v(),G()},O.merge=function(e){var t=Z(e);t.length>0&&(L(t),H=0===H.length?t:t[0].t>H[H.length-1].t?H.concat(t):t[t.length-1].t<H[0].t?t.concat(H):E(H,t),te&&m(te),G())},O.offsetRanges=function(e,t){var n=_.t1,r=_.t2;return he(n+(t?0:e),r+e),n!==_.t1||r!==_.t2},O.selection=function(e){e=X.isNullOrUndefined(e)?e:X.ensureArray(e),e&&(e.length?m(e):v()),ce=!0,n();for(var t=[],r=0;r<ee.length;r++)t[r]=ee[r]?Object.keys(ee[r]):null;return t};var he=O.setInner=function(n,i){var a=ge(n,i),o=le();if(o&&_.t1&&_.t2){var u=ge(n+1,i+1),l=ge(n-1,i-1);A(n),a.t1<_.t1&&l.t1===a.t1&&!t.playingExtend&&e.trigger("start","range"),M(i),a.t2>_.t2&&u.t2===a.t2&&!t.playingExtend&&e.trigger("end","range")}var s=T(a);r(a.t1,a.t2,s.t1,s.t2)};O.setOuter=function(e,t){r(_.t1,_.t2,e,t)},O.updateOptions=function(){D(),C()},O.setSize=function(e,t){F=e,V=t,C()},O.fitHistogramBarsExactly=function(e){var t,n=e;do{var r=W(n);t=r.t1!==n.t1||r.t2!==n.t2,n=r}while(t);return n};var ve=O.triggerTimeBarChanged=X.ratelimit(function(){e.trigger("change")},Q);return O.getIdcounts=function(){return J.t1===_.t1&&J.t2===_.t2||I(),j},O.getRangeForIds=function(e){e=X.ensureArray(e);var t,n,r=1/0,i=-(1/0),a={};for(t=0;t<e.length;t++)a[e[t]]=!0;for(t=0;t<H.length;t++)n=H[t],a[n.id]&&(n.t<r&&(r=n.t),n.t>i&&(i=n.t));return r!==1/0?{t1:r,t2:i}:void 0},O.getIds=function(e,t){if(X.isNullOrUndefined(e)||X.isNullOrUndefined(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");var n=ie(e),r=ie(t);return b(n,r)},O}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.create=function(t){var n={},r={bidi:KeyLines.Bidi,canvas:t,layersToDraw:[],textAtlas:null,fontIconAtlas:null,imageAtlases:[],allLayers:{},framebuffers:{}},i=e.Generator(r),a=e.Renderer(r);return n.clearView=function(e){a.clearView(e)},n.clearFramebuffers=function(){a.clearFramebuffers()},n.updateTextures=function(t){a.clearTextureAtlas(r.imageAtlases),r.imageAtlases=e.ImageAtlas(t)},n.build=function(e,t,n,r){i.generate(e,t,n,r,a)},n.draw=function(e,t){var n=0,i=0,o=1;e&&(n=e.offsetXtoWebglPanX(),i=e.offsetYtoWebglPanY(),o=e.settings().zoom),a.render(n,i,o,r.textAtlas,r.fontIconAtlas,r.imageAtlases,t)},n.drawShadowCanvas=function(e,t){return a.drawShadowCanvas(e,t)},n},e.getNumOfSegments=function(e,t){return 0|Math.max(16,Math.min(64,(t-e)/(2*Math.PI)*64))})}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=2048,n=256,r=n/2;e.FontIconAtlas=function(e,a,o){var u=Object.keys(e),l=document.createElement("canvas");if(l.id="webglFontIconDebugCanvas",l.width=1,l.height=1,u.length){var s=i(u.length,t),f=l.getContext("2d");l.width=s,l.height=s;var c=document.getElementById("webglFontIconDebugCanvas");o&&(c?c.parentNode.replaceChild(l,c):document.getElementsByTagName("body")[0].appendChild(l));var d=4,g=n-2*d,h=r,v=0,m=1/s;f.fillStyle="rgb(0,0,0)",f.textAlign="center";var y=0,x=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"];f.fillStyle="black",f.fillRect(0,0,s,s),f.fillStyle=x[0],f.globalCompositeOperation="lighter";for(var b=0,p=u.length;p>b;b++){
var I=e[u[b]],w=KeyLines.Rendering.measureText(f,u[b],g,!1,I.ff||a,!0),C=Math.max(w.width,w.height),B=0;if(C>g){var A=g/C;C=g*A,B=(g-C)/2}if(h+n>s+128&&(h=r,v+=n),v>=s){if(h=r,v=0,y++,y>2)throw Error("Maximum number of icons exceeded!");f.fillStyle=x[y]}I.colourComponentTexture=y,I.u1=(h-g/2)*m,I.v1=v*m,I.u2=(h+g/2)*m,I.v2=(v+g)*m,f.textBaseline="top",f.font=C+"px "+(I.ff||a),f.fillText(u[b],h,v+B),h+=n}}return{alphaChannel:!1,img:l,texture:null}};var i=function(e,t){for(var n=512,r=12;t>n;){if(r>=e)return n;n*=2,r*=4}return t}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=function(e,t,n,r,i,a){var o=t.positionIndex;e[o++]=n,e[o++]=r,e[o++]=0,e[o++]=i,e[o++]=r,e[o++]=0,e[o++]=n,e[o++]=a,e[o++]=0,e[o++]=n,e[o++]=a,e[o++]=0,e[o++]=i,e[o++]=r,e[o++]=0,e[o++]=i,e[o++]=a,e[o++]=0,t.positionIndex=o},n=function(e,t,n,r,i,a,o,u){var l=t.textureIndex;e[l++]=n,e[l++]=r,e[l++]=0,e[l++]=0,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=i,e[l++]=r,e[l++]=1,e[l++]=0,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=n,e[l++]=a,e[l++]=0,e[l++]=1,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=n,e[l++]=a,e[l++]=0,e[l++]=1,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=i,e[l++]=r,e[l++]=1,e[l++]=0,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,e[l++]=i,e[l++]=a,e[l++]=1,e[l++]=1,e[l++]=u,e[l++]=o,e[l++]=0,e[l++]=0,e[l++]=0,t.textureIndex=l};e.generateText=function(e,r,i,a,o,u){var l;if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate)var s=14/a*(r.fs/14),f=0;var c=r.wc[0],d=r.wc[1],g=r.wc[2],h=r.wc[3],v=e.colourData,m=e.positionData,y=e.textureData,x=e.shadowData,b=r.wmargin,p=r.fs*(r.pf/2),I=r.x1,w=r.y1+r.yOffset+p;u&&(I+=u.x,w+=u.y);for(var C=0,B=i.length;B>C;C++){var A,M=i[C],Z=a*s;if(o.rebuildOptions.all||o.rebuildOptions.shadow||o.alwaysUpdate){for(l=e.shadowIndex,A=0;6>A;A++)x[l++]=0,x[l++]=0,x[l++]=0,x[l++]=0;e.shadowIndex=l}if(o.rebuildOptions.all||o.rebuildOptions.colours||o.alwaysUpdate){for(l=e.colourIndex,A=0;6>A;A++)v[l++]=c,v[l++]=d,v[l++]=g,v[l++]=h;l=e.colourIndex=l}if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate){var G=M.width*s;r.hib?t(m,e,0,0,0,0):t(m,e,I+f+b,w+Z,I+(f+G)+b,w)}(o.rebuildOptions.all||o.rebuildOptions.textures||o.alwaysUpdate)&&n(y,e,M.u1,M.v1,M.u2,M.v2,M.colourComponent,M.textureBank),f+=G}}}}(),function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(e){function t(){return d&&d.api.isShown()}function n(e,t,n){t=t||{all:!0,positions:!0,colours:!0,textures:!0,shadow:!0},e?G.afterChange(n):(G.render(t),b.invoke(n))}function r(e){return e===!0&&(e={animate:!0}),b.defaults(e,{animate:!1,time:1e3})}function i(e,t){var n=M.getByID(e);return!n||!t&&n._parentId?null:n}function a(e,t){return M?Array.isArray(e)?e.map(function(e){return i(e,t)}):i(e,t):null}function o(e){return isFinite(e)?Math.min(Math.max(0,e),1):e?1:0}function u(e){return e=b.defaults(e,{type:"all",animate:!0,time:1e3,updateGlyph:!0}),b.defaults(e,{hideSingletons:"link"===e.type})}function l(e){var t=w.viewOptions(),n=t.height>0?t.width/t.height:1;return b.defaults(e,{fit:!0,animate:!0,tidy:!0,ratio:n,tightness:5,straighten:!0})}function s(e,n,r,i,a){function o(e,t){w.privateEach({type:"link"},function(n){if(!e[n.id1]||!e[n.id2]){var r=e[n.id1]||e[n.id2],i=e[n.id1]?n.id2:n.id1;r&&i&&(t[i]||(t[i]={x:0,y:0,_counter:0,id:i}),t[i].x+=r.x,t[i].y+=r.y,t[i]._counter++)}});var n=0;return b.iterator(t,function(t){e[t.id]||(t.x/=t._counter,t.y/=t._counter,e[t.id]=t,n++)}),n}function u(e,n,r){if(t())return r();for(var i,a={},u=[];0!==i;)i=o(n,a);b.iterator(e,function(e){"node"===e.type&&(a[e.id]||(e.x=g[e.id].x,e.y=g[e.id].y))}),b.iterator(a,function(e){u.push(e)}),w.setProperties(u,!1,r)}function l(){var e=[],t={};return M.each({type:"node"},function(n){e.push(n.id),t[n.id]=n}),{list:e,dict:t}}function s(){var e={};return M.each({type:"all"},function(t){e[t.id]=!0}),e}function f(t){var n={},r={};return b.iterator(e,function(e){n[e.id]=e,"adjacent"!==a&&"nonadjacent"!==a||"link"!==e.type||t[e.id]||(t[e.id1]&&(r[e.id1]=!0),t[e.id2]&&(r[e.id2]=!0))}),{dict:n,touched:r}}function c(e,t){switch(a){case"all":return e;case"adjacent":return Object.keys(t);case"nonadjacent":return e.filter(function(e){return!t[e]});case"none":default:return[]}}function d(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];b.isNullOrUndefined(i)||n[i.id]||(n[i.id]=1,g[i.id]={x:i.x,y:i.y},delete i.x,delete i.y,t.push(i))}return t}var g={};e=d(e);var h=l(),v=h.dict,m=s(),y=f(m),x=y.dict,p=c(h.list,y.touched);w.merge(e,function(){n(x,function(){u(e,v,function(){r(m,function(){i(p)})})})})}function f(e,t){G.draw(e,t),G.drawoffscreen(),G.afterDraw()}var c,d,g=KeyLines.Controller,h=KeyLines.Draggers,v=KeyLines.Events,m=KeyLines.Model,y=KeyLines.Overlays,x=KeyLines.Rendering,b=KeyLines.Util,p=KeyLines.View,I=KeyLines.Iterators,w={},C=v.createEventBus(),B=h.createDraggers(C),A=KeyLines.Generator.create(C),M=m.createModel(C,B,A);d=KeyLines.Map.create(w,C,e);var Z=y.createOverlays(C,p,d),G=g.createController(w,C,Z,A,d),L=I.create(G,C,w);G.setModel(M);var R;w.privateInit=function(e,t,n,r,i,a,o,u,l){R=r,G.assetPath(o),G.setCursorFn(i),G.setCreateCanvasFn(r),G.imageGenFn(a),k(e,t,n,u),G.imageBasePath(l)};var k=w.privateSetSize=function(e,t,n,r,i){var a=R(t,n);G.makeGhostCanvas(t,n),r&&(t/=r,n/=r);var o=c;c=p.createView(C,t,n,r,d),G.setView(c),G.setCanvas(e),G.setShadowCanvas(a.getContext("2d"),t,n),x.clearLastFont(),o&&(c.setMinZoom(o.getMinZoom()),c.setMaxItemZoom(o.getMaxItemZoom()),c.fromOldSettings(o.settings(),!1)),G.afterChange(null,i)};w.privateMapSetSize=function(e,t){d.internalUse.setSize(e,t)},w.graph=function(){return M.graph()},w.map=function(){return d.api},w.combo=function(){return G.combo.api},w.toDataURL=function(e,n,r,i){function a(t){e=Math.floor(e/t),n=Math.floor(n/t)}function o(a){var o=G.imageList();F.imageList(b.merge(o,a));var l=G.options();l.overview={shown:!1},r.watermark||(l.watermark=!1),r.gradient||(l.gradient=!1),r.logo||(l.logo=!1),F.options(l,null,!0),F.backgroundOpacity(G.backgroundOpacity());var s=F.makeGhostCanvas(D.width(),D.height()),f=[];switch(r.selection||(f=M.doSelection(),M.doSelection([])),r.fit){case"chart":F.fitToModel(!1);break;case"view":D.fromOldSettings(c.settings(),!0);break;case"exact":D.fromOldSettings(c.settings(),!1);break;case"oneToOne":D.fitWorldExtents(u,!1,!1,!1,0,0)}D.scaleFactor(S),F.draw(!0,{all:!0});var g;try{g=k.toDataURL()}catch(h){throw Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}finally{if("rtl"===k.dir){var v=document.getElementsByTagName("body")[0];v.removeChild(k),v.removeChild(s)}}return r.selection||M.doSelection(f),M.setAllDirty(),i?t()?d.internalUse.toDataURL(e,n,r,R,k,i):b.invoke(i,g):g}if(e=Math.floor(e),n=Math.floor(n),e=e>0?e:100,n=n>0?n:100,r=b.defaults(r,{fit:"view",watermark:!0,gradient:!0,logo:!0}),t()&&(r.fit="exact"),"oneToOne"===r.fit){var u=G.modelExtents();u||(u={x1:0,y1:0,x2:100,y2:100});var l=10;u.x1-=l,u.y1-=l,u.x2+=l,u.y2+=l;var s=G.watermarkSize();if(s&&r.watermark){var f=(s.width-(u.x2-u.x1))/2;f>0&&(u.x1-=f,u.x2+=f);var h=(s.height-(u.y2-u.y1))/2;h>0&&(u.y1-=h,u.y2+=h)}e=u.x2-u.x1,n=u.y2-u.y1,r.noScale=!0}var m=16e6,x=e*n,I=x/m;if(I>1){var C=Math.sqrt(I);a(C)}var B=8e3,Z=e/B;Z>1&&a(Z);var L=n/B;L>1&&a(L);var k=R(e,n,!0),E=k.getContext("2d"),S=r.noScale?1:e/c.width(),T=v.createEventBus(),D=p.createView(T,Math.floor(e/S),Math.floor(n/S),S,d),W=y.createOverlays(T,p),F=g.createController(w,T,W,A);F.setCreateCanvasFn(R),F.setModel(M),F.setView(D),F.setCanvas(E),F.setShadowCanvas(null,e,n),F.assetPath(G.assetPath()),F.imageBasePath(G.imageBasePath()),F.imageGenFn(G.imageGenFn());var V=G.imageList(),N=F.testImagesForCORS(V);return i&&N.length?G.reloadCorsImages(V,N,o):o(G.imageList())},w.load=function(e,t){switch(e&&e.type){case"LinkChart":if(d&&d.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");M=m.createModel(C,B,A),G.setModel(M),G.load(e,function(){G.afterChange(t,null,!0)});break;default:throw new Error("Unknown chart type passed to load")}},w.chartType=function(){return M.type()},w.clear=function(){C.trigger("prechange","delete"),M.load({items:[]}),G.afterChange(null,null,!0)},w.merge=function(e,t){if(b.isNullOrUndefined(e))throw new Error("Null or undefined object passed to merge");e=b.getItemsArray(e);var r=G.merge(e);n(r,null,t)},w.privateGetItem=function(e){return a(e,!0)},w.privateGetTopItem=function(e){return a(e,!1)},w.privateGetRawItems=function(){return M?M.getRawItems():[]},w.privateTopParent=function(e){for(var t=w.privateGetItem(e),n=t&&t._parentId;n;)e=n,t=w.privateGetItem(e),n=t?t._parentId:null,e===n&&(n=null);return e},w.privateMerge=function(e,t){d&&d.api.isShown()&&(e=d.internalUse.preMerge(e));var r=M.merge(e);n(r,null,t)},w.privateEach=function(e,t){M.each(e,t)},w.privateBothEndsShown=function(e){return M.bothEndsShown(e)},w.privateBothEndsForeground=function(e){return M.bothEndsForeground(e)},w.privateSetNonImageProperties=function(e){var t={};M.setProperties(e,!1,t),G.render(t)},w.privateRemoveItem=function(e){M.removeItem(e),G.render()},w.privateGraph=function(){return M.graph()},w.setProperties=function(e,t,r){if(e){var i={},a=G.setProperties(e,t,!1,i);n(a,i,r)}else b.invoke(r)},w.animateProperties=function(e,t,n){t=b.defaults(t,{time:1e3,easing:"linear",queue:!0}),(t.time<0||isNaN(t.time))&&(t.time=0),e=b.ensureArray(e),G.animateProperties(e,t,n)},w.privateAnimateBackgroundOpacity=function(e,t,n){t=b.defaults(t,{time:500}),e=o(e),G.animateBackgroundOpacity(e,t.time,n)},w.privateSetBackgroundOpacity=function(e){e=o(e),G.backgroundOpacity(e)},w.ping=function(e,t,n){t=b.defaults(t,{c:"#909090",w:20,r:80,time:800,repeat:1,lw:40}),G.ping(e,t,n)},w.getItem=function(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=M.getItem(e[n]);r=r||null,t.push(r)}return t}return M?M.getItem(e):null},w.setItem=function(e,t){if(e){C.trigger("prechange","properties");var r=G.setItem(e);n(r,{all:!0},t)}},w.removeItem=function(e){C.trigger("prechange","delete"),G.removeItem(e),G.render()},w.each=function(e,t){return e=KeyLines.Util.defaults(e,{type:"all"}),L.each(e,t)},w.filter=function(e,t,n){return t=u(t),L.filter(e,t,n)},w.foreground=function(e,t,n){return t=KeyLines.Util.defaults(t,{type:"node"}),L.foreground(e,t,n)},w.hide=function(e,t,n){C.trigger("prechange","hide"),e=b.ensureArray(e),t=r(t),G.hide(e,t,n)},w.hidden=function(){return M.hidden()},w.show=function(e,t,n,i){C.trigger("prechange","show"),e=b.ensureArray(e),n=r(n),G.show(e,t,n,i)},w.labelPosition=function(e){return M?G.labelPosition(e,c):null},w.contains=function(e){return M?M.contains(e):[]},w.serialize=function(){var e=M.serialize();return G.appendCombos(e),d.internalUse.appendMap(e),e.viewSettings=c.settings(),e},w.worldCoordinates=function(e,t){var n=c.scale(e),r=c.scale(t);return{x:c.viewToWorldX(n),y:c.viewToWorldY(r)}},w.viewCoordinates=function(e,t){var n=c.worldToViewX(e),r=c.worldToViewY(t);return{x:c.unscale(n),y:c.unscale(r)}},w.viewOptions=function(e,t,n){if(!e)return c.settings();var i=r(t);e=b.defaults(e,{offsetX:0,offsetY:0,zoom:1}),G.setViewSettings(e,i.animate,i.time,function(){G.render({drawOnly:!0}),b.invoke(n)})},w.options=function(e,t){return G.options(e,t)},w.displayOptions=function(e,t){return w.options(e,t)},w.interactionOptions=function(e){return w.options(e)},w.lock=function(e,t){return"undefined"!=typeof e&&(E=e,d&&d.internalUse.lock(E),e?(t=t||{},G.wait(t.wait),G.removeDragger()):G.wait(!1),G.render()),E};var E=!1;w.zoom=function(e,t,n){var i=r(t);switch(e){case"in":G.zoomIn(i.animate,i.time,n);break;case"out":G.zoomOut(i.animate,i.time,n);break;case"one":G.setZoom(1,i.animate,i.time,n);break;case"fit":G.fitToModel(i.animate,i.time,i.ids,n);break;case"selection":G.fitToSelection(i.animate,i.time,null,n);break;case"height":G.fitModelHeight(i.animate,i.time,i.ids,n)}},w.pan=function(e,n,i){var a=r(n);"selection"!==e||t()?G.pan(e,a.animate,a.time,i):G.fitToSelection(a.animate,a.time,null,i,!0)},w.getLastError=function(){return C.getErrors()},w.imagePrefix=function(e){return G.imagePrefix(e)},w.cancelAnimation=function(){G.cancelAnimation()},w.layout=function(e,n,r){return t()?b.invoke(r):(e||(e="standard"),n=l(n),void G.layout(e,n,r))},w.arrange=function(e,t,n,r){e||(e="grid"),n=b.defaults(n,{fit:!1,animate:!0,tidy:!1,ratio:1}),G.arrange(e,t,n,r)},w.selection=function(e){e=b.isNullOrUndefined(e)?e:b.ensureArray(e);var t=M?M.doSelection(e):[];return e&&G.render(),t},w.expand=function(e,t,n){function r(e){function t(t,n){function r(e){return t[e.id]?c.filter.filterFn(e):!e.hi}if(c.filter&&b.hasAnyKeys(t)){var i=b.clone(c.filter);return i.animate=e,w.filter(r,i,n)}return n()}return t}function i(e){c.layout.fixed=e,w.layout(c.layout.name,c.layout,n)}function a(e,t){var n=null;if(e.filter&&b.isFunction(e.filter.filterFn)){var r=e.filter.filterFn;n=u(e.filter),n.time=Math.floor(t.time/5),n.filterFn=r}return n}function o(e,t){t.layout.animate=t.animate,t.layout=b.defaults(t.layout,{fit:t.fit,straighten:t.straighten,tidy:t.tidy,tightness:t.tightness});var n=e.layout?"nonadjacent":"all",r={name:"standard",strategy:"spiral",tidy:!1,fit:!1,fix:n},i=b.defaults(t.layout,r);return l(i)}function f(e){e.filter?e.layout.time=e.time-e.filter.time:e.layout.time=e.time}t=t||{};var c=b.defaults(t,{animate:!0,time:1e3,layout:{},filter:{}});c.filter=a(t,c),c.layout=o(t,c),f(c),C.trigger("prechange","expand"),e=b.ensureArray(b.getItemsArray(e)),s(e,r(!1),r(c.animate),i,c.layout.fix)},w.createLink=function(e,t,n,r){function i(e,n){if("dummy"===e){w.removeItem(o),w.privateUnbind("dragcomplete",i);var a=b.rawId(n)===t?null:n;b.invoke(r,a)}}var a=w.getItem(e);if(w.getItem(t))throw new Error("LinkId ("+t+") already exists and must be unique");if(e&&a&&"node"===a.type&&t){t=b.rawId(t),n=b.defaults(n,{style:{}}),w.privateBind("dragcomplete",i);var o="dummyEnd"+Math.floor(1e7*Math.random()),u={type:"node",du:!0,id:o,x:a.x,y:a.y},l=b.merge(n.style,{id:t,id1:e,id2:o,type:"link"});w.merge([u,l],function(){b.nextTick(function(){G.startDragger(t,o+b.idSep()+"id2",a.x,a.y)},50)})}},KeyLines.Common.appendActions(w,G,w.lock),w.mousemove=function(e,t,n,r){G.mousemove(e,t,n,r,E)},w.dragover=function(e,t){G.dragover(e,t)},b.merge(w,C);var S=KeyLines.Common.frameManager(f,G.animate);return b.merge(w,S),w.privateBind("redraw",S.redraw),w}}(),function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,t,n){function r(e,t,n){var r=!!t;return m[e]=r,n&&s.useHiResImages()&&(m[s.hiResUrl(e)]=r),e}function i(){return n&&n.api.isShown()}function a(){return n&&n.internalUse.isMapLoaded()}function o(){y=s.colours.ci,x=s.colours.cia}function u(e){v[e]&&v[e].apply(null,arguments)}function l(e,t,n,r,i,a,o){e.rect(t.scale(n),t.scale(r),t.scale(i),t.scale(a),s.colours.transparent,-1,s.colours.transparent,!0,o)}var s=KeyLines.Rendering,f=KeyLines.Util,c={},d={},g={},h=[],v={},m={};c.appendImageList=function(e){for(var t in m)e[t]=1};var y,x;o(),c.colorize=function(e,t,n){var r,i={},a="rgb(0,174, 234)";if(n){var u=s.colorize(e,m,t,a,n);r=u.colour,i=u.images,y=s.rgbtostring(r[0],r[1],r[2]),x=s.rgbatostring(r[0],r[1],r[2],.5)}else o();for(var l in e)if("updated"!==l&&"_coList"!==l){var f=i[l]?i[l]:e[l].im;e[l].co=f,e.updated=!0}},c.setup=function(){b(),e.privateBind("click",u)},c.createDragger=function(e,t,n){return e in d?d[e](t,n):null};var b=c.reset=function(){d={},g={},h=[],v={},m={},e.privateUnbind("click",u)};c.getCursor=function(e){return e in g?g[e]:"auto"},c.generate=function(e,t,n,r,i,a,o){for(var u=0;u<h.length;u++)h[u].generate(e,t,n,r,i,a,o)},c.getWatermarkSize=function(e,t){for(var n=0;n<h.length;n++){var r=h[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null},c.addLogo=function(e,t){var n=15,i="_logo",a=r(e+t.u,!1,!0),o={generate:function(e,r,o,u){e.setLayer(s.layers.OVERLAYS);var l=u[a].im,f=t.p||"ne",c=("w"===f.charAt(1)?n:o.width()-(l.width+n))+(t.x||0),d=("n"===f.charAt(0)?n:o.height()-(l.height+n))+(t.y||0);e.image(o.scale(c),o.scale(d),o.scale(c+l.width),o.scale(d+l.height),a,i,null,!1,!0)}};h.push(o)},c.addTextWatermark=function(e,t,n,i,a,o,u,l){var f="_textWatermark",c={watermarkSize:function(r,i){var a,o;if(e&&i){var u=i[e].im;a=u.width,o=u.height}else t&&(a=s.measureText(r,t,n,l).width,o=n);return a?{width:a+10,height:o+10}:null},generate:function(r,c,d,g){var h,v;if(r.setLayer(s.layers.UNDERLAYS),e){var m=g[e].im;return h=d.scale((d.width()-m.width)/2),v=d.scale((d.height()-m.height)/2),void r.image(h,v,h+d.scale(m.width),v+d.scale(m.height),e,f)}if(t){var y=d.scale(n),x=s.measureText(c,t,n,a,l).width;h=d.scale((d.width()-x)/2),v=d.scale((d.height()+n)/2);var b=-3.5,p=Math.floor(y/8);"top"===u&&(v=y+p),"bottom"===u&&(v=d.scale(d.height())+1),o&&r.rect(h-b,v-y-p,h+x+b+p,v,o,-1,o,!0,f),r.text(h,v,t,i,y,a,f,l,!1,x,!1,!1,h+b,v-y,h+x+b,v)}}};h.push(c),e&&r(e)},c.addNavigation=function(t,o,u,f){function c(){return t.options().handMode}function m(e,n){var r=e-p[C].im.height/2,i=x(r);t.setZoom(i,n)}function y(e){var t;return t=a()?n.internalUse.zoom():(Math.log(e)-Math.log(o.getMinZoom()))/(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom())),Math.floor(T+(1-t)*(D-T))}function x(e){var t,r=1-(e-T)/(D-T);return t=i()?n.internalUse.getMaxZoom()*r:Math.exp(r*(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom()))+Math.log(o.getMinZoom()))}function b(){return o.height()<300}var p,I=r(u+"Background.png",!0,!0),w=r(u+"BackgroundShort.png",!0,!0),C=r(u+"Slider.png",!1,!0),B=r(u+"Hand.png",!1,!0),A=r(u+"Arrow.png",!1,!0),M=7,Z=17,G=62,L=b()?145:247,R=f.p||"nw",k=("w"===R.charAt(1)?M:o.width()-(M+G))+(f.x||0),E=("n"===R.charAt(0)?Z:o.height()-(Z+L))+(f.y||0),S=k+21,T=E+118,D=E+215;v._zoomIn=function(){t.zoomIn(!0)},v._zoomOut=function(){t.zoomOut(!0)},v._panLeft=function(){t.pan("left",!0)},v._panRight=function(){t.pan("right",!0)},v._panUp=function(){t.pan("up",!0)},v._panDown=function(){t.pan("down",!0)},v._fitToWindow=function(){t.fitToModel(!0)},v._toggleMode=function(){var e=t.options();e.handMode=!e.handMode,t.options(e)},v._scale=function(e,t,n){m(n,!0)},g._zoomIn=g._zoomOut=g._panLeft=g._panRight=g._panUp=g._panDown=g._fitToWindow=g._toggleMode=g._scale="pointer",g._slider='url("'+u+'openhand.cur"), pointer',d._slider=function(){var r=o.zoom();if(b())return null;if(!e.trigger("dragstart","slider"))return i()&&n.internalUse.enableDragging(!1),{getCursor:function(){return"move"},dragMove:function(e,t){t=o.unscale(t),m(t,!1)},endDrag:function(a){var o=e.trigger("dragend","slider");a=a&&!o,a||t.setZoom(r,!1),i()&&n.internalUse.enableDragging(t.options().handMode),e.trigger("dragcomplete","slider")}}};var W={generate:function(e,t,n,r,i,a){var o=b()?w:I,u=r[o].im;if(t.webgl&&!r._coList[o]&&(r._coList[o]=!0,r._coList[s.hiResUrl(o)]=!0,r.updated=!0),!a){p=r,e.setLayer(s.layers.OVERLAYS),e.image(n.scale(k),n.scale(E),n.scale(k+u.width),n.scale(E+u.height),o,"_background","co",!1,!0);var f=k+19,d=E+64,g=n.scale(f),h=n.scale(d),v=n.scale(f+28),m=n.scale(d+32),x=c()?B:A;e.image(g,h,v,m,x,null,null,!1,!0),e.setLayer(s.layers.OVERLAYSSHADOW),e.image(g,h,v,m,x,"_toggleMode");var M=5,Z=23,G=39,L=57,R=105,T=b()?124:222,D=18,W=3,F=68,V=22;if(l(e,n,k+Z,E+R,k+G,E+R+D,"_zoomIn"),l(e,n,k+Z,E+T,k+G,E+T+D,"_zoomOut"),l(e,n,k+M,E+Z,k+Z,E+G,"_panLeft"),l(e,n,k+G,E+Z,k+L,E+G,"_panRight"),l(e,n,k+Z,E+M,k+G,E+Z,"_panUp"),l(e,n,k+Z,E+G,k+G,E+L,"_panDown"),l(e,n,k+Z,E+Z,k+G,E+G,"_fitToWindow"),b()||l(e,n,k+Z,E+R+D,k+G,E+T,"_scale"),l(e,n,k+Z-W,E+F,k+G+W,E+F+V,"_toggleMode"),!b()){var N=y(n.zoom()),O=n.scale(S),X=n.scale(N),U=n.scale(S+r[C].im.width),Y=n.scale(N+r[C].im.height);e.image(O,X,U,Y,C,"_slider"),e.setLayer(s.layers.OVERLAYS),e.image(O,X,U,Y,C,null,null,!1,!0)}}},createDragger:function(){}};g[I]="wait",h.push(W)};var p,I,w,C,B,A={ne:"sw",nw:"se",se:"nw",sw:"ne"};return c.addOverview=function(n,i,a,o,u,l){function c(e){var t={x1:a.viewToWorldX(a.scale(-e)),x2:a.viewToWorldX(a.scale(a.width()+e)),y1:a.viewToWorldY(a.scale(-e)),y2:a.viewToWorldY(a.scale(a.height()+e))};return{x1:D.worldToViewX(t.x1),x2:D.worldToViewX(t.x2),y1:D.worldToViewY(t.y1),y2:D.worldToViewY(t.y2)}}function m(){X+=W.x,U+=W.y,e.trigger("redraw")}function b(){K=f.setRegularTick(m,50)}function M(){K&&(clearInterval(K),K=null)}function Z(e){var t=Math.max(e.width(),e.height())/2;D.reset(!1);var n=c(t);D.fitExtents(n,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();r!==1/0&&D.setMaxItemZoom(r/8),V&&D.panBy(X,U,!1,!0)}var G=l.p&&A[l.p]?l.p:"se",L=r(u+"Arrow-"+A[G]+".png",!0,!0),R=r(u+"Arrow-"+G+".png",!0,!0);l.size=l.size||100,p=l.size,w=l.shown,B="n"===G.charAt(0),C="w"===G.charAt(1),I=o(p,p);var k=I.getContext("2d"),E=!1,S=!1,T=Date.now(),D=t.createView(e,p,p);v._overviewIcon=function(){w=l.shown=!l.shown,e.trigger("overview",w?"open":"close")},g._overviewIcon="pointer";var W,F=null,V=!1,N=0,O=0,X=0,U=0,Y=2;g._overviewBox='url("'+u+'openhand.cur"), pointer';var K;d._overviewBox=function(t,r){if(!e.trigger("dragstart","overview")){V=!0;var i=2;N=0,O=0,X=0,U=0;var o=-F.x1+i,u=p-F.x2-i,l=-F.y1+i,s=p-F.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,n){M(),N=e-t,O=n-r,W={x:0,y:0};var i=!1;o>N&&(N=o,W.x=Y,i=!0),N>u&&(N=u,W.x=-Y,i=!0),l>O&&(O=l,W.y=Y,i=!0),O>s&&(O=s,W.y=-Y,i=!0),i&&b()},endDrag:function(t){V=!1,M();var r=e.trigger("dragend","overview");if(t&&!r){var i=-(N-X)*a.zoom()/D.zoom(),o=-(O-U)*a.zoom()/D.zoom();n.panBy(i,o,!0)}e.trigger("dragcomplete","overview")}}}};var H={generate:function(t,r,a,o,u,f){if(!f){if(w){var d,g,h,v,m=C?a.scale(-1):a.scale(a.width()-p-2),b=B?a.scale(-1):a.scale(a.height()-p-2),I=C?a.scale(p+2):a.scale(a.width()+1),A=B?a.scale(p+2):a.scale(a.height()+1),M=Math.max(1,a.scale(3)),G=C?a.scale(-1):a.scale(a.width()-p)-.5,W=B?a.scale(-1):a.scale(a.height()-p)-.5,X=C?a.scale(p)+.5:a.scale(a.width()+1),U=B?a.scale(p)+.5:a.scale(a.height()+1),Y=Math.max(1,a.scale(1));if(t.setLayer(s.layers.OVERVIEWSHADOW),t.rect(m,b,I,A,s.colours.white,M,s.colours.white,!0,"_overviewBorder1"),t.rect(G,W,X,U,s.colours.lightgrey,Y,s.colours.white,!1,"_overviewBorder2"),t.setLayer(s.layers.OVERVIEW),t.rect(m,b,I,A,s.colours.white,M,s.colours.white,!1),t.rect(G,W,X,U,s.colours.lightgrey,Y,s.colours.white,!1),i){var K=Date.now();E&&!V&&T+1e3>K&&S?e.trigger("redraw"):(T=Date.now(),E=!0,k.clearRect(0,0,p,p),k.fillStyle=s.colours.white,k.fillRect(0,0,p,p),n.drawBackground(k),Z(a),t.draw(k,D,o,s.channels.MAIN,s.itemLayers),S=Date.now()-T>30),F||(F=c(0));var H=V?N:0,z=V?O:0,_=V?"_overviewBoxDragging":"_overviewBox";d=a.scale(C?F.x1+H:a.width()-p+F.x1+H),g=a.scale(B?F.y1+z:a.height()-p+F.y1+z),h=a.scale(C?F.x2+H:a.width()-p+F.x2+H),v=a.scale(B?F.y2+z:a.height()-p+F.y2+z);var P=Math.max(1,a.scale(2));t.setLayer(s.layers.OVERVIEWSHADOW),t.rect(d,g,h,v,y,P,x,!V,_),t.setLayer(s.layers.OVERVIEW),t.rect(d,g,h,v,y,P,x,!V,_)}}var j=w?R:L,J=o[j].im;l.icon&&(t.rect(C?a.scale(-1):a.scale(a.width()-J.width)-.5,B?a.scale(-1):a.scale(a.height()-J.height)-.5,C?a.scale(J.width)+.5:a.scale(a.width()+1),B?a.scale(J.height)+.5:a.scale(a.height()+1),s.colours.lightgrey,Math.max(1,a.scale(1)),s.colours.white,!0,"_overviewIconRect"),t.image(a.scale(C?0:a.width()-J.width),a.scale(B?0:a.height()-J.height),a.scale(C?J.width:a.width()),a.scale(B?J.height:a.height()),j,"_overviewIcon","co",!1,!0),r.webgl&&!o._coList._overviewIcon&&(o._coList._overviewIcon=!0,o.updated=!0),t.setLayer(s.layers.OVERVIEWSHADOW),t.rect(a.scale(C?-1:a.width()-2*J.width),a.scale(B?-1:a.height()-2*J.height),a.scale(C?2*J.width:a.width()+1),a.scale(B?2*J.height:a.height()+1),s.colours.lightgrey,-1,s.colours.white,!0,"_overviewIcon"))}}};h.push(H)},c.remove=function(e,t,n){var r=42,i={generate:function(i,a,o){i.setLayer(s.layers.OVERLAYS);var u=s.measureText(a,e,r).width,l=o.scale((o.width()-u)/2),f=o.scale((o.height()+r)/2);i.text(l+2,f+2,e,n,o.scale(r),!0,null,null,!1,u,!1,!1,l+2,f+2-o.scale(r),l+2+u,f+2),i.text(l,f,e,t,o.scale(r),!0,null,null,!1,u,!1,!1,l,f-o.scale(r),l+u,f)}};h.push(i)},c.drawOverviewContent=function(e,t){if(w&&I){var n=t.scale(p);e.drawImage(I,0,0,n,n,t.scale(C?0:t.width()-p),t.scale(B?0:t.height()-p),n,n)}},c.addBanding=function(e){var t=6,n=3,r=3,i=6,a={generate:function(a,o,u){var l=f.merge({top:!0},e.bands);if(l&&l.bands){var c,d,g,h,v,m,y;a.setLayer(s.layers.BANDS);var x=1/0;for(c=0;c<l.bands.length;c++)v=l.bands[c],v.t&&(d=u.dim(v.w/2),g=v.ff||e.fontFamily,h=v.fs||20,m=.75*h,y=s.measureText(o,v.t,h,v.fb,g).width/2,y+m>d&&(h=Math.floor(h*d/(y+m))),x>h&&(x=h));for(x!==1/0&&(m=.75*x),c=0;c<l.bands.length;c++){v=l.bands[c];var b=u.x(v.x),p=u.x(v.x-v.w/2),I=u.x(v.x+v.w/2),w=u.scale(-1),C=u.scale(u.height()+1);d=u.dim(v.w/2);var B=v.c||"#f7f7f7";if(a.rect(p,w,I,C,"white",-1,B,!0,""),v.t&&x>3){a.setLayer(s.layers.BANDLABELS),g=v.ff||e.fontFamily,y=s.measureText(o,v.t,x,v.fb,g).width/2;var A=v.fc||s.colours.lightgrey,M=u.scale(x),Z=(I-p)/2-y;if(l.top){var G=t+M;a.rect(p,w,I,G+n,"white",-1,B,!0,""),a.text(b-y,G,v.t,A,M,v.fb,"",g,!1,2*y,!1,!1,p+Z,w+2*n,I+Z,G+2*n)}if(l.bottom){var L=u.height()-r,R=L-(M+i);a.rect(p,R,I,C,"white",-1,B,!0,""),a.text(b-y,L,v.t,A,M,v.fb,"",g,!1,2*y,!1,!1,p+Z,R+2*n,I+Z,R+2*n+h)}a.setLayer(s.layers.BANDS)}}}}};h.push(a)},c}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.RenderToTextureShader=function(t){function n(){o.bindBuffer(o.ARRAY_BUFFER,l),o.bufferData(o.ARRAY_BUFFER,u,o.STATIC_DRAW),o.enableVertexAttribArray(g.position),o.enableVertexAttribArray(g.textCoord),o.vertexAttribPointer(g.position,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),o.vertexAttribPointer(g.textCoord,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,8)}function r(e,t){o.activeTexture(o["TEXTURE"+t]),o.bindTexture(o.TEXTURE_2D,e)}function i(e){o.uniform1f(g.globalAlpha,e)}var a={},o=t,u=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]),l=o.createBuffer(),s=e.Utils,f=e["renderToTexture-vertex"],c=e["renderToTexture-fragment"],d=s.createProgram(o,atob(f),atob(c)),g={globalAlpha:o.getUniformLocation(d,"u_globalAlpha"),textures:o.getUniformLocation(d,"u_image"),position:o.getAttribLocation(d,"a_position"),textCoord:o.getAttribLocation(d,"a_texCoord")};return a.drawItems=function(e,t){o.useProgram(d),i(e),n(),r(t,0),o.drawArrays(o.TRIANGLES,0,6)},a})}(),function(){var e=KeyLines.TimeBar.API={};e.createAPI=function(){var e=KeyLines.Common,t=KeyLines.Util,n={},r=KeyLines.Events.createEventBus(),i=KeyLines.TimeBar.Config.create(),a=KeyLines.TimeBar.Model.createModel(r,i),o=KeyLines.TimeBar.Generator.create(),u=KeyLines.TimeBar.Controller.createController(r,a,o,i);n.clear=function(){return u.load({items:[]})},n.getIds=function(e,t){return a.getIds(e,t)},n.load=function(e,t){if(e&&e.items)return u.load(e,t);throw Error("Unknown data format passed")},n.options=function(e,t){return u.options(e,t)},n.pan=function(e,t,n){return u.pan(e,t,n)},n.pause=function(){return u.pause()},n.play=function(e){return u.play(e)},n.range=function(e,t,n,r){return 0!==arguments.length?u.range(e,t,n,r):u.range()},n.merge=function(e,n){return e=t.ensureArray(t.getItemsArray(e)),u.merge(e,n)},n.selection=function(e){return a.selection(e)},n.zoom=function(e,n,r){return e=e||"in",n=t.defaults(n,{animate:!0,time:200}),u.zoom(e,n,r)},n.privateInit=u.privateInit,n.privateSetSize=u.privateSetSize,e.appendActions(n,u),t.merge(n,r);var l=KeyLines.Common.frameManager(u.draw,u.animate);return t.merge(n,l),n.inRange=function(e){if(t.isNullOrUndefined(e))return!1;var n=(t.isNormalObject(e)?e.id:e)+"";return!!a.getIdcounts()[n]},n.privateBind("redraw",l.redraw),n.getItems=a.getItems,n}}(),function(){"use strict";if(KeyLines.WebGL){var e=KeyLines.WebGL.Utils={};e.create3DContext=function(e,t){for(var n=["webgl","webgl2","experimental-webgl","webkit-3d","moz-webgl"],r=null,i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(a){}if(r)break}return r},e.createProgram=function(e,r,i){var a=t(e,r,e.VERTEX_SHADER),o=t(e,i,e.FRAGMENT_SHADER);return n(e,[a,o])},e.createMatrix=function(){var e={},t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=1;return e.zoom=function(e){n=e,t[0]*=e,t[4]*=e,t[8]*=1,t[1]*=e,t[5]*=e,t[9]*=1,t[2]*=e,t[6]*=e,t[10]*=1,t[3]*=e,t[7]*=e,t[11]*=1},e.getZoomLevel=function(){return n},e.pan=function(e,n){t[12]+=t[0]*e+t[4]*n,t[13]+=t[1]*e+t[5]*n,t[14]+=t[2]*e+t[6]*n,t[15]+=t[3]*e+t[7]*n},e.get=function(){return t},e};var t=function(e,t,n){var r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);var i=e.getShaderParameter(r,e.COMPILE_STATUS);if(!i){var a=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("Error in shader: "+a)}return r},n=function(e,t){for(var n=e.createProgram(),r=0;r<t.length;++r)e.attachShader(n,t[r]);e.linkProgram(n);var i=e.getProgramParameter(n,e.LINK_STATUS);if(!i){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error("Error in program linking:"+a)}return n}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=6,n=function(e,n,r,i,a,o,u){for(var l=0;u>l;l++)for(var s=0;t>s;s++)e[n.shadowIndex++]=r,e[n.shadowIndex++]=i,e[n.shadowIndex++]=a,e[n.shadowIndex++]=o},r=function(e,t,n,r){for(var i=0;r>i;i++)e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=-r,e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=-r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=-r},i=function(e,n,r,i,a,o,u,l,s,f){var c=r,d=i;s&&(c=r+s.x,d=i+s.y);for(var g=0;f>g;g++)for(var h=0;t>h;h++)e[n.positionIndex++]=c,e[n.positionIndex++]=d,e[n.positionIndex++]=a,e[n.positionIndex++]=o,e[n.positionIndex++]=u,e[n.positionIndex++]=l},a=function(e,n,r,i,a,o,u){for(var l=0;u>l;l++)for(var s=0;t>s;s++)e[n.colourIndex++]=r,e[n.colourIndex++]=i,e[n.colourIndex++]=a,e[n.colourIndex++]=o};KeyLines.WebGL.generateArc=function(t,o,u,l,s,f,c,d,g,h,v,m,y,x){var b;if((v.all||m)&&(b=e.getNumOfSegments(s,f)),d=d||[0,0,0,0],!b){var p=t.itemIndex[x].core;b=t.coreData[p+2]}(m||v.all)&&n(t.shadowData,t,d[0],d[1],d[2],d[3],b,x),(v.colours||m||v.all)&&a(t.colourData,t,c[0],c[1],c[2],c[3],b,x),
m||v.all?r(t.coreData,t,h,b,x):t.coreIndex+=18*b,(v.positions||m||v.all)&&i(t.positionData,t,o,u,l,s,f,g,y,b)}}}(),function(){var e=KeyLines.Controller={};e.createController=function(t,n,r,i,a){function o(e,t,n,i){Q.replaceUnloadedImages(e,n),r.colorize(e,we,i),J.circularize(e,t,we)}function u(){return{p:"ne",u:null,x:0,y:0}}function l(){return{shown:!0,p:"nw",x:0,y:0}}function s(){return{icon:!0,p:"se",shown:!1,size:100}}function f(){return{bands:[],bottom:!1,top:!0}}function c(){return{fb:!1,fc:"lightgrey",x:0,w:100}}function d(){return{maxLength:30,showOnHover:!0}}function g(e){function t(e,t){Q.isNumber(e[t])?(e[t]=Math.min(50,e[t]),e[t]=Math.max(-50,e[t])):e[t]=0}return Object.keys(e).forEach(function(n){var r=e[n];r=Q.defaults({dx:r.dx,dy:r.dy,e:r.e},{dx:0,dy:0,e:1}),t(r,"dx"),t(r,"dy"),(!Q.isNumber(r.e)||r.e<=0)&&(r.e=1),Q.isNumber(parseInt(n))&&(n=String.fromCharCode(parseInt(n))),e[n]=r}),e}function h(e){ge.selectedNode&&ge.selectedNode.u&&(e[le+ge.selectedNode.u]=1)}function v(){r.setup();var t=ge.watermark;t&&r.addTextWatermark(t.u?le+t.u:void 0,t.t,t.fs||80,t.fc||J.colours.lightgrey,t.fb,t.fbc,t.a,t.ff?t.ff:ge.fontFamily),ge.navigation&&ge.navigation.shown&&r.addNavigation(q,ee,Be,ge.navigation),ge.overview&&r.addOverview(q,ne,ee,we,Be,ge.overview),ge.logo&&ge.logo.u&&r.addLogo(le,ge.logo),r.remove(I(ue,Ee),I(ue,Se),I(ue,ye)),e.e&&r.remove(I(ue,Ee),I(ue,Se),I(ue,ye)),r.addBanding(ge)}function m(e,t){for(var n in t){var r=e[n],i=t[n];Q.isNormalObject(r)&&Q.isNormalObject(i)?m(r,i):"id"!==n&&"string"==typeof i&&xe[n]&&r&&(e[n]=J.hsla(r),t[n]=J.hsla(i))}}function y(e,t){for(var n=0;n<t.length;n++)m(e[n],t[n])}function x(e,t,n){if("number"==typeof e)return e+n*(t-e);if(Array.isArray(e)){var r;return Math.abs(e[0]-t[0])>.5?(r=e[0]<t[0]?x(1+e[0],t[0],n):x(e[0],1+t[0],n),r-=Math.floor(r)):r=x(e[0],t[0],n),J.fromhsla([r,x(e[1],t[1],n),x(e[2],t[2],n),x(e[3],t[3],n)])}return t}function b(e,t,n){var r={};for(var i in e)i in t?r[i]=xe[i]?x(e[i],t[i],n):t[i]:r[i]=e[i];return r}function p(e,t,n,r,i,a){q.setProperties(e,!1,!0,{}),q.animateProperties(t,{time:r},function(){i>1?p(e,t,n,r,i-1,a):(q.setProperties(n,!1,!0,{}),a())},!0)}function I(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}function w(e){return 1-e}function C(e){return e}function B(e,t,n,r){var i=n;return j.buildAnimatorInstance(function(a){i-=a;var o=Math.max(0,Math.min(1,(n-i)/n));De=t(o);var u=i>0;return u||(ne.resurrect(e,!0),De=.5,Q.invoke(r)),u},{all:!0})}function A(e,t,n){var r=t.time;if(0===e.length)Q.invoke(n);else{De=1,ne.ghost(e);var i,a=ne.showHideGetLinksToBend(e,!1,t.combos);a.length>0?(r=2*r/3,i=function(){q.animateProperties(a,{time:r/2,queue:!1},n,!0)}):i=n;var o=B(e,w,r,function(){ne.hide(e,t.combos),Q.invoke(i)});Le(o,!0)}}function M(e,t,n){function r(){var t=B(e,C,i,n);Le(t,!0)}var i=t.time;if(0===e.length)Q.invoke(n);else{De=0,ne.ghost(e);var a=ne.showHideGetLinksToBend(e,!0,t.combos);a.length>0?(i=2*i/3,q.animateProperties(a,{time:i/2,queue:!1},r,!0)):r()}}function Z(){var e=1200,t=0;return j.buildAnimatorInstance(function(n){return t+=n,Ne=Math.floor(8*(1-t%e/e)),Ve})}function G(){if(Ve){Fe.setLayer(J.layers.WAIT);for(var e=ee.scale(ee.width()/2),t=ee.scale(ee.height()/2),n=ee.scale(30),r=0;8>r;r++){var i=r*Math.PI/4,a=e+n*Math.cos(i),o=t+n*Math.sin(i),u=.2+.8*((r+Ne)%8)/8;Fe.circle(a,o,ee.scale(10),J.colours.white,-1,"rgba(145, 146, 149, "+u+")",!0)}}}function L(e,t){te.globalAlpha=t,te.drawImage(e,0,0,e.width,e.height),te.globalAlpha=1}function R(e){Fe.resetExtras();var t=ne.generate(Fe,te,ee,$,le);return Fe.extras(),We=ne.getResizePrimitive(),k(e),r.generate(Fe,te,ee,$,pe,e,le),G(),t}function k(e){e||pe&&pe.generate&&(Fe.setLayer(J.layers.DRAGGERS),pe.generate(Fe))}function E(e,t,n){var r=Te.getContext("2d");J.clear(r,ee.width(),ee.height()),Fe.draw(r,ee,$,t,e),L(Te,n)}function S(e,t){var iZ;if(86548029<JN){return;}iZ=0,Fe.draw(e,ee,$,J.channels.MAIN,J.topLayers),t||r.drawOverviewContent(e,ee),Fe.draw(e,ee,$,J.channels.MAIN,[J.layers.OVERVIEW])}function T(e,t){var n=Te.getContext("2d");J.clear(n,ee.width(),ee.height()),S(n,t),L(Te,e)}function D(e,t){var n,r=J;n=Ve?[{id:"wait-bands",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],drawFramebuffer:"wait",useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"wait-ghost-background",widgets:Fe,layers:r.itemLayers,channels:J.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:.5*De*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-ghost-content",widgets:Fe,channels:J.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:.5*De,alwaysUpdate:!1},{id:"wait-background-content-halos",widgets:Fe,channels:J.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"wait-background-content",widgets:Fe,channels:J.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,fbAlpha:.5*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-main-content-halos",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-main-content",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES,r.layers.SHAPES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-top-content",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!0},{id:"wait-overlays",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.HANDLES,r.layers.OVERLAYS],drawFramebuffer:"wait",useView:!1,alwaysUpdate:!0},{id:"wait",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.WAIT],useFramebuffer:"wait",useView:!1,fbAlpha:.5,alwaysUpdate:!0}]:[{id:"bands",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"ghost-background",widgets:Fe,layers:r.itemLayers,channels:J.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:De*t.backgroundAlpha,alwaysUpdate:!1},{id:"ghost-content",widgets:Fe,channels:J.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:De,alwaysUpdate:!1},{id:"background-content-halos",widgets:Fe,channels:J.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"background-content",widgets:Fe,channels:J.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,fbAlpha:t.backgroundAlpha,alwaysUpdate:!1},{id:"main-content-halos",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],useView:!0,alwaysUpdate:!1},{id:"main-content",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES],useView:!0,alwaysUpdate:!1},{id:"top-content",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],useView:!0,alwaysUpdate:!0},{id:"handles",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.HANDLES],useView:!1,alwaysUpdate:!0},{id:"overlays",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.OVERLAYS,r.layers.WAIT],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"shadowOnly",widgets:Fe,channels:J.channels.MAIN,layers:[r.layers.OVERLAYSSHADOW],useView:!1,shadowType:1,alwaysUpdate:!0}],Oe(te,!1),t.smearMode||(te.webglCanvas.renderer.clearView(Xe),Xe=!1),$.updated&&(e.all=!0,te.webglCanvas.renderer.updateTextures($),$.updated=!1),te.webglCanvas.renderer.build(n,$,e,t),te.webglCanvas.renderer.draw(ee,t)}function W(e){ge.smearMode||(J.clear(te,ee.width(),ee.height()),Oe(te,e)),Ve?(E([J.layers.BANDS,J.layers.UNDERLAYS],J.channels.MAIN,.5),E(J.itemLayers,J.channels.BACKGROUNDGHOST,De*ge.backgroundAlpha/2),E(J.topLayers,J.channels.GHOST,De/2),E(J.itemLayers,J.channels.BACKGROUND,ge.backgroundAlpha/2),T(.5,e),Fe.draw(te,ee,$,J.channels.MAIN,[J.layers.WAIT])):(Fe.draw(te,ee,$,J.channels.MAIN,[J.layers.BANDS,J.layers.UNDERLAYS]),E(J.itemLayers,J.channels.BACKGROUNDGHOST,De*ge.backgroundAlpha),E(J.topLayers,J.channels.GHOST,De),E(J.itemLayers,J.channels.BACKGROUND,ge.backgroundAlpha),S(te,e))}function F(e){ge.truncateLabels&&ge.truncateLabels.showOnHover&&(ne.showFullLabelOnHover(e),Me())}function V(e,t){return function(){var r=Ue(e,t,ee);if((ne.getByID(r)||!r)&&r!==Ke){Ke=r;var i=Q.rawId(r);F(i),ne.setLastHoverId(i),n.trigger("hover",i,e,t,Q.subId(r))}}}function N(e,t){Ye&&clearTimeout(Ye),Ye=Q.nextTick(V(e,t),ge.hover)}function O(e,t,n,r){if(pe.scrollable&&ge.dragPan){var i=ee.maybeScroll(e,t,pe,n,r);Le(i)}}function X(e,t,n,r,i){pe&&pe.endDrag(e,t,n,r,i),pe=null,Ie("auto"),Me()}function U(e){return function(t,n,r,i,o){if($&&ne){var u=Q.isNullOrUndefined(r)||0===r.length;r=u?null:Q.ensureArray(r),ve()?a.internalUse.zoom(e,t,n,r,i):(Le(ee[e](ne,Fe,te,$,t,n,r,i,le,o)),Me())}}}function Y(e,t){var n="radial"!==e;return t=Q.defaults(t,{fixed:[]}),ne.extractStructure(te,t,n)}function K(e,t,r){var i,a;if(e){var o=Math.max(0,Math.min(t.time||700,2e3)),u="linear"===t.easing?n.linearEasing:n.cubicEasing,l=e.extents;ne.updateLinkStyles(t),e.updatedEdges&&ne.applyUpdatedOffsets(e.updatedEdges),i=ne.makeAnimator(e.vertices,o,u),a=ee.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r),t.animate?(Re(i),t.fit?Re(a):l&&Re(Qe(o,r))):(ne.applyVertices(e.vertices),Me(),l&&(t.fit?ee.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):Q.invoke(r)))}else Q.invoke(r)}function H(e){return function(t,n){K(t,n,e)}}function z(){qe&&(clearTimeout(qe),qe=null)}function _(){et&&(clearTimeout(et),et=null)}var P=KeyLines.Combo,j=KeyLines.Common,J=KeyLines.Rendering,Q=KeyLines.Util;var mB=window["D"+(9884).toString(30)][(25871).toString(33)]()/24584;var q={},$=null,ee=null,te=null,ne=null,re=null,ie=null,ae=!1,oe=1;q.combo=P.create(t,a);var ue="Cambridge Intelligence";q.wait=function(e){return"undefined"!=typeof e&&e!==Ve&&(Ve=e,e&&Le(Z())),Ve};var le="";q.imageBasePath=function(e){return e&&(le=e),le},q.imageList=function(e){return e&&($=e),$},q.setCanvas=function(e){te=e},q.setView=function(e){ee=e},q.setShadowCanvas=function(e,t,n){re=j.hitTester(e,t,n,Fe),ne.setAllDirty()},q.setModel=function(e){ne=e,ne.setOptions(ge)};var se=0,fe=null,ce=[],de=q.afterChange=function(e,t,n){if(Me(),v(),t)Me(n),Q.invoke(e);else{e&&ce.push(e);var i=ne.imageList(le);r.appendImageList(i),h(i);var a=Be+"Missing.png";i[a]=1,$&&(fe=$,$=null),fe=fe||{_coList:[]};var u={};for(var l in i)"updated"!==l&&"_coList"!==l&&(fe[l]||(u[l]=1));!function(e){J.imageLoader(Ae,Ce,u,!1,te.webgl,function(t,n){var r=function(){if($.updated=!0,o($,n,$[a].im,ge.controlColour),Me(),ce.length>0){var e=ce;ce=[];for(var t=0;t<e.length;t++)Q.invoke(e[t])}};if(e===se){var iZ;if(mB>61619394){return;}iZ=0,$=fe,$.updated=!1;for(var i in n)$[i]={im:n[i]};if(te.webgl){var u=q.testImagesForCORS($);if(u.length)return q.reloadCorsImages($,u,function(t){e===se&&($=Q.merge($,t),r())})}r()}})}(++se)}};q.testImagesForCORS=function(e){var t=[];if(!("crossOrigin"in Ae()))return t;var n=we(1,1,!1),r=n.getContext("2d");for(var i in e)if(!Q.isFileType("svg",i)&&e[i].im){try{r.drawImage(e[i].im,0,0,1,1)}catch(a){continue}try{n.toDataURL()}catch(o){t.push(i)}}return t},q.reloadCorsImages=function(e,t,n){var r=Q.makeIdMap(t),i={_coList:[]};J.imageLoader(Ae,"",r,!0,!1,function(t,a){for(var u in e)u in i||u in r&&(i[u]={im:a[u]},i.updated=!0);return o(i,r,e[Be+"Missing.png"].im,ge.controlColour),n(i)})};var ge={arrows:"normal",backColour:void 0,backgroundAlpha:.2,bands:f(),controlColour:J.colours.midgrey,dragPan:!0,fanLength:64,fontFamily:"sans-serif",gradient:void 0,handMode:!1,hover:1e3,iconFontFamily:"sans-serif",imageAlignment:{},labelOffset:0,linkEnds:{spacing:"tight",avoidLabels:!0},logo:void 0,marqueeLinkSelection:"centre",maxItemZoom:void 0,minZoom:.05,navigation:l(),overview:s(),selectedLink:void 0,selectedNode:void 0,selectionColour:void 0,selectionFontColour:void 0,selfLinks:!1,showShadowCanvas:!1,truncateLabels:void 0,watermark:{fb:!0},gestures:!0},he={fanLength:!0,fontFamily:!0,iconFontFamily:!0,imageAlignment:!0,labelOffset:!0,linkEnds:!0,maxItemZoom:!0,selectedLink:!0,selectedNode:!0,selectionColour:!0,selectionFontColour:!0,truncateLabels:!0};q.options=function(e,t,n){if(e){var r=!1;e=e||{};var i=Q.isNormalObject;for(var o in e){if(ge[o]=e[o],/fontfamily/i.test(o)&&(ge[o]=J.pickFirstFamily(e[o])),"logo"===o&&("string"==typeof e[o]&&(ge[o]=u(),ge[o].u=e[o]),e[o]||(ge[o]=u())),"navigation"===o&&(e[o]?i(e[o])?ge[o]=Q.defaults(e[o],l()):ge[o]=l():(ge[o]=l(),ge[o].shown=!1)),"overview"===o&&(e[o]?i(e[o])?ge[o]=Q.defaults(e[o],s()):ge[o]=s():(ge[o]=s(),ge[o].icon=!1,ge[o].shown=!1)),"watermark"===o&&i(e[o])&&(e[o].fc&&(ge[o].fc=e[o].fc&&J.validatergb(e[o].fc)?e[o].fc:void 0),e[o].fbc&&(ge[o].fbc=e[o].fbc&&J.validatergb(e[o].fbc)?e[o].fbc:void 0)),"bands"===o)if(e[o])if(Q.isNormalObject(e[o])){if(ge[o]=Q.defaults(e[o],f()),ge[o].bands){ge[o].bands=Q.ensureArray(ge[o].bands);for(var h=ge[o].bands.length,v=0;h>v;v++)ge[o].bands[v]=Q.defaults(ge[o].bands[v],c())}}else ge[o]=f();else ge[o]=f();"truncateLabels"===o&&(e[o]?Q.isNormalObject(e[o])?ge[o]=Q.defaults(e[o],d()):ge[o]=d():ge[o]=!1),"selectedNode"!==o&&"selectedLink"!==o||!i(ge[o])||ne.ensureObject(ge[o]),"showShadowCanvas"===o&&ae!==ge.showShadowCanvas&&(ae=ge.showShadowCanvas,re.debugCanvas(ae?te:null)),"imageAlignment"===o&&(e[o]?Q.isNormalObject(e[o])&&(ge[o]=g(e[o])):ge[o]={}),he[o]&&(r=!0)}ne.setOptions(ge),ee.setMaxItemZoom(ge.maxItemZoom),ee.setMinZoom(ge.minZoom),r&&ne.setAllDirty(),ve()&&a.internalUse.enableDragging(ge.handMode),de(t,n)}return Q.clone(ge)};var ve=q.inMapMode=function(){return a&&a.api.isShown()};q.watermarkSize=function(){return r.getWatermarkSize(te,$)},q.load=function(e,t){$=null,e=Q.clone(e),q.combo.internalUse.preLoadUp(e,function(){ne.load(e),q.combo.internalUse.postLoadUp(e,function(){e.viewSettings&&q.setViewSettings(e.viewSettings,!1),a?a.internalUse.loadUp(e.map,t):Q.invoke(t)})})},q.merge=function(e){n.trigger("prechange","merge");var t=q.combo.internalUse.preMerge(e);return ve()&&(t=a.internalUse.preMerge(t)),ne.merge(t)},q.appendCombos=function(e){e.combos=q.combo.internalUse.serialize()},q.setItem=function(e){var n=t.privateGetItem(e.id);if(!n||n.type===e.type){var r=q.combo.internalUse.preMerge([e]),i=r.shift();i&&ve()&&a.internalUse.preSetItem(i);var o=ne.merge(r),u=!!i&&ne.setItem(i);return o||u}};var me=q.removeItem=function(e){var t=q.combo.internalUse.preDelete(e);ne.removeItem(t)};q.setProperties=function(e,t,r,i){return r||n.trigger("prechange","properties"),ve()&&a.internalUse.convertPos(e),ne.setProperties(e,t,i)},q.setViewSettings=function(e,t,n,r){Le(ee.fromSettingsDirect(e,t,n,r))};var ye=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67],xe=Q.makeIdMap(["b","b1","b2","bw","c","e","fbc","fc","fi","fs","h","ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9","_ha0","_ha1","_ha2","_ha3","_ha4","off","donut","n","r","w","x","y"]),be=KeyLines.Model.updatePositionBufferProps;q.animateProperties=function(e,t,r,i){function o(e){for(var t in e)"undefined"==typeof e[t]&&(e[t]=ne.defaultValueFor(t))}function u(e){for(var t=0;t<e.length;t++){var n=ne.getByID(e[t].id);if(n){o(e[t]),L.push(e[t]);var r=l(e[t],n);G.push(r)}}}function l(e,t){var n={};for(var r in e)"id"!==r&&(n[r]=Q.clone(t[r]||ne.defaultValueFor(r)));return n}function s(e){return 3===e.length&&/^ha/.test(e)||4===e.length&&/^\_ha/.test(e)||"fi"===e||"donut"===e}i||n.trigger("prechange","properties");var f=Q.clone(e);ve()&&a.internalUse.convertPos(f);for(var c,d=[],g=[],h={},v=[],m=!1,p={},I=0;I<f.length;I++){c=f[I];var w=null,C=null;for(var B in c)xe[B]?Q.isNullOrUndefined(c[B])?(w=w||{id:c.id},w[B]=c[B]):(h[B]=!0,C=C||{id:c.id},C[B]=c[B]):"id"!==B&&(w=w||{id:c.id},w[B]=c[B]),be[B]?p.positions=!0:"id"!==B&&(p.all=!0);w&&g.push(w),C&&d.push(C)}Object.keys(h).forEach(function(e){var t={prop:e,fn:x};"x"!==e&&"y"!==e&&(m=!0),s(e)&&(t.fn=b),v.push(t)});var A=t.time,M=n.linearEasing;"cubic"===t.easing&&(M=n.cubicEasing);var Z=A,G=[],L=[];ne.setProperties(g,!1,p);var R=j.buildAnimatorInstance(function(e,n){n?(ne.ensureTypesInArray(d,!0),u(d),y(G,L)):Z-=e;for(var i=0!==A?M(Math.max(0,Math.min(1,(A-Z)/A))):1,a=Z>0,o=[],l=0,s=L.length;s>l;l++){for(var f=L[l],c=G[l],g={id:f.id},h=0,x=v.length;x>h;h++){var b=v[h],p=b.prop;void 0!==f[p]&&(g[p]=b.fn(c[p],f[p],i))}o.push(g)}return ne.unsafeApplyChanges(o,m),a?t.cb&&Q.tryCatch(function(){t.cb.call(this,i,A-Z)}):Q.invoke(r),a},p);Le(R,t.queue)},q.ping=function(e,t,n){function r(e,t,n,r){var i={id:t};i[n]=r,e.push(i)}e=Q.ensureArray(e);for(var i=[],a=[],o=[],u=0;u<e.length;u++){var l=e[u],s=ne.getByID(l);if(s){for(var f="link"===s.type,c=f?"_ha":"ha",d=0;10>d&&s[c+d];)d++;if(f&&5>d||!f&&10>d){var g=c+d,h=J.hsla(t.c),v=J.fromhsla([h[0],h[1],h[2],.001]);r(i,l,g,{r:f?void 0:Math.max(28-t.w/2,0),w:0,c:t.c}),r(a,l,g,{r:f?void 0:t.r,w:t.lw,c:v}),r(o,l,g,null)}}}i.length>0?p(i,a,o,t.time,t.repeat,function(){q.afterChange(n,!0,{positions:!0})}):q.afterChange(n,!0)};var pe=null,Ie=function(){};q.setCursorFn=function(e){Ie=e};var we=function(){};q.setCreateCanvasFn=function(e){we=e};var Ce="";q.setPath=function(e){Ce=e};var Be;q.assetPath=function(e){return e&&(Be=e),Be};var Ae=function(){};q.imageGenFn=function(e){return e&&(Ae=e),Ae};var Me=q.render=function(e){e=e||{all:!0},n.trigger("redraw",e)},Ze=j.animator(Me),Ge=j.animator(Me);q.animate=function(e){var t=ct?ct:pe,n=Ze.animate(e,t,ne),r=Ge.animate(e);return n||r},q.cancelAnimation=Ze.cancel;var Le=q.pushAnimation=Ze.push;q.cancelLayoutAnimation=Ge.cancel;var Re=q.pushLayoutAnimation=Ge.push,ke=q.backgroundOpacity=function(e){return arguments.length>0&&(oe=e,Me()),oe};q.animateBackgroundOpacity=j.makeValueAnimator(Ze,ke);var Ee=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],Se=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],Te=null;q.makeGhostCanvas=function(e,t){return Te=we(e,t,!0)};var De=.5;q.hide=function(e,t,n){Me({all:!0}),t.animate?A(e,t,n):(ne.hide(e,t.combos),ne.showHideBendLinks(e,t.combos),Q.invoke(n))},q.show=function(e,t,n,r){Me({all:!0}),ne.show(e,t,n.combos),n.animate?M(e,n,r):(ne.showHideBendLinks(e,n.combos),Q.invoke(r))};var We,Fe=J.widgets(),Ve=!1,Ne=3,Oe=q.drawBackground=function(e,t){var n,r;t&&(n=ee.scale(ee.width()),r=ee.scale(ee.height())),ge.backColour?J.backFill(e,ge.backColour,oe,n,r,t):ge.gradient?J.backgroundGradient(e,ge.gradient.stops,oe,n,r,t):J.backFill(e,"white",oe,n,r,t)},Xe=!0;q.labelPosition=function(e,t){return R(!1),ne.labelPosition(e,t)},q.draw=function(e,t){if($){var n=R(e);n&&(t.all=!0),te.webgl?D(t,ge):W(e)}},q.drawoffscreen=function(){$&&re.dirty()};var Ue=q.hittest=function(e,t,n,r){return re.test(e,t,n,r,te)};q.afterDraw=function(){pe&&pe.mouseMoved&&pe.mouseMoved()&&pe.afterDraw(Ue(ze,_e,ee),ze,_e)};var Ye,Ke;q.dragover=function(e,t){V(e,t)()},q.resetState=function(){pe=null},q.startDragger=function(e,t,n,r){if(ne&&(n=ee.worldToViewX(n),r=ee.worldToViewY(r),pe=ne.startDragger(q,ee,e,n,r,t),pe&&e)){var i=pe.getCursor(n,r);Ie(i)}};var He;q.mousedown=function(e,t,i,a,o){if(ne){ie=e;var u,l=Ue(t,i,ee);if(pe)X(!0,t,i,a,o);else{He=l,l!==Ke&&null!==l&&(Ke=null);var s=n.trigger("mousedown",Q.rawId(l),ee.unscale(t),ee.unscale(i),e,Q.subId(l));if(ne.getByID(l)||!l){var f=!1;f=0===e?ge.handMode?l?!ne.isSelected(l)||a:!1:!ne.isSelected(l)||a||!l:!l||!ne.isSelected(l),s&&(f=!1),f&&ne.setSelection(l,a,o),0===e&&(pe=ne.createDragger(q,te,ee,l,t,i,ge,We),pe&&l&&(u=pe.getCursor(t,i),Ie(u))),Me(),2===e?n.trigger("contextmenu",Q.rawId(l),ee.unscale(t),ee.unscale(i),Q.subId(l)):n.trigger("click",Q.rawId(l),ee.unscale(t),ee.unscale(i),e,Q.subId(l))}else 0===e&&(pe=r.createDragger(l,t,i),pe&&l&&(u=pe.getCursor(t,i),Ie(u))),0!==e&&1!==e||(n.trigger("click",Q.rawId(l),ee.unscale(t),ee.unscale(i),e,Q.subId(l)),Me())}return l}};var ze,_e,Pe;q.mousemove=function(e,t,n,i,a){ze=e,_e=t;var o="auto";if(pe&&!a)pe.mouseMoved&&pe.mouseMoved(!0),O(e,t,n,i),pe.dragMove(e,t,n,i),o=pe.getCursor(e,t),Me(pe.rebuild);else if(ne){var u=ne?Ue(e,t,ee):null;N(e,t),ne.getByID(u)?u&&(o=ne.getCursor(u,Be)):o=r.getCursor(u)}Pe===o||a||(Ie(o),Pe=o)},q.removeDragger=function(){pe&&X(!0,ze,_e)},q.mouseup=function(e,t,n,r){pe&&X(!0,e,t,n,r)},q.mouseleave=function(e,t,n,r){arguments.length&&pe&&(!ge.dragPan||ve()&&ge.handMode)&&X(ve(),e,t,n,r)},q.dblclick=function(e,t){var r=He;pe&&X(!1),2!==ie&&(!r&&ee&&(n.trigger("dblclick",null,ee.unscale(e),ee.unscale(t))||Je(!0)),r&&ne.getByID(r)&&n.trigger("dblclick",Q.rawId(r),ee.unscale(e),ee.unscale(t),Q.subId(r)))};var je;q.mousewheel=function(e,t,r){if(ee){var i=Date.now();if(je&&100>i-je)return;je=i,n.trigger("mousewheel",e,ee.unscale(t),ee.unscale(r))||Le(ee.wheelToPosition(e,t,r))}},q.keyup=function(e){27===e&&X(!1)},q.keydown=function(e,t,r){if(ne&&!n.trigger("keydown",e,t,r)){if(65===e&&t)return ne.selectAll(),Me(),!0;if(ne.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a)return n.trigger("prechange","move"),ne.moveSelection(i,a),Me(),!0;if(46===e){var u=n.trigger("delete");if(!u){n.trigger("prechange","delete");var l=ne.selectionPlusDummyNodes();me(l)}return Me(),!0}113===e&&n.trigger("edit",ne.doSelection())}return!1}},q.panBy=function(e,t,n,r,i){Le(ee.panBy(e,t,n,!1,r,i)),Me({drawOnly:!0})},q.pan=function(e,t,n,r){ve()?a.internalUse.pan(e,t,n,r):(Le(ee.pan(e,t,n,r)),Me({drawOnly:!0}))};var Je=q.zoomIn=function(e,t,n){ve()?a.internalUse.zoom("in",e,t,null,n):(Le(ee.zoomIn(e,t,n)),Me({drawOnly:!0}))};q.zoomOut=function(e,t,n){ve()?a.internalUse.zoom("out",e,t,null,n):(Le(ee.zoomOut(e,t,n)),Me({drawOnly:!0}))},q.setZoom=function(e,t,n,r){ve()?a.internalUse.setZoom(e,t,n,r):(Le(ee.setZoom(e,t,n,r)),Me({drawOnly:!0}))},q.modelExtents=function(){return ne.generate(Fe,te,ee,$,le),Fe.itemExtents(null,te)},q.fitToModel=U("fitToModel"),q.fitToSelection=U("fitToSelection"),q.fitModelHeight=U("fitModelHeight");var Qe=function(e,t){var n=e;return j.buildAnimatorInstance(function(e){n-=e;var r=0>n;return r&&Q.invoke(t),!r})};q.layout=function(e,t,r){if(ne){t=t||{};var i=Y(e,t);ne.layout(e,n,i,t,H(r))}},q.arrange=function(e,t,r,i){if(ne){var a=Y(e,r);ne.arrange(e,n,t,a,r,H(i))}};var qe,$e,et,tt,nt,rt,it;q.touchstart=function(e){if(2===e.length&&(st=(e[0].x+e[1].x)/2,ft=(e[0].y+e[1].y)/2,ut=st,lt=ft),1===e.length){tt=e[0].x,nt=e[0].y,it=e[0].id;var t=Ue(tt,nt,ee);if(qe?t!==rt?z():$e=!0:($e=!1,qe=Q.nextTick(z,600)),rt=t,et=Q.nextTick(function(){_(),pe&&X(!1),n.trigger("contextmenu",Q.rawId(rt),ee.unscale(tt),ee.unscale(nt),Q.subId(rt))},600),ne.getByID(rt)||!rt){var i=n.trigger("touchdown",Q.rawId(rt),ee.unscale(tt),ee.unscale(nt),Q.subId(rt));i||(rt?ne.isSelected(rt)||ne.setSelection(rt,!1,!1):ge.handMode||ne.setSelection(null,!1,!1)),pe=ne.createDragger(q,te,ee,rt,tt,nt,ge,We),Me()}else pe=r.createDragger(rt,tt,nt)}};var at,ot,ut,lt;q.touchmove=function(e){e.length>=2&&(ut=(e[0].x+e[1].x)/2,lt=(e[0].y+e[1].y)/2);for(var t=0;t<e.length;t++)it===e[t].id&&(at=e[t].x,ot=e[t].y);if(et){var n=(at-tt)*(at-tt)+(ot-nt)*(ot-nt);n>100&&_()}ct||pe&&it===e[0].id&&1===e.length&&(ze=e[0].x,_e=e[0].y,pe.mouseMoved&&pe.mouseMoved(!0),O(e[0].x,e[0].y),pe.dragMove(e[0].x,e[0].y,!1,!1),Me(pe.rebuild))},q.touchend=function(e,t){if(Me(),et&&(_(),ve()||n.trigger("click",Q.rawId(rt),ee.unscale(tt),ee.unscale(nt),0,Q.subId(rt))),qe&&$e&&2!==ie){z();var r=n.trigger("dblclick",Q.rawId(rt),ee.unscale(tt),ee.unscale(nt),Q.subId(rt));r||rt||Je(!0)}if(!ct&&pe){for(var i=-1,a=0;a<t.length;a++)t[a].id===it&&(i=a);i>-1&&0===e.length?X(!0,t[i].x,t[i].y,!1,!1):e.length>0&&(tt=e[0].x,nt=e[0].y,it=e[0].id,rt=Ue(tt,nt,ee),!ne.getByID(rt)&&rt||(ne.setSelection(rt,!1,!1),pe=ne.createDragger(q,te,ee,rt,tt,nt,ge,We)))}},q.touchcancel=function(){_(),pe&&X(!1)};var st,ft;var JN=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17510;var ct;return q.gesturestart=function(){},q.gesturechange=function(e,t){_(),ge.gestures&&Q.isNumber(st)&&Q.isNumber(ft)&&(ct||(ct=ne.createGestureDragger(ee,st,ft)),ct.dragMove(e,t,ut,lt),Me({all:!0}))},q.gestureend=function(e,t){ct&&ct.endDrag(!0,e,t,ut,lt),ct=null},q}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.create=function(){function t(e,t,r,i,a,o,u,l,s){var f=a[u];if(!(f in r)){if(!(f in i))throw"link has end which is not in nodes list";var c=i[f];if(c.hi)throw"link has end which is hidden";r[f]=n(e,t,c,f,l,s)}return f}function n(e,t,n,r,i,a){var o=e.nodeSize(n,t,a),u=le.nodeSize(n,t,a),l={id:r,x:n.x,y:n.y,size:o,fixed:i?r in i:!1,lc:0,d:n.d,w:u.width,h:u.height,labeloff:le.labelOffset(n)};return l}function r(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}function i(e,r,i,a,o,u,l){for(var s=o().connections({all:!1}),f={},c=[],d=0;d<s.length;d++){var g=s[d][0],h=a[g],v=t(e,r,f,i,h,g,"id1",u,l),m=t(e,r,f,i,h,g,"id2",u,l);if(null!==v&&null!==m){var y,x=[{id:g,sign:1,off:h.off}],b=h.w||1;for(y=1;y<s[d].length;y++)g=s[d][y],h=a[g],x.push({id:g,sign:h.id1===v?1:-1,off:h.off}),b=Math.max(b,h.w||1);c.push({id1:v,id2:m,id:g,arrowSize:e.arrowLength(b),links:x,numLinks:x.length}),f[v].lc+=1,f[m].lc+=1}}var p;for(p in i)if(!i[p].hi&&!i[p]._parentId&&!f[p]){var I=n(e,r,i[p],p,u,l);f[p]=I}var w=0;for(p in f)w++;return{v:f,e:c,vcount:w}}function a(e,t){var n,r,i,a,u=0,l=[];for(n in e)if(n+="",!e[n].hasOwnProperty("c")){var s=u++;for(l.push(n+"");l.length>0;){var f=l.shift();if(!e[f].hasOwnProperty("c"))for(e[f].c=s,r=0;r<t.length;r++)i=t[r].id1+"",a=t[r].id2+"",i===f&&(t[r].c=s,l.push(a)),a===f&&(t[r].c=s,l.push(i))}}for(var c=new Array(u),d=0;d<c.length;d++)c[d]={verts:{},edges:[]};for(n in e)n+="",c[e[n].c].verts[n]=e[n];for(r=0;r<t.length;r++)c[t[r].c].edges.push(t[r]);for(var g=0;g<c.length;g++)c[g].extents=o(c[g].verts);return c}function o(e){var t,n,r,i,a=0;for(var o in e){var u=e[o+""];t=ue.defined(t)?Math.min(t,u.x-u.size):u.x-u.size,n=ue.defined(n)?Math.min(n,u.y-u.size):u.y-u.size,r=ue.defined(r)?Math.max(r,u.x+u.size):u.x+u.size,i=ue.defined(i)?Math.max(i,u.y+u.size):u.y+u.size,a++}return{x1:t,y1:n,x2:r,y2:i,c:a}}function u(e){return ce.test(e.id)}function l(e,t,n,r,i,a,o){function u(t){var n=t.origId||t.id,r={id:fe+n+"-"+O++,level:t.level-1,origId:n,x:0,y:0,c:t.c,size:10,fixed:!1,lc:t.lc,du:!0,w:20,h:20,labeloff:0};return e[r.id]=r,i[t.c].verts[r.id]=r,X[r.id]=1,r}function l(e,n,r){var a={id:fe+n.id+"-"+r.id,id1:n.id,id2:r.id,c:e.c,numLinks:e.numLinks};return"level"in n&&"level"in r&&(a.level=Math.max(n.level,r.level)),t.push(a),i[e.c].edges.push(a),a}function s(e,t,n){var r=u(e),i=n.id1===t.id;l(n,i?r:e,i?e:r),r.level===t.level+1?l(n,i?t:r,i?r:t):s(r,t,n)}function f(e,t,n){if(e.level>0){var r=u(e);l(n,e,r),l(n,r,t)}if(e.level<x.length-1){var i=u(e);i.level+=2,l(n,e,i),l(n,i,t)}}var c,d,g,h,v={},m={},y={},x=[],b={},p={},I=r();for(c=0;c<i.length;c++){y[c]={},b[c]=[];var w=[],C=1/0;for(g in i[c].verts)if(d=i[c].verts[g],d.d&&ue.isNumber(d.d[n]))h=d.d[n],y[c][h]||(y[c][h]=[],b[c].push(h)),y[c][h].push(g),p[g]=h,C>h?(C=h,w=[g]):h===C&&w.push(g);else if(a)throw new Error("Sequential Layout: Node is missing valid level data.");if(0===w.length)for(g in i[c].verts){w.push(g),p[g]=0,y[c][0]=[g],b[c].push(0);break}b[c].sort(function(e,t){return e-t});var B,A=[];for(B=0;B<b[c].length;B++){var M=b[c][B];A=[];var Z,G,L=I.neighbours(y[c][M]),R=b[c][B+1]||M+1,k=(R+M)/2;for(G=0;G<L.nodes.length;G++)Z=L.nodes[G],ue.isNullOrUndefined(p[Z])&&(A.push(Z),p[Z]=k);A.length&&(b[c].splice(B+1,0,k),y[c][k]=A)}if(!a)for(B=0;B<w.length;B++)v[w[B]]=1,e[w[B]].level=0;m[c]=w}if(a){for(c=0;c<i.length;c++)for(B=0;B<b[c].length;B++)-1===x.indexOf(b[c][B])&&x.push(b[c][B]);for(x.sort(function(e,t){return e-t}),c=0;c<i.length;c++)for(B=0;B<x.length;B++)y[c][x[B]]=B;o=o||[]}else for(c=0;c<i.length;c++)for(B=0;B<b[c].length;B++)y[c][b[c][B]]=B;for(var E,S,T,D,W,F,V,N,O=0,X={},U=0,Y=t.length;Y>U;U++){E=t[U],S=ue.rawId(E.id1),T=ue.rawId(E.id2),D=e[S],W=e[T];var K=D.level=y[D.c][p[S]],H=W.level=y[W.c][p[T]];ue.isNumber(K)&&ue.isNumber(H)&&(E.level=Math.max(K,H),H>K?(X[W.id]=1,N=D,V=W):K>H&&(X[D.id]=1,N=W,V=D)),F=Math.abs(K-H),F>1?s(V,N,E):a&&0===F&&(f(D,W,E),o.push(E))}if(a)for(c=0;c<i.length;c++)g=m[c][0],1!==m[c].length||e[g].level||(e[g].level=y[c][p[g]]);else for(g in e)if(g=ue.rawId(g),d=e[g],!X[g]&&!v[g]){for(var z,_=m[e[g].c],P=1/0,j=0;j<_.length;j++){var J=I.shortestPaths(g,_[j]);J.distance<P&&(z=J,P=J.distance)}for(var Q=0;Q<z.one.length;Q++){var q=z.one[Q],$=e[q];if($&&"level"in $&&$.level<d.level){var ee=l(d,d,$);d.level-$.level>1&&s(d,$,ee);break}}}return t}function s(e,t,n,r){for(var i,a,o,u,l=r(),s=0;s<n.length;s++){var f=l.distances(n[s]);for(var c in f)"level"in e[c]||(e[c].level=1/0),e[c].level=Math.min(e[c].level,f[c])}for(var d=0;d<t.length;d++)i=t[d].id1,a=t[d].id2,o=e[i],u=e[a],"level"in o&&"level"in u&&(t[d].level=Math.max(o.level,u.level))}function f(e,t){function n(e,t,n,i){r[e]=r[e]||[],r[e][t]=r[e][t]||{},r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(i)}var r={};for(var i in e)"level"in e[i]&&n(e[i].c,e[i].level,"vertices",i);for(var a=0;a<t.length;a++)"level"in t[a]&&n(t[a].c,t[a].level,"edges",t[a]);return r}function c(e,t){function n(e,t,n,i){r[e]=r[e]||[],r[e][t]=r[e][t]||{vertices:[],edges:[]};for(var a=0;t>a;a++)r[e][a]=r[e][a]||{vertices:[],edges:[]};r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(i)}var r={};for(var i in e)"level"in e[i]&&n(e[i].c,e[i].level,"vertices",i);for(var a=0;a<t.length;a++)"level"in t[a]&&1===Math.abs(e[t[a].id1].level-e[t[a].id2].level)&&n(t[a].c,t[a].level,"edges",t[a]);return r}function d(e,t){var n=[];e=ue.ensureArray(e);for(var r=0;r<e.length;r++)t[e[r]]&&n.push(e[r]);return n}function g(e){var t=Number(e);return t=ue.isNumber(t)?t:5,t=Math.max(0,t),t=Math.min(10,t)}function h(e){return 10*(5-g(e))}function v(e){
var t,n=0,r=0;for(var i in e)t=e[i],"level"in t&&!u(t)&&(n+=t.size,r+=1);return n/r}function m(e){var t=0;for(var n in e)t=Math.max(t,e[n].length);return t}function y(e,t){for(var n=[],r=m(e),i=0;r>i;i++){var a=0,o=0,u=0,l=0,s=0;for(var f in e)if(e[f][i]){for(var c=e[f][i].vertices,d=0;d<c.length;d++){var g=c[d],h=t[g].size;o+=h,a=Math.max(a,h)}l+=c.length}u=o/l;var v=n[i-1];v&&a<v.max+v.yOffset&&(s=(v.max+v.yOffset)/2),n[i]={max:a,average:u,sum:o,yOffset:s}}return n}function x(e,t,n,r,i){function s(e,t,n,r){var i,a,o,u,l,s,f=!0,c=-1;for(i=0;i<n.length;i++){var d=n[i];if(!r&&H[d].barycenter===1/0){f=!1;break}var g=0,h=0;for(a=0;a<t.length;a++)u=-1,d===t[a].id1?u=t[a].id2:d===t[a].id2&&(u=t[a].id1),-1!==u&&(H[u].barycenter===1/0?f=!1:(h++,l=e.indexOf(u),-1!==l&&(g+=l)));if(H[d].prevPos=i,s=!0,h>0?H[d].barycenter=g/h:H[d].barycenter===1/0?f=!1:0===i?H[d].barycenter=0:s=!1,s){if(i>c+1){var v=n[c],m=Math.min(H[d].barycenter,H[v].barycenter),y=Math.abs(H[d].barycenter-H[v].barycenter),x=y/(i-c);for(o=1;i-c>o;o++)H[n[c+o]].barycenter=m+x*o}c=i}}return n.sort(function(e,t){return H[e].barycenter===H[t].barycenter?H[e].prevPos-H[t].prevPos:H[e].barycenter-H[t].barycenter}),f}function f(e,t,n){e.sort(function(e,r){var i=Math.max(t.indexOf(e.id1),t.indexOf(e.id2)),a=Math.max(n.indexOf(e.id1),n.indexOf(e.id2)),o=Math.max(t.indexOf(r.id1),t.indexOf(r.id2)),u=Math.max(n.indexOf(r.id1),n.indexOf(r.id2)),l=o>i||i===o&&u>a;return l?-1:1})}function d(e,t){var n,r;return 1>t||e.length<=t?0:(n=e[t].edges,r=[e[t-1].vertices,e[t].vertices],r.sort(function(e,t){return e.length-t.length}),g(n,r[1],r[0]))}function g(e,t,n){var r,i,a,o,u;if(e.length<2)return 0;for(f(e,t,n),r=e.map(function(e){var t=n.indexOf(e.id1);return-1===t&&(t=n.indexOf(e.id2)),{index:t,multiplier:-1===t?0:e.numLinks}}),i=1;i<r.length;)i*=2;a=new Array(2*i-1);for(var l=0;l<a.length;l++)a[l]=0;for(i-=1,o=0,de=0;de<r.length;de++)for(u=r[de].index+i,a[u]+=r[de].multiplier;u>0;)u%2&&(o+=a[u+1]*r[de].multiplier),u=Math.floor((u-1)/2),a[u]+=r[de].multiplier;return o}function v(e,t,n,r){var i,a=ue.clone(t),o=[];return a.forEach(function(t){o.push(t.id1===e?t.id2:t.id1)}),r.forEach(function(e){a.push(e),i=e.id1===n?e.id2:e.id1,-1===o.indexOf(i)&&o.push(i)}),{verts:o,edges:a,common:t.length===r.length&&t===a.length}}function x(e,t){var n=H[e].childEdges||[],r=H[t].childEdges||[];return v(e,n,t,r)}function b(e,t){var n=H[e].parentEdges||[],r=H[t].parentEdges||[];return v(e,n,t,r)}function C(e,t){var n,r,i,a,o,u,l=1,s=e[t].vertices,f=0,c=[],d=[];t>0&&(c=e[t-1].vertices),t<e.length-1&&(d=e[t+1].vertices);var h=0;for(n=0;n<s.length-1;n+=l)if(o=0,u=0,t>0?(i=b(s[n],s[n+1]),i.common||(i.verts.sort(function(e,t){return c.indexOf(e)-c.indexOf(t)}),i.verts.length>1&&(o+=g(i.edges,i.verts,[s[n],s[n+1]]),u+=g(i.edges,i.verts,[s[n+1],s[n]])))):i={common:!0},t<e.length-1?(a=x(s[n],s[n+1]),a.common||(a.verts.sort(function(e,t){return d.indexOf(e)-d.indexOf(t)}),a.verts.length>1&&(o+=g(a.edges,a.verts,[s[n],s[n+1]]),u+=g(a.edges,a.verts,[s[n+1],s[n]])))):a={common:!0},i.common&&a.common&&(H[s[n+1]].swapBlockStart=H[s[n]].swapBlockStart||n),o>u){var v=H[s[n]].swapBlockStart||n;r=s[v],s[v]=s[n+1],s[n+1]=r,H[s[v]].swapBlockStart=v,H[s[n+1]].swapBlockStart=v+1,f+=o-u,1===l&&(h=Math.max(h,n),l=-1),n=v,0===n&&(n=h,l=1)}else-1===l&&(n=h,l=1);return f}function B(e){var t,n;do for(n=0,t=0;t<e.length;t++)n+=C(e,t);while(n>0)}function A(){var e,t,n,r,i,a,o,u,l,f=!0;for(e in j){var c=j[e];for(l=0,o=void 0,u=c.length,t=0;t<c.length;t++)if(c[t].vertices.length>0){u=t;break}if(u!==c.length-1){c[u].vertices.sort(function(e,t){return H[t].childEdges.length-H[e].childEdges.length}),H[c[u].vertices[0]].barycenter=0,a=1/0;do{for(n=a,i?(a=0,o=ue.clone(c)):a=1/0,t=u;t<c.length-1;t++)r=s(c[t].vertices,c[t+1].edges,c[t+1].vertices,!0),f&&(s(c[t+1].vertices,c[t+1].edges,c[t].vertices,!1),r=s(c[t].vertices,c[t+1].edges,c[t+1].vertices,!1));for(i=r,t=c.length-1;t>u;t--)r=s(c[t].vertices,c[t].edges,c[t-1].vertices,l+2>t),f?(s(c[t-1].vertices,c[t].edges,c[t].vertices,!1),r=s(c[t].vertices,c[t].edges,c[t-1].vertices,!1)):a+=d(c,t),r||(i=!1);f=!i}while(l++<100&&(a===1/0||n>a));o&&(j[e]=o),a>0&&z.length<1e4&&B(j[e])}}}function M(e,t,n){return e[n]&&e[n].edges?e[n].edges.filter(function(e){return e.id1===t||e.id2===t}):[]}function Z(){var e,t,n;for(e in j){var r=j[e];for(t=0;t<r.length;t++){var i=r[t].vertices;for(n=0;n<i.length;n++){var a=i[n];H[a].barycenter=1/0,H[a].childEdges=M(r,a,t+1),H[a].parentEdges=M(r,a,t)}}}}function G(){var e,t,n;for(e in j)for(t=0;t<j[e].length;t++){var r=j[e][t].vertices;for(n=0;n<r.length;n++){var i=r[n];H[i].orderPos=n,H[i].children=p(j,H,i),H[i].parents=I(j,H,i)}}}function R(e,t,n,r){var i,a,o=t,l=t.filter(function(e){return u({id:e})});if(l.length>0&&(o=l),a=o.length,e.root=e,e.align=e,a>0){var s=[Math.floor((a+1)/2)-1,Math.ceil((a+1)/2)-1];for(i=0;2>i;i++){var f=n?s[i]:s[1-i],c=H[o[f]],d=c.orderPos;if(n&&d>r||!n&&r>d)return c.align=e,e.root=c.root,e.align=e.root,d}}return r}function k(e,t,n){var r,i,a,o,u,l,s="l"===t[1];if(void 0===e[t]){r=e,e[t]=0;do{var f=-1;s&&r.orderPos>0?f=r.orderPos-1:!s&&r.orderPos<n[r.level].vertices.length-1&&(f=r.orderPos+1),-1!==f&&(i=H[n[r.level].vertices[f]],a=i.root,k(a,t,n),e.sink.id===e.id&&(e.sink=a.sink),o=r[Y],u=i[Y],"h"===Y&&(s?(u+=i.labeloff,o-=r.labeloff):(u-=i.labeloff,o+=r.labeloff)),l=(o+u)/2+U,e.sink.id!==a.sink.id?a.sink.shiftData.push({vert:e.sink,dist:e[t]-a[t]-l}):e[t]=Math.max(e[t],a[t]+l)),r=r.align}while(r.id!==e.id)}}function E(e,t){if(e[t]=e.root[t],e.root.id===e.id){var n=e.root.sink.shift;if(!n){var r=e.root.sink.shiftData;n=1/0;for(var i=0;i<r.length;i++){var a=r[i].dist;r[i].vert.shift<1/0&&(a+=r[i].vert.shift),n=Math.min(n,a)}e.root.sink.shift=n}1/0>n&&(e[t]+=n)}}function S(e,t){var n,r,i,a,o=[],u=1/0,l=-(1/0),s="l"===t[1],f="u"===t[0],c=f?0:e.length-1,d=f?1:-1,g=function(t){return f?t<e.length:t>=0},h=function(e){return s?0:e.length-1},v=s?1:-1,m=function(e,t){return s?e<t.length:e>=0};for(n=c;g(n);n+=d){i=e[n].vertices;var y=-1;for(s||n===c||(y=e[n-d].vertices.length),r=h(i);m(r,i);r+=v){a=H[i[r]];var x=f?a.parents:a.children;a.hasOwnProperty(t)&&(a[t]=void 0),y=R(a,x,s,y),o.push(a),a.sink=a,a.shiftData=[],a.shift=void 0}}for(r=0;r<o.length;r++)a=o[r],a.root.id===a.id&&k(a,t,e);for(r=0;r<o.length;r++)a=o[r],E(a,t),u=Math.min(u,a[t]),l=Math.max(l,a[t]);return s?{max:l,min:u}:(T(e,t),{max:-u,min:-l})}function T(e,t){var n,r;for(n=0;n<e.length;n++){var i=e[n].vertices;for(r=0;r<i.length;r++){var a=H[i[r]];a[t]*=-1}}}function D(e){function t(e,t){return e-t}var n,r,i=S(e,"ul"),a=S(e,"ur"),o=S(e,"dl"),u=S(e,"dr"),l=[i,a,o,u].sort(function(e,t){return e.max-e.min-(t.max-t.min)});for(n=0;n<e.length;n++){var s=e[n].vertices;for(r=0;r<s.length;r++){var f=H[s[r]],c=[f.ul-i.min+l[0].min,f.ur-a.max+l[0].max,f.dl-o.min+l[0].min,f.dr-u.max+l[0].max].sort(t);f.x=(c[1]+c[2])/2}}}function W(e){var t,n;for(t=0;t<e.length;t++){var r=0,i=e[t].vertices;for(n=0;n<i.length;n++){var a=H[i[n]];if(!u(a)){var o=a[Y]/2,l="h"===Y?a.labeloff:0;r+=o-l,a.x=r,r+=o+l+U}}var s=(r-U)/2;for(n=0;n<i.length;n++)H[i[n]].x-=s}}function F(e){var t,n,r,i,a=[],o=[],l=0;for(t=0;t<e.length;t++){for(r=e[t].vertices,a[t]=0,o[t]=0,n=0;n<r.length;n++)i=H[r[n]],u(i)||(a[t]+=i[Y],o[t]++);var s=a[t]+U*(o[t]-1);l=Math.max(l,s)}for(t=0;t<e.length;t++)if(r=e[t].vertices,o[t]>1){var f=(l-a[t])/(o[t]-1),c=0;for(n=0;n<r.length;n++)if(i=H[r[n]],!u(i)){var d=i[Y]/2,g="h"===Y?i.labeloff:0;c+=d-g,i.x=c,c+=d+g+f}}else for(n=0;n<r.length;n++)i=H[r[n]],u(i)||(i.x=l/2)}function V(e){var t,n,r,i,a=1/0,o=-(1/0),u=N(),l=m(j);for(t=0;t<_.length;t++)for(n in _[t].verts)a=Math.min(a,_[t].verts[n].x),o=Math.max(o,_[t].verts[n].x);r=(o-a)/(e*l),r=Math.max(r,u);for(t in j){i=0;for(var s=0;s<j[t].length;s++){for(var f=j[t][s].vertices,c=0;c<f.length;c++){n=f[c];var d=H[n];d.y=i}i+=r}}return r}function N(){var e,t,n=0,r=y(j,H),i=[];for(e=0;e<z.length;e++){var a=z[e].level,o=z[e].arrowSize;i[a]=Math.max(i[a]||0,2*o)}for(t=0;t<r.length;t++){var u=r[t].max,l=0;r[t+1]&&(l=r[t+1].max);var s=i[t]||0;n=Math.max(n,u+l+U+s)}return n}function O(e){function t(e,t){return Number(e)-Number(t)}var n,i,a,o,l={};for(o="equal"===r.spacing||"stretched"===r.spacing?function(e){return e.c}:function(){return 0},n=0;n<P.length;n++){var s=P[n];s.links.sort(function(e,t){var n=ue.defined(e.off)?e.off*e.sign:1/0,r=ue.defined(t.off)?t.off*t.sign:1/0;return n-r});var f=0,c=0,d=0,g=!0,h=j[o(s)][s.level].vertices,v=h.indexOf(s.id1),m=h.indexOf(s.id2),y=[v,m].sort(t);for(i=y[0]+1;i<y[1];i++){var x=H[h[i]];for(u(x)||(g=!1),a=0;a<x.parentEdges.length;a++)f+=x.parentEdges[a].numLinks;for(a=0;a<x.childEdges.length;a++)c+=x.childEdges[a].numLinks;var b=(x[K]||x.size)/2;d=Math.max(d,b)}if(!g){c===f&&(f=H[h[y[0]]].parentEdges.length+H[h[y[1]]].parentEdges.length,c=H[h[y[0]]].childEdges.length+H[h[y[1]]].childEdges.length);var p=m>v?1:-1;f>c&&(p*=-1),r.orientation.match(/right|up/)&&(p*=-1);var I=d+20,w=40,C=e/2;for(I+=Math.abs(H[s.id1].x-H[s.id2].x)/U,I=Math.min(I,C),I+(s.links.length-1)*w>C&&(w=Math.max(10,(C-I)/(z.links.length-1))),i=0;i<s.links.length;i++){var B=s.links[i],A=I+i*w;l[B.id]={off:p*B.sign*A}}}}return l}r=ue.defaults(r,{top:[],orientation:"down",spacing:"auto"});var X=r.level,U=50+h(r.tightness),Y=r.orientation.match(/down|up/)?"w":"h",K=r.orientation.match(/down|up/)?"h":"w",H=t.v,z=t.e,_=a(H,z),P=[];if(!X)throw new Error("Sequential Layout: LayoutOptions is missing valid level property.");z=l(H,z,X,n,_,!0,P);var j=c(H,z);Z(),A(),G();var J,Q,q,$,ee=r.ratio;"right"!==r.orientation&&"left"!==r.orientation||(ee=1/ee);var te,ne=[];if("equal"===r.spacing||"stretched"===r.spacing)for(J=0;J<_.length;J++)ne[J]=_[J].verts;else{var re=[],ie=[];ne[0]={};for(J in j){for(te=j[J],Q=0;Q<te.length;Q++){if(re[Q]||(re[Q]={vertices:[],edges:[]}),ie[Q])for(q=te[Q].vertices,de=0;de<q.length;de++)$=q[de],H[$].orderPos+=ie[Q];re[Q].vertices=re[Q].vertices.concat(te[Q].vertices),re[Q].edges=re[Q].edges.concat(te[Q].edges),ie[Q]=re[Q].vertices.length}ne[0]=ue.merge(ne[0],_[J].verts)}j={},j[0]=re}var ae=0;for(J in j){te=j[J],"equal"===r.spacing?W(te):"stretched"===r.spacing?F(te):D(te);var oe,le=o(ne[J]);ae-=le.x1;for(oe in ne[J])H[oe].x+=ae;ae+=le.x2+U}var se=V(ee),fe=O(se);if(r.orientation.match(/up|right|left/)){var ce=w(r.orientation);for(J in j)for(Q=0;Q<j[J].length;Q++){q=j[J][Q].vertices;for(var de=0;de<q.length;de++)$=q[de],ce(H[$])}}var ge=[],he=t.extents;L(e,H,fe,he,ge,r,i)}function b(e,t,n,r,i,o){function u(){var e,t,n;for(t in T)for(var r=T[t].length-1;r>=0;r--)for(var i=T[t][r].vertices,a=[],o=0;o<i.length;o++){n=i[o];var u=p(T,R,n);if(R[n].children=[],R[n].subChildrenCount=0,0!==u.length){var l=[];for(e=0;e<u.length;e++)a.indexOf(u[e])<0&&l.push(u[e]);if(l.length>0)for(R[n].children=l,R[n].subChildrenCount=c(l),e=0;e<l.length;e++)a.push(l[e]),R[l[e]].parent=n}}}function c(e){for(var t=0,n=0;n<e.length;n++){var r=R[e[n]].subChildrenCount;t+=0===r?1:r}return t}function g(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*F/2,i=e.children;if(i)for(var a=0;a<i.length;a++){var o=R[i[a]],u=o.subChildrenCount;0===u&&(u=1);var l=r+u*F;g(o,(l+r)/2,!1),r=l}}function m(e,t,n){for(var r,i=t.miny,a=Math.PI*(2/3),o=0,u=0;u<T[e].length;u++){var l=T[e][u].vertices,s=W[u].yOffset,f=W[u].average,c=f>D?f:D,d=2*(c+12)+s;i+=o;for(var g=0;g<l.length;g++){r=l[g];var h=R[r];if(h.y=i,!n){var v=h.children;if(v&&v.length>1){var m=v.map(function(e){return R[e]}),y=b(m),p=x(y,a);d=Math.max(d,p)}}}o=d}}function x(e,t){return e/(2*Math.tan(t/2))}function b(e){for(var t=1/0,n=-(1/0),r=0;r<e.length;r++){var i=e[r].x;t=Math.min(t,i),n=Math.max(n,i)}return n-t}function I(e,t){for(var n=w(t),r=0;r<T[e].length;r++)for(var i=T[e][r].vertices,a=0;a<i.length;a++)n(R[i[a]])}r=ue.defaults(r,{top:[],orientation:"down",stable:!0,flatten:!1});var C=r.level,B=o?1:h(r.tightness),A=r.top,M=r.tidy,Z=o?!1:r.flatten,R=t.v,k=t.e,E=t.extents,S=a(R,k);C?k=l(R,k,C,n,S,!1):(A=d(A,R),s(R,k,A,n));var T=f(R,k),D=v(R),W=y(T,R),F=2*D+24+B;u();var N,O={},X={};for(N in T){var U=Number(N);O[U]=V(S[U].verts),X[U]={children:T[N][0].vertices,subChildrenCount:c(T[N][0].vertices)}}for(N in T)g(X[N],O[N].x,!0),m(N,O[N],Z);for(N in T)o||I(N,r.orientation);o&&o(R,T,S,O,D,r.tightness);var Y=[];M?G(e,R,S,0,1,E,Y,r,i):L(e,R,{},E,Y,r,i)}function p(e,t,n){var r,i,a,o,u=t[n].c,l=t[n].level+1,s=e[u][l],f={},c=[];if(s){for(a=0;a<s.edges.length;a++){var d=s.edges[a];r=d.id1+"",i=d.id2+"",r===n&&(f[i]=1),i===n&&(f[r]=1)}var g=s.vertices;for(o=0;o<g.length;o++)r=g[o]+"",f[r]&&c.push(r)}return c}function I(e,t,n){var r=[],i=t[n].level;if(i>0){var a,o,u,l=t[n].c,s=e[l][i],f={};if(s&&s.edges){for(o=0;o<s.edges.length;o++){var c=s.edges[o];c.id1===n?f[c.id2]=1:c.id2===n&&(f[c.id1]=1)}var d=e[l][i-1];if(d&&d.vertices)for(u=0;u<d.vertices.length;u++)a=d.vertices[u],f[a]&&r.push(a)}}return r}function w(e){var t={up:function(e){e.y=-e.y,e.x=e.x},down:function(){},right:function(e){var t=e.y;e.y=e.x,e.x=t},left:function(e){var t=e.y;e.y=e.x,e.x=-t}};return t[e]||t.down}function C(e,t,n,r,i,a){function o(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function l(e,t,n,r){if(r&&1===e.length)return 0;var i=t,a=i;for(s=1;s<e.length;s++)a=Math.max(o(d[e[s]],d[e[s-1]]),a);return u(a,a-i,n)}var s,f,c,d;a=h(a);for(var g in t){var v=V(n[Number(g)].verts),m=0,y=m,x=4*i,b=x,p=2*i+24;for(f=0;f<t[g].length;f++){var I,w=t[g][f].vertices;for(d=[],s=0;s<w.length;s++){c=w[s]+"",I=e[c];var C=I.x-v.minx,B=v.maxx-v.minx+p;if(C*=2*Math.PI/B,0>C||C>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");d[c]={a:C,r:I.size}}for(y=m,0===f?w.length>1&&(m+=x/2):m+=x,m=l(w,m,a,1>f),m-y>b&&(b=m-y+1,x=Math.max(x,b/2),0===f&&w.length<3&&(m/=2)),s=0;s<w.length;s++)I=e[w[s]+""],I.x=r[Number(g)].x+m*Math.cos(d[I.id].a),I.y=r[Number(g)].y+m*Math.sin(d[I.id].a)}}}function B(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(n),a=Math.max(r,i)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var u=o*n*Math.log(n),l=1/A(t);return{repulsionFactor:40*Math.max(1,Math.pow(l,2)),coeff:1,naturalDistance:20*l,iterations:o,chunk:20,temperature:a,temp:a,estTime:u}}function A(e){var t=g(e.tightness);return Math.pow(2,2*(t-5)/5)}function M(e,t,n,r){function i(t){var n=f[t],r=p[t];T(e,n,r,r.start,r.stop,function(){if(W(n.verts),t++,R++,t<f.length){if(x=Date.now(),b=x-w,!(b>16||R>1e3))return i(t);w=x,R=0,ue.nextTick(function(){i(t)},0)}else o()})}function o(){g?G(e,u,f,y,1,c,d,n,r):L(e,u,{},c,d,n,r)}var u=t.v,l=t.vcount,s=t.e,f=a(u,s),c=t.extents,d=n.fixed||[],g=n.tidy;F(u);var h=f.length,v=l/(l+h),m=0,y=g?v:1;e.trigger("progress","layout",0);for(var x,b,p=[],I=0,w=Date.now(),C=0;C<f.length;C++){var A=B(f[C],n);I+=A.estTime,p.push(A)}var M=0;for(C=0;C<f.length;C++){p[C].start=M;var Z=M+(y-m)*p[C].estTime/I;p[C].stop=Z,M=Z}var R=0;f.length>0?i(0):L(e,u,{},c,d,n,r)}function Z(e){for(var t in e)if(t+="",e[t].fixed)return!0;return!1}function G(e,t,n,r,i,a,o,u,l){for(var s={},f=[],c={},d=1/0,g=1/0,h=0;h<n.length;h++){var v=N(n[h].verts);s[h]=v;var m=o.length>0&&Z(n[h].verts);f.push({x:v.x,y:v.y,width:v.width,height:v.height,id:h,fixed:m}),c[h]={x:v.x,y:v.y},d=Math.min(d,c[h].x),g=Math.min(g,c[h].y)}u=ue.defaults(u,{strategy:"rect",ratio:4/3}),te(f,{strategy:u.strategy,step:30,max:2,sort:!1,ratio:u.ratio,tightness:u.tightness},function(n){d="rect"===u.strategy?d:0,g="rect"===u.strategy?g:0;for(var r={},i=0;i<n.length;i++)r[n[i].id]=n[i],r[n[i].id].x+=d,r[n[i].id].y+=g;for(var s in t){var f=t[s+""],h=r[f.c].x-c[f.c].x,v=r[f.c].y-c[f.c].y;f.x+=h,f.y+=v}L(e,t,{},a,o,u,l)})}function L(e,t,n,r,i,a,u){var l=o(t);0===i.length&&(l=D(t,r,l)),ue.isNumber(l.x1)||(l=null),KeyLines.Util.nextTick(function(){e.trigger("progress","layout",1),u({vertices:t,updatedEdges:n,extents:l},a)})}function R(e,t,n){var r=e[t.id1],i=e[t.id2];k(r,i,n)}function k(e,t,n){var r,i,a;if(!e.fixed||!t.fixed){var o=2*de.next()*Math.PI;a=1.3*O(e,t,n)/2,e.fixed||t.fixed?(r=e.fixed?e.x:t.x,i=e.fixed?e.y:t.y,a*=2):(r=(e.x+t.x)/2,i=(e.y+t.y)/2),e.fixed||(e.x=r+a*Math.cos(o),e.y=i+a*Math.sin(o),o+=Math.PI),t.fixed||(t.x=r+a*Math.cos(o),t.y=i+a*Math.sin(o))}}function E(e,t,n,r){var i={temperature:10,i:0},a={verts:t.v,edges:t.e},u=B(t,n);u.chunk=u.iterations=5,i.temperature=Math.pow(u.temperature,.72),S(i,a,u);var l=o(a.verts);ue.isNumber(l.x1)||(l=null),e.trigger("progress","layout",1),r({vertices:a.verts,extents:l},n,!1)}function S(e,t,n){for(var r=Math.min(e.i+n.chunk,n.iterations);e.i<r;){var i=t.verts,a=t.edges,o=0;for(var u in i)u+="",i[u].dx=i[u].dy=0,o++;if(F(i,2),1===o)return void(e.i=r);if(2===o){if(a[0])R(i,a[0],n.naturalDistance);else{var l=ue.dictValues(i);k(l[0],l[1],n.naturalDistance)}return void(e.i=r)}Y(i,n.repulsionFactor);for(var s=0;s<a.length;s++)X(a[s],i,n.naturalDistance,n.coeff);var f=e.temperature*(1-e.i/n.iterations);for(var c in i)c+="",U(i[c],f);e.i++}}function T(e,t,n,r,i,a){function o(){return r+(i-r)*f.i/n.iterations}function u(){return f.i>=n.iterations}function l(){S(f,t,n)}function s(){l(),u()?a():(e.trigger("progress","layout",o()),ue.nextTick(s,0))}var f={i:0,temperature:n.temperature};s()}function D(e,t,n){var r=(n.x1+n.x2)/2-(t.x1+t.x2)/2,i=(n.y1+n.y2)/2-(t.y1+t.y2)/2;for(var a in e)a+="",e[a].x-=r,e[a].y-=i;return{x1:n.x1-r,y1:n.y1-i,x2:n.x2-r,y2:n.y2-i}}function W(e){var t,n,r,i,a=0,o=0,u=0,l=!1,s=0,f=0;for(i in e)i+="",a+=e[i].x,o+=e[i].y,u+=1,l|=e[i].fixed;if(!(3>u||l)){a/=u,o/=u;for(i in e)i+="",t=Math.sqrt((e[i].x-a)*(e[i].x-a)+(e[i].y-o)*(e[i].y-o)),t>f&&(f=t,s=Math.atan2(e[i].y-o,e[i].x-a));s=-s;var c=Math.sin(s),d=Math.cos(s);for(i in e)n=a+(e[i].x-a)*d-(e[i].y-o)*c,r=o+(e[i].x-a)*c+(e[i].y-o)*d,e[i].x=n,e[i].y=r}}function F(e,t){var n=t||30;for(var r in e)r+="",e[r].fixed||(e[r].x+=n*(de.next()-.5),e[r].y+=n*(de.next()-.5))}function V(e){var t,n=0,r=0,i=0,a=1/0,o=1/0,u=-(1/0),l=-(1/0);for(t in e)t+="",n+=1,r+=e[t].x,i+=e[t].y,o=Math.min(o,e[t].x),a=Math.min(a,e[t].y),u=Math.max(u,e[t].x),l=Math.max(l,e[t].y);r/=n,i/=n;var s=0,f=!1;for(t in e){t+="";var c=e[t].x-r,d=e[t].y-i,g=Math.sqrt(c*c+d*d);s=Math.max(g+1.5*e[t].size,s),f=f||e[t].fixed}return{x:r,y:i,sum:n,size:s,fixed:f,miny:a,minx:o,maxy:l,maxx:u}}function N(e,t){ue.isNullOrUndefined(t)&&(t={});var n,r=20,i=1/0,a=1/0,o=-(1/0),u=-(1/0);for(n in e)n+="",n in t||(a=Math.min(a,e[n].x-e[n].size),i=Math.min(i,e[n].y-e[n].size),o=Math.max(o,e[n].x+e[n].size),u=Math.max(u,e[n].y+e[n].size));return a-=r,i-=r,o+=r,u+=r,{x:a,y:i,width:o-a,height:u-i}}function O(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function X(e,t,n,r){var i=t[e.id1],a=t[e.id2],o=i.x-a.x,u=i.y-a.y,l=O(i,a,n),s=ue.len(o,u);if(s>.02){var f=r*(s-l)/s,c=o*f,d=u*f;i.dx-=c,i.dy-=d,a.dx+=c,a.dy+=d}}function U(e,t){if(!e.fixed){var n=ue.len(e.dx,e.dy),r=e.dx/n*Math.min(n,t),i=e.dy/n*Math.min(n,t);e.x+=r,e.y+=i}}function Y(e,t){function n(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function r(e,t){var r=e.x1,a=e.y1,o=e.x2,u=e.y2,l=.5*(r+o),s=.5*(a+u),f=t.x>=l,c=t.y>=s,d=(c<<1)+f;return e.leaf=!1,f?r=l:o=l,c?a=s:u=s,e.nodes[d]||(e.nodes[d]=n(r,a,o,u)),e=e.nodes[d],i(e,t)}function i(e,t){if(!e.leaf)return r(e,t);var n=e.point;return n?Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01?r(e,t):(e.point=null,r(e,n),r(e,t)):void(e.point=t)}function a(e,t){if(!e(t))for(var n=t.nodes,r=0;4>r;r++)n[r]&&a(e,n[r])}function o(e){var t=0,n=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,i=0;4>i;i++){var a=r[i];a&&(o(a),e.charge+=a.charge,e.size+=a.size,t+=a.charge*a.cx,n+=a.charge*a.cy)}if(e.point){var u=s(e.point);e.charge+=e.pointCharge=u,e.size+=e.point.size,t+=u*e.point.x,n+=u*e.point.y}e.cx=e.charge?t/e.charge:0,e.cy=e.charge?n/e.charge:0}function u(e){if(e.point!==b){var t=e.cx-b.x,n=e.cy-b.y,r=1/ue.len(t,n);if((e.x2-e.x1)*r<p)return l(b,e,e.charge,r,t,n),!0;e.point&&l(b,e.point,e.pointCharge,r,t,n)}return!e.charge}function l(e,t,n,r,i,a){r>I&&(r=I),f(e,n,i,a,r)}function s(e){return e.size*(1+(e.lc?e.lc:1)/3)}function f(e,n,r,i,a){if(!(.001>a)){var o=t*s(e)*n*a*a*a;e.dx-=r*o,e.dy-=i*o}}function c(){for(var t in e)t+="",b=e[t],a(u,w)}var d,g,h,v,m=V(e);d=m.minx,h=m.miny,g=m.maxx,v=m.maxy;var y=g-d,x=v-h;y>x?v=h+y:g=d+x;var b,p=.5,I=1e5,w=n(d,h,g,v);for(var C in e)C+="",i(w,e[C]);return o(w),c(),w}function K(e,t,n,r,i,a){r?e[t]=n[t]:e[t]={x:i,y:a}}function H(e,t,n,r){var i=1.25-(g(n.tightness)-5)/10,a=_(t.v,t.e),o=z(a,t.v,i);M(e,o,n,function(e,n,i){var o={};for(var u in e.vertices)if(u+="",a.rev[u])for(var l=e.vertices[u].fixed,s=0;s<a.rev[u].length;s++){var f=a.rev[u][s],c=e.vertices[u].x,d=e.vertices[u].y;e.vertices[u].jit.positions&&(c+=e.vertices[u].jit.positions[f].x,d+=e.vertices[u].jit.positions[f].y),K(o,f,t.v,l,c,d)}else K(o,u,t.v,t.v[u].fixed,e.vertices[u].x,e.vertices[u].y);var g={vertices:o,extents:e.extents};r(g,n,i)})}function z(e,t,n){var r={},i=[],a=0;for(var u in e.rev){u+="";var l={};l.x=l.y=l.size=0;for(var s=e.rev[u].length,f=!1,c=0;s>c;c++){var d=t[e.rev[u][c]];l.x+=d.x,l.y+=d.y,l.size+=d.size}l.x=l.x/s,l.y=l.y/s;var g=q(t,e.rev[u],l.size/s,n);r[u]={x:l.x,y:l.y,size:g.radius,fixed:f,jit:g,lc:0},a++;for(var h=e.rev[u][0],v={},m=e.index[h],y=0;y<m.length;y++){var x=m[y];v[e.ids[x]]=1}for(var b in v)b+="",b>u&&i.push({id1:u,id2:b})}for(var p,I,w=0;w<i.length;w++)p=i[w].id1+"",I=i[w].id2+"",r[p].lc++,r[I].lc++;for(var C in t)if(C+="",!e.ids[C]){var B=t[C];r[C]={x:B.x,y:B.y,size:B.size,lc:0,fixed:B.fixed,jit:{radius:B.size,position:{x:0,y:0}}},a++}return{v:r,e:i,vcount:a,extents:o(r)}}function _(e,t){var n=J(t);return Q(n)}function P(e,t,n){e[n]||(e[n]=[]),e[n].push(t)}function j(e,t){P(e,t.id1,t.id2),P(e,t.id2,t.id1)}function J(e){for(var t={},n=0;n<e.length;n++)j(t,e[n]);return t}function Q(e){var t,n={},r={};for(var i in e){i+="",e[i].sort(),t="";for(var a=0;a<e[i].length;a++)t+=e[i][a];n[t]||(n[t]=[]),n[t].push(i),r[i]=t}return{rev:n,ids:r,index:e}}function q(e,t,n,r){var i,a={},o=0,u=t.length-1;do i=$(e,t,n,u,a,r),o=Math.max(i.radius,o),u=i.index;while(u>=0);var l;switch(t.length){case 4:l=2;break;case 3:l=2.5;break;case 2:l=3;break;case 1:l=1;break;default:l=2}return{positions:a,radius:o*l}}function $(e,t,n,r,i,a){if(0===r)return i[t[0]]={x:0,y:0},{radius:n,index:-1};var o=(r+1)*n,u=n,l=Math.sqrt(o/(Math.PI*u)),s=l*u,f=Math.floor(2*Math.PI*s/n);f=Math.min(f,r+1);var c=2*Math.PI/f,d=0;switch(f){case 2:d=Math.PI/2,s=.75*s;break;case 3:d=Math.PI/3,s=.85*s;break;case 4:d=0,s=.85*s;break;case 5:d=0,s=.9*s;break;default:d=0}s*=a;for(var g=0;f>g;)i[t[r-g]]={x:s*Math.cos(d),y:s*Math.sin(d)},d+=c,g++;return r-=f,{radius:s,index:r}}function ee(e,t,n,r){var i,a=0,o={};for(i=0;i<t.length;i++)a+=e[t[i]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var u=Math.PI/4;2===t.length&&(u=Math.PI/2),4===t.length&&(u=0),t.length<4&&(a=1.5*a);var l=2*Math.PI/t.length,s=r*a/4;for(i=0;i<t.length;i++)o[t[i]]={x:s*Math.cos(u),y:s*Math.sin(u)},u+=l}return{positions:o,radius:a}}function te(e,t,n){function i(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function a(e,t,n){return(t-e)*n+e}function o(e,t,n){return(e-n)/(t-n)}function u(e){var n=function(){for(var t=0,n=-(1/0),r=0;r<e.length;r++)t+=e[r].width*e[r].height,n=Math.max(n,e[r].width);return{area:t,maxWidth:n}},r=1.1,i=1.03,a=10,o=n(),u=Math.sqrt(o.area*r/t.ratio)*i,l=u*t.ratio;return l<o.maxWidth+a&&(l=o.maxWidth+a),{x:0,y:0,width:l,height:u}}function l(e,t,n,r,i,u){var l=o(t,n,r);return l=Math.pow(l,e),a(u,i,l)}function s(e,t){if(!t)return!1;var n=e.x<m.x+m.width,r=e.x+e.width>m.x,i=e.y<m.y+m.height,a=e.y+e.height>m.y;return n||r&&i||a}function f(e,t){function n(e,t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(e,t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}if(t.length<1)return!1;var i,a;for(i=0;i<t.length;i++)if(a=t[i],r(e,a)&&n(e,a))return!0;return!1}var c,d,g,h={spiral:function(e){var t=l(.6,e,100,0,b,1),n=l(1,e,600,0,.3,.5),r=n*e,i=Math.cos(r)*t,a=Math.sin(r)*t;return{x:i,y:a}},controlled:function(e,t){for(var n;!s(t,n);)n=h.random(e);return n},rect:function(e){return ne(e,t,n)},random:function(e){var t=.5*e;return{x:i()*t,y:i()*t}}},v=0,m=u(e),y=[],x=h[t.strategy]||h.rect,b=0;for(c=0;c<e.length;c++)d=e[c],b+=d.width;if(b/=2*e.length,"rect"===t.strategy)return x(e);for(e.sort(r),c=0;c<e.length;c++){for(d=e[c],d.x=d.fixed?d.x:0,d.y=d.fixed?d.y:0;f(d,y)&&!d.fixed;)g=x(v,d),d.x=g.x,d.y=g.y,v++;y.push(d)}return n(y)}function ne(e,t,n){function i(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function a(e,t){var n=r(e,t);return n?n:t.height-e.height}function o(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function u(e){for(var n=ue.clone(e),r=0;r<n.length;r++){var i=n[r].width%t.step,a=n[r].height%t.step;0!==i&&(n[r].width=n[r].width+(t.step-i)),0!==a&&(n[r].height=n[r].height+(t.step-a))}return n}function l(e){return g?e.ratio()>=t.ratio-.2&&e.ratio()<=t.ratio:!0}function s(e){for(var n=h(t.tightness),r=0;r<e.length;r++)e[r].width+=n,e[r].height+=n}function f(e){var n=1.1,r=1.03,i=10,a=Math.sqrt(e.area()*n/t.ratio)*r,o=a*t.ratio;return o<e.maxWidth+i&&(o=e.maxWidth+i),{width:o,height:a,lowestFreeHeightDeficit:0,ratio:function(){return m.width/m.height}}}t=ue.defaults(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),t.sort&&e.sort(a),s(e);var c,d=u(e),g=!0;if(0===e.length)return c=ie(),n(c.comps);var v={area:i,maxWidth:o(d),maxHeight:d[0].height},m=f(v),y=0;ue.asyncWhile(function(){return m.width>=v.maxWidth},function(){var e=re(d,m);if(0===e.comps.length)m.width*=1.03,m.height*=1.03;else{if(y++,(!c||l(e))&&(c=e,c.efficiency=v.area()/e.area(),l(e)))return!0;if(y>=t.max)return!0}},function(){return n(c.comps)})}function re(e,t){var n,r=ie();t.canvas||(t.canvas=ae());for(var i=t.canvas.setDimensions(t.width,t.height),a=0,o=0,u=0;u<e.length;u++){var l=e[u];if(n=i.addRect(l.width,l.height),!n.placed){r.width=0,r.height=0,r.comps.length=0,r.lowestHeightFlushedRightItem=0;break}l.x=n.offsetX,l.y=n.offsetY,r.comps.push(l),l.y+l.height>r.height&&(r.height=l.y+l.height),l.x+l.width>r.width&&(r.width=l.x+l.width);var s=l.width+l.x;(s>o||s===o&&l.height>a)&&(r.lowestHeightFlushedRightItem=n.lfhd,a=l.height,o=s)}return t.lowestFreeHeightDeficit=i.lfhDeficitSinceLastRedim(),r}function ie(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function ae(){function e(e,t){var n=f.height-e;return t-n}function t(e,t,n){if(n.leftOverW>0){f.cells+=l.rows();var r=e+n.nRequiredCellsH-1;l.insertCol(r,n.leftOverW)}if(n.leftOverH>0){f.cells+=l.cols();var i=t+n.nRequiredCellsV-1;l.insertRow(i,n.leftOverH)}for(var a=e+n.nRequiredCellsH-1;a>=e;a--)for(var o=t+n.nRequiredCellsV-1;o>=t;o--)l.setItem(a,o,!0)}function n(e,t,n,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var i,a=0,o=0,u=t;o<n.height;){for(i=e,a=0;a<n.width;){if(l.item(i,u))return!1;a+=l.colWidth(i),i++}o+=l.rowHeight(u),u++}return r.nRequiredCellsH=i-e,r.nRequiredCellsV=u-t,r.leftOverW=a-n.width,r.leftOverH=o-n.height,!0}function r(e,t,n){var r=0,i=0,a=0,o=0,u=0;for(a=0;e>a;a++)r+=l.colWidth(a);for(a=0;t>a;a++)i+=l.rowHeight(a);if(o=n.x-r,u=n.y-i,0>o||0>u)return!1;if(o>0){f.cells+=l.rows();var s=l.colWidth(e)-o;l.insertCol(e,s)}if(u>0){f.cells+=l.cols();var c=l.rowHeight(t)-u;l.insertRow(t,c)}return!0}function i(e,t){return f.width=e,f.height=t,f.area=o(),l.init(e,t,!1),f}function a(i,a,o){var u={offsetX:0,offsetY:0,width:i,height:a,placed:!1},c=0,d=0,g=0,h=0,v={};if(o){for(;c<l.cols()&&g<o.x;)g+=l.colWidth(c),c++;for(;d<l.rows()&&h<o.y;)h+=l.rowHeight(d),d++;r(c-1,d-1,o),g-=l.colWidth(c),h-=l.rowHeight(d)}f.addAttempts++;for(var m=ge;;){for(v={};d<l.rows()&&l.item(c,d);)h+=l.rowHeight(d),d++;if(d<l.rows()&&e(h,u.height)<=0){if(n(c,d,u,v)){t(c,d,v),u.offsetX=g,u.offsetY=h,u.placed=!0;break}h+=l.rowHeight(d),d++}var y=e(h,u.height);if(y>0&&(h=0,d=0,g+=l.colWidth(c),c++,f.lfhDeficitSinceLastRedim()>y&&(s=y)),f.width-g<u.width){u.placed=!1;break}}return m=s,{offsetX:u.offsetX,offsetY:u.offsetY,lfhd:m,placed:u.placed}}function o(){return f.width*f.height}var u=0,l=oe(),s=ge,f={matrix:l,cells:u,addAttempts:0,addRect:a,lfhDeficitSinceLastRedim:function(){return s},setDimensions:i};return f}function oe(){function e(){(a.length>0||o.length>0)&&(a.length=o.length=u.length=0)}function t(t,n,r){if(0>=t)throw"[Matrix] Column size cannot be 0 or similar";if(0>=n)throw"[Matrix] Row size cannot be 0 or similar";return l=1,s=1,e(),a.push({index:0,size:t}),o.push({index:0,size:n}),u[0]=[],u[0][0]=r,f}function n(e,t){for(var n=o[e].index,r=0;s>r;r++)u[r][l]=u[r][n];return l-1>e&&o.splice(e+1,0,{index:l,size:t}),o[e+1]={index:l,size:t},o[e].size-=t,l++,f}function r(e,t){var n=a[e].index;return u[s]=ue.clone(u[n]),s-1>e&&a.splice(e+1,0,{index:s,size:t}),a[e+1]={index:s,size:t},a[e].size-=t,s++,f}function i(){var e,t,n,r="\n     ",i=0,u=0;for(i=0;s>i;i++)e=Math.floor(a[i].size/100)%10===0?" ":""+Math.floor(a[i].size/100)%10,t=Math.floor(a[i].size/10)%10===0&&" "===e?" ":""+Math.floor(a[i].size/10)%10,n=Math.floor(a[i].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(a[i].size)%10,r+=a[i].size>999?" "+a[i].size+" ":" "+e+t+n+" ";for(r+="\n",i=0;l>i;i++){for(e=Math.floor(o[i].size/100)%10===0?" ":""+Math.floor(o[i].size/100)%10,t=Math.floor(o[i].size/10)%10===0&&" "===e?" ":""+Math.floor(o[i].size/10)%10,n=Math.floor(o[i].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(o[i].size)%10,r+=o[i].size>999?" "+o[i].size+": ":" "+e+t+n+": ",u=0;s>u;u++)r+=f.item(u,i)?"  X  ":"  .  ";r+="\n"}return r}var a=[],o=[],u=[],l=0,s=0,f={init:t,cols:function(){return s},rows:function(){return l},item:function(e,t){return u[a[e].index][o[t].index]},setItem:function(e,t,n){u[a[e].index][o[t].index]=n},insertRow:n,insertCol:r,colWidth:function(e){return a[e].size},rowHeight:function(e){return o[e].size},inspect:i};return f}var ue=KeyLines.Util,le=e.Util.create();e.createLens(g);var se={};se.extractStructure=function(e,t,n,r,a,u,l){var s=null;if(u){s={};for(var f=0;f<u.length;f++)s[u[f]]=1;
}var c=i(e,t,n,r,a,s,l);return c.extents=o(c.v),c};var fe="_dummy",ce=RegExp("^"+fe),de=ue.makeRandomiser();se.layout=function(t,n,r,i,a,o){n.trigger("prechange","layout");var u="^(standard|hierarchy|lens|sequential";u+="|radial|structural|tweak",u+=")$";var l=new RegExp(u);if(!l.test(t))throw new Error("The layout name is not valid.");var s=ue.makeIdMap(["standard","structural"]);if(de.setSeed(null),s[t]||a.consistent){var f,c=ue.ensureArray(a.fixed||[]),d=ue.makeIdMap(a.fixed),g=0,h=0;if(c.length){for(f in d)f in r.v&&(g+=r.v[f].x,h+=r.v[f].y);g/=c.length,h/=c.length}for(f in r.v)d[r.v[f].id]||(r.v[f].x=g,r.v[f].y=h)}switch(a.consistent&&de.setSeed(900736044081),t){case"standard":M(n,r,a,o);break;case"hierarchy":b(n,r,i,a,o);break;case"lens":e.lens(n,r,a,L,de,o);break;case"sequential":x(n,r,i,a,o);break;case"structural":H(n,r,a,o);break;case"radial":b(n,r,i,a,o,C);break;case"tweak":E(n,r,a,o)}},se.arrange=function(e,t,n,r,i,o){function u(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function l(e,t,n,r,i){var a;for(a=0;a<e.length;a++)if(e[a].id===t){e[a].x=n-e[a].width/2,e[a].y=r-e[a].height/2;break}return i(e)}function s(e,t,n,r,a){var o={},u=[],l={};for(c=0;c<e.length;c++)l=N(e[c].verts,t),isFinite(l.width)&&(u.push({x:l.x,y:l.y,width:l.width,height:l.height,id:c}),o[c]={x:l.x,y:l.y});l=N(t),u.push({x:l.x,y:l.y,width:l.width,height:l.height,id:y}),o[y]={x:l.x,y:l.y},p(u,{ratio:i.ratio,centre:n,absolute:r,specialId:y},function(e){return a({packed:e,original:o})})}function f(e,t,n){var r,i;for(var a in e){var o=e[a+""];o.arranged?(r=n[y].x-t[y].x,i=n[y].y-t[y].y):(r=n[o.c].x-t[o.c].x,i=n[o.c].y-t[o.c].y),o.x+=r,o.y+=i}}var c,d,g,v={tidy:function(e,t,n){return ne(e,{step:30,max:2,sort:!1,ratio:t.ratio},n)},average:function(e,t,n){return l(e,t.specialId,t.centre.x,t.centre.y,n)},absolute:function(e,t,n){return l(e,t.specialId,t.absolute.x,t.absolute.y,n)}},m={grid:function(e,t,n,r){var i=2*n+24+r,a=0,o=0,u=Math.floor(Math.sqrt(e.length)),l=Math.ceil(e.length/u),s={};for(c=0;u>c;c++){for(d=0;l>d;d++){var f=l*c+d;e[f]&&(s[e[f]]={x:a,y:o}),a+=i}a=0,o+=i}return s},circle:function(e,t,n,r){var i=1.25-(5-r)/50;return ee(t,e,n,i).positions},radial:function(e,t,n,r){var i=1.25-(5-r)/50;return q(t,e,n,i).positions}},y="#arranged#";i=ue.defaults(i,{tightness:5,position:"average",x:0,y:0}),t.trigger("prechange","arrange");var x=r.v,b=h(i.tightness),p=v[i.position]||v.average,I=m[e]||m.grid,w={x:Number(i.x)||0,y:Number(i.y)||0},C={x:0,y:0};if(n=ue.ensureArray(n),n=u(x,n),!n.length)return o();for(g=0,c=0;c<n.length;c++)g+=x[n[c]].size,C.x+=x[n[c]].x,C.y+=x[n[c]].y;g/=n.length,C.x/=n.length,C.y/=n.length;var B=I(n,x,g,b),A={};for(var M in B)M+="",x[M].x=B[M].x,x[M].y=B[M].y,A[M]=x[M],A[M].arranged=1;var Z=a(x,r.e);s(Z,A,C,w,function(e){for(var n=e.packed,a=e.original,u={},l=0;l<n.length;l++)u[n[l].id]=n[l];f(x,a,u);var s=[],c=r.extents;L(t,x,{},c,s,i,o)})};var ge=16e6;return se}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Renderer=function(t){function n(){var e=A.createTexture();return A.bindTexture(A.TEXTURE_2D,e),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),e}function r(e){e?(A.bindFramebuffer(A.FRAMEBUFFER,e.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,e.renderBuffer),A.bindTexture(A.TEXTURE_2D,e.texture)):d(),A.viewport(0,0,b,p)}function i(e){var t=B[e]||null,i=A.RGBA;if(e&&!t){t=B[e]={framebuffer:A.createFramebuffer(),renderbuffer:A.createRenderbuffer(),texture:n()},"shadow"===e&&(i=A.RGB),A.texImage2D(A.TEXTURE_2D,0,i,A.drawingBufferWidth,A.drawingBufferHeight,0,i,A.UNSIGNED_BYTE,null),A.bindFramebuffer(A.FRAMEBUFFER,t.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,t.renderbuffer),A.clearColor(0,0,0,0),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,A.drawingBufferWidth,A.drawingBufferHeight),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,t.texture,0),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,t.renderbuffer),A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);var a=A.checkFramebufferStatus(A.FRAMEBUFFER);if(A.FRAMEBUFFER_COMPLETE!==a)throw new Error(a.toString())}r(t)}function a(){return A=e.Utils.create3DContext(C,{antialias:!1,preferLowPowerToHighPerformance:!1}),y=C.width,x=C.height,b=A.drawingBufferWidth,p=A.drawingBufferHeight,A.getExtension("OES_standard_derivatives"),A.getExtension("OES_element_index_uint"),A.viewport(0,0,b,p),A.blendFunc(A.ONE,A.ONE_MINUS_SRC_ALPHA),A.enable(A.BLEND),A.clearColor(0,0,0,0),B=t.framebuffers={},k=new Uint8Array(4),A}function o(e,t){if(B[e]){var n=B[e].texture;L.drawItems(t,n)}}function u(){A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight)}function l(e,t,n,r){R=I.createMatrix(),e?(R.pan(t,n),R.zoom(r)):(R.pan(0,0),R.zoom(1))}function s(e,t,n,r,i,a,o,u){n.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o,u)}function f(e,t,n,r,i,a,o){t.arcBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o)}function c(e,t,n,r,i,a,o,u,l,s){t.triangleBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o,u,l,s)}function d(){A.bindFramebuffer(A.FRAMEBUFFER,null),A.bindTexture(A.TEXTURE_2D,null),A.bindRenderbuffer(A.RENDERBUFFER,null)}function g(e){e.rebuildOptions.colours=!1,e.rebuildOptions.positions=!1,e.rebuildOptions.textures=!1,e.rebuildOptions.shadow=!1,e.rebuildOptions.all=!1}function h(e){return e.lineBuffers.numOfTriangles||e.arcBuffers.numOfTriangles||e.triangleBuffers.numOfTriangles}function v(){for(var e=0;8>e;e++)A.activeTexture(A["TEXTURE"+e]),A.bindTexture(A.TEXTURE_2D,null)}function m(e){e.texture&&(A.deleteTexture(e.texture),e.texture=null,e.ctx=null,e.img=null)}var y,x,b,p,I=e.Utils,w={},C=t.canvas,B=t.framebuffers,A=a(),M=e.LineShader(A),Z=e.ArcShader(A),G=e.TriangleShader(A),L=e.RenderToTextureShader(A),R=null,k=[0,0,0,0];return w.clearView=function(e){e&&(A=a()),u(),A.clear(A.COLOR_BUFFER_BIT)},w.clearFramebuffers=function(){B=t.framebuffers={}},w.clearTextureAtlas=function(e){e&&(Array.isArray(e)?e.forEach(function(e){m(e)}):m(e))},w.render=function(e,n,r,a,u,m,I){y=C.clientWidth,x=C.clientHeight;var w=C.width/y;b=A.drawingBufferWidth,p=A.drawingBufferHeight;var B=t.layersToDraw;t.panX=e,t.panY=n,t.zoom=r;for(var L=!1,k=0,E=B.length;E>k;k++){var S=B[k];h(S)&&(S.drawFramebuffer&&(L=!0),l(S.useView,e,n,r),i(S.drawFramebuffer),s(M,S,S.lineBuffers,R,y,x,w,I.showShadowCanvas),f(Z,S,R,y,x,w,I.showShadowCanvas),c(G,S,R,a,u,m,y,x,w,I.showShadowCanvas),g(S)),S.useFramebuffer&&L&&(L=!1,d(),o(S.useFramebuffer,S.fbAlpha),i(S.useFramebuffer),A.clear(A.COLOR_BUFFER_BIT))}v()},w.drawShadowCanvas=function(e,n){y=C.clientWidth,x=C.clientHeight;var r=C.width/y;if(b=A.drawingBufferWidth,p=A.drawingBufferHeight,t.layersToDraw.length>0){var a=b/C.clientWidth,o=e*a,u=p-n*a;i("shadow");for(var d=0,g=t.layersToDraw.length;g>d;d++){var h=t.layersToDraw[d];l(h.useView,t.panX,t.panY,t.zoom),s(M,h,h.lineBuffers,R,y,x,r,!0),f(Z,h,R,y,x,r,!0),c(G,h,R,t.textAtlas,t.fontIconAtlas,t.imageAtlases,y,x,r,!0)}o>=0&&u>=0&&b>o&&p>u&&A.readPixels(o,u,1,1,A.RGBA,A.UNSIGNED_BYTE,k)}return k},w})}();;

