//
//     KeyLines v3.2.2-2615 professional eval
//     Licensed to Honeywell for Connexo expires on Sat Dec 24 2016
//
//     Copyright Â© 2011-2016 Cambridge Intelligence Limited.
//     All rights reserved.
//

!function(){var e={},t="undefined"!=typeof window;t&&(window.KeyLines=e="undefined"!=typeof window.KeyLines?window.KeyLines:e),e.TimeBar={},"object"==typeof module&&"object"==typeof module.exports?(global.KeyLines=e,module.exports=e):"function"==typeof define&&define.amd&&define(e),e.webGLSupport=function(){if(!e.WebGL&&t){var n,r=["OES_standard_derivatives","OES_element_index_uint"],a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=document.createElement("canvas"),o=null;for(n=0;n<a.length;++n){try{o=i.getContext(a[n])}catch(u){}if(o)break}var s=o&&"getSupportedExtensions"in o;if(s){var l=o.getSupportedExtensions(),f={};for(n=0;n<l.length;n++)f[l[n]]=!0;for(n=0;s&&n<r.length;n++)s=f[r[n]]}return s}return!0},e.webGLSupport()&&(e.WebGL={})}(),function(){var e=KeyLines.Model={};e.createModel=function(e,t,n){function r(){O=K=null}function a(e){for(var t in ie)c(ie[t],e);for(t in ae)c(ae[t],e)}function i(e,t){switch(e){case"x1":return ae[t.id1].x;case"y1":return ae[t.id1].y;case"x2":return ae[t.id2].x;case"y2":return ae[t.id2].y}}function o(e){le=!1,se=e||{},fe=0}function u(e){se[e]||(fe++,se[e]=oe)}function s(){return le?!0:P.hasAnyKeys(se)}function l(){function e(e){var n=P.clone(e,!0);n.id=P.rawId(e.id),t.push(n)}var t=[];return P.iterator(ie,e),P.iterator(ae,e),t}function f(e){for(var t in e)P.isNullOrUndefined(e[t])&&delete e[t]}function c(e,t){e[t]&&De(e.id)}function g(e,t,n){for(var r="x"===t||"y"===t?u:he,a=0;a<e.length;a++){var i=e[a],o=ae[i];if(o)o[t]=n,r(i);else{var s=ie[i];s&&(s[t]=n,he(i))}}}function d(e,t){var n=!1;return ae[e]&&(n=v(ae[e],t)),ie[e]&&(n=v(ie[e],t)),n}function h(e){return(ae[e]||ie[e])&&!(d(e,"hi")||d(e,"gh"))}function v(e,t){return!!e[t]}function m(e,t,n){e=P.ensureArray(e),g(e,t,!1);var r;if(ve.ensureConsistency(t,!1,ae,ie),n){var a={};for(r=0;r<e.length;r++)a[e[r]]=1;for(r in ie)v(ie[r],t)&&(v(ae[ie[r].id1],t)||v(ae[ie[r].id2],t)||(a[ie[r].id1]||a[ie[r].id2])&&(ie[r][t]=!1))}}function x(e){var t,n=[];for(t in ae)t=P.rawId(t),ae[t][e]&&n.push(t);for(t in ie)t=P.rawId(t),ie[t][e]&&n.push(t);return n}function y(e,t){e=P.ensureArray(e),g(e,t,!0),ve.ensureConsistency(t,!1,ae,ie)}function p(e){var t={};for(var n in e)ie[n]&&"undefined"==typeof ie[n].off&&(t[n]=ie[n]);return t}function b(){var e=I(ae);return e=I(ie)||e}function I(e){var t=!1;for(var r in e){var a=e[r];if(t=w(a)||t,n.itemHasGlyph(a))for(var i=0;i<a.g.length;i++)t=w(a.g[i])||t;a.bu&&(t=w(a.bu.g)||t)}return t}function w(e){if(e){var t=e.u;if(t&&!(t in Be))return Be[t]=1,!0}}function B(e){var t={};for(var n in e){var r=e[n];r.hi||(t[n]=r)}return t}function C(){O||(O=B(ae),K=B(ie))}function A(){le||(fe>100?M():me().internalMarkLinks(se))}function M(){for(var e in K)if(!se[e]){var t=ie[e];(se[t.id1]||se[t.id2])&&(se[e]=ue)}}function Z(e){for(var t in e)Ze(t,!0)}function D(t){var n=KeyLines.Graph.create(e);return n.privateSetProperties(ae,t),n}function L(){return me().connections({all:!1})}function G(e,t){var n=[],r={};if(P.hasAnyKeys(e)){var a=D(e).findAdjacency;n=L();for(var i=0;i<n.length;i++){var o=ie[n[i][0]];a({all:!0},o.id1,o.id2)&&(r[i]=1)}}t(n,r)}function R(e){for(var t={},n=0;n<e.length;n++){var r=e[n],a=ie[r];a&&(t[r]=a)}return t}function S(){k(L())}function T(){for(var e in ie){var t=ie[e];delete t.st}}function E(e,t,n,r){function a(e,t){return i(ie[e])-i(ie[t])}function i(e){var t=P.defined(e.off)?e.off:s;return e.id1>=e.id2&&(t=-t),t}function o(e,t){r(e,e.id1<e.id2?t:-t)}var u,s=1e6,l=t||e,f=40;P.iterator(l,function(t,r){u=e[+r],n||(u=u.filter(function(e){return!ie[e].gh})),u.sort(a);for(var i=u.length,s=Math.floor(i/2),l=(i+1)%2/2,c=0;i>c;c++){var g=ie[u[c]];o(g,(c-s+l)*f)}})}function k(e,t){function n(e,t){e.off=t,he(e.id)}E(e,t,!0,n)}function V(e,t,n){function r(e,t){a.push({id:e.id,off:t})}var a=[];return E(e,t,n,r),a}function F(){for(var e=L(),t={},n=0;n<e.length;n++){var r=!1,a=e[n];if(a.length>1){for(var i=0;i<a.length;i++){var o=ie[a[i]];o&&(r=r||P.defined(o.off))}r||(t[n]=1)}}k(e,t)}function W(e){return(e+"").match(Ee)}function N(e){var t=W(e);return ke[t[2]]}function U(e){var t=W(e);return t?t[1]:null}var O,K,X,Y,H=KeyLines.Common,z=KeyLines.Rendering,P=KeyLines.Util,_={x:1,y:1,w:1,h:1,e:1,fs:1,off:1,b1:1,b2:1,bw:1},j={t:1,u:1,id:1,id1:1,id2:1,ff:1,sh:1,p:1,ls:1,bs:1},J={c:1,b:1,fc:1,fbc:1},Q={hi:1,bg:1,ci:1,du:1,fb:1,a1:1,a2:1,re:1,tc:1,a:1},q={gh:1},$={pos:1},ee={x:1,y:1,off:1,lat:1,lng:1},te={ls:{solid:!0,dashed:!0,dotted:!0},bs:{solid:!0,dashed:!0}},ne=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"],re={},ae={},ie={},oe=1,ue=2,se={},le=!1,fe=0,ce=P.idSep(),ge=null,de=KeyLines.Layouts.create(),he=re.setDirty=function(e){se[e]||fe++,se[e]=ue},ve=KeyLines.Validation.create({numbers:_,negatives:ee,strings:j,stringValues:te,colours:J,booleans:Q,reserved:q,mapPos:$,halos:ne},he,r,a),me=re.graph=function(){return ge||(ge=KeyLines.Graph.create(e),ge.privateSetProperties(ae,ie)),ge},xe=re.setAllDirty=function(){le=!0},ye=re.moveNode=function(e,t,n){var r=ae[e];r&&(r.x=t,r.y=n,u(e))};re.moveLink=function(e,t){var n=ie[e];n&&(n.y=t,he(e))},re.setLinkOffset=function(e,t){var n=ie[e];n&&(n.off=t,he(e))},re.ensureObject=ve.ensureObject,re.ensureTypesInArray=ve.ensureTypesInArray,re.load=function(e){if(e){ae={},ie={},Ge(!0),ve.typeCheck(e,ie);var t=ve.filterNodesAndLinks(e.items,ae);ie=t.links,ae=t.nodes,ve.ensureHiddenItemConsistency(ae,ie),ge=null,F(),xe()}b()},re.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return n.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"c":case"b":return z.colours.midgrey;case"fc":return z.colours.black;case"fbc":return z.colours.textback}},re.bothEndsShown=function(e){return!(ae[e.id1].hi||ae[e.id2].hi)},re.ensureBackgroundConsistency=function(){ve.ensureConsistency("bg",!0,ae,ie)},re.resurrect=function(e,t){m(e,"gh",t)},re.ghost=function(e){y(e,"gh")},re.show=function(e,t){m(e,"hi",t),Ce()},re.hidden=function(){return x("hi")},re.hide=function(e){y(e,"hi"),Ce()},re.each=function(e,t){if(e.type.match(/^(node|all)$/))for(var n in ae)t(ae[n]);if(e.type.match(/^(link|all)$/))for(var r in ie)t(ie[r])},re.setItem=function(e){ve.ensureObject(e,!1,ie);var t=null;return"node"===e.type&&(t=ae),"link"!==e.type||(t=ie,ve.hasValidEnds(e,{},ae))?(ve.setZeroXY(e),e.id&&(t[e.id]=P.clone(e),e.hi?ve.ensureHiddenItemConsistency(ae,ie):r(),Ce(),he(e.id)),b()):!1};var pe=re.type=function(){return"LinkChart"};re.setOptions=function(e){Y=e.marqueeLinkSelection,t.setOptions(e),n.setOptions(e)};var be;re.setLastHoverId=function(e){be=e},re.showFullLabelOnHover=function(e){be&&he(be),e?(he(e),n.setSpecialOptions("showFullLabel",e)):n.setSpecialOptions("showFullLabel",null)},re.serialize=function(){return{type:pe(),items:l()}};var Ie=re.applyChanges=function(e,t){var n,r,a,i,o,s,l;for(n=0;n<e.length;n++){if(r=P.rawId(e[n].id))if(s=[],t){l=new RegExp(r,"im");for(a in ae)l.test(a)&&s.push(ae[a]);for(i in ie)l.test(i)&&s.push(ie[i])}else ae[r]&&s.push(ae[r]),ie[r]&&s.push(ie[r]);var c=P.clone(e[n]);for(delete c.id,delete c.type,o=0;o<s.length;o++){var g=!0,d=s[o],h=c.id1||d.id1,v=c.id2||d.id2,m=h===v;for(var x in c)switch(x){case"x":case"y":d[x]=c[x];break;case"id1":if(!ae[c.id1])throw Error("Unexisting node id '"+c.id1+"' for link property id1");case"id2":if(m)break;if(!ae[c.id2])throw Error("Unexisting node id '"+c.id2+"' for link property id2");default:d[x]=c[x],g=!1}f(d),g?u(d.id):he(d.id)}}};re.unsafeApplyChanges=function(e){var t,n,r,a;for(t=0;t<e.length;t++)for(n=P.rawId(e[t].id),n&&(a=[],ae[n]&&a.push(ae[n]),ie[n]&&a.push(ie[n])),r=0;r<a.length;r++){var i=!0,o=a[r];P.merge(o,e[t]);for(var s in e[t])"id"!==s&&"x"!==s&&"y"!==s&&(i=!1);f(o),i?u(o.id):he(o.id)}},re.setProperties=function(e,t){e=P.ensureArray(e),ve.ensureTypesInArray(e,!1,ie),Ie(e,t),ve.ensureHiddenItemConsistency(ae,ie),Ce();var n=b();return n},re.merge=function(e){ve.ensureTypesInArray(e,!1,ie);var t=ve.filterNodesAndLinks(e,ae,!0);for(var n in t.nodes)ae[n]=P.merge(ae[n],t.nodes[n]),he(n);for(var r in t.links)ie[r]=P.merge(ie[r],t.links[r]),he(r);Ce();var a=p(t.links);Se(a),ve.ensureHiddenItemConsistency(ae,ie);var i=b();return i},re.getItem=function(e){var t=we(e);return P.clone(t,!0)};var we=re.getByID=function(e){return e=P.rawId(e),ae[e]||ie[e]},Be={};re.imageList=function(e){var t={updated:!1,_coList:{}};for(var n in Be)t[e+n]=1;return t};var Ce=re.clearGraphCache=function(){ge&&ge.clearCache()};re.generate=function(e,t,r,a,i){var u=r.getUnzoom();if(u!==X&&xe(),s()){C(),A();var l=n.generate(O,K,le,se,e,t,r,a,i,Le);o(l),X=u}return n.generateHandles(e,t,r,Me),n.animated()},re.contains=function(e){return n.contains(e,ae)},re.animated=function(){return n.animated()};var Ae={},Me=[];re.setSelection=function(e,t,n){e=P.rawId(e),t||n||Ge(e),Ae[e]?t&&De(e):Ze(e)};var Ze=re.addToSelection=function(t,n){t=P.rawId(t),t&&(Ae[t]||h(t)&&(Ae[t]=1,Me.push(t),he(t),n||e.trigger("selectionchange")))},De=re.removeFromSelection=function(t,n){if(t=P.rawId(t),Ae[t]){he(t),delete Ae[t];var r=Me.indexOf(t);r>-1&&Me.splice(r,1),n||e.trigger("selectionchange")}};re.hasSelection=function(){return Me.length>0};var Le=re.isSelected=function(e){return e=P.rawId(e),e in Ae},Ge=re.clearSelection=function(t){for(var n=0;n<Me.length;n++)he(Me[n]);Ae={},Me=[],t||e.trigger("selectionchange")};re.selectAll=function(){Z(ae),Z(ie),e.trigger("selectionchange")};var Re=re.doSelection=function(e){if(e){Ge(!0);for(var t=0;t<e.length;t++)Ze(e[t],!0)}return P.clone(Me)};re.privateSelection=function(){return Ae},re.moveSelection=function(e,t){var n=[];if(Ae){for(var r in ae)Le(r)&&n.push(r);for(var a in ie)Le(a)&&(ae[ie[a].id1].du&&n.push(ie[a].id1),ae[ie[a].id2].du&&n.push(ie[a].id2))}for(var i=0;i<n.length;i++){var o=ae[n[i]];o.x+=e,o.y+=t,u(o.id)}},re.removeItem=function(e){var t;e=P.ensureArray(e);for(var n={},a={},i=0;i<e.length;i++)t=e[i],ie[t]&&(n[t]=ie[t]),ae[t]&&(a[t]=1);for(t in ie)(a[ie[t].id1]||a[ie[t].id2])&&(n[t]=ie[t]);for(t in n)De(t,!0),he(t),delete ie[t];for(t in a)De(t,!0),he(t),delete ae[t];Ce(),Se(n),r()},re.selectionPlusDummyNodes=function(){for(var e=Re(),t=0;t<e.length;t++){var n=ie[e[t]];n&&(ae[n.id1].du&&e.push(n.id1),ae[n.id2].du&&e.push(n.id2))}return e};var Se=re.resetConnectionOffsets=function(e){G(e,k)},Te=function(e,t){var n;return G(e,function(e,r){n=V(e,r,t)}),n};re.showHideBendLinks=function(e){var t=R(e);Se(t)},re.showHideGetLinksToBend=function(e,t){for(var n=R(e),r=Te(n,t),a=[],i=0;i<r.length;i++){var o=r[i];ie[o.id].off!==o.off&&a.push(o)}return a},re.getCursor=function(e,t){var n=U(e);return n?n:e?'url("'+t+'openhand.cur"), pointer':"auto"},re.getResizePrimitive=function(){return n.getResizePrimitive()};var Ee=new RegExp(ce+"((\\S+)(?:\\-resize))$"),ke={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},Ve=new RegExp(ce+"(id[1|2])$");re.startDragger=function(e,n,r,a,i,o){var u=(o+"").match(Ve),s=P.rawId(r);return t.createLinkEndDragger(e,re,n,ae,ie[s],u[1],a,i,s)},re.createDragger=function(n,r,a,o,u,s,l,f){var c=l.handMode,g=P.rawId(o),d=W(o);if(d){var h=N(o),v=f;return t.primitiveMover(z,r,a,g,v,!0,h,u,s,function(t){e.trigger("prechange","resize");var n=ae[P.rawId(o)],r=t.a,a=r?r.x:0,i=r?r.y:0;if("C"===t.p)n.x=a+t.x,n.y=i+t.y,n.w=n.h=2*t.r;else{var u=a+t.x1,s=i+t.y1,l=a+t.x2,f=i+t.y2;n.x=u+Math.floor((l-u)/2),n.y=s+Math.floor((f-s)/2),n.w=l-u,n.h=f-s}he(n.id)})}if(null!==g&&ie[g]&&"h"!==ie[g].st){var m=(o+"").match(Ve);return m?t.createLinkEndDragger(n,re,a,ae,ie[g],m[1],u,s,g):t.createLinkDragger(i,r,a,re,ie[g],u,s,g)}return c&&null===o?t.createHandDragger(a,u,s,Ge):null!==g?(C(),t.createDefaultDragger(re,O,K,Le,a,o,u,s)):Fe(a,u,s)};var Fe=function(t,n,r){function a(e,n){l.x1=Math.min(t.worldToViewX(f),e),l.y1=Math.min(t.worldToViewY(c),n),l.x2=Math.max(t.worldToViewX(f),e),l.y2=Math.max(t.worldToViewY(c),n),g.x1=t.viewToWorldX(l.x1),g.y1=t.viewToWorldY(l.y1),g.x2=t.viewToWorldX(l.x2),g.y2=t.viewToWorldY(l.y2)}function i(e,t,n){for(var r in e)e[r]?Ze(r,!0):t||n?u[r]||De(r,!0):De(r,!0)}function o(e,t,n,r){C(),a(e,t);var o={};for(var u in O)o[u]=z.inside(g,O[u].x,O[u].y);if("off"!==Y)for(var s in K)if("centre"===Y)o[s]=z.inside(g,K[s]._x,K[s]._y);else if("ends"===Y){var l=O[K[s].id1],f=O[K[s].id2];o[s]=z.inside(g,l.x,l.y)&&z.inside(g,f.x,f.y)}i(o,n,r)}if(!e.trigger("dragstart","area",null,t.unscale(n),t.unscale(r),null)){var u={};for(var s in Ae)u[s]=1;var l={p:z.primitives.rect,x1:n,y1:r,x2:n,y2:r,bc:z.colours.midgrey,bw:1,fc:z.colours.blue,fi:!1},f=t.viewToWorldX(n),c=t.viewToWorldY(r),g={x1:f,y1:c,x2:f,y2:c};l.wbc=z.webglColour(l.bc),l.wfc=z.webglColour(l.fc);var d={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){var t=e.getLayer();e.setLayer(z.layers.HANDLES),e.copyPrimitive(l),e.setLayer(t)},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(n,r,a){t.cancelScroll();var i=e.trigger("dragend","area",null,t.unscale(r),t.unscale(a));i||(n?e.trigger("selectionchange"):Ge()),e.trigger("dragcomplete","area",null,t.unscale(r),t.unscale(a))}};return d}};return re.createGestureDragger=function(t,n,r){function a(e,n,r){var a=2*-e*Math.PI/360;a*=2;var i=Math.sin(a),o=Math.cos(a);for(var u in ae){var s=(g[u].x-f)*o+(g[u].y-c)*i+f,l=-(g[u].x-f)*i+(g[u].y-c)*o+c;ye(u,s,l)}var d=t.viewToWorldX(n),h=t.viewToWorldY(r);for(var v in ae)ye(v,ae[v].x+d-f,ae[v].y+h-c)}function i(e){e=Math.pow(e,2),t.zoomToPosition(e*l,n,r)}function o(e,t,n,r){h=e,v=t,m=n,x=r}function u(){i(h),y=y||Math.abs(v)>12,b=b||Math.abs(m-f)>p||Math.abs(x-c)>p,a(y?v:0,b?m:f,b?x:c)}function s(){for(var e in ae)ye(e,g[e].x,g[e].y)}var l=t.zoom(),f=t.viewToWorldX(n),c=t.viewToWorldY(r),g={};for(var d in ae)g[d]={x:ae[d].x,y:ae[d].y};var h,v,m,x;o(1,0,f,c);var y=!1,p=60,b=!1,I={animate:function(){u()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(t,n,r,a,i){o(n,r,a,i),t?(s(),e.trigger("prechange","move"),u()):s()}};return I},re.labelPosition=function(e,t){var r=we(e);return n.labelPosition(r,t)},re.extractStructure=function(e,t,r){return t.straighten&&S(),T(),de.extractStructure(n,e,ae,ie,me,t.fixed,r)},re.layout=function(e,t,n,r,a,i){de.layout(e,t,n,me,r,a,i)},re.arrange=function(e,t,n,r,a,i){de.arrange(e,t,n,r,a,i)},re.applyVertices=function(e){for(var t in ae)e[t]&&ye(t,e[t].x,e[t].y)},re.makeAnimator=function(e,t,n){var r=t,a={};for(var i in ae)a[i]={x:ae[i].x,y:ae[i].y};return H.buildAnimatorInstance(function(i){r-=i;var o=n(Math.max(0,(t-r)/t));for(var u in ae)if(e[u]){var s=a[u].x+o*(e[u].x-a[u].x),l=a[u].y+o*(e[u].y-a[u].y);ye(u,s,l)}return r>0},{all:!0})},re}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateImage=function(t,n,r,a){var i=t.wsc||[0,0,0,0],o=0;if("ci"===t.s&&(o="width"===n.maxDimension?(t.y2-t.y1)/2:(t.x2-t.x1)/2),r.alwaysUpdate||r.rebuildOptions.all||r.rebuildOptions.shadow)for(var u=0;e>u;u++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=i[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=i[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=i[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=i[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(u=0;e>u;u++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255;if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var s=t.x1,l=t.y1,f=t.x2,c=t.y2;a&&(s=t.x1+a.x,l=t.y1+a.y,f=t.x2+a.x,c=t.y2+a.y),r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0}if(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all){var g,d,h,v;o?(d=n.cu1,g=n.cv1,v=n.cu2,h=n.cv2):(d=n.u1,g=n.v1,v=n.u2,h=n.v2),r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o}}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){for(var t,n=!1,r=4096,a=16,i=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"],o=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\xa1\xa2\xa3\xa4\xa5\xa8\xa9\xad\xae\xaf\xb0\xb4\xb7\xb8\u20ac",u={},s=0,l=o.length;l>s;s++)u[o[s]]=!0;e.TextAtlas=function(e,n){var r=e;return t=128,g(r)};var f=function(e){for(var t=0,n=e.length;n>t;t++)for(var r=e[t],a=0,i=r.length;i>a;a++){var s=r[a];u[s]||(o+=s,u[s]=!0)}},c=function(e,t){var r=document.createElement("canvas"),a=r.getContext("2d");if(r.id="webglDebugTextCanvas"+t,r.width=e,r.height=e,a.fillStyle="black",a.fillRect(0,0,e,e),n){var i=document.getElementById(r.id);i?i.parentNode.replaceChild(r,i):document.getElementsByTagName("body")[0].appendChild(r)}return a},g=function(e){var t=Object.keys(e),n=d(t),r={},a=h(r,t,n);return a.getGlyphsFrom=function(e,t,n,a,i){var o=!1,u={},s=[],l=r[t||n],c=0;if(a)for(var g=0,d=e.length;d>g;g++){var h=e[g]+"B",v=l[h];v?s[c++]=v:(u[e[g]]=!0,o=!0)}else for(var g=0,d=e.length;d>g;g++){var v=l[e[g]];v?s[c++]=v:(u[e[g]]=!0,o=!0)}return o&&(f(Object.keys(u)),i.textAtlas=!0),s},a},d=function(e){for(var n=0,r=document.createElement("canvas").getContext("2d"),i=0,u=e.length;u>i;i++){r.font=t+"px "+e[i];for(var s=0;s<o.length;++s){var l=o[s];n+=r.measureText(l).width+a}r.font="bold "+t+"px "+e[i];for(var s=0;s<o.length;++s){var l=o[s];n+=r.measureText(l).width+a}}for(var f=t+a,c=f*n/3,g=256;c/(g*g)>3;)g*=2;return g},h=function(e,n,i){var o,u,s=function(){o=[],u={x:a,y:a,colourComponent:0,textureBank:0};for(var t=0,r=n.length;r>t;t++)e[n[t]]=e[n[t]]||{},x(o,i,e,u,n[t],!1),x(o,i,e,u,n[t],!0)};KeyLines.Util.tryCatch(s,function(e){if(e){if(i*=2,i>r&&(t/=2),32>t)return void console.log("Number of unique text characters exceeded, try reducing the number of fonts or use canvas mode");s()}});for(var l in e)e.hasOwnProperty(l)&&(m(o,e,l,!1),m(o,e,l,!0));for(;u.textureBank<2;){u.textureBank++;var f=c(1,u.textureBank);o[u.textureBank]={img:f.canvas,texture:null}}return{fontSize:t,atlases:o,glyphInfo:e}},v=function(e,t,n){var r=e[t].ctx;return r.font=n,r.globalCompositeOperation="lighter",r},m=function(e,n,r,a){for(var u=n[r],s=a?"B":"",l=a?"bold ":"",f=0;f<o.length;++f){var c=o[f],g=u[c+s];if(g){var d=v(e,g.textureBank,l+t+"px "+r);d.fillStyle=i[g.colourComponent],d.fillText(c,g.x,g.y+.75*t)}}},x=function(e,n,r,u,s,l){var f=e[u.textureBank];if(!f){var g=c(n,u.textureBank);f=e[u.textureBank]={img:g.canvas,ctx:g,texture:null}}var g=f.ctx,d=l?"B":"",h=l?"bold ":"";g.font=h+t+"px "+s,g.fillStyle="black";for(var v=0;v<o.length;++v){var m=o[v],x=g.measureText(m);if(u.x+x.width+a>n){var y=u.y+t+a;if(y+t>n){if(y=a,u.colourComponent<2)u.colourComponent++;else{if(!(u.textureBank<2))throw new Error("Warning: Number of unique text characters exceeded, restarting build with larger Texture");u.colourComponent=0,u.textureBank++,g=c(n,u.textureBank),g.font=h+t+"px "+s,e.push({img:g.canvas,ctx:g,texture:null})}g.fillStyle=i[u.colourComponent]}u.x=a,u.y=y}r[s][m+d]={x:u.x,y:u.y,u1:u.x/n,v1:(u.y+t)/n,u2:(u.x+x.width)/n,v2:u.y/n,colourComponent:u.colourComponent,textureBank:u.textureBank,width:x.width},u.x+=x.width+a}}}}(),function(){"use strict";if(KeyLines.WebGL){var e=6,t=new Float32Array(6);KeyLines.WebGL.generateCircle=function(n,r,a,i,o,u,s,l,f,c){var g;if(f.rebuildOptions.all||f.rebuildOptions.shadow||f.alwaysUpdate)for(o=o||[0,0,0,0],g=0;e>g;g++)f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[0],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[1],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[2],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[3];if(f.rebuildOptions.all||f.rebuildOptions.colours||f.alwaysUpdate)for(g=0;e>g;g++)f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=i[0],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=i[1],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=i[2],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=i[3];(f.rebuildOptions.all||f.rebuildOptions.positions||f.alwaysUpdate)&&(t[0]=2*a,t[1]=0,t[2]=n-a,t[3]=r-a,t[4]=t[2]+t[0],t[5]=t[3]+t[0],c&&(t[2]=t[2]+c.x,t[3]=t[3]+c.y,t[4]=t[4]+c.x,t[5]=t[5]+c.y),f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u),(f.rebuildOptions.all||f.rebuildOptions.textures||f.alwaysUpdate)&&(f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=a)}}}(),function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.createAPI=function(){var e=KeyLines.Common,t=KeyLines.Util,n={},r=KeyLines.Events.createEventBus(),a=KeyLines.TimeBar.Config.create(),i=KeyLines.TimeBar.Model.createModel(r,a),o=KeyLines.TimeBar.Generator.create(),u=KeyLines.TimeBar.Controller.createController(r,i,o,a);n.clear=function(){return i.load({items:[]})},n.getIds=function(e,t){return i.getIds(e,t)},n.load=function(e,t){if(e&&e.items)return i.load(e,t);throw Error("Unknown data format passed")},n.options=function(e,t){return u.options(e,t)},n.pan=function(e,t,n){return u.pan(e,t,n)},n.pause=function(){return u.pause()},n.play=function(e){return u.play(e)},n.range=function(e,t,n,r){return 0!==arguments.length?u.range(e,t,n,r):u.range()},n.merge=function(e,n){return e=t.ensureArray(t.getItemsArray(e)),i.merge(e,n)},n.selection=function(e){return i.selection(e)},n.zoom=function(e,n,r){return e=e||"in",n=t.defaults(n,{animate:!0,time:200,pad:0}),u.zoom(e,n,r)},n.privateInit=u.privateInit,n.privateSetSize=u.privateSetSize,n.getIdcounts=i.getIdcounts,e.appendActions(n,u),t.merge(n,r);var s=KeyLines.Common.frameManager(u.draw,u.animate);return t.merge(n,s),n.bind("redraw",s.redraw),n.getItems=i.getItems,n}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=512,n=4,r=264,a=4,i=!1;e.ImageAtlas=function(e){for(var t=[],n=4,r=4,i=4,u=0,f=l(e),c=o(f),g=1/c,d=s(c,0),h=0,v=f.length;v>h;h++){var m=f[h],x=m.im,y=x.width/m.imageRatio,p=x.height/m.imageRatio;if(n+y+a>c&&(n=0,r+=u+a,u=0),r+p>c&&(i++,r=a,t.push({img:d.canvas,texture:null}),d=s(c,i)),x.u1=n*g,x.v1=r*g,x.u2=(n+y)*g,x.v2=(r+p)*g,x.maxDimension=m.nonSquare,x.textureBank=i,m.nonSquare){var b=x.v2-x.v1,I=x.u2-x.u1;if("width"===m.nonSquare){
var w=b/I,B=(I-I*w)/2;x.cu1=x.u1+B,x.cv1=x.v1,x.cu2=x.u2-B,x.cv2=x.v2}else{var w=I/b,C=(b-b*w)/2;x.cu1=x.u1,x.cv1=x.v1+C,x.cu2=x.u2,x.cv2=x.v2-C}}else x.cu1=x.u1,x.cv1=x.v1,x.cu2=x.u2,x.cv2=x.v2;d.drawImage(x,n,r,y,p),p>u&&(u=p),n+=y+a}for(t.push({img:d.canvas,texture:null}),i++;8>i;){var A=s(1,i++);t.push({img:A.canvas,texture:null})}return t};var o=function(e){for(var t=1,r=a,i=a,o=0,u=1024,s=0,l=e.length;l>s;s++){var f=e[s],c=f.im,g=c.width/f.imageRatio,d=c.height/f.imageRatio;r+g+a>u&&(r=0,i+=o+a,o=0),i+d>u&&(t++,i=a),d>o&&(o=d),r+=g+a}return n>t?1024:4*n>t?2048:4096},u=function(e,n){var a=1,i=!1;return e>r&&(n>0?e>t&&(a=e/t):a=e/r,i=!0),{imageRatio:a,largeImage:i}},s=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.id="webglDebugImageCanvas"+t,n.width=e,n.height=e,i){var a=document.getElementById(n.id);a?a.parentNode.replaceChild(n,a):document.getElementsByTagName("body")[0].appendChild(n)}return r},l=function(e){var t=[],n=2;for(var r in e)if(e.hasOwnProperty(r)&&e[r]&&e[r].im){var a=e._coList[r]?e[r].co:e[r].im,i=a.width>a.height?"width":"height",o=u(a[i],n);o.largeImage&&n>0&&n--,t.push({im:a,size:a[i]/o.imageRatio,imageRatio:o.imageRatio,nonSquare:a.width!==a.height?i:!1})}return t.sort(function(e,t){return e.size-t.size})}}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.create=function(){function t(e,t,r,a,i,o,u,s,l){var f=i[u];if(!(f in r)){if(!(f in a))throw"link has end which is not in nodes list";var c=a[f];if(c.hi)throw"link has end which is hidden";r[f]=n(e,t,c,f,s,l)}return f}function n(e,t,n,r,a,i){return{id:r,x:n.x,y:n.y,size:e.nodeSize(n,t,i),fixed:a?r in a:!1,lc:0,d:n.d}}function r(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}function a(e,r,a,i,o,u,s){for(var l=o().connections({all:!1}),f={},c=[],g=0;g<l.length;g++){var d=l[g][0],h=i[d],v=t(e,r,f,a,h,d,"id1",u,s),m=t(e,r,f,a,h,d,"id2",u,s);null!==v&&null!==m&&(c.push({id1:v,id2:m,id:d}),f[v].lc+=1,f[m].lc+=1)}var x;for(x in a)if(x+="",!a[x].hi&&!f[x]){var y=n(e,r,a[x],x,u,s);f[x]=y}var p=0;for(x in f)p++;return{v:f,e:c,vcount:p}}function i(e,t){var n,r,a,i,u=0,s=[];for(n in e)if(n+="",!e[n].hasOwnProperty("c")){var l=u++;for(s.push(n+"");s.length>0;){var f=s.shift();if(!e[f].hasOwnProperty("c"))for(e[f].c=l,r=0;r<t.length;r++)a=t[r].id1+"",i=t[r].id2+"",a===f&&(t[r].c=l,s.push(i)),i===f&&(t[r].c=l,s.push(a))}}for(var c=new Array(u),g=0;g<c.length;g++)c[g]={verts:{},edges:[]};for(n in e)n+="",c[e[n].c].verts[n]=e[n];for(r=0;r<t.length;r++)c[t[r].c].edges.push(t[r]);for(var d=0;d<c.length;d++)c[d].extents=o(c[d].verts);return c}function o(e){var t,n,r,a,i=0;for(var o in e){var u=e[o+""];t=t?Math.min(t,u.x-u.size):u.x-u.size,n=n?Math.min(n,u.y-u.size):u.y-u.size,r=r?Math.max(r,u.x+u.size):u.x+u.size,a=a?Math.max(a,u.y+u.size):u.y+u.size,i++}return{x1:t,y1:n,x2:r,y2:a,c:i}}function u(e,t,n,r,a){function i(t){var n=t.origId||t.id,r={id:ae+n+"-"+k++,level:t.level-1,origId:n,x:0,y:0,c:t.c,size:10,fixed:!1,lc:t.lc,du:!0};return e[r.id]=r,a[t.c].verts[r.id]=r,V[r.id]=1,r}function o(e,n,r){var i={id:ae+n.id+"-"+r.id,id1:n.id,id2:r.id,c:e.c};return"level"in n&&"level"in r&&(i.level=Math.max(n.level,r.level)),t.push(i),a[e.c].edges.push(i),i}function u(e,t,n){var r=i(e),a=n.id1===t.id;o(n,a?r:e,a?e:r),r.level===t.level+1?o(n,a?t:r,a?r:t):u(r,t,n)}for(var s,l,f,c=[],g={},d={},h={},v=r(),m=0;m<a.length;m++){g[m]={},d[m]=[];var x=[],y=1/0;for(l in a[m].verts)l=ne.rawId(l),s=a[m].verts[l],s.d&&ne.isNumber(s.d[n])&&(f=s.d[n],g[m][f]||(g[m][f]=[],d[m].push(f)),g[m][f].push(l),h[l]=f,y>f?(y=f,x=[l]):f===y&&x.push(l));if(0===x.length)for(l in a[m].verts){l+="",x.push(l),h[l]=0,g[m][0]=[l],d[m].push(0);break}d[m].sort(function(e,t){return e-t});var p,b=[];for(p=0;p<d[m].length;p++){var I=d[m][p];b=[];var w,B,C=v.neighbours(g[m][I]),A=d[m][p+1]||I+1,M=(A+I)/2;for(B=0;B<C.nodes.length;B++)w=C.nodes[B],ne.isNullOrUndefined(h[w])&&(b.push(w),h[w]=M);b.length&&(d[m].splice(p+1,0,M),g[m][M]=b)}for(p=0;p<d[m].length;p++)g[m][d[m][p]]=p;for(p=0;p<x.length;p++)e[x[p]].level=0;c=c.concat(x)}for(var Z,D,L,G,R,S,T,E,k=0,V={},F=0,W=t.length;W>F;F++){Z=t[F],D=ne.rawId(Z.id1),L=ne.rawId(Z.id2),G=e[D],R=e[L];var N=G.level=g[G.c][h[D]],U=R.level=g[R.c][h[L]];ne.isNumber(N)&&ne.isNumber(U)&&(Z.level=Math.max(N,U),U>N?(V[R.id]=1,E=G,T=R):N>U&&(V[G.id]=1,E=R,T=G)),S=Math.abs(N-U),S>1&&u(T,E,Z)}var O=ne.makeIdMap(c);for(l in e)if(l=ne.rawId(l),s=e[l],!V[l]&&!O[l]){for(var K,X=1/0,Y=0;Y<c.length;Y++){var H=v.shortestPaths(l,c[Y]);H.distance<X&&(K=H,X=H.distance)}for(var z=0;z<K.onePath.length;z++){var P=K.onePath[z],_=e[P];if(_&&"level"in _&&_.level<s.level){var j=o(s,s,_);s.level-_.level>1&&u(s,_,j);break}}}return t}function s(e,t,n,r){for(var a,i,o,u,s=r(),l=0;l<n.length;l++){var f=s.distances(n[l]);for(var c in f)c+="",e[c].hasOwnProperty("level")||(e[c].level=1/0),e[c].level=Math.min(e[c].level,f[c])}for(var g=0;g<t.length;g++)a=t[g].id1+"",i=t[g].id2+"",o=e[a],u=e[i],o.hasOwnProperty("level")&&u.hasOwnProperty("level")&&(t[g].level=Math.max(o.level,u.level))}function l(e,t){function n(e,t,n,a){r[e]=r[e]||[],r[e][t]=r[e][t]||{},r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(a)}var r={};for(var a in e)a+="",e[a].hasOwnProperty("level")&&n(e[a].c,e[a].level,"vertices",a);for(var i=0;i<t.length;i++)t[i].hasOwnProperty("level")&&n(t[i].c,t[i].level,"edges",t[i]);return r}function f(e,t){for(var n=[],r=0;r<e.length;r++)t[e[r]]&&n.push(e[r]);return n}function c(e){var t=Number(e);return t=ne.isNumber(t)?t:5,t=Math.max(0,t),t=Math.min(10,t)}function g(e){return 10*(5-c(e))}function d(e){var t,n=0,r=0,a=new RegExp("^"+ae);for(var i in e)i+="",t=e[i],"level"in t&&!a.test(t.id)&&(n+=t.size,r+=1);return n/r}function h(e){var t=0;for(var n in e)t=Math.max(t,e[n].length);return t}function v(e,t,n){for(var r=[],a=h(e),i=0;a>i;i++){var o=0,u=0,s=0,l=0,f=0;for(var c in e)if(e[c][i]){for(var g=e[c][i].vertices,d=0;d<g.length;d++){var v=g[d],m=t[v].size;u+=m,o=Math.max(o,m)}l+=g.length}s=u/l;var x=r[i-1];x&&o<x.max+x.yOffset&&(f=(x.max+x.yOffset)/2),n&&(f=Math.max(o,f)),r[i]={max:o,average:s,sum:u,yOffset:f}}return r}function m(e,t,n,r,a,o){function c(){var e,t,n,r=0,a=0;for(t in k)for(var i=k[t].length-1;i>=0;i--)for(var o=k[t][i].vertices,u=[],s=0;s<o.length;s++){n=o[s]+"";var l=x(k,L,n);if(L[n].children=[],L[n].subChildrenCount=0,0===l.length)r++;else{var f=[];for(e=0;e<l.length;e++)u.indexOf(l[e])<0&&f.push(l[e]);if(f.length>0)for(L[n].children=f,L[n].subChildrenCount=h(f),e=0;e<f.length;e++)u.push(f[e]),L[f[e]].parent=n}a++}}function h(e){for(var t=0,n=0;n<e.length;n++){var r=L[e[n]].subChildrenCount;t+=0===r?1:r}return t}function m(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*W/2,a=e.children;if(a)for(var i=0;i<a.length;i++){var o=L[a[i]],u=o.subChildrenCount;0===u&&(u=1);var s=r+u*W;m(o,(s+r)/2,!1),r=s}}function y(e,t,n){for(var r,a=t.miny,i=Math.PI*(2/3),o=0,u=0;u<k[e].length;u++){var s=k[e][u].vertices,l=F[u].yOffset,f=F[u].average,c=f>V?f:V,g=2*(c+12)+l;a+=o;for(var d=0;d<s.length;d++){r=s[d];var h=L[r];if(h.y=a,!n){var v=h.children;if(v&&v.length>1){var m=v.map(function(e){return L[e]}),x=b(m),y=p(x,i);g=Math.max(g,y)}}}o=g}}function p(e,t){return e/(2*Math.tan(t/2))}function b(e){for(var t=1/0,n=-(1/0),r=0;r<e.length;r++){var a=e[r].x;t=Math.min(t,a),n=Math.max(n,a)}return n-t}function I(e,t){for(var n,r={up:function(e){e.y=-e.y,e.x=e.x},down:function(e){},right:function(e){var t=e.y;e.y=e.x,e.x=t},left:function(e){var t=e.y;e.y=e.x,e.x=-t}},a=r[t]||r.down,i=0;i<k[e].length;i++)for(var o=k[e][i].vertices,u=0;u<o.length;u++)n=o[u]+"",a(L[n])}r=ne.defaults(r,{top:[],orientation:"down",stable:!0,flatten:!1});var w=r.level,A=o?1:g(r.tightness),M=r.top,Z=r.tidy,D=o?!1:r.flatten,L=t.v,G=t.e,R=t.extents,S=i(L,G);w?G=u(L,G,w,n,S):(M=f(M,L),s(L,G,M,n));var E=/^(left|right)$/.test(r.orientation),k=l(L,G),V=d(L),F=v(k,L,E),W=2*V+24+A;c();var N,U={},O={};for(N in k){var K=Number(N);U[K]=T(S[K].verts),O[K]={children:k[N][0].vertices,subChildrenCount:h(k[N][0].vertices)}}for(N in k)m(O[N],U[N].x,!0),y(N,U[N],D);for(N in k)o||I(N,r.orientation);o&&o(L,k,S,U,V,r.tightness);var X=[];Z?B(e,L,S,0,1,R,X,r,a):C(e,L,R,X,r,a)}function x(e,t,n){var r,a,i,o,u=t[n].c,s=t[n].level+1,l=e[u][s],f={},c=[];if(l){for(i=0;i<l.edges.length;i++){var g=l.edges[i];r=g.id1+"",a=g.id2+"",r===n&&(f[a]=1),a===n&&(f[r]=1)}var d=l.vertices;for(o=0;o<d.length;o++)r=d[o]+"",f[r]&&c.push(r)}return c}function y(e,t,n,r,a,i){function o(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function s(e,t,n,r){if(r&&1===e.length)return 0;var a=t,i=a;for(l=1;l<e.length;l++)i=Math.max(o(d[e[l]],d[e[l-1]]),i);return u(i,i-a,n)}var l,f,c,d;i=g(i);for(var h in t){var v=T(n[Number(h)].verts),m=0,x=m,y=4*a,p=y,b=2*a+24;for(f=0;f<t[h].length;f++){var I,w=t[h][f].vertices;for(d=[],l=0;l<w.length;l++){c=w[l]+"",I=e[c];var B=I.x-v.minx,C=v.maxx-v.minx+b;if(B*=2*Math.PI/C,0>B||B>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");d[c]={a:B,r:I.size}}for(x=m,0===f?w.length>1&&(m+=y/2):m+=y,m=s(w,m,i,1>f),m-x>p&&(p=m-x+1,y=Math.max(y,p/2),0===f&&w.length<3&&(m/=2)),l=0;l<w.length;l++)I=e[w[l]+""],I.x=r[Number(h)].x+m*Math.cos(d[I.id].a),I.y=r[Number(h)].y+m*Math.sin(d[I.id].a)}}}function p(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),a=120*Math.sqrt(n),i=Math.max(r,a)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var u=o*n*Math.log(n),s=1/b(t);return{repulsionFactor:40*Math.max(1,Math.pow(s,2)),coeff:1,naturalDistance:20*s,iterations:o,chunk:20,temperature:i,temp:i,estTime:u}}function b(e){var t=c(e.tightness);return Math.pow(2,2*(t-5)/5)}function I(e,t,n,r){function a(t){var n=f[t],r=y[t];L(e,n,r,r.start,r.stop,function(){R(n.verts),t++,t<f.length?ne.nextTick(function(){a(t)},0):o()})}function o(){d?B(e,u,f,x,1,c,g,n,r):C(e,u,c,g,n,r)}var u=t.v,s=t.vcount,l=t.e,f=i(u,l),c=t.extents,g=n.fixed||[],d=n.tidy;S(u);var h=f.length,v=s/(s+h),m=0,x=d?v:1;e.trigger("progress","layout",0);for(var y=[],b=0,I=0;I<f.length;I++){var w=p(f[I],n);b+=w.estTime,y.push(w)}var A=0;for(I=0;I<f.length;I++){y[I].start=A;var M=A+(x-m)*y[I].estTime/b;y[I].stop=M,A=M}f.length>0?a(0):C(e,u,c,g,n,r)}function w(e){for(var t in e)if(t+="",e[t].fixed)return!0;return!1}function B(e,t,n,r,a,i,o,u,s){for(var l={},f=[],c={},g=1/0,d=1/0,h=0;h<n.length;h++){var v=E(n[h].verts);l[h]=v;var m=o.length>0&&w(n[h].verts);f.push({x:v.x,y:v.y,width:v.width,height:v.height,id:h,fixed:m}),c[h]={x:v.x,y:v.y},g=Math.min(g,c[h].x),d=Math.min(d,c[h].y)}u=ne.defaults(u,{strategy:"rect",ratio:4/3}),J(f,{strategy:u.strategy,step:30,max:2,sort:!1,ratio:u.ratio,tightness:u.tightness},function(n){g="rect"===u.strategy?g:0,d="rect"===u.strategy?d:0;for(var r={},a=0;a<n.length;a++)r[n[a].id]=n[a],r[n[a].id].x+=g,r[n[a].id].y+=d;for(var l in t){var f=t[l+""],h=r[f.c].x-c[f.c].x,v=r[f.c].y-c[f.c].y;f.x+=h,f.y+=v}C(e,t,i,o,u,s)})}function C(e,t,n,r,a,i){var u=o(t);0===r.length&&(u=G(t,n,u)),ne.isNumber(u.x1)||(u=null),e.trigger("progress","layout",1),i({vertices:t,extents:u},a)}function A(e,t,n){var r=e[t.id1],a=e[t.id2];M(r,a,n)}function M(e,t,n){if(!e.fixed||!t.fixed){var r=2*ie.next()*Math.PI,a=(e.x+t.x)/2,i=(e.y+t.y)/2,o=1.3*k(e,t,n)/2;e.x=a+o*Math.cos(r),e.y=i+o*Math.sin(r),r+=Math.PI,t.x=a+o*Math.cos(r),t.y=i+o*Math.sin(r)}}function Z(e,t,n,r){var a={temperature:10,i:0},i={verts:t.v,edges:t.e},u=p(t,n);u.chunk=u.iterations=5,a.temperature=Math.pow(u.temperature,.72),D(a,i,u);var s=o(i.verts);ne.isNumber(s.x1)||(s=null),e.trigger("progress","layout",1),r({vertices:i.verts,extents:s},n,!1)}function D(e,t,n){for(var r=Math.min(e.i+n.chunk,n.iterations);e.i<r;){var a=t.verts,i=t.edges,o=0;for(var u in a)u+="",a[u].dx=a[u].dy=0,o++;if(S(a,2),1===o)return void(e.i=r);if(2===o){if(i[0])A(a,i[0],n.naturalDistance);else{var s=ne.dictValues(a);M(s[0],s[1],n.naturalDistance)}return void(e.i=r)}W(a,n.repulsionFactor);for(var l=0;l<i.length;l++)V(i[l],a,n.naturalDistance,n.coeff);var f=e.temperature*(1-e.i/n.iterations);for(var c in a)c+="",F(a[c],f);e.i++}}function L(e,t,n,r,a,i){function o(){return r+(a-r)*f.i/n.iterations}function u(){return f.i>=n.iterations}function s(){D(f,t,n)}function l(){s(),u()?i():(e.trigger("progress","layout",o()),ne.nextTick(l,0))}var f={i:0,temperature:n.temperature};l()}function G(e,t,n){var r=(n.x1+n.x2)/2-(t.x1+t.x2)/2,a=(n.y1+n.y2)/2-(t.y1+t.y2)/2;for(var i in e)i+="",e[i].x-=r,e[i].y-=a;return{x1:n.x1-r,y1:n.y1-a,x2:n.x2-r,y2:n.y2-a}}function R(e){var t,n,r,a,i=0,o=0,u=0,s=!1,l=0,f=0;for(a in e)a+="",i+=e[a].x,o+=e[a].y,u+=1,s|=e[a].fixed;if(!(3>u||s)){i/=u,o/=u;for(a in e)a+="",t=Math.sqrt((e[a].x-i)*(e[a].x-i)+(e[a].y-o)*(e[a].y-o)),t>f&&(f=t,l=Math.atan2(e[a].y-o,e[a].x-i));l=-l;var c=Math.sin(l),g=Math.cos(l);for(a in e)n=i+(e[a].x-i)*g-(e[a].y-o)*c,r=o+(e[a].x-i)*c+(e[a].y-o)*g,e[a].x=n,e[a].y=r}}function S(e,t){var n=t||30;for(var r in e)r+="",e[r].fixed||(e[r].x+=n*(ie.next()-.5),e[r].y+=n*(ie.next()-.5))}function T(e){var t,n=0,r=0,a=0,i=1/0,o=1/0,u=-(1/0),s=-(1/0);for(t in e)t+="",n+=1,r+=e[t].x,a+=e[t].y,o=Math.min(o,e[t].x),i=Math.min(i,e[t].y),u=Math.max(u,e[t].x),s=Math.max(s,e[t].y);r/=n,a/=n;var l=0,f=!1;for(t in e){t+="";var c=e[t].x-r,g=e[t].y-a,d=Math.sqrt(c*c+g*g);l=Math.max(d+1.5*e[t].size,l),f=f||e[t].fixed}return{x:r,y:a,sum:n,size:l,fixed:f,miny:i,minx:o,maxy:s,maxx:u}}function E(e,t){ne.isNullOrUndefined(t)&&(t={});var n,r=20,a=1/0,i=1/0,o=-(1/0),u=-(1/0);for(n in e)n+="",n in t||(i=Math.min(i,e[n].x-e[n].size),a=Math.min(a,e[n].y-e[n].size),o=Math.max(o,e[n].x+e[n].size),u=Math.max(u,e[n].y+e[n].size));return i-=r,a-=r,o+=r,u+=r,{x:i,y:a,width:o-i,height:u-a}}function k(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function V(e,t,n,r){var a=t[e.id1],i=t[e.id2],o=a.x-i.x,u=a.y-i.y,s=k(a,i,n),l=ne.len(o,u);if(l>.02){var f=r*(l-s)/l,c=o*f,g=u*f;a.dx-=c,a.dy-=g,i.dx+=c,i.dy+=g}}function F(e,t){if(!e.fixed){var n=ne.len(e.dx,e.dy),r=e.dx/n*Math.min(n,t),a=e.dy/n*Math.min(n,t);e.x+=r,e.y+=a}}function W(e,t){function n(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function r(e,t){var r=e.x1,i=e.y1,o=e.x2,u=e.y2,s=.5*(r+o),l=.5*(i+u),f=t.x>=s,c=t.y>=l,g=(c<<1)+f;e.leaf=!1,f?r=s:o=s,c?i=l:u=l,e=e.nodes[g]||(e.nodes[g]=n(r,i,o,u)),a(e,t)}function a(e,t){if(e.leaf){var n=e.point;n?Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01?r(e,t):(e.point=null,r(e,n),r(e,t)):e.point=t}else r(e,t)}function i(e,t){if(!e(t))for(var n=t.nodes,r=0;4>r;r++)n[r]&&i(e,n[r])}function o(e){var t=0,n=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,a=0;4>a;a++){var i=r[a];i&&(o(i),e.charge+=i.charge,e.size+=i.size,t+=i.charge*i.cx,n+=i.charge*i.cy)}if(e.point){var u=l(e.point);e.charge+=e.pointCharge=u,e.size+=e.point.size,t+=u*e.point.x,n+=u*e.point.y}e.cx=e.charge?t/e.charge:0,e.cy=e.charge?n/e.charge:0}function u(e){if(e.point!==p){var t=e.cx-p.x,n=e.cy-p.y,r=1/ne.len(t,n);if((e.x2-e.x1)*r<b)return s(p,e,e.charge,r,t,n),w++,!0;e.point&&(s(p,e.point,e.pointCharge,r,t,n),I++)}return!e.charge}function s(e,t,n,r,a,i){r>B&&(r=B),f(e,n,a,i,r)}function l(e){return e.size*(1+(e.lc?e.lc:1)/3)}function f(e,n,r,a,i){if(!(.001>i)){var o=t*l(e)*n*i*i*i;e.dx-=r*o,e.dy-=a*o}}function c(){for(var t in e)t+="",p=e[t],i(u,C)}var g,d,h,v,m=T(e);g=m.minx,h=m.miny,d=m.maxx,v=m.maxy;var x=d-g,y=v-h;x>y?v=h+x:d=g+y;var p,b=.5,I=0,w=0,B=1e5,C=n(g,h,d,v);for(var A in e)A+="",a(C,e[A]);return o(C),c(),C}function N(e,t,n,r,a,i){r?e[t]=n[t]:e[t]={x:a,y:i}}function U(e,t,n,r){var a=1.25-(c(n.tightness)-5)/10,i=K(t.v,t.e),o=O(i,t.v,a);I(e,o,n,function(e,n,a){var o={};for(var u in e.vertices)if(u+="",i.rev[u])for(var s=e.vertices[u].fixed,l=0;l<i.rev[u].length;l++){var f=i.rev[u][l],c=e.vertices[u].x,g=e.vertices[u].y;e.vertices[u].jit.positions&&(c+=e.vertices[u].jit.positions[f].x,g+=e.vertices[u].jit.positions[f].y),N(o,f,t.v,s,c,g)}else N(o,u,t.v,t.v[u].fixed,e.vertices[u].x,e.vertices[u].y);var d={vertices:o,extents:e.extents};r(d,n,a)})}function O(e,t,n){var r={},a=[],i=0;for(var u in e.rev){u+="";var s={};s.x=s.y=s.size=0;for(var l=e.rev[u].length,f=!1,c=0;l>c;c++){var g=t[e.rev[u][c]];s.x+=g.x,s.y+=g.y,s.size+=g.size}s.x=s.x/l,s.y=s.y/l;var d=P(t,e.rev[u],s.size/l,n);r[u]={x:s.x,y:s.y,size:d.radius,fixed:f,jit:d,lc:0},i++;for(var h=e.rev[u][0],v={},m=e.index[h],x=0;x<m.length;x++){var y=m[x];v[e.ids[y]]=1}for(var p in v)p+="",p>u&&a.push({id1:u,id2:p})}for(var b,I,w=0;w<a.length;w++)b=a[w].id1+"",I=a[w].id2+"",r[b].lc++,r[I].lc++;for(var B in t)if(B+="",!e.ids[B]){var C=t[B];r[B]={x:C.x,y:C.y,size:C.size,lc:0,fixed:C.fixed,jit:{radius:C.size,position:{x:0,y:0}}},i++}return{v:r,e:a,vcount:i,extents:o(r)}}function K(e,t){var n=H(t);return z(n)}function X(e,t,n){e[n]||(e[n]=[]),e[n].push(t)}function Y(e,t){X(e,t.id1,t.id2),X(e,t.id2,t.id1)}function H(e){for(var t={},n=0;n<e.length;n++)Y(t,e[n]);return t}function z(e){var t,n={},r={};for(var a in e){a+="",e[a].sort(),t="";for(var i=0;i<e[a].length;i++)t+=e[a][i];n[t]||(n[t]=[]),n[t].push(a),r[a]=t}return{rev:n,ids:r,index:e}}function P(e,t,n,r){var a,i={},o=0,u=t.length-1;do a=_(e,t,n,u,i,r),o=Math.max(a.radius,o),u=a.index;while(u>=0);var s;switch(t.length){case 4:s=2;break;case 3:s=2.5;break;case 2:s=3;break;case 1:s=1;break;default:s=2}return{positions:i,radius:o*s}}function _(e,t,n,r,a,i){if(0===r)return a[t[0]]={x:0,y:0},{radius:n,index:-1};var o=(r+1)*n,u=n,s=Math.sqrt(o/(Math.PI*u)),l=s*u,f=Math.floor(2*Math.PI*l/n);f=Math.min(f,r+1);var c=2*Math.PI/f,g=0;switch(f){case 2:g=Math.PI/2,l=.75*l;break;case 3:g=Math.PI/3,l=.85*l;break;case 4:g=0,l=.85*l;break;case 5:g=0,l=.9*l;break;default:g=0}l*=i;for(var d=0;f>d;)a[t[r-d]]={x:l*Math.cos(g),y:l*Math.sin(g)},g+=c,d++;return r-=f,{radius:l,index:r}}function j(e,t,n,r){var a,i=0,o={};for(a=0;a<t.length;a++)i+=e[t[a]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var u=Math.PI/4;2===t.length&&(u=Math.PI/2),4===t.length&&(u=0),t.length<4&&(i=1.5*i);var s=2*Math.PI/t.length,l=r*i/4;for(a=0;a<t.length;a++)o[t[a]]={x:l*Math.cos(u),y:l*Math.sin(u)},u+=s}return{positions:o,radius:i}}function J(e,t,n){function a(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function i(e,t,n){return(t-e)*n+e}function o(e,t,n){return(e-n)/(t-n)}function u(e){var n=function(){for(var t=0,n=-(1/0),r=0;r<e.length;r++)t+=e[r].width*e[r].height,n=Math.max(n,e[r].width);return{area:t,maxWidth:n}},r=1.1,a=1.03,i=10,o=n(),u=Math.sqrt(o.area*r/t.ratio)*a,s=u*t.ratio;return s<o.maxWidth+i&&(s=o.maxWidth+i),{x:0,y:0,width:s,height:u}}function s(e,t,n,r,a,u){var s=o(t,n,r);return s=Math.pow(s,e),i(u,a,s)}function l(e,t){if(!t)return!1;var n=e.x<m.x+m.width,r=e.x+e.width>m.x,a=e.y<m.y+m.height,i=e.y+e.height>m.y;return n||r&&a||i}function f(e,t){function n(e,t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(e,t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}if(t.length<1)return!1;var a,i;for(a=0;a<t.length;a++)if(i=t[a],r(e,i)&&n(e,i))return!0;return!1}var c,g,d,h={spiral:function(e){var t=s(.6,e,100,0,p,1),n=s(1,e,600,0,.3,.5),r=n*e,a=Math.cos(r)*t,i=Math.sin(r)*t;return{x:a,y:i}},controlled:function(e,t){for(var n;!l(t,n);)n=h.random(e);return n},rect:function(e){return Q(e,t,n)},random:function(e){var t=.5*e;return{x:a()*t,y:a()*t}}},v=0,m=u(e),x=[],y=h[t.strategy]||h.rect,p=0;for(c=0;c<e.length;c++)g=e[c],p+=g.width;if(p/=2*e.length,"rect"===t.strategy)return y(e);for(e.sort(r),c=0;c<e.length;c++){for(g=e[c],g.x=g.fixed?g.x:0,g.y=g.fixed?g.y:0;f(g,x)&&!g.fixed;)d=y(v,g),g.x=d.x,g.y=d.y,v++;x.push(g)}return n(x)}function Q(e,t,n){function a(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function i(e,t){var n=r(e,t);return n?n:t.height-e.height}function o(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function u(e){for(var n=ne.clone(e),r=0;r<n.length;r++){var a=n[r].width%t.step,i=n[r].height%t.step;0!==a&&(n[r].width=n[r].width+(t.step-a)),0!==i&&(n[r].height=n[r].height+(t.step-i))}return n}function s(e){return h?e.ratio()>=t.ratio-.2&&e.ratio()<=t.ratio:!0}function l(e){for(var n=g(t.tightness),r=0;r<e.length;r++)e[r].width+=n,e[r].height+=n}function f(e,n){var r=1.1,a=1.03,i=10,o=Math.sqrt(e.area()*r/t.ratio)*a,u=o*t.ratio;return u<e.maxWidth+i&&(u=e.maxWidth+i),{width:u,height:o,lowestFreeHeightDeficit:0,ratio:function(){return m.width/m.height}}}t=ne.defaults(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),t.sort&&e.sort(i),l(e);var c,d=u(e),h=!0;if(0===e.length)return c=$(),n(c.comps);var v={area:a,maxWidth:o(d),maxHeight:d[0].height},m=f(v,d),x=0;ne.asyncWhile(function(){return m.width>=v.maxWidth},function(){var e=q(d,m);if(0===e.comps.length)m.width*=1.03,m.height*=1.03;else{if(x++,(!c||s(e))&&(c=e,c.efficiency=v.area()/e.area(),s(e)))return!0;if(x>=t.max)return!0}},function(){return n(c.comps)})}function q(e,t){var n,r=$();t.canvas||(t.canvas=ee());for(var a=t.canvas.setDimensions(t.width,t.height),i=0,o=0,u=0;u<e.length;u++){var s=e[u];if(n=a.addRect(s.width,s.height),!n.placed){r.width=0,r.height=0,r.comps.length=0,r.lowestHeightFlushedRightItem=0;break}s.x=n.offsetX,s.y=n.offsetY,r.comps.push(s),s.y+s.height>r.height&&(r.height=s.y+s.height),s.x+s.width>r.width&&(r.width=s.x+s.width);var l=s.width+s.x;(l>o||l===o&&s.height>i)&&(r.lowestHeightFlushedRightItem=n.lfhd,i=s.height,o=l)}return t.lowestFreeHeightDeficit=a.lfhDeficitSinceLastRedim(),r}function $(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function ee(){function e(e,t){var n=f.height-e;return t-n}function t(e,t,n){if(n.leftOverW>0){f.cells+=s.rows();var r=e+n.nRequiredCellsH-1;s.insertCol(r,n.leftOverW)}if(n.leftOverH>0){f.cells+=s.cols();var a=t+n.nRequiredCellsV-1;s.insertRow(a,n.leftOverH)}for(var i=e+n.nRequiredCellsH-1;i>=e;i--)for(var o=t+n.nRequiredCellsV-1;o>=t;o--)s.setItem(i,o,!0)}function n(e,t,n,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var a,i=0,o=0,u=t;o<n.height;){for(a=e,i=0;i<n.width;){if(s.item(a,u))return!1;i+=s.colWidth(a),a++}o+=s.rowHeight(u),u++}return r.nRequiredCellsH=a-e,r.nRequiredCellsV=u-t,r.leftOverW=i-n.width,r.leftOverH=o-n.height,!0}function r(e,t,n){var r=0,a=0,i=0,o=0,u=0;for(i=0;e>i;i++)r+=s.colWidth(i);for(i=0;t>i;i++)a+=s.rowHeight(i);if(o=n.x-r,u=n.y-a,0>o||0>u)return!1;if(o>0){f.cells+=s.rows();var l=s.colWidth(e)-o;s.insertCol(e,l)}if(u>0){f.cells+=s.cols();var c=s.rowHeight(t)-u;s.insertRow(t,c)}return!0}function a(e,t){return f.width=e,f.height=t,f.area=o(),s.init(e,t,!1),f}function i(a,i,o){var u={offsetX:0,offsetY:0,width:a,height:i,placed:!1},c=0,g=0,d=0,h=0,v={};if(o){for(;c<s.cols()&&d<o.x;)d+=s.colWidth(c),c++;for(;g<s.rows()&&h<o.y;)h+=s.rowHeight(g),g++;r(c-1,g-1,o),d-=s.colWidth(c),h-=s.rowHeight(g)}f.addAttempts++;for(var m=oe;;){for(v={};g<s.rows()&&s.item(c,g);)h+=s.rowHeight(g),g++;if(g<s.rows()&&e(h,u.height)<=0){if(n(c,g,u,v)){t(c,g,v),u.offsetX=d,u.offsetY=h,u.placed=!0;break}h+=s.rowHeight(g),g++}var x=e(h,u.height);if(x>0&&(h=0,g=0,d+=s.colWidth(c),c++,f.lfhDeficitSinceLastRedim()>x&&(l=x)),f.width-d<u.width){u.placed=!1;break}}return m=l,{offsetX:u.offsetX,offsetY:u.offsetY,lfhd:m,placed:u.placed}}function o(){return f.width*f.height}var u=0,s=te(),l=oe,f={matrix:s,cells:u,addAttempts:0,addRect:i,lfhDeficitSinceLastRedim:function(){return l},setDimensions:a};return f}function te(){function e(){(i.length>0||o.length>0)&&(i.length=o.length=u.length=0)}function t(t,n,r){if(0>=t)throw"[Matrix] Column size cannot be 0 or similar";if(0>=n)throw"[Matrix] Row size cannot be 0 or similar";return s=1,l=1,e(),i.push({index:0,size:t}),o.push({index:0,size:n}),u[0]=[],u[0][0]=r,f}function n(e,t){for(var n=o[e].index,r=0;l>r;r++)u[r][s]=u[r][n];return s-1>e&&o.splice(e+1,0,{index:s,size:t}),o[e+1]={index:s,size:t},o[e].size-=t,s++,f}function r(e,t){var n=(u[0].length,i[e].index);return u[l]=ne.clone(u[n]),l-1>e&&i.splice(e+1,0,{index:l,size:t}),i[e+1]={index:l,size:t},i[e].size-=t,l++,f}function a(){var e,t,n,r="\n     ",a=0,u=0;for(a=0;l>a;a++)e=Math.floor(i[a].size/100)%10===0?" ":""+Math.floor(i[a].size/100)%10,t=Math.floor(i[a].size/10)%10===0&&" "===e?" ":""+Math.floor(i[a].size/10)%10,n=Math.floor(i[a].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(i[a].size)%10,r+=i[a].size>999?" "+i[a].size+" ":" "+e+t+n+" ";for(r+="\n",a=0;s>a;a++){for(e=Math.floor(o[a].size/100)%10===0?" ":""+Math.floor(o[a].size/100)%10,t=Math.floor(o[a].size/10)%10===0&&" "===e?" ":""+Math.floor(o[a].size/10)%10,n=Math.floor(o[a].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(o[a].size)%10,r+=o[a].size>999?" "+o[a].size+": ":" "+e+t+n+": ",u=0;l>u;u++)r+=f.item(u,a)?"  X  ":"  .  ";r+="\n"}return r}var i=[],o=[],u=[],s=0,l=0,f={init:t,cols:function(){return l},rows:function(){return s},item:function(e,t){return u[i[e].index][o[t].index]},setItem:function(e,t,n){u[i[e].index][o[t].index]=n},insertRow:n,insertCol:r,colWidth:function(e){return i[e].size},rowHeight:function(e){return o[e].size},inspect:a};return f}var ne=KeyLines.Util;e.createLens(c);var re={},ae=(re.extractStructure=function(e,t,n,r,i,u,s){var l=null;if(u){l={};for(var f=0;f<u.length;f++)l[u[f]]=1}var c=a(e,t,n,r,i,l,s);return c.extents=o(c.v),c},"_dummy"),ie=ne.Randomiser();re.layout=function(t,n,r,a,i,o){n.trigger("prechange","layout");var u="^(standard|hierarchy|lens";u+="|radial|structural|tweak",u+=")$";var s=new RegExp(u);if(!s.test(t))throw new Error("The layout name is not valid.");var l=ne.makeIdMap(["standard","structural"]);if(ie.setSeed(null),l[t]||i.consistent){var f,c=ne.ensureArray(i.fixed||[]),g=ne.makeIdMap(i.fixed),d=0,h=0;if(c.length){for(f in g)f in r.v&&(d+=r.v[f].x,h+=r.v[f].y);d/=c.length,h/=c.length}for(f in r.v)g[r.v[f].id]||(r.v[f].x=d,r.v[f].y=h)}i.consistent&&ie.setSeed(900736044081),"standard"===t&&I(n,r,i,o),"hierarchy"===t&&m(n,r,a,i,o),"lens"===t&&e.lens(n,r,i,C,ie,o),"structural"===t&&U(n,r,i,o),"radial"===t&&m(n,r,a,i,o,y),"tweak"===t&&Z(n,r,i,o)};re.arrange=function(e,t,n,r,a,o){function u(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function s(e,t,n,r,a){var i;for(i=0;i<e.length;i++)if(e[i].id===t){e[i].x=n-e[i].width/2,e[i].y=r-e[i].height/2;break}return a(e)}function l(e,t,n,r,i){var o={},u=[],s={};for(c=0;c<e.length;c++)s=E(e[c].verts,t),isFinite(s.width)&&(u.push({x:s.x,y:s.y,width:s.width,height:s.height,id:c}),o[c]={x:s.x,y:s.y});s=E(t),u.push({x:s.x,y:s.y,width:s.width,height:s.height,id:x}),o[x]={x:s.x,y:s.y},b(u,{ratio:a.ratio,centre:n,absolute:r,specialId:x},function(e){return i({packed:e,original:o})})}function f(e,t,n){var r,a;for(var i in e){var o=e[i+""];o.arranged?(r=n[x].x-t[x].x,a=n[x].y-t[x].y):(r=n[o.c].x-t[o.c].x,a=n[o.c].y-t[o.c].y),o.x+=r,o.y+=a}}var c,d,h,v={tidy:function(e,t,n){return Q(e,{step:30,max:2,sort:!1,ratio:t.ratio},n)},average:function(e,t,n){return s(e,t.specialId,t.centre.x,t.centre.y,n)},absolute:function(e,t,n){return s(e,t.specialId,t.absolute.x,t.absolute.y,n)}},m={grid:function(e,t,n,r){var a=2*n+24+r,i=0,o=0,u=Math.floor(Math.sqrt(e.length)),s=Math.ceil(e.length/u),l={};for(c=0;u>c;c++){for(d=0;s>d;d++){var f=s*c+d;e[f]&&(l[e[f]]={x:i,y:o}),i+=a}i=0,o+=a}return l},circle:function(e,t,n,r){var a=1.25-(5-r)/50;return j(t,e,n,a).positions},radial:function(e,t,n,r){var a=1.25-(5-r)/50;return P(t,e,n,a).positions}},x="#arranged#";a=ne.defaults(a,{tightness:5,position:"average",x:0,y:0}),t.trigger("prechange","arrange");var y=r.v,p=g(a.tightness),b=v[a.position]||v.average,I=m[e]||m.grid,w={x:Number(a.x)||0,y:Number(a.y)||0},B={x:0,y:0};if(n=ne.ensureArray(n),n=u(y,n),!n.length)return o();for(h=0,c=0;c<n.length;c++)h+=y[n[c]].size,B.x+=y[n[c]].x,B.y+=y[n[c]].y;h/=n.length,B.x/=n.length,B.y/=n.length;var A=I(n,y,h,p),M={};for(var Z in A)Z+="",y[Z].x=A[Z].x,y[Z].y=A[Z].y,M[Z]=y[Z],M[Z].arranged=1;var D=i(y,r.e);l(D,M,B,w,function(e){for(var n=e.packed,i=e.original,u={},s=0;s<n.length;s++)u[n[s].id]=n[s];f(y,i,u);var l=[],c=r.extents;C(t,y,c,l,a,o)})};var oe=16e6;return re}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.create=function(t){var n={},r={canvas:t,layersToDraw:[],textAtlas:null,fontIconAtlas:null,imageAtlases:[],allLayers:{},framebuffers:{}},a=e.Generator(r),i=e.Renderer(r);return n.clearView=function(e){i.clearView(e)},n.clearFramebuffers=function(){i.clearFramebuffers()},n.updateTextures=function(t){i.clearTextureAtlas(r.imageAtlases),r.imageAtlases=e.ImageAtlas(t)},n.build=function(e,t,n,r){a.generate(e,t,n,r,i)},n.draw=function(e,t){var n=0,a=0,o=1;e&&(n=e.offsetXtoWebglPanX(),a=e.offsetYtoWebglPanY(),o=e.settings().zoom),i.render(n,a,o,r.textAtlas,r.fontIconAtlas,r.imageAtlases,t)},n.drawShadowCanvas=function(e,t){return i.drawShadowCanvas(e,t)},n})}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.TriangleShader=function(t){function n(e,t,n){for(var r=0,a=e.atlases.length;a>r;r++)u(e.atlases[r],r);t&&u(t,3);for(var r=0,a=n.length;a>r;r++)u(n[r],r+4)}function r(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.shadowData,c.STATIC_DRAW),c.enableVertexAttribArray(m.shadowColour),c.vertexAttribPointer(m.shadowColour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function a(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.textureBuffer),(e.rebuildOptions.textures||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.textureData,c.STATIC_DRAW),c.enableVertexAttribArray(m.textCoord),c.enableVertexAttribArray(m.textureBank),c.enableVertexAttribArray(m.circleRadius),c.vertexAttribPointer(m.textCoord,4,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.textureBank,2,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(m.circleRadius,1,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,24)}function i(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.colourData,c.STATIC_DRAW),
c.enableVertexAttribArray(m.colour),c.vertexAttribPointer(m.colour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function o(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.positionBuffer),(e.rebuildOptions.positions||e.rebuildOptions.all||e.alwaysUpdate)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.positionData,c.STATIC_DRAW),c.enableVertexAttribArray(m.position),c.enableVertexAttribArray(m.width),c.vertexAttribPointer(m.position,2,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.width,1,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8)}function u(e,t){c.activeTexture(c["TEXTURE"+t]),e.texture?c.bindTexture(c.TEXTURE_2D,e.texture):(e.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,e.texture),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e.img),c.generateMipmap(c.TEXTURE_2D),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e.img=null)}function s(e){e.triangleBuffers.positionBuffer||(e.triangleBuffers.positionBuffer=c.createBuffer()),e.triangleBuffers.textureBuffer||(e.triangleBuffers.textureBuffer=c.createBuffer()),e.triangleBuffers.colourBuffer||(e.triangleBuffers.colourBuffer=c.createBuffer()),e.triangleBuffers.shadowBuffer||(e.triangleBuffers.shadowBuffer=c.createBuffer())}function l(e,t,n,r,a){c.uniform2f(m.resolution,t,n),c.uniform1f(m.hitTest,0|r),c.uniform1iv(m.textures,[0,1,2,3,4,5,6,7]),c.uniformMatrix4fv(m.transform,!1,e.get()),c.uniform1f(m.shadowType,a),c.uniform1f(m.zoom,e.getZoomLevel())}var f={},c=t,g=e.Utils,d=e["triangle-vertex"],h=e["triangle-fragment"],v=(c.getExtension("OES_standard_derivatives"),g.createProgram(c,atob(d),atob(h))),m={transform:c.getUniformLocation(v,"u_transform"),textures:c.getUniformLocation(v,"u_image[0]"),resolution:c.getUniformLocation(v,"u_resolution"),hitTest:c.getUniformLocation(v,"u_hitTest"),shadowType:c.getUniformLocation(v,"u_shadowType"),zoom:c.getUniformLocation(v,"u_zoom"),position:c.getAttribLocation(v,"a_position"),circleRadius:c.getAttribLocation(v,"a_circleRadius"),width:c.getAttribLocation(v,"a_width"),colour:c.getAttribLocation(v,"a_colour"),textCoord:c.getAttribLocation(v,"a_texCoord"),shadowColour:c.getAttribLocation(v,"a_hitTestColour"),textureBank:c.getAttribLocation(v,"a_textureBank")};f.drawItems=function(e,t,u,f,g,d,h,m){c.useProgram(v),l(t,d,h,m,0|e.shadowType),s(e),r(e),a(e),i(e),o(e),n(u,f,g),c.drawArrays(c.TRIANGLES,0,3*e.triangleBuffers.numOfTriangles)};return f})}(),function(){var e=KeyLines.WebGL;e&&(e["line-arc-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV9yYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3N0YXJ0QW5nbGU7CmF0dHJpYnV0ZSBmbG9hdCBhX2VuZEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIGZsb2F0IGFfaW5kZXg7CmF0dHJpYnV0ZSBmbG9hdCBhX251bU9mU2VnbWVudHM7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9saW5lVHlwZTsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV96b29tOwp1bmlmb3JtIHZlYzIgdV9yZXNvbHV0aW9uOwp1bmlmb3JtIG1hdDQgdV90cmFuc2Zvcm07Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgbG93cCBmbG9hdCB2X2xpbmVUeXBlOwp2YXJ5aW5nIGZsb2F0IHZfdXY7CnZhcnlpbmcgZmxvYXQgdl9zaWduOwp2YXJ5aW5nIHZlYzQgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0Owp2YXJ5aW5nIGZsb2F0IHZfZG90c0xlbmd0aDsKCgpmbG9hdCBwaSA9IDMuMTQxNTkyNjUzNTk7CmZsb2F0IG1pbldpZHRoID0gMS4wOwogICAKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0gICAKICAgCi8vIE5leHQgc2VnbWVudCBpbiB0aGUgYXJjICAgCnZlYzIgZ2V0TmV4dFBvc2l0aW9uKHZlYzIgcG9zaXRpb24sIGZsb2F0IGFfcmFkaXVzLCBmbG9hdCBhX3N0YXJ0QW5nbGUsIGZsb2F0IGFuZ2xlSW5jcmVtZW50LCBmbG9hdCBpbmRleCkgewogIHJldHVybiB2ZWMyKAogICAgICAgYV9wb3NpdGlvbi54ICsgYV9yYWRpdXMgKiBjb3MoYV9zdGFydEFuZ2xlICsgYW5nbGVJbmNyZW1lbnQgKiBpbmRleCksCiAgICAgICBhX3Bvc2l0aW9uLnkgKyBhX3JhZGl1cyAqIHNpbihhX3N0YXJ0QW5nbGUgKyBhbmdsZUluY3JlbWVudCAqIGluZGV4KQogICk7Cn0KCnZvaWQgbWFpbigpIHsKICAgZmxvYXQgZGFzaE9mZnNldCA9IDAuNTsKICAgaW50IGxpbmVUeXBlID0gcm91bmRUb0ludChhX2xpbmVUeXBlKTsKICAgLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogICBib29sIGlzU2hhcnBMaW5lID0gbGluZVR5cGUgPT0gMTsKICAgYm9vbCBpc0Rhc2hlZExpbmUgPSBsaW5lVHlwZSA9PSAyOwogICBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IDM7CiAgIGlmKHVfaGl0VGVzdCA9PSAxLjApIHsKICAgICAgbWluV2lkdGggPSA4LjA7CiAgIH0KICAgLy8gaW5jcmVhc2UgbWluLXdpZHRoIGZvciBkb3R0ZWQgbGluZSAjMjQyNgogICBtaW5XaWR0aCA9IG1heChtaW5XaWR0aCwgc3RlcCgyLjUsIGFfbGluZVR5cGUpICogMi4wKTsKICAgCiAgIGZsb2F0IHJhZGl1cyA9IGFfcmFkaXVzOwogICB2ZWMyIHBvc2l0aW9uOwogICAvLyBEaXJlY3Rpb24gb2YgdGhlIG5vcm1hbCB2ZWN0b3IsIGVuY29kZWQgaW4gdGhlIHNpZ24gb2YgbnVtYmVyT2ZTZWdtZW50cyBmb3IgZWZmaWNpZW5jeSAKICAgYm9vbCBub3JtYWxQb2ludHNVcHdhcmQgPSByb3VuZFRvSW50KHNpZ24oYV9udW1PZlNlZ21lbnRzKSkgPT0gMTsKICAgCiAgIC8vIFdoZXRoZXIgdGhlIHZlcnRleCBpcyBhdCB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBzZWdtZW50LCBlbmNvZGVkIGluIHRoZSBzaWduIG9mIHRoZSBpbmRleCBwYXJhbWV0ZXIKICAgYm9vbCBpbmRleERpcmVjdGlvbiA9IHNpZ24oYV9pbmRleCkgPT0gMS4wIHx8IGFfaW5kZXggPT0gMC4wOwogICAvLyBUaGUgcmVhbCBpbmRleCB2YWx1ZQogICBmbG9hdCBpbmRleCA9IHNpZ24oYV9pbmRleCkgKiBhX2luZGV4OwogICAvLyBUaGUgcmVhbCBudW1PZlNlZ21lbnRzIHZhbHVlCiAgIGZsb2F0IG51bU9mU2VnbWVudHMgPSBzaWduKGFfbnVtT2ZTZWdtZW50cykgKiBhX251bU9mU2VnbWVudHM7CiAgIC8vIEhvdyBtdWNoIGVhY2ggc2VnbWVudCBuZWVkcyB0byBjdXJ2ZQogICBmbG9hdCBhbmdsZUluY3JlbWVudCA9IChhX2VuZEFuZ2xlIC0gIGFfc3RhcnRBbmdsZSkgLyBudW1PZlNlZ21lbnRzOwogIAogICBmbG9hdCBmaW5hbFdpZHRoID0gbWF4KChhX3dpZHRoICogMi4wKSAqIHVfem9vbSwgKG1pbldpZHRoICogMi4wKSkgLyB1X3pvb207CiAgIHZlYzIgZGlzdGFuY2VWZWN0b3I7CiAgIGZsb2F0IG5leHRJbmRleDsKICAgCiAgIGlmKG5vcm1hbFBvaW50c1Vwd2FyZCkgewogICAgIHJhZGl1cyArPSBmaW5hbFdpZHRoLzIuMDsKICAgICB2X3NpZ24gPSAxLjA7CiAgIH0gZWxzZSB7CiAgICAgcmFkaXVzIC09IGZpbmFsV2lkdGgvMi4wOwogICAgIHZfc2lnbiA9IDAuMDsKICAgfQogIAogICBpZihhX2VuZEFuZ2xlIC0gYV9zdGFydEFuZ2xlID09IDIuMCpwaSkgewogICAgICBkYXNoT2Zmc2V0ID0gMC4wOwogICB9CiAgCiAgIHBvc2l0aW9uID0gZ2V0TmV4dFBvc2l0aW9uKGFfcG9zaXRpb24ueHksIHJhZGl1cywgYV9zdGFydEFuZ2xlLCBhbmdsZUluY3JlbWVudCwgaW5kZXgpOwogIAogICAgLyoKICAgICBjb252ZXJ0IHRvIGNsaXBzcGFjZSAKICAgICovCiAgIC8vIGNvbnZlcnQgdGhlIHJlY3RhbmdsZSBmcm9tIHBpeGVscyB0byAwLjAgdG8gMS4wCiAgIHZlYzIgemVyb1RvT25lID0gcG9zaXRpb24gLyB1X3Jlc29sdXRpb247CgogICAvLyBjb252ZXJ0IGZyb20gMC0+MSB0byAwLT4yCiAgIHZlYzIgemVyb1RvVHdvID0gemVyb1RvT25lICogMi4wOwoKICAgLy8gY29udmVydCBmcm9tIDAtPjIgdG8gLTEtPisxIChjbGlwc3BhY2UpCiAgIHZlYzIgY2xpcFNwYWNlID0gemVyb1RvVHdvIC0gMS4wOwogICAKICAgLyoKICAgIEFzc2lnbiBWYXJ5aW5ncwogICAqLyAKICAgdl9jb2xvdXIgPSBhX2NvbG91cjsKICAgCiAgIHZfdXYgPSBpbmRleCAvIDI0LjA7CiAgIHZfbGVuZ3RoID0gYV9yYWRpdXMgKiAoYV9lbmRBbmdsZSAtIGFfc3RhcnRBbmdsZSk7CiAgIHZfaGl0VGVzdENvbG91ciA9IGFfaGl0VGVzdENvbG91cjsKICAgdl9saW5lVHlwZSA9IGFfbGluZVR5cGU7CiAgIHZfd2lkdGggPSBmaW5hbFdpZHRoOwogICB2X2Rhc2hPZmZzZXQgPSBkYXNoT2Zmc2V0OwogICAKICAgaWYoaXNEb3R0ZWRMaW5lKSB7CiAgICAgdl91diA9IHZfdXYqIGNlaWwodl9sZW5ndGgvZmluYWxXaWR0aCk7CiAgIH0KICAgCiAgIC8qCiAgICBBc3NpZ24gZmluYWwgdmVydGV4IHBvc2l0aW9uIGFuZCBhcHBseSB0cmFuc2Zvcm1zIGZvciB6b29tL3BhbgogICAqLwogICBnbF9Qb3NpdGlvbiA9IHVfdHJhbnNmb3JtICogdmVjNChjbGlwU3BhY2UgKiB2ZWMyKDEsIC0xKSwgMCwgMSk7Cn0=")}(),function(){var e=KeyLines.WebGL;e&&(e["line-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKcHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3V2Owp2YXJ5aW5nIGZsb2F0IHZfc2lnbjsKdmFyeWluZyBsb3dwIGZsb2F0IHZfbGluZVR5cGU7CnZhcnlpbmcgZmxvYXQgdl9sZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2RvdHNMZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0OwoKZmxvYXQgcGkgPSAzLjE0MTU5MjY1MzU5OwpmbG9hdCBzcXJ0T2ZIYWxmID0gMC43MDcxMDY3ODExODY1NDc1NzsKLy8gUGVyZm9ybWFuY2UgYW50aWFsaWFzaW5nIHVzaW5nIHN0YW5kYXJkIGRlcml2YXRpdmVzCi8vIFNtb290aHMgdGhlIGZyYWdtZW50IG92ZXIgMSBwaXhlbCB3aGVuIHZhbHVlIGlzIG1vcmUgdGhhbiB0aHJlc2hvbGQKLy8gZXNlbnRpYWxseSBhIGJldHRlciB2ZXJzaW9uIG9mIHN0ZXAgYW5kIHNtb290aHN0ZXAKZmxvYXQgYWFzdGVwKGZsb2F0IHRocmVzaG9sZCwgZmxvYXQgdmFsdWUpIHsKICAgIGZsb2F0IGFmd2lkdGggPSBsZW5ndGgodmVjMihkRmR4KHZhbHVlKSwgZEZkeSh2YWx1ZSkpKSAqIHNxcnRPZkhhbGY7CiAgICByZXR1cm4gc21vb3Roc3RlcCh0aHJlc2hvbGQtYWZ3aWR0aCwgdGhyZXNob2xkK2Fmd2lkdGgsIHZhbHVlKTsKfQoKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCnZvaWQgbWFpbigpIHsKZmxvYXQgZGFzaFRocmVzaG9sZCA9IC0wLjU7CiBpbnQgc2hhZG93VHlwZSA9IGludCh1X3NoYWRvd1R5cGUpOwogCiBpbnQgbGluZVR5cGUgPSByb3VuZFRvSW50KHZfbGluZVR5cGUpOwogLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogYm9vbCBpc1NoYXJwTGluZSA9IGxpbmVUeXBlID09IDE7CiBib29sIGlzRGFzaGVkTGluZSA9IGxpbmVUeXBlID09IDI7CiBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IDM7CiBib29sIGV4Y2x1ZGVGcm9tU2hhZG93ID0gc2hhZG93VHlwZSA9PSAtMTsKIGJvb2wgb25seU9uU2hhZG93ID0gc2hhZG93VHlwZSA9PSAxOwogIGlmKGludCh1X2hpdFRlc3QpID09IDEpIHsKICAgIC8vIEV4Y2x1ZGUgZnJvbSBzaGFkb3cKICAgIGlmKGV4Y2x1ZGVGcm9tU2hhZG93KSB7CiAgICAgICAgZGlzY2FyZDsKICAgIH0gZWxzZSB7CiAgICAgIGdsX0ZyYWdDb2xvciA9IHZfaGl0VGVzdENvbG91ciAvIDI1NS4wOwogICAgfQogIC8vIHNob3cgb25seSBvbiBzaGFkb3cKICB9IGVsc2UgaWYob25seU9uU2hhZG93KSB7CiAgICBkaXNjYXJkOwogIH0gZWxzZSB7CiAgICBmbG9hdCBkaXN0VG9FZGdlID0gYWJzKDAuNSAtIHZfc2lnbik7CiAgICB2ZWM0IGNvbG91ciA9IHZlYzQoKHZfY29sb3VyLnJnYi8gMjU1LjApICogKHZfY29sb3VyLmEgLzI1NS4wKSwgKHZfY29sb3VyLmEgLyAyNTUuMCkpOwogICAgLy8gZG90dGVkIGxpbmVzCiAgICBpZihpc0RvdHRlZExpbmUpIHsKICAgICAgLy8gRGlzdGFuY2UgdG8gbmVhcmVzdCBwb2ludCBpbiBhIGdyaWQgb2YKICAgICAgLy8gcG9pbnRzIG92ZXIgdGhlIHVuaXQgc3F1YXJlCiAgICAgIHZlYzIgbmVhcmVzdCA9IDIuMCpmcmFjdCh2ZWMyKHZfdXYsIHZfc2lnbiApKSAtIDEuMDsKICAgICAgZmxvYXQgZGlzdCA9IGxlbmd0aChuZWFyZXN0KTsKICAgICAgZmxvYXQgcmFkaXVzID0gMC41OwogICAgICBjb2xvdXIgKj0gYWFzdGVwKHJhZGl1cywgMS4wIC0gZGlzdCk7CiAgICAvLyBkYXNoZXMgIAogICAgfSBlbHNlIGlmKGlzRGFzaGVkTGluZSkgewogICAgICBmbG9hdCBkYXNoTGVuZ3RoID0gdl93aWR0aDsKICAgICAgZmxvYXQgZ2FwV2lkdGggPSBkYXNoTGVuZ3RoIC8gMi4wOwogICAgICBmbG9hdCBkYXNoZXMgPSBmbG9vcigodl9sZW5ndGggKyBnYXBXaWR0aCkgLyAoZGFzaExlbmd0aCArIGdhcFdpZHRoKSkgKyB2X2Rhc2hPZmZzZXQ7CiAgICAgIGZsb2F0IGRhc2ggPSBzaW4oKCh2X3V2ICogZGFzaGVzKSkgKiAoMi4wICogcGkpKTsKICAgICAgLy8gc21vb3RoIGFuZCBjdXQgb3V0IGEgZ2FwIHdoZW4gdGhlIHNpbmUgd2F2ZSBpZiBwYXN0IHRoZSBkYXNoVGhyZXNob2xkCiAgICAgIGNvbG91ciAqPSBhYXN0ZXAoZGFzaFRocmVzaG9sZCwgIGRhc2gpOwogICAgICAvLyBzbW9vdGggZWRnZSBvZiBsaW5lCiAgICAgIGNvbG91ciAqPSAxLjAgLSBhYXN0ZXAoMC4yNDksIGRpc3RUb0VkZ2UpOwogICAgLy8gTm9ybWFsIGxpbmUKICAgIH0gZWxzZSB7CiAgICAgIC8vIHNtb290aCBlZGdlIG9mIGxpbmUKICAgICAgY29sb3VyICo9IDEuMCAtIGFhc3RlcCgwLjI1MSwgZGlzdFRvRWRnZSk7CiAgICB9CiAgICAvLyBhc3NpZ24gdGhlIGZpbmFsIGNvbG91ciB0byB0aGUgZnJhZ21lbnQKICAgIGdsX0ZyYWdDb2xvciA9IGNvbG91cjsKICB9Cn0=")}(),function(){var e=KeyLines.WebGL;e&&(e["line-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjNCBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIHZlYzQgYV92ZXJ0ZXhJbmZvOwphdHRyaWJ1dGUgdmVjNCBhX2NvbG91cjsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247CnVuaWZvcm0gbWF0NCB1X3RyYW5zZm9ybTsKdW5pZm9ybSBmbG9hdCB1X3pvb207CnVuaWZvcm0gZmxvYXQgdV92aWV3SW5kZXBlbmRlbnQ7Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgdmVjNCB2X3ZlcnRleEluZm87CnZhcnlpbmcgZmxvYXQgdl91djsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3NpZ247CnZhcnlpbmcgZmxvYXQgdl9hYURpc3RhbmNlOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl96b29tOwp2YXJ5aW5nIGxvd3AgZmxvYXQgdl9saW5lVHlwZTsKdmFyeWluZyBmbG9hdCB2X2RvdHNMZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0OwoKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCnZvaWQgbWFpbigpIHsKICBmbG9hdCBtaW5XaWR0aCA9IDEuMDsKICBpbnQgbGluZVR5cGUgPSBpbnQoYV92ZXJ0ZXhJbmZvLncpOwogIC8vIGRpc2FibGUgYWEgd2hlbiB0eXBlID09IDEKICBib29sIGlzU2hhcnBMaW5lID0gbGluZVR5cGUgPT0gMTsKICBib29sIGlzRGFzaGVkTGluZSA9IGxpbmVUeXBlID09IDI7CiAgYm9vbCBpc0RvdHRlZExpbmUgPSBsaW5lVHlwZSA9PSAzOwogIC8vIE1ha2UgaXQgd2lkZXIgdG8gYWxsb3cgdGhlIGFudGkgYWxpYXNpbmcgdG8gZWF0IGludG8gdGhlIGxpbmUgaW4gb3JkZXIgdG8gbWFrZSBpdCBzbW9vdGgKICBmbG9hdCBhYVdpZHRoQnVmZmVyID0gMi4wOwogIC8vIGRvbid0IHdpZGVuIGZvciBkb3RzCiAgdl9hYURpc3RhbmNlID0gMC4yNTsKICBpZihpc1NoYXJwTGluZSkgewogICAgLy9lbnN1cmUgYWEgbmV2ZXIga2lja3MgaW4gd2hpbGUgYXZvaWRpbmcgYW4gaWYgc3RhdGVtZW50IGluIGZyYWdtZW50IHNoYWRlcgogICAgdl9hYURpc3RhbmNlID0gMS4wOwogIH0KICAKICBpZih1X2hpdFRlc3QgPT0gMS4wKSB7CiAgICBtaW5XaWR0aCA9IDQuMDsKICB9CiAgLy8gaW5jcmVhc2UgbWluLXdpZHRoIGZvciBkb3R0ZWQgbGluZSAjMjQyNgogIG1pbldpZHRoID0gbWF4KG1pbldpZHRoLCBzdGVwKDIuNSwgYV92ZXJ0ZXhJbmZvLncpICogMi4wKTsKICAKICB2ZWMyIHBvc2l0aW9uOwogIAogIC8vIERpcmVjdGlvbiBvZiB0aGUgbm9ybWFsIHZlY3RvcgogIGZsb2F0IG5vcm1hbFBvaW50c1Vwd2FyZCA9IGFfdmVydGV4SW5mby55IC0gMS4wOwogIAogIC8vIFRoZSBVViBjb29yZHMgZnJvbSAwIC0+IDEsIHVzZWQgZm9yIGRhc2hpbmcsIHRoZSBsaW5lIG51bWJlciBpcyBhZGRlZAogIC8vIGZvciB0aGUgY2FzZSB3aGVuIGxpbmVzIGFyZSBqb2luZWQKICBmbG9hdCB1diA9IGFfdmVydGV4SW5mby54ICsgYV92ZXJ0ZXhJbmZvLno7CiAgCiAgdmVjMiBkaXN0YW5jZVZlY3RvciA9IGFfcG9zaXRpb24uencgLSBhX3Bvc2l0aW9uLnh5OwogIAogIHZlYzIgbm9ybWFsID0gbm9ybWFsaXplKHZlYzIoLWRpc3RhbmNlVmVjdG9yLnksIGRpc3RhbmNlVmVjdG9yLngpKTsKICAKICAvLyBXaGV0aGVyIHRoZSB2ZXJ0ZXggaXMgYXQgdGhlIHN0YXJ0IG9yIGVuZCBvZiB0aGUgc2VnbWVudC4KICBpZihpbnQoYV92ZXJ0ZXhJbmZvLngpID09IDApIHsKICAgcG9zaXRpb24gPSBhX3Bvc2l0aW9uLnh5OwogIH0gZWxzZSB7CiAgIHBvc2l0aW9uID0gYV9wb3NpdGlvbi56dzsKICB9CiAgZmxvYXQgZmluYWxXaWR0aCA9IGNlaWwoYV93aWR0aCAqIGFhV2lkdGhCdWZmZXIpOwogIGlmKGludCh1X3ZpZXdJbmRlcGVuZGVudCkgPT0gMCkgewogICBmaW5hbFdpZHRoID0gbWF4KChmaW5hbFdpZHRoKSAqIHVfem9vbSwgbWluV2lkdGggKiBhYVdpZHRoQnVmZmVyKSAvIHVfem9vbTsKICB9CiAgLy8gZ2V0IHZlY3RvciBmb3IgbGluZQogIHZlYzIgbm9ybWFsVmVjID0gbm9ybWFsICogKGZpbmFsV2lkdGgvMi4wKSAqIG5vcm1hbFBvaW50c1Vwd2FyZDsKICBwb3NpdGlvbiA9IHBvc2l0aW9uICsgbm9ybWFsVmVjOwogIAogIC8qCiAgIGNvbnZlcnQgdG8gY2xpcHNwYWNlIAogICovCiAgLy8gY29udmVydCB0aGUgcmVjdGFuZ2xlIGZyb20gcGl4ZWxzIHRvIDAuMCB0byAxLjAKICB2ZWMyIHplcm9Ub09uZSA9IHBvc2l0aW9uIC8gdV9yZXNvbHV0aW9uOwogIAogIC8vIGNvbnZlcnQgZnJvbSAwLT4xIHRvIDAtPjIKICB2ZWMyIHplcm9Ub1R3byA9IHplcm9Ub09uZSAqIDIuMDsKICAKICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICB2ZWMyIGNsaXBTcGFjZSA9IHplcm9Ub1R3byAtIDEuMDsKICAKICAvKgogICBBc3NpZ24gVmFyeWluZ3MKICAqLyAKICB2X2NvbG91ciA9IGFfY29sb3VyOwogIHZfdXYgPSB1djsKICBpZihpbnQobm9ybWFsUG9pbnRzVXB3YXJkKSA9PSAxKSB7CiAgIHZfc2lnbiA9IDAuMDsKICB9IGVsc2UgewogICB2X3NpZ24gPSAxLjA7CiAgfQogICAKICB2X2xlbmd0aCA9IGRpc3RhbmNlKGFfcG9zaXRpb24ueHksIGFfcG9zaXRpb24uencpOwogIHZfaGl0VGVzdENvbG91ciA9IGFfaGl0VGVzdENvbG91cjsKICB2X3dpZHRoID0gZmluYWxXaWR0aDsKCiAgdl96b29tID0gdV96b29tOwogIHZfbGluZVR5cGUgPSBhX3ZlcnRleEluZm8udzsKICAKICBpZihhX3ZlcnRleEluZm8ueCA9PSAwLjApIHsKICAgIHZfZG90c0xlbmd0aCA9IDAuMDsgCiAgfSBlbHNlIHsKICAgIHZfZG90c0xlbmd0aCA9IHZfbGVuZ3RoIC8gKGZpbmFsV2lkdGgqMi4wKTsKICB9CiAgCiAgLy9Eb3R0ZWQgbGluZXMsIHNvIGNhbGMgdXYgbGVuZ3RoCiAgaWYoYV92ZXJ0ZXhJbmZvLncgPT0gMy4wICkgewogICAgdl91diA9IHV2ICogY2VpbCh2X2xlbmd0aC9maW5hbFdpZHRoKTsKICB9IAogIAogIHZfZGFzaE9mZnNldCA9IDAuNTsKICAKICAvKgogICBBc3NpZ24gZmluYWwgdmVydGV4IHBvc2l0aW9uIGFuZCBhcHBseSB0cmFuc2Zvcm1zIGZvciB6b29tL3BhbgogICovCiAgZ2xfUG9zaXRpb24gPSB1X3RyYW5zZm9ybSAqIHZlYzQoY2xpcFNwYWNlICogdmVjMigxLCAtMSksIDAsIDEpOwp9")}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2VbOF07CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwoKLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci4KdmFyeWluZyB2ZWM0IHZfdGV4Q29vcmQ7CnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUJhbms7CnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2lzQ2lyY2xlOwp2YXJ5aW5nIGZsb2F0IHZfcGl4ZWw7CnZhcnlpbmcgZmxvYXQgdl9oV2lkdGg7CnZhcnlpbmcgZmxvYXQgdl92SGVpZ2h0Owp2YXJ5aW5nIGZsb2F0IHZfYm9yZGVyV2lkdGg7CgpmbG9hdCBhYXN0ZXAoZmxvYXQgdGhyZXNob2xkLCBmbG9hdCB2YWx1ZSkgewogIGZsb2F0IGFmd2lkdGggPSBsZW5ndGgodmVjMihkRmR4KHZhbHVlKSwgZEZkeSh2YWx1ZSkpKSAqIDAuNzA3MTA2NzgxMTg2NTQ3NTc7CiAgcmV0dXJuIHNtb290aHN0ZXAodGhyZXNob2xkLWFmd2lkdGgsIHRocmVzaG9sZCthZndpZHRoLCB2YWx1ZSk7Cn0KCmZsb2F0IGVkZ2VGYWN0b3IodmVjMyBiYXJ5Y2VudHJpY0Nvb3Jkcyl7CiAgdmVjMyBkID0gZndpZHRoKGJhcnljZW50cmljQ29vcmRzKTsKICB2ZWMzIGEzID0gc21vb3Roc3RlcCh2ZWMzKDAuMCksIGQqMy4wLCBiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiByZXR1cm4gbWluKG1pbihhMy54LCBhMy55KSwgYTMueik7Cn0KCi8vIFJlYWQgdGhlIHRleHR1cmUgdmFsdWUgb2YgYSBnbHlwaCBmcm9tIHRoZSBzcGVjaWZpZWQgY29sb3VyIGNoYW5uZWwKZmxvYXQgcmVhZENvbG91ckNvbXBvbmVudEZyb21UZXh0dXJlKGZsb2F0IHRleHR1cmVCYW5rLCB2ZWM0IHRleENvb3JkKSB7CiAgZmxvYXQgdGV4Q29tcG9uZW50OwogIGlmKHRleHR1cmVCYW5rIDwgMC41KSB7CiAgICB0ZXhDb21wb25lbnQgPSB0ZXhDb29yZC5yOwogIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA8IDEuNSkgewogICAgdGV4Q29tcG9uZW50ID0gdGV4Q29vcmQuZzsKICB9IGVsc2UgewogICAgdGV4Q29tcG9uZW50ID0gdGV4Q29vcmQuYjsKICB9CiAgcmV0dXJuIHRleENvbXBvbmVudDsKfQoKLy8gVXNlZCB0byByZWNvbnN0cnVjdCBhIGdseXBoIGZyb20gdGhlIGNvbG91ckNvbXBvbmVudCB0ZXh0dXJlCnZlYzQgZ2V0Q29sb3VyRnJvbUNvbXBvbmVudChmbG9hdCBjb2xvdXJDb21wb25lbnQsIHZlYzQgY29sb3VyTW9kaWZpZXIpIHsKICBmbG9hdCBjb2xvdXJBdmcgPSAoY29sb3VyTW9kaWZpZXIuciArIGNvbG91ck1vZGlmaWVyLmIgKyBjb2xvdXJNb2RpZmllci5nKSAvIDMuMDsKICBmbG9hdCBpc1doaXRlID0gc3RlcCgxLjAsY29sb3VyQXZnKTsKICAvLyBJZiB0aGUgdGV4dCBpcyB3aGl0ZSBib29zdCB0aGUgYWxwaGEgdG8gaW5jcmVhc2UgY29udHJhc3QKICBmbG9hdCB3aGl0ZVRleHRCb29zdCA9IGlzV2hpdGUgKiAoc3RlcCgwLjI1LGNvbG91ckNvbXBvbmVudCkqbWluKGNvbG91ckF2ZywwLjI1KSk7CiAgZmxvYXQgYSA9IGNvbG91ckNvbXBvbmVudCAgKyB3aGl0ZVRleHRCb29zdDsKICBmbG9hdCByID0gY29sb3VyTW9kaWZpZXIuciAqIGE7CiAgZmxvYXQgZyA9IGNvbG91ck1vZGlmaWVyLmcgKiBhOwogIGZsb2F0IGIgPSBjb2xvdXJNb2RpZmllci5iICogYTsKICByZXR1cm4gdmVjNChyLGcsYixhKTsKfQoKdm9pZCBtYWluKCkgewogIHZlYzQgY29sb3JBOwogIHZlYzIgY2lyY2xlQ2VudHJlID0gdmVjMigwLjUsIDAuNSk7CiAgaWYodV9oaXRUZXN0ID4gMC4wKSB7CiAgICAvLyBFeGNsdWRlIGZyb20gc2hhZG93CiAgICBpZih1X3NoYWRvd1R5cGUgPCAtMC41KXsKICAgICAgICBkaXNjYXJkOwogICAgfSBlbHNlIHsKICAgICAgdmVjNCBjb2xvckEgPSB2X2hpdFRlc3RDb2xvdXIgLyAyNTUuMDsKICAgICAgaWYodl9pc0NpcmNsZSA+IDAuMCkgewogICAgICAgIGlmKHZfdGV4dHVyZUJhbmsueCA+IC0xLjUgJiYgdl90ZXh0dXJlQmFuay54IDwgLTAuNSkgewogICAgICAgICAvLyBmb3Igb2Zmc2V0IGNpcmNsZXMKICAgICAgICAgY2lyY2xlQ2VudHJlID0gdl90ZXhDb29yZC54eTsKICAgICAgICB9CiAgICAgICAgZmxvYXQgZGlzdCA9IGRpc3RhbmNlKHZfdGV4Q29vcmQuencsIGNpcmNsZUNlbnRyZSk7CiAgICAgICAgZmxvYXQgYm9yZGVyID0gMC41IC0gdl93aWR0aDsKICAgICAgICBjb2xvckEgKj0gc3RlcCgwLjUgKyB2X3BpeGVsLzIuMCwgIDEuMCAtIGRpc3QpOwogICAgICAgIGlmKHZfd2lkdGggPiAwLjApIHsKICAgICAgICAgIGNvbG9yQSAqPSBzdGVwKGJvcmRlciwgZGlzdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGdsX0ZyYWdDb2xvciA9IGNvbG9yQTsKICAgIH0KICB9IGVsc2UgaWYodV9zaGFkb3dUeXBlID4gMC41KXsKICAgIGRpc2NhcmQ7CiAgfSBlbHNlIHsKICAgICAgY29sb3JBID0gdl9jb2xvdXIgLyAyNTUuMDsKICAgICAgLy8gbG9hZCB0aGUgY29ycmVjdCB0ZXh0dXJlIGFuZCByZWFkIGl0CiAgICAgIC8vIC0yIGZsYXQgc2hhZGVkIHdpdGggYW50aSBhbGlhc2luZwogICAgICAvLyAtMSBmbGF0IHNoYWRlZAogICAgICAvLyAwLi4yIC0+IHRleHQKICAgICAgLy8gMyAtPiBmb250SWNvbnMKICAgICAgLy8gNC4uLjcgLT4gaW1hZ2VzCiAgICAgIGlmICh2X3RleHR1cmVCYW5rLnggPiAtMC41KSB7CiAgICAgICAgICB2ZWM0IHRleENvb3JkOwogICAgICAgICAgLy8gc2V0IG1pcG1hcCBsZXZlbCBiaWFzIHRvIHNoYXJwZW4gdGV4dHVyZXMKICAgICAgICAgIGZsb2F0IGJpYXMgPSAtMi4wLzMuMDsKICAgICAgICAgIGZsb2F0IHRleHRCaWFzID0gLTAuODsKICAgICAgICAgIC8vdGV4dCAwCiAgICAgICAgICBpZih2X3RleHR1cmVCYW5rLnggPCAwLjUpICB7CiAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVswXSwgdl90ZXhDb29yZC54eSwgdGV4dEJpYXMpOwogICAgICAgICAgLy90ZXh0IDEKICAgICAgICAgIH0gZWxzZSBpZih2X3RleHR1cmVCYW5rLnggPCAxLjUpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVsxXSwgdl90ZXhDb29yZC54eSwgdGV4dEJpYXMpOwogICAgICAgICAgLy8gdGV4dCAyCiAgICAgICAgICB9IGVsc2UgaWYodl90ZXh0dXJlQmFuay54IDwgMi41KSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbMl0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgIC8vIGZvbnRJY29ucyAzIAogICAgICAgICAgfSBlbHNlIGlmKHZfdGV4dHVyZUJhbmsueCA8IDMuNSkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzNdLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgIC8vIGltYWdlIDQgICAKICAgICAgICAgIH0gZWxzZSBpZih2X3RleHR1cmVCYW5rLnggPCA0LjUpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVs0XSwgdl90ZXhDb29yZC54eSwgYmlhcyk7CiAgICAgICAgICAvLyBpbWFnZSA1ICAgCiAgICAgICAgICB9IGVsc2UgaWYodl90ZXh0dXJlQmFuay54IDwgNS41KSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbNV0sIHZfdGV4Q29vcmQueHksIGJpYXMpOwogICAgICAgICAgLy8gaW1hZ2UgNgogICAgICAgICAgfSBlbHNlIGlmKHZfdGV4dHVyZUJhbmsueCA8IDYuNSkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzZdLCB2X3RleENvb3JkLnh5LCBiaWFzKTsgICAgIAogICAgICAgICAgLy8gaW1hZ2UgNyAgIAogICAgICAgICAgfSBlbHNlICB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbN10sIHZfdGV4Q29vcmQueHksIGJpYXMpOwogICAgICAgICAgfQogICAgICAgICAgaWYodl90ZXh0dXJlQmFuay54ID4gMy41KSB7CiAgICAgICAgICAgIGNvbG9yQSA9IHZlYzQoY29sb3JBLnJnYiAgKiB0ZXhDb29yZC5yZ2IsY29sb3JBLmEgKiB0ZXhDb29yZC5hKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZsb2F0IGNvbG91ckNvbXBvbmVudCA9IHJlYWRDb2xvdXJDb21wb25lbnRGcm9tVGV4dHVyZSh2X3RleHR1cmVCYW5rLnksIHRleENvb3JkKTsgICAgCiAgICAgICAgICAgIGNvbG9yQSA9IGdldENvbG91ckZyb21Db21wb25lbnQoY29sb3VyQ29tcG9uZW50LCBjb2xvckEpOwogICAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZfdGV4dHVyZUJhbmsueCA8IC0xLjUpIHsKICAgICAgICAvLyBUZXh0IGNvb3JkcyBhcmUgYmFyeWNlbnRyaWMsIHVzZWQgZm9yIGFhIHRyaWFuZ2xlcwogICAgICAgIGZsb2F0IGFscGhhID0gY29sb3JBLmE7CiAgICAgICAgY29sb3JBID0gdmVjNChjb2xvckEucmdiICAqIGFscGhhLCBhbHBoYSk7CiAgICAgICAgY29sb3JBICo9IGFhc3RlcCgwLjA1LCBlZGdlRmFjdG9yKHZfdGV4Q29vcmQueHl6KSk7IAogICAgICB9IGVsc2UgewogICAgICAgIC8vIGZsYXQgc2hhZGVkIHJlY3Qgb3IgdHJpYW5nbGUsIGp1c3QgYXBwbHkgdGhlIGNvbG91cgogICAgICAgIGZsb2F0IGFscGhhID0gY29sb3JBLmE7CiAgICAgICAgY2lyY2xlQ2VudHJlID0gdl90ZXhDb29yZC54eTsKICAgICAgICBjb2xvckEgPSB2ZWM0KGNvbG9yQS5yZ2IgICogYWxwaGEsIGFscGhhKTsKICAgICAgfQogICAgICAKICAgICAgaWYodl9pc0NpcmNsZSA+IDAuMCkgewogICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2Uodl90ZXhDb29yZC56dywgY2lyY2xlQ2VudHJlKTsKICAgICAgICAgLy8gYWRkIGEgMS8zIG9mIGEgcGl4ZWwgcGFkZGluZyBmb3Igc21vb3RoIGVkZ2VzIGFyb3VuZCBib3JkZXIgIzI3NzEKICAgICAgICAgY29sb3JBICo9IGFhc3RlcCgwLjUsICAxLjAgLSB2X3BpeGVsLzMuMCAtIGRpc3QpOwogICAgICAgICBpZih2X3dpZHRoID4gMC4wKSB7CiAgICAgICAgICBmbG9hdCBib3JkZXIgPSAwLjUgLSB2X3dpZHRoOwogICAgICAgICAgY29sb3JBICo9IGFhc3RlcChib3JkZXIsIGRpc3QpOwogICAgICAgICB9CiAgICAgIC8vIGRyYXcgYSBzcXVhcmUgYm9yZGVyICAKICAgICAgfSBlbHNlIGlmKHZfaXNDaXJjbGUgPCAtMC41KSB7CiAgICAgICAgZmxvYXQgdGwgPSBtYXgoc3RlcCh2X3RleENvb3JkLngsIHZfYm9yZGVyV2lkdGgpLHN0ZXAodl90ZXhDb29yZC55LCB2X2JvcmRlcldpZHRoKSk7IAogICAgICAgIGZsb2F0IGJyID0gbWF4KHN0ZXAodl90ZXhDb29yZC56IC0gdl90ZXhDb29yZC54LHZfYm9yZGVyV2lkdGgpLHN0ZXAodl90ZXhDb29yZC53IC0gdl90ZXhDb29yZC55LHZfYm9yZGVyV2lkdGgpKTsgCiAgICAgICAgY29sb3JBICo9IG1heCh0bCxicik7CiAgICAgIH0KICAgICAgZ2xfRnJhZ0NvbG9yID0gY29sb3JBOwogICB9Cn0=")}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjNCBhX3RleENvb3JkOwphdHRyaWJ1dGUgdmVjNCBhX2hpdFRlc3RDb2xvdXI7CmF0dHJpYnV0ZSB2ZWMyIGFfdGV4dHVyZUJhbms7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9jaXJjbGVSYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3dpZHRoOwoKdW5pZm9ybSB2ZWMyIHVfcmVzb2x1dGlvbjsKdW5pZm9ybSBtYXQ0IHVfdHJhbnNmb3JtOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2lzQ2lyY2xlOwp2YXJ5aW5nIHZlYzQgdl90ZXhDb29yZDsKdmFyeWluZyB2ZWM0IHZfY29sb3VyOwp2YXJ5aW5nIHZlYzQgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIHZlYzIgdl90ZXh0dXJlQmFuazsKdmFyeWluZyBmbG9hdCB2X3BpeGVsOwp2YXJ5aW5nIGZsb2F0IHZfYm9yZGVyV2lkdGg7CgoKdm9pZCBtYWluKCkgewogICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogICB2ZWMyIHplcm9Ub09uZSA9IGFfcG9zaXRpb24gLyB1X3Jlc29sdXRpb247CiAgIC8vIGNvbnZlcnQgZnJvbSAwLT4xIHRvIDAtPjIKICAgdmVjMiB6ZXJvVG9Ud28gPSB6ZXJvVG9PbmUgKiAyLjA7CgogICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICAgdmVjMiBjbGlwU3BhY2UgPSB6ZXJvVG9Ud28gLSAxLjA7CgogICBnbF9Qb3NpdGlvbiA9IHVfdHJhbnNmb3JtICogdmVjNChjbGlwU3BhY2UgKiB2ZWMyKDEsIC0xKSwgMCwgMSk7CgogICAvLyBwYXNzIHRoZSB0ZXhDb29yZCB0byB0aGUgZnJhZ21lbnQgc2hhZGVyCiAgIC8vIFRoZSBHUFUgd2lsbCBpbnRlcnBvbGF0ZSB0aGlzIHZhbHVlIGJldHdlZW4gcG9pbnRzLgogICB2X3RleENvb3JkID0gYV90ZXhDb29yZDsKICAgdl9jb2xvdXIgPSBhX2NvbG91cjsKICAgdl9oaXRUZXN0Q29sb3VyID0gYV9oaXRUZXN0Q29sb3VyOwogICB2X3RleHR1cmVCYW5rID0gYV90ZXh0dXJlQmFuazsKICAgaWYoYV9jaXJjbGVSYWRpdXMgPiAwLjApIHsKICAgICB2X2lzQ2lyY2xlID0gMS4wOwogICB9IGVsc2UgewogICAgIHZfaXNDaXJjbGUgPSBhX2NpcmNsZVJhZGl1czsKICAgfQogICB2X3dpZHRoID0gYV93aWR0aCAvIChhX2NpcmNsZVJhZGl1cyAqIDIuMCk7CiAgIC8vIHRoZSBzaXplIG9mIGEgcGl4ZWwgaW4gc2NyZWVuc3BhY2UgY2xpcCBjb29yZGluYXRlcwogICB2X3BpeGVsID0gMS4wIC8gKGFfY2lyY2xlUmFkaXVzICogMi4wKSAvIHVfem9vbTsKICAgdl9ib3JkZXJXaWR0aCA9IGFfd2lkdGg7Cn0K")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2U7CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2dsb2JhbEFscGhhOwoKLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci4KdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHVfaW1hZ2UsIHZfdGV4Q29vcmQpICogdV9nbG9iYWxBbHBoYTsKfQo=")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjMiBhX3RleENvb3JkOwoKdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgIGdsX1Bvc2l0aW9uID0gdmVjNChhX3Bvc2l0aW9uLCAwLjAsMS4wKTsKICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7Cn0K")}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=function(e,t,n,r,a,i,o){e[t.positionIndex++]=n,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=a,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=n,e[t.positionIndex++]=i,e[t.positionIndex++]=0,e[t.positionIndex++]=n,e[t.positionIndex++]=i,e[t.positionIndex++]=0,e[t.positionIndex++]=a,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=a,e[t.positionIndex++]=i,e[t.positionIndex++]=0},n=function(e,t,n,r,a,i,o,u){e[t.textureIndex++]=n,e[t.textureIndex++]=r,e[t.textureIndex++]=0,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=a,e[t.textureIndex++]=r,e[t.textureIndex++]=1,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=n,e[t.textureIndex++]=i,e[t.textureIndex++]=0,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=n,e[t.textureIndex++]=i,e[t.textureIndex++]=0,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=a,e[t.textureIndex++]=r,e[t.textureIndex++]=1,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=a,e[t.textureIndex++]=i,e[t.textureIndex++]=1,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0};e.generateText=function(e,r,a,i,o,u){if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate){var s=14/i*(r.fs/14);i*=s;var l=(r.w,0)}var f=r.wc[0],c=r.wc[1],g=r.wc[2],d=r.wc[3],h=e.colourData,v=e.positionData,m=e.textureData,x=e.shadowData,y=r.x1,p=r.y1,b=r.x2,I=r.y2;u&&(y+=u.x,p+=u.y,b+=u.x,I+=u.y);for(var w=0,B=a.length;B>w;w++){var C=a[w];if(o.rebuildOptions.all||o.rebuildOptions.shadow||o.alwaysUpdate)for(var A=0;6>A;A++)x[e.shadowIndex++]=0,x[e.shadowIndex++]=0,x[e.shadowIndex++]=0,x[e.shadowIndex++]=0;if(o.rebuildOptions.all||o.rebuildOptions.colours||o.alwaysUpdate)for(var A=0;6>A;A++)h[e.colourIndex++]=f,h[e.colourIndex++]=c,h[e.colourIndex++]=g,h[e.colourIndex++]=d;if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate){var M=C.width*s;t(v,e,y+l+4,p+i,y+(l+M)+4,p,u)}(o.rebuildOptions.all||o.rebuildOptions.textures||o.alwaysUpdate)&&n(m,e,C.u1,C.v1,C.u2,C.v2,C.colourComponent,C.textureBank),l+=M}}}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.createLens=function(t){function n(e,t){function n(e,t,n,r,a){return{isLeaf:!0,children:[],points:[],x1:e,y1:t,x2:n,y2:r,depth:a}}function r(e){return e.depth>=t}function a(e,t){var r,a,i,o,u=.5*(e.x1+e.x2),s=.5*(e.y1+e.y2);0===t||1===t?(i=e.y1,o=s):(i=s,o=e.y2),0===t||2===t?(r=e.x1,a=u):(r=u,a=e.x2),e.isLeaf=!1,e.children[t]=n(r,i,a,o,e.depth+1)}function i(e,t){var n;for(t(e),n=0;4>n;n++)e.children[n]&&i(e.children[n],t)}function o(e,t){if(t.x<e.x1||t.y<e.y1||t.x>e.x2||t.y>e.y2)throw new Error("Error: the point is out of range.");if(r(e))e.points.push(t);else{e.points.push(t);var n,i=.5*(e.x1+e.x2),u=.5*(e.y1+e.y2);t.x<i&&t.y<u&&(n=0),t.x>=i&&t.y<u&&(n=1),t.x<i&&t.y>=u&&(n=2),t.x>=i&&t.y>=u&&(n=3),e.children[n]||a(e,n),o(e.children[n],t)}}var u,s=[],l=[];for(u=0;u<e.length;u++)s.push(e[u].x),l.push(e[u].y);var f=Math.min.apply(0,s),c=Math.max.apply(0,s),g=Math.min.apply(0,l),d=Math.max.apply(0,l),h=c-f,v=d-g;h>v?d=g+h:c=f+v;var m=n(f,g,c,d,0);for(m.addPoint=function(e){o(m,e)},m.visit=function(e){i(m,e)},u=0;u<e.length;u++)m.addPoint(e[u]);return m}function r(){function e(e){function t(t){if(t.isLeaf){var a=e.x-.5*(t.x1+t.x2),i=e.y-.5*(t.y1+t.y2),o=Math.sqrt(a*a+i*i),u=(t.x2-t.x1)/o,s=t.points;if(u>G){var l;for(l=0;l<s.length;l++)if(e.id!==s[l].id){var f=e.x-s[l].x,c=e.y-s[l].y,g=Math.max(.001,Math.sqrt(f*f+c*c));n+=f/g,r+=c/g}}else n+=s.length*a/o,r+=s.length*i/o}}var n=0,r=0;a.visit(t),B.push(n),C.push(r)}var t,r=[];for(t in A)r.push({id:t,x:Z[p[t]],y:D[p[t]]});var a=n(r,L);B.length=0,C.length=0,y.iterator(r,e),f(B),f(C)}function a(e,t,n){var r,a=t,i=s(e,u(l(t,n),-1)),f=y.clone(i),c=o(i,i);for(r=0;20>r&&c/d>.01;r++){var g=l(f,n),h=c/o(g,f);a=s(a,u(f,h));var v=s(i,u(g,-h)),m=o(v,v)/c;i=v,c=o(i,i),f=s(v,u(f,m))}return a}function i(){var e;for(I.length=0,w.length=0,e=0;d>e;e++){I[e]=[],w[e]={},w[e][e]=!0;for(var t=0;d>t;t++)I[e][t]=0}for(e=0;e<M.length;e++){var n=p[M[e].id1],r=p[M[e].id2];w[n][r]=!0,w[r][n]=!0,I[n][r]-=1,I[r][n]-=1,I[n][n]+=1,I[r][r]+=1}}function o(e,t){var n,r=0;for(n=0;n<e.length;n++)r+=e[n]*t[n];return r}function u(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=t*e[n];return r}function s(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=e[n]+t[n];
return r}function l(e,t){var n,r,a=[],i=0;for(n=0;d>n;n++){i=0;for(r in w[n])i+=I[n][r]*e[r];a.push(i)}for(a=u(a,t),i=0,n=0;d>n;n++)i+=e[n];var o=[];for(n=0;d>n;n++)o.push(d*e[n]-i);return s(a,o)}function f(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];for(n/=e.length,t=0;t<e.length;t++)e[t]-=n}function c(e,t,n){var i;for(i=0;t>i;i++)R+=1/(h+v+1),e.trigger("progress","layout",R),r(Z,D),Z=a(B,Z,n),D=a(C,D,n),f(Z),f(D)}function g(e){var n,r=0,a=0;for(n in A)A[n].hasOwnProperty("size")?(r+=A[n].size*A[n].size,a+=A[n].size*A[n].size):(r+=1,a+=1);r=Math.sqrt(r/d),a/=d;var i=a/(r*r)-1;b=100*Math.sqrt(d)*(r/60),40>d&&(b=1.5*b),b*=1+i,x=d/50,m=500*x,h=8,v=8;var o=t(e.tightness);o=2*(o-8),x*=Math.exp(o)}var d,h,v,m,x,y=KeyLines.Util,p={},b=500,I=[],w=[],B=[],C=[],A={},M=[],Z=[],D=[],L=3,G=.5,R=0;e.lens=function(e,t,n,r,a,o){R=0,e.trigger("progress","layout",0);var u;A=t.v,M=t.e,d=t.vcount;var s=t.extents,l=[];if(2>d)return r(e,A,s,l,n,o);g(n),Z.length=0,D.length=0;var f=0;for(u in A)Z.push(b*a.next()),D.push(b*a.next()),p[u]=f,f++;i(),c(e,h,m),c(e,v,x);for(u in A)A[u].x=b*Z[p[u]],A[u].y=b*D[p[u]];r(e,A,s,l,n,o)}}}(),function(){"use strict";var e=KeyLines.Generator={};e.create=function(e){function t(){return ue||ve.colours.white}function n(e){return Math.abs(e)<1e-5}function r(e,t,n,r,a,i,o){return{x:((i-r)*n-(o-a)*t)/e,y:((i-r)*t+(o-a)*n)/e}}function a(e){return e.hasOwnProperty("t")&&e.t}function i(e,t,a,i,o,u,s,l,f,c){var g=r(t,a,i,o,u,s,l),d=r(t,a,i,o,u,f,c);e/=t;var h=e/2;if(g.y>h&&d.y>h||g.y<-h&&d.y<-h)return NaN;if(n(d.y-g.y))return Math.max(g.x,d.x);var v,m=g.y>d.y?g:d,x=g.y>d.y?d:g;v=h<m.y?m.x-(m.y-h)*(m.x-x.x)/(m.y-x.y):m.x;var y;return y=x.y<-h?x.x-(x.y- -h)*(x.x-m.x)/(x.y-m.y):x.x,Math.max(v,y)}function o(e,t,n,r,a,o,u,s){for(var l=-(1/0),f=u.length,c=0;f>c;c+=2){var g=(c+2)%f,d=i(e,t,n,r,a,o,u[c]+s.x,u[c+1]+s.y,u[g]+s.x,u[g+1]+s.y);me.isNaN(d)||(l=Math.max(l,d))}return l}function u(e,t,n,r,a,i,u,s){return o(e,t,n,r,a,i,[u.x1,u.y1,u.x2,u.y1,u.x2,u.y2,u.x1,u.y2],s)}function s(e,t,n,r,a,i,o,u){var s=-(1/0),l=o.cx+u.x-a,f=o.cy+u.y-i,c=t*t,g=-2*t*(l*r-f*n),d=l*l+f*f-o.r*o.r,h=g*g-4*c*d;return h>=0&&(s=(-g+Math.sqrt(h))/(2*c)),s}function l(e,t,n,r,a,i){for(var l,f=-(1/0),c=Math.sin(-n),g=Math.cos(-n),d=i._cl,h=0;h<d.length;h++){var v=d[h];l=v.length?o(e,t,c,g,r,a,v,i):v.r?s(e,t,c,g,r,a,v,i):u(e,t,c,g,r,a,v,i),f=Math.max(f,l)}return f}function f(e,t,n,r,a,i){var o=0;return r._c&&(o=r._c/t),r._cl&&(o=Math.max(o,l(e,t,n,a,i,r))),o}function c(e,t,r,a,i,o,u,s,l,c,g){var d={},h=r-e,v=a-t,m=Math.sqrt(h*h+v*v);if(n(m))d.skip=!0;else{var x=Math.atan2(v,h),y=f(ie&&s?0:i,m,x,o,e,t),p=f(ie&&l?0:i,m,x+Math.PI,u,r,a);c=c||0,g=g||0,y=Math.max(c,y),p=Math.max(g,p);var b=1-(y+p),I=0;if(s||l){var w=G(i)*Math.cos(Te);I=w/m,s&&l&&(I=1.5*I)}d.skip=b<Math.max(.1,I),d.skip||(d.cx1=e+y*h,d.cy1=t+y*v,d.cx2=r+p*-h,d.cy2=a+p*-v)}return d}function g(e,t,n,r,a,i,o){var u=[],s=i-r,l=o-a,f=r-e,c=a-t,g=s*s+l*l,d=2*(s*f+l*c),h=f*f+c*c-n*n,v=d*d-4*g*h;if(v>=0){var m=Math.sqrt(v),x=(-d-m)/(2*g),y=(-d+m)/(2*g);if(x>=0&&1>=x){var p=r+x*s,b=a+x*l;u.push(Math.atan2(b-t,p-e))}if(y!==x&&y>=0&&1>=y){var I=r+y*s,w=a+y*l;u.push(Math.atan2(w-t,I-e))}}return u}function d(e,t,n,r,a,i){var o=r-t;if(Math.abs(o)>n)return[];var u=Math.max(a,i),s=Math.min(a,i);if(e-n>u||s>e+n)return[];var l=Math.asin(o/n),f=n*Math.cos(l),c=[];return e-f>=s&&u>=e-f&&c.push(o>0?Math.PI-l:-Math.PI-l),e+f>=s&&u>=e+f&&c.push(l),c}function h(e,t,n,r,a,i){var o=r-e;if(Math.abs(o)>n)return[];var u=Math.max(a,i),s=Math.min(a,i);if(t-n>u||s>t+n)return[];var l=Math.acos(o/n),f=n*Math.sin(l),c=[];return t-f>=s&&u>=t-f&&c.push(-l),t+f>=s&&u>=t+f&&c.push(l),c}function v(e,t,n,r,a,i){for(var o=[],u=0;u<r.length;u+=2){var s=(u+2)%r.length,l=g(e,t,n,r[u]+a,r[u+1]+i,r[s]+a,r[s+1]+i);o=o.concat(l)}return o}function m(e,t,n,r,a,i){var o=d(e,t,n,r.y2+i,r.x1+a,r.x2+a),u=d(e,t,n,r.y1+i,r.x1+a,r.x2+a),s=h(e,t,n,r.x1+a,r.y1+i,r.y2+i),l=h(e,t,n,r.x2+a,r.y1+i,r.y2+i);return o.concat(u,l,s)}function x(e,t,n,r,a,i,o){var u=Math.PI,s=o?r:a;if(i._c&&(s+=(o?1:-1)*i._c/n),i._cl&&i._cl.length>0)for(var l=0;l<i._cl.length;l++){var f,c=i._cl[l],g=i.x,d=i.y;f=c.length?v(e,t,n,c,g,d):c.r?De(e,t,n,c,g,d):m(e,t,n,c,g,d);for(var h=0;h<f.length;h++)f[h]+2*Math.PI<a&&(f[h]+=2*Math.PI),r<f[h]&&f[h]<a&&(o?f[h]-s<u&&(s=Math.max(s,f[h])):s-f[h]<u&&(s=Math.min(s,f[h])))}return s}function y(e,t,n,r,a,i,o,u){var s=x(t,n,r,a,i,e>0?o:u,!0),l=x(t,n,r,s,i,e>0?u:o,!1);return{startangle:s,endangle:l}}function p(e,t){var n=t(e.id),r=Ze(e),a=K("b",e,n),i=K("c",e,n);return!(!a&&!i||r)}function b(e,t,n,r,a,i,o,u,s,l,f,c,g,d,h,v,m){var x=(l+c)/2,b=(f+g)/2,I=c-l,w=g-f;i=Number(i);var B=i>0,C=Math.max(.001,w*w+I*I),A=Math.sqrt(C),M=(C/4+i*i)/(2*Math.abs(i)),Z=M-Math.abs(i),D=B?1:-1,L=x-w*D*Z/A,G=b+I*D*Z/A,S=Math.atan2(f-G,l-L),T=Math.atan2(g-G,c-L),E=B?S:T,k=B?T:S;E>k&&(k+=2*Math.PI),r=r||0,a=a||0;var V=E+(B?r:a)*(k-E),F=E+(B?1-a:1-r)*(k-E),W=y(i,L,G,M,E,k,u,s);if(W.startangle=Math.max(V,W.startangle),W.endangle=Math.min(F,W.endangle),!(W.startangle>=W.endangle)){var N=(W.startangle+W.endangle)/2,U={};U.lx=L+M*Math.cos(N),U.ly=G+M*Math.sin(N);var O,K,X,Y,H,z,P=1.5*h/M,_=-.25;return t?(O=B?W.startangle:W.endangle,K=L+M*Math.cos(O),X=G+M*Math.sin(O),B?W.startangle+=P:W.endangle-=P):ie&&p(u,m)&&(B?W.startangle+=_*P:W.endangle-=_*P),n?(Y=B?W.endangle:W.startangle,H=L+M*Math.cos(Y),z=G+M*Math.sin(Y),B?W.endangle-=P:W.startangle+=P):ie&&p(s,m)&&(B?W.endangle-=_*P:W.startangle+=_*P),W.startangle<W.endangle&&(M>1e5?e.line(l,f,c,g,d,h,o,v):e.arc(L,G,M,W.startangle,W.endangle,d,h,o,v),t&&R(e,K,X,h,+D*P*.66+O-D*Math.PI/2,d,o+pe+"a1"),n&&R(e,H,z,h,-D*P*.66+Y+Math.PI-D*Math.PI/2,d,o+pe+"a2")),U}}function I(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function w(e,t){var n,r=Ve,a=(e.e||1)*ze;return n=t.x>e.x&&"e"===e.sh?e.x+a*r:t.x<e.x&&"w"===e.sh?e.x-a*r:e.x}function B(e,t,n,r,a,i,o,u,s,l,c,g,d,h){var v,m,x=w(u,s),y=w(s,u),p=i||0;y>x?(v=x+se,m=y-se,v>m&&(v=m=(x+y)/2)):(v=x-se,m=y+se,m>v&&(v=m=(x+y)/2));var b=I(x,l,v,p),B=I(v,p,m,p),C=I(m,p,y,c),A=b+B+C,M=Math.atan2(p-l,v-x),Z=Math.atan2(p-c,m-y),D=0===b?0:f(d,b,M,u,x,l),L=0===C?0:f(d,C,Z,s,y,c);r=0===b?0:(r||0)*A/b,a=0===C?0:(a||0)*A/C,D=Math.min(1,Math.max(r,D)),L=Math.min(1,Math.max(a,L));var G,S,T,E,k,V,F,W,N=x+D*(v-x),U=l+D*(p-l),O=y+L*(m-y),K=c+L*(p-c);t&&(k=N,V=U,G=v-N,S=p-U,T=Math.max(.001,S*S+G*G),E=Math.sqrt(T),N+=1.5*d*G/E,U+=1.5*d*S/E),n&&(F=O,W=K,G=m-O,S=p-K,T=Math.max(.001,S*S+G*G),E=Math.sqrt(T),O+=1.5*d*G/E,K+=1.5*d*S/E),e.line3(N,U,v,p,m,p,O,K,g,d,o,h),t&&R(e,k,V,d,M+Math.PI,g,o+pe+"a1"),n&&R(e,F,W,d,Z+Math.PI,g,o+pe+"a2");var X={above:!0,lx:(v+m)/2,ly:(p+p)/2};return X}function C(e,t,n,r,a,i,o,u,s,l,f,g,d,h,v,m){var x=c(s,l,f,g,h,o,u,t,n,r,a);if(!x.skip){var y,b,I,w,B,C,A=x.cx1,M=x.cy1,Z=x.cx2,D=x.cy2,L=Z-A,G=D-M,S=Math.max(.001,G*G+L*L),T=Math.sqrt(S),E=.25;t?(y=Math.atan2(G,L),I=A,w=M,A+=1.5*h*L/T,M+=1.5*h*G/T):ie&&p(o,m)&&(A-=E*h*L/T,M-=E*h*G/T),n?(b=Math.atan2(G,L),B=Z,C=D,Z-=1.5*h*L/T,D-=1.5*h*G/T):ie&&p(u,m)&&(Z+=E*h*L/T,D+=E*h*G/T),e.line(A,M,Z,D,d,h,i,v),t&&R(e,I,w,h,y+Math.PI,d,i+pe+"a1"),n&&R(e,B,C,h,b,d,i+pe+"a2");var k={};return k.lx=(A+Z)/2,k.ly=(M+D)/2,k}}function A(e,t,n,r,a,i,o,u,s,l,f){function c(e){for(var t=n.length-1,a=r;t>=0;t--)e(n[t],a),t>0&&(a-=L(n[t-1],n[t])*i)}if(o){for(var g=0,d=0;d<n.length-1;d++)g+=L(n[d],n[d+1])*i;r+=g/2}else r-=D(n[n.length-1])*i;o&&u&&c(function(t,n){e.circle(n,a,Z(t)*i*1.25,ve.colours.white,-1,Ae(),!0,l)}),c(function(n,r){Q(e,t,l+pe+d,r,a,i,n,s,f)})}function M(e,n,r,i,o,u,s){function l(e){return g&&ge&&ce.hasOwnProperty(e)?ce[e]:r[e]}if(!r.hi){r._edit=null;var f,c=r.id,g=s(c),d=g&&!ge,h=l("b1"),v=l("b2"),m=l("c"),x=l("fb"),y=l("fbc"),p=l("fc"),I=l("ff"),w=l("fs"),M=l("ls"),Z=l("w"),D=i.x,L=i.y,G=o.x,R=o.y,T=(Z||1)*ze,E=m||ve.colours.midgrey,F=0;f="h"===r.st?B(n,r.a1,r.a2,h,v,r.y,c,i,o,L,R,E,T,M):r.off?b(n,r.a1,r.a2,h,v,r.off,c,i,o,D,L,G,R,E,T,M,s):C(n,r.a1,r.a2,h,v,c,i,o,D,L,G,R,E,T,M,s);var W=f?f.lx:(D+G)/2,U=f?f.ly:(L+R)/2;if(r._x=W,r._y=U,f){var O=f.lx,K=f.ly,X=O,Y=K,H=Me(r);w=Number(w||xe)*ze;var z=!1,P=p||ve.colours.black,_=y||ve.colours.textback;d&&(P=t(),_=Ae());var j=k(r),J=V(j,e,w,x,I),Q=w+3*ze;F=Q*j.length,j.length>0&&(X-=J[0]/2);for(var q=(j.length-1)*Q,$=f.above?K-(q+Q/2+T/2):K-q/2,te=0;te<j.length;te++){0===te&&(Y=$);var re=N(e,n,j[te],O,$,c,!0,P,_,x,r,!1,!0,99,J[te],d,w,I||ne);z=z||re,$+=Q}var ae=!a(r)||!z;if(ae&&d&&!H){var ie=Math.max(.66*(Z||0),w/2);n.circle(O,K,ie,ve.colours.white,-1,Ae(),!0,c)}H&&A(n,e,r.g,X,Y,1,ae,d,u,c),r.bu&&ee(n,e,c,O,K,F/2+4,1,r.bu,u)}S(i,"id1",c,D,L,n,T,E),S(o,"id2",c,G,R,n,T,E)}}function Z(e){var t=Re;return J(e)&&(t+=Se/2),e.e&&(t*=e.e),t}function D(e){return Z(e)+Le}function L(e,t){return Z(e)+Ge+Z(t)}function G(e){return 1.7*e+ze*("small"===te?6:10)}function R(e,t,n,r,a,i,o){var u=G(r),s=a+Math.PI;e.triangle(t+u*Math.cos(s+Te),n+u*Math.sin(s+Te),t+u*Math.cos(s-Te),n+u*Math.sin(s-Te),t,n,i,-1,i,!0,o)}function S(e,t,n,r,a,i,o,u){e.du&&i.circle(r,a,1.5*o,u,o,ve.colours.white,!0,n+pe+t)}function T(e){return Be.showFullLabel&&Be.showFullLabel===e}function E(e){return de&&("node"===e.type||"link"===e.type)&&e.t.length>de&&!T(e.id)}function k(e){if(e.t){var t=e.t+"";return E(e)&&(t=t.substring(0,de-3)+"..."),t.split(/\r\n|\r|\n/)}return[""]}function V(e,t,n,r,a){for(var i=[],o=0;o<e.length;o++)i[o]=ve.measureText(t,e[o],n,r,a||ne).width;return i}function F(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function W(e,t,n,r,a,i,o,u,s,l,f,c,g,d,h,v,m){var x=ve.measureText(e,n,v,l,m).width;return N(e,t,n,r,a,i,o,u,s,l,f,c,g,d,x,h,v,m)}function N(e,t,n,r,a,i,o,u,s,l,f,c,g,d,h,v,m,x){var y=!0;0===n.length&&(y=!1);var p=i+pe+"t";if(c&&h>d)return W(e,t,n,r,a,i,o,u,s,l,f,c,g,d,v,.85*m,x);var b,I=4*ze,w=r-h/2;b=g?a+1+m/2:a+(1+m)/2;var B={x1:w-I,y1:b-m,x2:w+h+I,y2:b};if(y){var C=g?we:0;t.text(r,b+C,n,u,m,l,p,x,!0,h,!1,o,B.x1,B.y1,B.x2,B.y2,s,v)}return f&&"node"===f.type&&(B.x1=B.x1-f.x,B.y1=B.y1-f.y,B.x2=B.x2-f.x,B.y2=B.y2-f.y),f&&U(f,B,m,y),y}function U(e,t,n,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,t.x1),e._edit.x2=Math.max(e._edit.x2,t.x2),e._edit.y1=Math.min(e._edit.y1,t.y1),e._edit.y2=Math.max(e._edit.y2,t.y2)):(e._edit=t,e._edit.fs=n),oe&&r&&e._cl&&e._cl.push(t)}function O(e,t){var n=e.getLayer(),r=ve.selMap[n];r&&e.setLayer(r),t(),r&&e.setLayer(n)}function K(e,t,n){return n&&fe&&le.hasOwnProperty(e)?le[e]:t[e]}function X(e,t){return t?Ue[e.sh]?e.sh:"box":e.sh in Ue?e.sh:e.sq?"box":"circle"}function Y(e,t,n,r,a,i,o,u,s){var l=r+i,f=a+i;if("circle"===e){var c=Math.min(l,f);o(c)}else{var g=t-l,d=n-f,h=t+l,v=n+f;if("box"===e)u(g,d,h,v);else{var m=i*Ne,x=r*Ve/ke+i*We;"e"===e?(h-=m,s(h,d,t+x,n,h,v,g,v,g,d)):(g+=m,s(g,v,t-x,n,g,d,h,d,h,v))}}}function H(e,t,n,r,a,i,o,u,s,l,f,c,g){Y(g,t,n,r,a,i,function(r){e.circle(t,n,r,o,u,l,f,c,s)},function(t,n,r,a){e.rect(t,n,r,a,o,u,l,f,c,s)},function(t,n,r,a,i,g,d,h,v,m){e.pentagon(t,n,r,a,i,g,d,h,v,m,o,u,l,f,c,s)})}function z(e,t,n,r,a,i,o){Y(o,t,n,r,a,i,function(t){e._c=t},function(r,a,i,o){e._cl.push({x1:r-t,y1:a-n,x2:i-t,y2:o-n})},function(r,a,i,o,u,s,l,f,c,g){e._cl.push([r-t,a-n,i-t,o-n,u-t,s-n,l-t,f-n,c-t,g-n])})}function P(e,t,n,r,a){function i(e){return K(e,n,l)}if(!n.hi&&!n.du){var o=n.id,u=Ze(n),s=X(n,u),l=a(o),f=l&&!fe,c=i("b"),g=i("bs"),d=i("c"),h=(u?1:i("e")||1)*ze,v=u?i("re"):!1,m=i("u"),x=i("fi");n._c=0,n._cl=[],n._edit=null;var y,p,b=!!c,I=!!d,w=!!m||!(!x||!x.t),B=b?c:ve.colours.white,C=b?h*(i("bw")||Ee):0,A=I?d:ve.colours.white,M=n.x,Z=n.y;u?(y=n.w/2,p=n.h/2):y=p=h*ke;var D,L=y+C/2,G=p+C/2,R=b?C:h*Ee,S=3*R/4;if(D=ie?b||I?C/2:S-R/2:S+R/2,(b||I)&&H(t,M,Z,L,G,0,B,C||-1,g,A,I,o,s),(w||b||I)&&(z(n,M,Z,L,G,D,s),l&&(v&&!w&&(Ye=t.cloneLast()),f))){var T=Ae();O(t,function(){H(t,M,Z,L,G,S,T,R,null,T,!1,o,s),v&&(Xe=t.getLast())})}if(w){if(m)t.image(M-y,Z-p,M+y,Z+p,r+m,o,n.ci?"ci":void 0,1);else{var E=u?Math.min(y,p):y;q(t,e,o,M,Z,E,x.t,x.c||ve.colours.black,re)}l&&v&&(Ye=t.cloneLast())}_(t,e,M,Z,C,y,p,n,u,s,b,I,w,f,h,o,r,i)}}function _(e,n,r,i,o,u,s,l,f,c,g,d,h,v,m,x,y,p){var b,I=r,w=r,B=i,C=Me(l),M=!1,Z=p("fb"),L=p("fbc"),G=p("fc"),R=p("ff"),S=(p("fs")||xe)*m,T=3*m+S/2,E=G?G:ve.colours.black,F=L?L:ve.colours.textback;v&&(E=t(),F=Ae());var W=i+s+T,U=k(l),O=V(U,n,S,Z,R),K=S+3,X=K,Y=K*U.length;U.length>0&&(w-=O[0]/2);var H=f||h||g||d,z=me.defined(l.tc)?!!l.tc:!h&&!f,P=(U.length-1)*X/2;if(H)z&&(W=i-P);else{if(C){var _=D(l.g[l.g.length-1])*m;w=r+_,r+=O[0]/2+_}W=i,i+=P}var j=r;if(("e"===c||"w"===c)&&(g||d)){var J=8*m;j+="e"===c?J:-J}U.length>0&&(B=W),g&&!z&&(W+=o-3*m);for(var q=0;q<U.length;q++){var te=N(n,e,U[q],j,W,x,!0,E,F,Z,l,!1,!0,99,O[q],v,S,R||ne);M=M||te,W+=X}var re=!a(l)||!M;if(C)if(h||g||d){var ae=3,ie=h?11:3;if(!f&&!h&&"circle"===c){var oe=2;ae+=oe,ie+=oe}f&&(ae++,ie++);var ue=ae*m,se=ie*m;if(l.g.length)for(b=0;b<l.g.length;b++){var le,fe=l.g[b],ce=null,ge=!1;switch(fe.p){case"ne":ce=u-ue,le=-s+se;break;case"nw":ce=-u+ue,le=-s+se,ge=!0;break;case"sw":ce=-u+ue,le=s-se,ge=!0;break;case"se":ce=u-ue,le=s-se}null!==ce&&Q(e,n,x+pe+fe.p,l.x+ce,l.y+le,m,fe,y,l,ge,!0)}}else A(e,n,l.g,re?I:w,B,m,re,v,y,x,l);if(f||$(e,x,r,i,m,p),l.bu){var de=0;H?de=s:Y>0?de=Y/2+4:Me(l)&&(de=13*m),ee(e,n,x,r,i,de,m,l.bu,y)}}function j(e,t){var n=0,r=0;if(a(e)){var i=(e.fs?e.fs:xe)*(e.e?e.e:1),o=k(e),u=V(o,t,i,e.fb,e.ff);n=F(u),r=i*(o.length+1),e.u||(n/=10)}return{width:n,height:r}}function J(e){return"b"in e?e.b:ve.colours.keyline}function Q(e,t,n,r,a,i,o,u,s,l,f){if(o){o.e&&(i*=o.e);var c=o.a?Ke:1,g=Re*i*c,d=J(o),h=d?Se*i:-1,v=g+(d?h/2:0),m=!!(o.u||o.fi&&o.fi.t);if(o.c){if(o.t){var x,y,p,b,I=o.hasOwnProperty("fb")?o.fb:!0,w=o.fc||ve.colours.white,B=o.ff||ne;if(o.w&&f){x=i*ye[1]*c,p=(o.t+"").substring(0,25),y=ve.measureText(t,p,x,I,B).width,b=Math.max(y,g);var C,A,M=g;l?(C=r-(b-M)-g,A=r+g,r-=(b-M)/2):(C=r-g,A=r+(b-M)+g,r+=(b-M)/2);var Z=a-g,D=a+g;e.round(C,Z,A,D,g,d,h,o.c,!0,n),s&&(s._cl.push({cx:C+g-s.x,cy:a-s.y,r:v}),s._cl.push({cx:A-g-s.x,cy:a-s.y,r:v}),s._cl.push({x1:C+g-s.x,x2:A-g-s.x,y1:Z-s.y-h/2,y2:D-s.y+h/2}))}else e.circle(r,a,g,d,h,o.c,!0,n),p=(o.t+"").substring(0,4),x=i*ye[p.length-1]*c,y=ve.measureText(t,p,x,I,B).width,b=1.7*g,s&&s._cl.push({cx:r-s.x,cy:a-s.y,r:v});N(t,e,p,r,a,n,!1,w,ve.colours.white,I,null,!0,!1,b,y,!1,x,B)}else if(e.circle(r,a,g,d,h,o.c,!0,n),s&&s._cl.push({cx:r-s.x,cy:a-s.y,r:v}),m){var L=g/1.41421;o.u?e.image(r-L,a-L,r+L,a+L,u+o.u,n):q(e,t,n,r,a,L,o.fi.t,o.fi.c||ve.colours.black,re)}}else m&&(s&&s._cl.push({cx:r-s.x,cy:a-s.y,r:g}),o.u?e.image(r-g,a-g,r+g,a+g,u+o.u,n):q(e,t,n,r,a,g,o.fi.t,o.fi.c||ve.colours.black,re));o.a&&(He=He||{},He[me.rawId(n)]=!0)}}function q(e,t,n,r,a,i,o,u,s){e.rect(r-i,a-i,r+i,a+i,ve.colours.transparent,-1,ve.colours.transparent,!0,n);var l=2*i,f=ve.measureText(t,o,l,!1,s||ne).width,c=f-l,g=l-(c>0?5*c/4:0);f=ve.measureText(t,o,g,!1,s||ne).width,e.text(r,a+g/2,o,u,g,!1,n,s,!0,f,!0,n,r-i,a-i,r+i,a+i)}function $(e,t,n,r,a,i){var o=e.getLayer();e.setLayer(ve.layers.HALOS);for(var u=0;u<Oe.length;u++){var s=Oe[u],l=i(s);if(l){var f=t+pe+s,c=l.r*a,g=l.w*a;g/2>=c?e.circle(n,r,c+g/2,ve.colours.white,-1,l.c,!0,f,null,!0):e.circle(n,r,c,l.c,g,ve.colours.white,!1,f,null,!0)}}e.setLayer(o)}function ee(e,t,n,r,a,i,o,u,s){if(u.t){var l=e.getLayer();e.setLayer(ve.layers.BUBBLES);var f=u.p?""+u.p:"ne",c="w"===f.substring(1,2),g="s"===f.substring(0,1),d=n+pe+"bu",h=Number(u.fs?u.fs:xe)*ze,v=u.b?u.b:ve.colours.keyline,m=u.c?u.c:ve.colours.white,x=u.fc?u.fc:ve.colours.black,y=k(u),p=h+3*ze,b=p*y.length,I=V(y,t,h,u.fb,u.ff),w=F(I),B=13*ze,C=6*ze,A=2*o,M=9*ze,Z=13*ze,D=10*ze;i+=Z;var L=b+2*C,G=2*ze,R=Math.max(G/2,1),S=3*ze;u.g&&delete u.g.e;var T=u.g?17*ze:0;c&&(r-=w+2*A+2*B+T),g&&(a+=(h+3)*y.length+2*i+2*C);var E=r+A+.5,W=r+A+2*B+w+T+.5,N=a-i-L+.5,U=a-i+.5;e.round(E,N,W,U,8*ze,v,G,m,!0,d),Q(e,t,d,r+T,(N+U)/2,ze,u.g,s);var O,K=N-.5+C+p,X=E+B+T-.5;for(O=0;O<y.length;O++){var Y=I[O];e.text(X,K,y[O],x,h,u.fb,d,u.ff||ne,!1,Y,!1,!1,X-1.5,K-h,W,U),K+=p}c&&(E=W,M=-M,D=-D,R=-R),g&&(U=N,Z=-Z,S=-S),e.triangle(E+M,U,E+M+D,U,E+M,U+Z,v,G,m,!0,d),e.triangle(E+M+R,U-S,E+M+D+R,U-S,E+M+R,U+Z-S,v,-1,m,!0,d),e.setLayer(l)}}var te,ne,re,ae,ie,oe,ue,se,le,fe,ce,ge,de,he={},ve=KeyLines.Rendering,me=KeyLines.Util,xe=he.fontSize=14,ye=[12,9,7,7],pe=me.idSep(),be=1,Ie=2,we=0,Be={};he.setSpecialOptions=function(e,t){Be[e]=t};var Ce=!1;he.setDashSupport=function(e){Ce=!!e};var Ae=he.editColour=function(){return ae||ve.colours.edit};he.setOptions=function(e){te=e.arrows,me.isNumber(e.labelOffset)&&(we=e.labelOffset),de=e.truncateLabels&&e.truncateLabels.maxLength&&me.isNumber(e.truncateLabels.maxLength)?e.truncateLabels.maxLength:!1,e.selectionColour&&(ae=ve.validatergb(e.selectionColour)?e.selectionColour:void 0),se=e.fanLength,ne=e.fontFamily,re=e.iconFontFamily,oe=e.linkEnds.avoidLabels,ie="loose"!==e.linkEnds.spacing,e.selectionFontColour&&(ue=ve.validatergb(e.selectionFontColour)?e.selectionFontColour:void 0),le=e.selectedNode,fe=me.isNormalObject(e.selectedNode),ce=e.selectedLink,ge=me.isNormalObject(e.selectedLink)};var Me=he.itemHasGlyph=function(e){return e.hasOwnProperty("g")&&Array.isArray(e.g)&&e.g.length>0},Ze=he.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)},De=function(e,t,n,r,a,i){var o=r.cx+a-e,u=r.cy+i-t,s=Math.sqrt(o*o+u*u);if(s>n+r.r||s<Math.abs(n-r.r)||0===s)return[];var l=(n*n-r.r*r.r+s*s)/(2*s),f=Math.sqrt(n*n-l*l),c=e+l*o/s,g=t+l*u/s,d=c+f*u/s,h=c-f*u/s,v=g-f*o/s,m=g+f*o/s;return[Math.atan2(v-t,d-e),Math.atan2(m-t,h-e)]},Le=3,Ge=1,Re=9,Se=2,Te=Math.PI/7;he.labelPosition=function(e,t){if(!e||e.hi)return null;var n=e._edit,r=n.x1,a=n.y1,i=n.x2,o=n.y2;return"node"===e.type&&(r+=e.x,a+=e.y,i+=e.x,o+=e.y),{x1:t.x(r),y1:t.y(a),x2:t.x(i),y2:t.y(o),fs:t.dim(n.fs)}};var Ee=4,ke=27,Ve=50,Fe=Ve-ke,We=Math.sqrt(ke*ke+Fe*Fe)/ke,Ne=1-Math.sin(Math.atan2(ke,Fe)/2),Ue={box:!0,circle:!0,e:!1,w:!1};he.nodeSize=function(e,t,n){if(e.w&&e.h)return me.len(e.w,e.h)/2;if(e.du)return 10;var r=ke*(e.e?e.e:1),a=j(e,t);if(n){var i=r+a.height/2,o=a.width/2;return me.len(o,i)}return r+a.height/2};var Oe=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];he.contains=function(e,t){function n(e,t){e&&i.push(t)}var r,a,i=[];if(e=me.defaults(e,{sh:"box",x:0,y:0}),Ze(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(a in t)r=t[a],Ze(r)?"circle"===r.sh?n(ve.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):n(ve.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):n(ve.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var u={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(a in t)if(r=t[a],Ze(r))if("circle"===r.sh){var s=Math.min(r.w,r.h)/2;n(ve.rectContains(u,r.x-s,r.y-s,r.x+s,r.y+s),r.id)}else n(ve.rectContains(u,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else n(ve.inside(u,r.x,r.y),r.id)}return i};var Ke,Xe,Ye,He,ze=1;return he.getResizePrimitive=function(){return Ye},he.animated=function(){return!!He},he.generate=function(t,n,r,a,i,o,u,s,l,f){function c(e){i.resetItem(e,e.x,e.y),i.setLayer(Ze(e)?ve.layers.SHAPES:ve.layers.NODES),P(o,i,e,l,f)}function g(e){i.resetItem(e),i.setLayer(ve.layers.LINKS),M(o,i,e,t[e.id1],t[e.id2],l,f)}if(Ye&&(r||a[Ye.id]===Ie)&&(Xe=null,Ye=null),He=null,Ke=e.atanEasing(Date.now()%1e3/1e3),ze=u.getUnzoom(),r){i.removeAllItems();for(var d in t)c(t[d]);for(var h in n)g(n[h])}else{var v;for(v in a){var m=t[v];m?a[v]===be?i.moveItem(m,m.x,m.y):c(m):n[v]||i.removeItem(v)}for(v in a)n[v]&&g(n[v])}return i.assembleItems(),He},he.generateHandles=function(e,t,n,r){e.extras(),e.setLayer(ve.layers.HANDLES),Xe&&1===r.length&&(ve.getHandles(e,t,n,Xe,1,Xe.id,Ae(),pe),ve.getHandles(e,t,n,Xe,4,Xe.id,ve.colours.transparent,pe))},he}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=2048,n=244;e.FontIconAtlas=function(e,a,i){var o=Object.keys(e),u=document.createElement("canvas");if(u.id="webglFontIconDebugCanvas",u.width=1,u.height=1,o.length){var s=r(o.length,t),l=u.getContext("2d");u.width=s,u.height=s;var f=document.getElementById("webglFontIconDebugCanvas");i&&(f?f.parentNode.replaceChild(u,f):document.getElementsByTagName("body")[0].appendChild(u));var c=4,g=2*c+n/2,d=c,h=1/s;l.fillStyle="rgb(0,0,0)",l.textAlign="center";var v=0,m=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"];l.fillStyle="black",l.fillRect(0,0,s,s),l.fillStyle=m[0],l.globalCompositeOperation="lighter";for(var x=0,y=o.length;y>x;x++){var p=e[o[x]];if(g+n>s+128&&(g=c+n/2,d+=c+n),d+n>=s){if(g=c+n/2,d=0,v++,v>2)throw new Error("Maximum number of icons exceeded!");l.fillStyle=m[v]}p.colourComponentTexture=v,p.u1=(g-128)*h,p.v1=d*h,p.u2=(g-128+n)*h,p.v2=(d+n)*h,l.textBaseline="top",l.font=n+"px "+a;var b=l.measureText(o[x]).width,I=n*(n/b)-2*c;if(n>I){var w=n-I;l.font=I+"px "+a,l.fillText(o[x],g-c,d+w/4)}else l.fillText(o[x],g-c,d,236);g+=2*c+n}}return{img:u,texture:null}};var r=function(e,t){for(var n=512,r=12;t>n;){if(r>=e)return n;n*=2,r*=4}return t}}}(),function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(e){function t(){return f&&f.api.isShown()}function n(e,t,n){t=t||{all:!0,positions:!0,colours:!0,textures:!0,shadow:!0},e?M.afterChange(n):(M.render(t),x.invoke(n))}function r(e){return e===!0&&(e={animate:!0}),x.defaults(e,{animate:!1,time:1e3})}function a(e){return isFinite(e)?Math.min(Math.max(0,e),1):e?1:0}function i(e){return e=x.defaults(e,{type:"all",animate:!0,time:1e3,updateGlyph:!0}),x.defaults(e,{hideSingletons:"link"===e.type})}function o(e){var t=b.viewOptions(),n=t.height>0?t.width/t.height:1;return x.defaults(e,{fit:!0,animate:!0,tidy:!0,ratio:n,tightness:5,straighten:!0})}function u(e,n,r,a,i){function o(e,t){b.privateEach({type:"link"},function(n){if(!e[n.id1]||!e[n.id2]){var r=e[n.id1]||e[n.id2],a=e[n.id1]?n.id2:n.id1;r&&a&&(t[a]||(t[a]={x:0,y:0,_counter:0,id:a}),t[a].x+=r.x,t[a].y+=r.y,t[a]._counter++)}});var n=0;return x.iterator(t,function(t){e[t.id]||(t.x/=t._counter,t.y/=t._counter,e[t.id]=t,n++)}),n}function u(e,n,r){if(t())return r();for(var a,i={},u=[];0!==a;)a=o(n,i);x.iterator(e,function(e){"node"===e.type&&(i[e.id]||(e.x=d[e.id].x,e.y=d[e.id].y))}),x.iterator(i,function(e){u.push(e)}),b.setProperties(u,!1,r)}function s(){var e=[],t={};return C.each({type:"node"},function(n){e.push(n.id),t[n.id]=n}),{list:e,dict:t}}function l(){var e={};return C.each({type:"all"},function(t){e[t.id]=!0}),e}function f(t){var n={},r={};return x.iterator(e,function(e){n[e.id]=e,"adjacent"!==i&&"nonadjacent"!==i||"link"!==e.type||t[e.id]||(t[e.id1]&&(r[e.id1]=!0),t[e.id2]&&(r[e.id2]=!0))}),{dict:n,touched:r}}function c(e,t){switch(i){case"all":return e;case"adjacent":return x.flattenMap(t);case"nonadjacent":return e.filter(function(e){return!t[e]});case"none":default:return[]}}function g(e){for(var t=[],n={},r=0;r<e.length;r++){var a=e[r];x.isNullOrUndefined(a)||n[a.id]||(n[a.id]=1,d[a.id]={x:a.x,y:a.y},delete a.x,delete a.y,t.push(a))}return t}var d={};e=g(e);var h=s(),v=h.dict,m=l(),y=f(m),p=y.dict,I=c(h.list,y.touched);b.merge(e,function(){n(p,function(){u(e,v,function(){r(m,function(){a(I)})})})})}function s(e,t){M.draw(e,t),M.drawoffscreen(),M.afterDraw()}var l,f,c=KeyLines.Controller,g=KeyLines.Draggers,d=KeyLines.Events,h=KeyLines.Model,v=KeyLines.Overlays,m=KeyLines.Rendering,x=KeyLines.Util,y=KeyLines.View,p=KeyLines.Iterators,b={},I=d.createEventBus(),w=g.createDraggers(I),B=KeyLines.Generator.create(I),C=h.createModel(I,w,B);f=KeyLines.Map.create(b,I,e);var A=v.createOverlays(I,y,f),M=c.createController(b,I,A,B,f),Z=p.create(M,I,b);M.setModel(C);var D;b.privateInit=function(e,t,n,r,a,i,o,u,s){D=r,M.assetPath(o),M.setCursorFn(a),M.setCreateCanvasFn(r),M.setImageGenFn(i),L(e,t,n,u),M.imageBasePath(s)};var L=b.privateSetSize=function(e,t,n,r,a){var i=D(t,n);M.makeGhostCanvas(t,n),r&&(t/=r,n/=r);var o=l;l=y.createView(I,t,n,r,f),M.setView(l),M.setCanvas(e),M.setShadowCanvas(i.getContext("2d"),t,n),m.clearLastFont(),o&&(l.setMinZoom(o.getMinZoom()),l.setMaxItemZoom(o.getMaxItemZoom()),l.fromOldSettings(o.settings(),!1)),M.afterChange(null,a)};b.privateMapSetSize=function(e,t){f.internalUse.setSize(e,t)},b.graph=function(){return C.graph()},b.map=function(){return f.api},b.combo=function(){return M.combo.api},b.toDataURL=function(e,n,r,a){function i(t){e=Math.floor(e/t),n=Math.floor(n/t)}if(e=Math.floor(e),n=Math.floor(n),e=e>0?e:100,n=n>0?n:100,r=x.defaults(r,{fit:"view",watermark:!0,gradient:!0,logo:!0}),t()&&(r.fit="exact"),"oneToOne"===r.fit){var o=M.modelExtents();o||(o={x1:0,y1:0,x2:100,y2:100});var u=10;o.x1-=u,o.y1-=u,o.x2+=u,o.y2+=u;var s=M.watermarkSize();if(s&&r.watermark){var g=(s.width-(o.x2-o.x1))/2;g>0&&(o.x1-=g,o.x2+=g);var h=(s.height-(o.y2-o.y1))/2;h>0&&(o.y1-=h,o.y2+=h)}e=o.x2-o.x1,n=o.y2-o.y1,r.noScale=!0}var m=16e6,p=e*n,I=p/m;if(I>1){var w=Math.sqrt(I);i(w)}var A=8e3,Z=e/A;Z>1&&i(Z);var L=n/A;L>1&&i(L);var G=D(e,n,!0),R=G.getContext("2d"),S=r.noScale?1:e/l.width(),T=d.createEventBus(),E=y.createView(T,Math.floor(e/S),Math.floor(n/S),S,f),k=v.createOverlays(T,y),V=c.createController(b,T,k,B);V.setCreateCanvasFn(D),V.setModel(C),V.setView(E),V.setCanvas(R),V.setShadowCanvas(null,e,n),V.assetPath(M.assetPath()),V.imageBasePath(M.imageBasePath()),V.imageList(M.imageList());var F=M.options();F.overview={shown:!1},r.watermark||(F.watermark=!1),r.gradient||(F.gradient=!1),r.logo||(F.logo=!1),V.options(F,null,!0),V.backgroundOpacity(M.backgroundOpacity());var W=V.makeGhostCanvas(E.width(),E.height()),N=[];switch(r.selection||(N=C.doSelection(),C.doSelection([])),r.fit){case"chart":V.fitToModel(!1);break;case"view":E.fromOldSettings(l.settings(),!0);break;case"exact":E.fromOldSettings(l.settings(),!1);break;case"oneToOne":E.fitWorldExtents(o,!1,!1,!1,0,0)}E.scaleFactor(S),V.draw(!0,{all:!0});var U;try{U=G.toDataURL()}catch(O){throw new Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}finally{if("rtl"===G.dir){var K=document.getElementsByTagName("body")[0];K.removeChild(G),K.removeChild(W)}}return r.selection||C.doSelection(N),C.setAllDirty(),a?t()?f.internalUse.toDataURL(e,n,r,D,G,a):x.invoke(a,U):U},b.load=function(e,t){switch(e&&e.type){case"LinkChart":if(f&&f.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");C=h.createModel(I,w,B),M.setModel(C),M.load(e,function(){M.afterChange(t,null,!0)});break;default:throw new Error("Unknown chart type passed to load")}},b.chartType=function(){return C.type()},b.clear=function(){I.trigger("prechange","delete"),C.load({items:[]}),M.combo.internalUse.loadUp(),M.afterChange(null,null,!0)},b.merge=function(e,t){e=x.getItemsArray(e);var r=M.merge(e);n(r,null,function(){M.postMerge(t)})},b.privateMerge=function(e,t){var r=C.merge(e);n(r,null,t)},b.privateEach=function(e,t){C.each(e,t)},b.privateBothEndsShown=function(e){return C.bothEndsShown(e)},b.privateRemoveItem=function(e){C.removeItem(e),M.render()},b.privateGraph=function(){return C.graph()},b.setProperties=function(e,t,r){var a=M.setProperties(e,t);n(a,{all:!0,colours:!0},r)},b.animateProperties=function(e,t,n){t=x.defaults(t,{time:1e3,easing:"linear",queue:!0}),e=x.ensureArray(e),M.animateProperties(e,t,n)},b.privateAnimateBackgroundOpacity=function(e,t,n){t=x.defaults(t,{time:500}),e=a(e),M.animateBackgroundOpacity(e,t.time,n)},b.privateSetBackgroundOpacity=function(e){e=a(e),M.backgroundOpacity(e)},b.ping=function(e,t,n){t=x.defaults(t,{c:"#909090",w:20,r:80,time:800,repeat:1}),M.ping(e,t,n)},b.getItem=function(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=C.getItem(e[n]);r=r||null,t.push(r)}return t}return C?C.getItem(e):null},b.setItem=function(e,t){if(e){I.trigger("prechange","properties");var r=M.setItem(e);n(r,{all:!0},function(){M.postMerge(t)})}},b.removeItem=function(e){I.trigger("prechange","delete"),M.removeItem(e),M.render()},b.each=function(e,t){return e=KeyLines.Util.defaults(e,{type:"all"}),Z.each(e,t)},b.filter=function(e,t,n){return t=i(t),Z.filter(e,t,n)},b.foreground=function(e,t,n){return t=KeyLines.Util.defaults(t,{type:"node"}),Z.foreground(e,t,n)},b.hide=function(e,t,n){I.trigger("prechange","hide"),e=x.ensureArray(e),t=r(t),M.hide(e,t,n)},b.hidden=function(){return C.hidden()},b.show=function(e,t,n,a){I.trigger("prechange","show"),e=x.ensureArray(e),n=r(n),M.show(e,t,n,a)},b.labelPosition=function(e){return C?M.labelPosition(e,l):null},b.contains=function(e){return C?C.contains(e):[]},b.serialize=function(){var e=C.serialize();return M.appendCombos(e),f.internalUse.appendMap(e),e.viewSettings=l.settings(),e},b.worldCoordinates=function(e,t){var n=l.scale(e),r=l.scale(t);return{x:l.viewToWorldX(n),y:l.viewToWorldY(r)}},b.viewCoordinates=function(e,t){var n=l.worldToViewX(e),r=l.worldToViewY(t);return{x:l.unscale(n),y:l.unscale(r)}},b.viewOptions=function(e,t,n){if(!e)return l.settings();var a=r(t);e=x.defaults(e,{offsetX:0,offsetY:0,zoom:1}),M.setViewSettings(e,a.animate,a.time,function(){M.render({drawOnly:!0}),x.invoke(n)})},b.options=function(e,t){return M.options(e,t)},b.displayOptions=function(e,t){return b.options(e,t)},b.interactionOptions=function(e){return b.options(e)},b.lock=function(e,t){return"undefined"!=typeof e&&(G=e,f&&f.internalUse.lock(G),e?(t=t||{},M.wait(t.wait),M.removeDragger()):M.wait(!1),M.render()),G};var G=!1;b.zoom=function(e,t,n){var a=r(t);switch(e){case"in":M.zoomIn(a.animate,a.time,n);break;case"out":M.zoomOut(a.animate,a.time,n);break;case"one":M.setZoom(1,a.animate,a.time,n);break;case"fit":M.fitToModel(a.animate,a.time,n);break;case"selection":M.fitToSelection(a.animate,a.time,n);break;case"height":M.fitModelHeight(a.animate,a.time,n)}},b.pan=function(e,n,a){var i=r(n);"selection"!==e||t()?M.pan(e,i.animate,i.time,a):M.fitToSelection(i.animate,i.time,a,!0)},b.getLastError=function(){return I.getErrors()},b.imagePrefix=function(e){return M.imagePrefix(e)},b.cancelAnimation=function(){M.cancelAnimation()},b.layout=function(e,n,r){return t()?x.invoke(r):(e||(e="standard"),n=o(n),void M.layout(e,n,r))},b.arrange=function(e,t,n,r){e||(e="grid"),n=x.defaults(n,{fit:!1,animate:!0,tidy:!1,ratio:1}),M.arrange(e,t,n,r)},b.selection=function(e){e=x.isNullOrUndefined(e)?e:x.ensureArray(e);var t=C?C.doSelection(e):[];return e&&M.render(),
t},b.expand=function(e,t,n){function r(e){function t(t,n){function r(e){return t[e.id]?c.filter.filterFn(e):!e.hi}if(c.filter&&x.hasAnyKeys(t)){var a=x.clone(c.filter);return a.animate=e,b.filter(r,a,n)}return n()}return t}function a(e){c.layout.fixed=e,b.layout(c.layout.name,c.layout,n)}function s(e,t){var n=null;if(e.filter&&x.isFunction(e.filter.filterFn)){var r=e.filter.filterFn;n=i(e.filter),n.time=Math.floor(t.time/5),n.filterFn=r}return n}function l(e,t){t.layout.animate=t.animate,x.defaults(t.layout,{fit:t.fit,straighten:t.straighten,tidy:t.tidy,tightness:t.tightness});var n=e.layout?"nonadjacent":"all",r={name:"standard",strategy:"spiral",tidy:!1,fit:!1,fix:n},a=x.defaults(t.layout,r);return o(a)}function f(e){e.filter?e.layout.time=e.time-e.filter.time:e.layout.time=e.time}t=t||{};var c=x.defaults(t,{animate:!0,time:1e3,layout:{},filter:{}});c.filter=s(t,c),c.layout=l(t,c),f(c),I.trigger("prechange","expand"),e=x.ensureArray(x.getItemsArray(e)),u(e,r(!1),r(c.animate),a,c.layout.fix)},b.createLink=function(e,t,n,r){function a(e,t){"dummy"===e&&(b.removeItem(o),b.unbind("dragcomplete",a),x.invoke(r,t))}var i=b.getItem(e);if(b.getItem(t))throw new Error("LinkId ("+t+") already exists and must be unique");if(e&&i&&"node"===i.type&&t){t=x.rawId(t),n=x.defaults(n,{style:{}}),b.bind("dragcomplete",a);var o="dummyEnd"+Math.floor(1e7*Math.random()),u={type:"node",du:!0,id:o,x:i.x,y:i.y},s=x.merge(n.style,{id:t,id1:e,id2:o,type:"link"});b.merge([u,s],function(){x.nextTick(function(){M.startDragger(t,o+x.idSep()+"id2",i.x,i.y)},50)})}},KeyLines.Common.appendActions(b,M,b.lock),b.mousemove=function(e,t,n,r){M.mousemove(e,t,n,r,G)},b.dragover=function(e,t){M.dragover(e,t)},x.merge(b,I);var R=KeyLines.Common.frameManager(s,M.animate);return x.merge(b,R),b.bind("redraw",R.redraw),b}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.LineShader=function(t){function n(e,t,n,r,a,i){c.uniform2f(h.resolution,t,n),c.uniformMatrix4fv(h.transform,!1,e.get()),c.uniform1f(h.hitTest,0|r),c.uniform1f(h.zoom,e.getZoomLevel()),c.uniform1f(h.shadowType,a),c.uniform1f(h.viewIndependent,0|!i)}function r(e){e.elementBuffer||(e.elementBuffer=c.createBuffer()),e.indexBuffer||(e.indexBuffer=c.createBuffer())}function a(e){c.bindBuffer(c.ARRAY_BUFFER,e.elementBuffer),c.enableVertexAttribArray(h.position),c.enableVertexAttribArray(h.width),c.enableVertexAttribArray(h.vertexInfo),c.enableVertexAttribArray(h.colour),c.enableVertexAttribArray(h.shadowColour),c.vertexAttribPointer(h.position,4,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(h.width,1,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(h.vertexInfo,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,20),c.vertexAttribPointer(h.colour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,24),c.vertexAttribPointer(h.shadowColour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,28)}function i(e,t){(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.positions||e.rebuildOptions.colours||e.rebuildOptions.textures||e.rebuildOptions.shadow)&&(c.bindBuffer(c.ARRAY_BUFFER,t.elementBuffer),c.bufferData(c.ARRAY_BUFFER,t.elementData,c.DYNAMIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,t.elementIndex,c.DYNAMIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null))}function o(e){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.indexBuffer),c.drawElements(c.TRIANGLES,3*e.numOfTriangles,c.UNSIGNED_INT,0)}function u(){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindBuffer(c.ARRAY_BUFFER,null)}var s=e.Utils,l=e["line-vertex"],f=e["line-fragment"],c=t,g={},d=s.createProgram(c,atob(l),atob(f));c.getExtension("OES_standard_derivatives"),c.getExtension("OES_element_index_uint");var h={hitTest:c.getUniformLocation(d,"u_hitTest"),zoom:c.getUniformLocation(d,"u_zoom"),transform:c.getUniformLocation(d,"u_transform"),resolution:c.getUniformLocation(d,"u_resolution"),shadowType:c.getUniformLocation(d,"u_shadowType"),viewIndependent:c.getUniformLocation(d,"u_viewIndependent"),position:c.getAttribLocation(d,"a_position"),colour:c.getAttribLocation(d,"a_colour"),width:c.getAttribLocation(d,"a_width"),vertexInfo:c.getAttribLocation(d,"a_vertexInfo"),shadowColour:c.getAttribLocation(d,"a_hitTestColour")};return g.drawItems=function(e,t,s,l,f,g){c.useProgram(d),u(),n(s,l,f,g,0|e.shadowType,e.useView),r(t),i(e,t),a(t),o(t),u()},g})}(),function(){var e=KeyLines.Combo={};e.create=function(e){function t(t,n){function r(e){t[e.id]&&a.push(e.id)}var a=[];return e.privateEach({type:n},r),a}function n(e){for(var t={},n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function r(e){var t=[];for(var n in e)n=Y.rawId(n),t.push(e[n]);return t}function a(e){return e+Math.floor(1e7*Math.random())}function i(e,t){var n=a(t);return e[n]?i(e):n}function o(e,t){return e.substring(0,t.length)===t}function u(e){return o(e,H)&&!!z[e]}function s(e){var t=[];if(u(e))for(var n=z[e].nodes,r=0;r<n.length;r++)u(n[r].id)?t=t.concat(s(n[r].id)):t.push(n[r]);return t}function l(e){var t=[];if(u(e))for(var n=z[e].nodes,r=0;r<n.length;r++)u(n[r].id)&&(t.push(n[r].id),t=t.concat(l(n[r].id)));return t}function f(e,t){var n=P[e.id];if("undefined"==typeof n)return 0;var r=z[n],a=+e[t]-r[t];return a+f(r,t)}function c(e,t,n){var r=i(z,H);return z[r]={id:r,nodes:e,x:t,y:n},r}function g(e){var t=z[e];return delete z[e],t}function d(){var e={};for(var t in z){t=Y.rawId(t);for(var n=0;n<z[t].nodes.length;n++)e[z[t].nodes[n].id]=t}return e}function h(){P=d()}function v(e){for(var t;e;)t=e,e=P[e];return t}function m(e){return e!==v(e)}function x(e){return o(e,_)}function y(){var t=a(_);return e.getItem(t)?y():t}function p(e,t,n){var r=v(e.id1),a=v(e.id2);return r===t&&a===n||r===n&&a===t}function b(t){if(x(t)){var n=e.getItem(t);if(n){var r=[];for(var a in j)a=Y.rawId(a),p(j[a],n.id1,n.id2)&&r.push(j[a]);return r}}return null}function I(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r].id]=1;for(var a in j){a=Y.rawId(a);var i=j[a];n[i.id1]&&n[i.id2]&&t.push(i)}return t}function w(){function t(e,t,n){var r=t>e?e:t,a=e>t?e:t;f[r]||(f[r]={}),f[r][a]||(f[r][a]=[]),f[r][a].push(n)}function n(e){return e.some(function(e){return!e.hi})}function r(e){return!(o(e,H)&&!z[e])}function a(e){for(var t={},n=s(e),r=0;r<n.length;r++)t[n[r].id+""]=1;return t}function i(e,t,n,r){var i,o,s,l;u(t)?s=a(t):(s={},s[t+""]=1),u(n)?l=a(n):(l={},l[n+""]=1);for(var f=0;(!i||!o)&&f<r.length;f++){var c=r[f];i=i||c.a1&&c.id1 in s,i=i||c.a2&&c.id2 in s,o=o||c.a2&&c.id2 in l,o=o||c.a1&&c.id1 in l}e.a1=i,e.a2=o}var l={};e.privateEach({type:"node"},function(e){l[e.id]={}}),e.privateEach({type:"link"},function(e){l[e.id1][e.id2]=l[e.id2][e.id1]=!0});var f={};for(var c in j){c=Y.rawId(c);var g=j[c],d=v(g.id1),h=v(g.id2),m=r(d)&&r(h);m&&d!==h&&(l[d][h]||t(d,h,g))}var x=[];for(var p in f){p=Y.rawId(p);for(var b in f[p])if(b=Y.rawId(b),u(p)||u(b)){var I=f[p][b],w=Y.clone(I[0]);w.id1=p,w.id2=b,w.id=y(),w.hi&&n(I)&&delete w.hi,w.off=void 0,i(w,p,b,I),x.push(w)}else for(var B=f[p][b],C=0;C<B.length;C++)x.push(B[C]),delete j[B[C].id]}return x}function B(t,n,r){for(var a=e.privateGraph().shortestPaths(n,r,{all:!0}).items,i=0;i<a.length;i++)if(a[i]!==n&&a[i]!==r&&x(a[i]))for(var o=b(a[i]),u=0;u<o.length;u++)if(t===o[u].id)return a[i]}function C(e){var t,n=j[e],r=v(n.id1),a=v(n.id2),i=r&&a&&r!==a,o=r&&r===a;return t=i?B(e,r,a):o?r:r||a}function A(e){e=Y.ensureArray(e);for(var t=[],n=0;n<e.length;n++){var r=null;if(e[n]){r=v(e[n]);var a=u(r),i=e[n]in j;a||(r=i?C(e[n]):null)}t.push(r)}return t}function M(e){if(Y.isNullOrUndefined(e))throw new Error("[Find] Undefined argument passed");return Array.isArray(e)?A(e):A(e)[0]}function Z(e,t){if(Y.isNullOrUndefined(t.label)){for(var n="",r=0;r<e.length;r++)Y.isNullOrUndefined(e[r].t)||(n+=e[r].t,r<e.length-1&&(n+="\n"));return n}return t.label}function D(e,t,n){var r,a=0,i=0;for(r=0;r<e.length;r++)a+=e[r].x,i+=e[r].y;a/=e.length,i/=e.length;var o="average"===t.position?a:e[0].x,u="average"===t.position?i:e[0].y,s=Y.isNumber(t.dx)?t.dx:0,l=Y.isNumber(t.dy)?t.dy:0;for(r=0;r<e.length;r++)n.push({id:e[r].id,x:o,y:u}),e[r].x+=s,e[r].y+=l;return{x:o,y:u}}function L(e,t,n){var r=Y.isNormalObject(t.style)?t.style:Y.clone(e[0]),a=G(e);a&&(r.pos=a),delete r.id;var i={p:"ne",c:"rgb(255, 0, 0)",t:n},o=[];return Y.isNormalObject(t.glyph)&&(i=Y.merge(i,t.glyph),t.glyph.c||t.glyph.u||(i.c="rgb(255, 0, 0)")),null!==t.glyph&&o.push(i),Array.isArray(r.g)&&(o=o.concat(r.g)),r.g=o,Y.isNormalObject(t.d)&&(r.d=Y.clone(t.d)),r.type="node",r}function G(e){for(var t=0;t<e.length;t++)if(e[t].pos)return e[t].pos;return null}function R(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id);return t}function S(e){for(var t,n=[],r={},a=0;a<e.length;a++)for(var i=0;i<e[a].ids.length;i++){if(t=e[a].ids[i],r[t])throw new Error("[Combine] nodes should be only in one combo");r[t]=1,n.push(t)}return n}function T(t){for(var n,r,a={},i=[],o=e.getItem(t),u=0;u<t.length;u++)if(n=t[u],!a[n]){if(r=o[u],!r||"node"!==r.type)throw new Error("[Combine] function must be passed valid ids");"node"===r.type&&(i.push(r),a[n]=1)}if(i.length<1)throw new Error("[Combine] function must be passed at least one node id");return i}function E(e,t,n){var r=c(e,n.x,n.y),a=s(r),i=L(e,t,a.length),o=Y.merge(i,{id:r,t:Z(e,t),x:n.x,y:n.y});return o}function k(t,n,r){function a(){for(var a=[],i=0;i<t.length;i++){var o=E(l[i],t[i],d[i]);a.push(o)}h(),e.merge(a,function(){e.privateRemoveItem(c);var t=w();e.privateMerge(t,function(){var t=R(a);n.select&&(e.selection(t),e.trigger("selectionchange")),Y.invoke(r,t)})})}var i,o,u,s,l=[];for(n=Y.defaults(n,{animate:!0,select:!0,time:250}),t=Y.ensureArray(t),i=0;i<t.length;i++)s=t[i],t[i]=Y.defaults(s,{position:"average",dx:0,dy:0,label:null,style:null,d:null}),t[i].ids=Y.ensureArray(t[i].ids),u=T(t[i].ids),l.push(u);var f,c=S(t),g=[],d=[];for(i=0;i<t.length;i++)f=D(l[i],t[i],g),d.push(f);var v=e.privateGraph().neighbours(c,{all:!0});for(o=0;o<v.links.length;o++){var m=v.links[o];x(m)||(j[m]=e.getItem(m))}e.trigger("prechange","combine");var y=g.length?n.time:0;n.animate?e.animateProperties(g,{time:y},a):e.setProperties(g,!1,a)}function V(t){for(var n=0;n<t.length;n++){var r=t[n];r.hi=!e.privateBothEndsShown(r)}}function F(t,n,r){function a(e){var t=z[e.id].nodes;e.hi=!0,e.bg=!0;for(var n=0,r=t.length;r>n;n++){var i=t[n];if(u(i.id)&&a(i),i.hi||(e.hi=!1),i.bg||(e.bg=!1),!e.hi&&!e.bg)return}}function i(){n.select&&(e.selection(y),e.trigger("selectionchange")),Y.invoke(r)}e.trigger("prechange","uncombine"),n=Y.defaults(n,{animate:!0,time:250,full:!1,select:!0}),h();for(var o,c=Y.ensureArray(t),d={},v=0,m={},x=[],y=[],p=[],b=0;b<c.length;b++)if(M=c[b],u(M)){var I=e.getItem(M);if(I)if(v++,d[M]=I,n.full)m[M]=s(M),x=x.concat(l(M));else{m[M]=z[M].nodes;for(var B=0,C=z[M].nodes.length;C>B;B++){var A=z[M].nodes[B];u(A.id)&&a(A)}}}if(0===v)return void Y.invoke(r);for(var M in d)for(M=Y.rawId(M),B=0;B<m[M].length;B++)o=m[M][B],y.push(o.id),p.push({id:o.id,x:d[M].x+f(o,"x"),y:d[M].y+f(o,"y"),pos:o.pos});for(var Z=0;Z<x.length;Z++)g(x[Z]);var D=[],L=[];for(var G in d){G=Y.rawId(G);for(var R=m[G],S=0;S<R.length;S++){var T=R[S];T.x=d[G].x,T.y=d[G].y}D=D.concat(R),L.push(G)}for(e.privateMerge(D),B=0;B<L.length;B++)g(L[B]);e.privateRemoveItem(L),h();var E=w();V(E),e.privateMerge(E,function(){n.animate?e.animateProperties(p,{time:n.time},i):e.setProperties(p,!1,i)})}function W(e){if(u(e)){var t=s(e);return{nodes:t,links:I(t)}}return x(e)?{nodes:null,links:b(e)}:null}function N(e,t){var n=Y.ensureArray(e);if(t=Y.defaults(t,{type:"all"}),!t.type.match(/^(node|link|all)$/))throw new TypeError("[isCombo] opts type property should be either 'node', 'link' or 'all'");for(var r=0;r<n.length;r++){if(u(n[r])&&"link"!==t.type)return!0;if(x(n[r])&&"node"!==t.type)return!0}return!1}function U(e){for(var t=["id","id1","id2"],n=0;n<t.length;n++)t[n]in e&&(e[t[n]]+="")}function O(e,t,n,r){function a(){t.forEach(function(e){var t=e.id,n=s(t),r=x(t)?"link":"node";f[t]={id:t,nodes:[],links:[],updated:!1},i(t,n),o(e,r)})}function i(t,r){r.forEach(function(r){var a=e[r.id];a?(r[n]&&(f[t].updated=!0,r[n]=!1),f[t][r.type+"s"].push(r)):r[n]||(r[n]=!0,f[t].updated=!0)})}function o(e,t){u(e.id,t)?e[n]||(c.itemsToHide.push({id:e.id,type:t}),f[e.id].updated=!1):e[n]&&c.itemsToShow.push({id:e.id,type:t})}function u(e,t){return 0===f[e][t+"s"].length}function s(e){var t=W(e),n=t.nodes||[];return n.concat(t.links)}function l(){for(var e in f){var t=f[e];t.updated&&(x(e)?c.links.push(f[e]):c.nodes.push(f[e]))}}var f={},c={nodes:[],links:[],itemsToShow:[],itemsToHide:[]};return a(),l(),Y.clone(c)}function K(t,n){if(n.updateGlyph){var r=[];t.forEach(function(t){var n=t.nodes.length,a=e.getItem(t.id);a.g&&a.g.forEach(function(e){"ne"===e.p&&(e.t=n,r.push({id:a.id,g:a.g}))})}),e.setProperties(r)}}function X(e){e&&(z=n(e.nodes),j=n(e.links));var t=Y.clone(r(z)),a=Y.clone(r(j));return{nodes:t,links:a}}var Y=KeyLines.Util,H="_combo_",z={},P={},_="_combolink_",j={},J={api:{combine:k,uncombine:F,info:W,isCombo:N,find:M},internalUse:{filter:function(e,t,n){var r=O(e,t,"hi",n);return K(r.nodes,n),r},foreground:function(e,t,n){return O(e,t,"bg",n)},preMerge:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(U(r),"node"===r.type)m(r.id)||t.push(r);else{if("link"!==r.type)throw new Error("The type of the item should be specified.");m(r.id1)||m(r.id2)?j[r.id]=r:t.push(r)}}return t},postMerge:function(t){var n=w();e.privateMerge(n,t)},preDelete:function(n){var r,a,i;n=Y.ensureArray(n);var o=Y.makeIdMap(n),s=t(o,"node"),l=t(o,"link"),f=e.privateGraph().neighbours(s,{all:!0}).links,c=Y.makeIdMap(f.concat(l));for(var d in j)if(d in c){if(x(d))for(i=b(d),r=0;r<i.length;r++)j[i[r].id]&&delete j[i[r].id]}else{var m=j[d],y=v(m.id1),p=v(m.id2);(y in o||p in o)&&delete j[d]}var I;for(r=0;r<l.length;r++)if(I=l[r],x(I))for(i=b(I),a=0;a<i.length;a++)delete j[i[r].id];for(r=0;r<s.length;r++)I=s[r],u(I)&&g(I);h()},serialize:X,loadUp:function(e){e?X(e):(z={},j={}),h()}}};return J}}(),function(){function e(e,t,n){return function(){if(!n||!n()){var r,a=t[e];return a&&(r=a.apply(null,arguments)),r}}}var t=KeyLines.Common={};t.frameManager=function(e,t){function n(){return{all:!0,colours:!0,textures:!0,positions:!0,shadow:!0}}function r(){s.all=!1,s.colours=!1,s.textures=!1,s.positions=!1,s.shadow=!1}var a=Date.now(),i=a>>10,o=0,u=!1,s=n(),l=!0,f=0;return{frameRate:function(){return f},update:function(){var n=Date.now(),c=n>>10;c>i?(f=Math.round(o/(c-i)),o=0,i=c):o++;var g=t(n-a);a=n,u=u||g,u&&(u=!1,l&&(e(null,s),r()))},redraw:function(e){u=!0,e=e||n(),s.all||(s.all=e.all),s.positions||(s.positions=e.positions),s.shadow||(s.shadow=e.shadow),s.textures||(s.textures=e.textures),s.colours||(s.colours=e.colours)},allowDraw:function(e){e&&!l&&(u=!0),l=e}}},t.buildAnimatorInstance=function(e,t,n){var r=!0;return{rebuild:t,animate:function(t){var a=t;r&&!n&&(a=16);var i=e(a,r);return r=!1,i}}},t.animator=function(e){var t=[],n=[];return{push:function(e,r){e&&(e.queue=r,r?n.push(e):t.push(e))},cancel:function(){t=[],n=[],e()},animate:function(r,a,i){var o=!1,u=!1;if(t.length>0){var s=t;t=[];for(var l=0;l<s.length;l++)s[l].animate(r)&&(u=u||s[l].queue,t.push(s[l])),e(s[l].rebuild);o=!0}return u||n.length>0&&(t.push(n.shift()),o=!0),a&&a.animate&&(a.animate(r),o=!0),i&&(o=o||i.animated()),o}}},t.makeValueAnimator=function(e,n){var r,a,i,o;return function(u,s,l){var f=n();f===u||o&&a===u||(r=f,a=u,i=0,o||(o=t.buildAnimatorInstance(function(e){i=Math.min(s,i+e);var t=0>=s?a:r+(a-r)*i/s;n(t);var u=s>i;return u||(o=null,KeyLines.Util.invoke(l)),u}),e.push(o,!1)))}};var n=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];t.appendActions=function(t,r,a){for(var i=0;i<n.length;i++)t[n[i]]=e(n[i],r,a)},t.hitTester=function(e,t,n,r){function a(e,a){o.clear(e,t,n),o.backFill(e,u,1,t,n),r.drawShadowCanvas(e,a),s=!1}var i,o=KeyLines.Rendering,u=o.randomColour(),s=!0,l=5,f=function(){var e={},t={};return{getColour:function(n){if(n in e)return e[n];var r=o.randomColour(t);return e[n]=r,t[r]=n,r},getId:function(e){return t[e]||null}}}();r.setShadowColourMap(f);var c={};return c.test=function(t,n,r,a,i){var g=[0,0,0];i&&i.webgl?g=i.webglCanvas.renderer.drawShadowCanvas(Math.floor(t),Math.floor(n)):(s&&c.draw(r),g=e.getImageData(Math.floor(t),Math.floor(n),1,1).data);var d=o.rgbtostring(g[0],g[1],g[2]);if(d===u)return null;var h=f.getId(d);return h?h:i&&i.webgl?null:(a=a||1,a>l?null:t+a>l&&n+a>l?c.test(t-1,n-1,r,++a,i):c.test(t+1,n+1,r,++a,i))},c.dirty=function(){s=!0},c.debugCanvas=function(e){i=e},c.draw=function(t){a(e,t),i&&a(i,t)},c}}(),function(){var e=KeyLines.Graph={};KeyLines.getGraphEngine=function(){function e(e){function t(t){i.typeCheck(t);var n=i.filterNodesAndLinks(t.items);i.ensureHiddenItemConsistency(n.nodes,n.links),e.privateSetProperties(n.nodes,n.links)}return t}function t(e){function t(){var t={};e.privateSetProperties(t,t)}return t}var n=KeyLines.Util,r=KeyLines.Events.createEventBus(),a=KeyLines.Graph.create(r),i=KeyLines.Validation.create({numbers:{x:1,y:1},strings:{id:1,id1:1,id2:1},booleans:{hi:1,a1:1,a2:1}}),o={load:e(a),clear:t(a)};return n.merge(a,o)},e.create=function(e){function t(e,t,n,r,a){e[n]||(e[n]={}),e[r]||(e[r]={}),e[n][r]||(e[n][r]=e[r][n]=[],t.push(a)),e[n][r].push(a)}function n(e,t,n){var r={id:t.id,id1:t.id1,id2:t.id2,ids:n};e.edges.push(r),e.connections.push(n)}function r(e){var r=e&&e.all?"all":"visible";if(null===x&&(x={}),!x[r]){x[r]={connections:[],adjacency:{},vertices:{},edges:[]},b({all:e&&e.all},function(e,t){x[r].vertices[t]={x:e.x,y:e.y},x[r].adjacency[t]={}});var a=[];p({all:e&&e.all},function(e,n,i,o){i!==o&&t(x[r].adjacency,a,i,o,n)});for(var i=a.length,o=0;i>o;o++){var u=v[a[o]];n(x[r],u,x[r].adjacency[u.id1][u.id2])}}return x[r]}function a(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function i(e){if(e.normalization=e.normalization||"any",!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function o(e){return p(e,function(t,n,r,a){if(Z(r,a,n,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:f(e)}}function u(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function s(e){return a(e)||o(e)}function l(e){e.all=!!e.all}function f(e){return!!e.weights}function c(e){var t=0;return b(e,function(){t++}),t}var g=KeyLines.Util,d={},h={},v={},m=e,x=null,y=d.clearCache=function(){x=null};d.privateSetProperties=function(e,t){h=e,v=t,y()};var p=function(e,t){var n=e&&e.all;for(var r in v){r=g.rawId(r);var a=v[r];!n&&a.hi||t(a,r,a.id1,a.id2)}},b=function(e,t){var n=e&&e.all;for(var r in h){r=g.rawId(r);var a=h[r];!n&&a.hi||t(a,r)}},I=function(e,t,n,r){function a(){var t=[];return b(e,function(e){t.push(e)}),t}var i=a(),o=i.length,u=-1,s=Date.now(),l=s,f=700,c=function(){return u++,u>=o?(d(1),void r()):void n(i[u],v)},d=function(e){m&&m.trigger("progress",t,e)},h=function(){return s=Date.now(),s-l>f?(l=Date.now(),!0):!1},v=function(){h()?(d(u/o),g.nextTick(c,0)):c()};d(0),v()};d.findAdjacency=function(e,t,n){var a=r(e).adjacency;return a[t]?a[t][n]:void 0},d.connections=function(e){return r(e).connections},d.eigenCentrality=function(e){function t(t){function n(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function r(e){var t,n,r=[];for(t=0;t<l.length;t++){var a=0;for(n=0;n<f[t].length;n++)a+=c[t][f[t][n]]*e[f[t][n]];a+=g*e[t],r.push(a)}return r}function a(){var e,t=1/i(d);for(e=0;e<l.length;e++)d[e]=d[e]*t}function i(e){var t,n=0;for(t=0;t<e.length;t++)n+=Math.abs(e[t]);return n}var o,u,s={},l=[],f=[],c=[],g=0,d=[],h=0;if(b(e,function(e,n){t[n]&&(l.push(n),s[n]=l.length-1,f.push([]),c.push({}))}),u=Math.max(100,5*Math.sqrt(l.length)),p(e,function(r,a,i,o){if(t[i]&&t[o]){var u=s[i],l=s[o];c[u][l]||(f[u].push(l),f[l].push(u),c[l][u]=0,c[u][l]=0);var d=n(r,e);c[u][l]+=d,c[l][u]+=d,g+=d,h++}}),0===l.length)return{};if(1===l.length)return d={},d[l[0]]=1,d;if(2===l.length)return d={},d[l[0]]=.5,d[l[1]]=.5,d;for(g/=h,u=Math.max(100,5*Math.sqrt(l.length)),o=0;o<l.length;o++)d.push(Math.random());for(o=0;u>o;o++)d=r(d),o%10===0&&a();a();var v={};for(o=0;o<l.length;o++)v[l[o]]=d[o];return v}e=g.defaults(e,{all:!1,value:void 0}),e.direction="any",l(e),o(e);var n,r,a={},i=w(e);for(n=0;n<i.length;n++){var u={};for(r=0;r<i[n].nodes.length;r++)u[i[n].nodes[r]]=!0;var s=t(u);for(r in s)a[r]=s[r]*i[n].nodes.length}return a},d.pageRank=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){var t,n,r=[],a=0,i=0;for(t=0;t<u.length;t++)a+=e[t];for(t=0;t<u.length;t++){var o=0;for(n=0;n<f[t].length;n++){var s=f[t][n];o+=c[t][s]*e[s]/h[s]}0===h[t]&&(i+=m*e[t]),o=m*o,o+=(1-m)*a/u.length,r.push(o)}for(i/=u.length,t=0;t<v.length;t++)r[t]+=i;return r}function r(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n}var a;e=g.defaults(e,{all:!1,value:void 0,directed:!0}),l(e),s(e);var i,o={},u=[],f=[],c=[],d=0,h=[],v=[],m=.85;for(b(e,function(e){u.push(e.id),o[e.id]=u.length-1,f.push([]),c.push({}),h.push(0)}),i=Math.max(100,5*Math.sqrt(u.length)),p(e,function(n,r,a,i){var u=o[a],s=o[i],l=t(n,e);e.directed&&!n.a2&&(n.a1||n.a2)||(c[s][u]||(c[s][u]=0,f[s].push(u)),c[s][u]+=l,h[u]+=l),e.directed&&!n.a1&&(n.a1||n.a2)||(c[u][s]||(c[u][s]=0,f[u].push(s)),c[u][s]+=l,h[s]+=l),d++}),a=0;a<u.length;a++)v.push(Math.random());var x=1/r(v);for(a=0;a<u.length;a++)v[a]=v[a]*x;for(a=0;i>a;a++)v=n(v);for(x=1/r(v),a=0;a<u.length;a++)v[a]=v[a]*x;var y={};for(a=0;a<u.length;a++)y[u[a]]=v[a];return y},d.neighbours=function(e,t){function n(e,n,r){var a=g.rawId(m[r][e][n]);!c[a]&&M(r,e,a,t)&&(i[a]=o[e]=c[a]=1,e in d&&(o[r]=1),e in u||(s++,f[e]=1))}function a(){for(var e in u)if(e=g.rawId(e),h[e]&&m[e])for(var r in m[e]){r=g.rawId(r);for(var a=0;a<m[e][r].length;a++)n(r,a,e)}else if(v[e]){var i=v[e];!c[i.id2]&&M(i.id2,i.id1,e,t)&&(o[i.id2]=c[i.id2]=c[e]=1,i.id2 in u||(s++,f[i.id2]=1)),!c[i.id1]&&M(i.id1,i.id2,e,t)&&(o[i.id1]=c[i.id1]=c[e]=1,i.id1 in u||(s++,f[i.id1]=1))}}e=g.ensureArray(e);var i={},o={},u=g.makeIdMap(e);if(t=g.defaults(t,{all:!1,direction:"any",hops:1}),t.hops<1)throw new Error("neighbours error: hops must be a positive number");l(t);var s=0,f={},c={},d=u,m=r(t).adjacency;for(var x in u){if(x=g.rawId(x),!h[x]&&!v[x])throw new Error("neighbours error: ids must be present in the graph");s++}for(;t.hops--&&s;)s=0,a(),u=f,f={};return{nodes:g.flattenMap(o),links:g.flattenMap(i)}},d.clusters=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){c=+e,c=g.isNumber(c)?c:5,c=Math.max(0,c),c=Math.min(10,c),c=c*c*c/125}function r(){var e,t,n=[];for(e=0;e<A.length;e++){var r=[];for(t=0;t<I[A[e]].length;t++)r.push(m[I[A[e]][t]]);n.push(r)}return n}function a(e,t,n){var r,a=B[t],i=B[e],o=d[n],u=(-o+a-i)*o*c;for(u/=2*y,r=0;r<h[n].length;r++){var s=h[n][r];w[s]===t?u-=v[n][s]:w[s]===e&&(u+=v[n][s])}return u/y}function i(e,t){var n,r;if(t!==e&&0!==I[e].length&&0!==I[t].length){var a=B[e],i=B[t],u=0;for(u-=c*a*i/y,n=0;n<I[e].length;n++){var s=I[e][n];for(r=0;r<h[s].length;r++)w[h[s][r]]===t&&(u+=v[s][h[s][r]])}if(u/=y,u>0){var l=I[e].length;for(n=0;l>n;n++)o(I[e][0],t)}}}function o(e,t){var n,r=w[e];w[e]=t;var a=[];for(n=0;n<I[r].length;n++)I[r][n]!==e&&a.push(I[r][n]);0===I[t].length&&(A.push(t),C.splice(C.indexOf(t),1)),I[r]=a,I[t].push(e),B[t]+=d[e],B[r]-=d[e],0===I[r].length&&(C.push(r),A.splice(A.indexOf(r),1))}function u(e){var t,n=I[e].length;if(1!==n&&C.length){var r=[];for(t=0;n>t;t++)r.push(I[e][t]);for(t=0;n>t&&C.length;t++)o(r[t],C[0])}}var s;e=g.defaults(e,{all:!1,factor:5}),l(e);var f,c,d=[],h=[],v=[],m=[],x={},y=0,I=[],w=[],B=[],C=[],A=[];if(b(e,function(e){m.push(e.id),h.push([]),v.push([]),x[e.id]=m.length-1,I.push([m.length-1]),w.push(m.length-1),A.push(m.length-1),d.push(0),B.push(0)}),p(e,function(n,r,a,i){var o=t(n,e);y+=o;var u=x[a],s=x[i];v[u][s]||(v[u][s]=0,v[s][u]=0),v[u][s]+=o,v[s][u]+=o,d[u]+=o,d[s]+=o,B[u]+=o,B[s]+=o,h[u].push(s),h[s].push(u)}),f=Math.max(1e4,50*m.length),0===m.length)return[];for(0===y&&(f=0),n(e.factor),s=0;f>s;s++){if(Math.random()>.95){var M=A[Math.floor(Math.random()*A.length)],Z=A[Math.floor(Math.random()*A.length)];i(M,Z)}if(.5*f>s&&Math.random()>.98){var D=A[Math.floor(Math.random()*A.length)];u(D)}var L=Math.floor(m.length*Math.random()),G=h[L][Math.floor(Math.random()*h[L].length)],R=w[G],S=w[L];if(R!==S){var T=a(R,S,L);T>=0&&o(L,R)}}return r()};var w=d.components=function(e){var t,n,a=[],i=0,o=[];e=g.defaults(e,{all:!1}),l(e);var u=r(e).vertices,s=r(e).edges;for(t in u)if(u[t].hasOwnProperty("c"))o[u[t].c]||(o[u[t].c]={nodes:[],links:[]});else{for(a.push(t+"");a.length>0;){var f=a.shift();if(!u[f].hasOwnProperty("c"))for(u[f].c=i,n=0;n<s.length;n++)s[n].hasOwnProperty("c")||(s[n].id1===f?(s[n].c=i,a.push(s[n].id2)):s[n].id2===f&&(s[n].c=i,a.push(s[n].id1)))}o.push({nodes:[],links:[]}),i++}for(t in u)o[u[t].c].nodes.push(t+"");for(n=0;n<s.length;n++)o[s[n].c].links=o[s[n].c].links.concat(s[n].ids);return o};d.internalMarkLinks=function(e){var t=r().adjacency,n=2,a={};for(var i in e){var o=t[i];if(o)for(var u in o)for(var s=o[u],l=0;l<s.length;l++){var f=s[l];a[f]=!0}}for(var c in a)e[c]=n};var B=d.distances=function(e,t){if(!h[e])throw new Error("distances error: id(s) must be present in the graph");t=t||{},s(t),l(t);var n=G(e,t),r={};for(var a in n.distance){var i=n.distance[a];g.isNumber(i)&&(r[a]=i)}return r},C=function(e,t,n){var a,i=r(n).adjacency,o=i[e][t],u=1/0,s=D(n);if(o)for(var l=0;l<o.length;l++){var f=s(e,t,o[l],n);g.isNumber(f)&&(u>f&&(a=[],u=f),f===u&&u!==1/0&&a.push(o[l]))}return{value:u,links:a}},A=function(e,t){return v[e].a2&&v[e].id2===t||v[e].a1&&v[e].id1===t},M=function(e,t,n,r){return"any"!==r.direction?"from"===r.direction&&A(n,t)||"to"===r.direction&&A(n,e):!0},Z=function(e,t,n,r){var a=NaN;return M(e,t,n,r)&&(r.value?v[n].d&&(a=+v[n].d[r.value]):a=1),a},D=function(e){return f(e)?L:Z},L=function(e,t,n,r){var a=Z(e,t,n,r);return g.isNaN(a)?a:1/a},G=function(e,t){function n(){for(var e,t=1/0,n=0;n<u.length;n++){var r=i[u[n]];t>=r&&(e=n,t=r)}return e}function a(e,t,n){o[e]||(o[e]=[]),o[e].push({id:t,links:n})}var i={},o={},u=[],s=r(t).adjacency;for(b(t,function(e,t){i[t]=1/0,o[t]=void 0,u.push(t)}),i[e]=0;u.length>0;){var l=n(),f=u[l];if(i[f]===1/0)break;u.splice(l,1);for(var c in s[f]){c=g.rawId(c);var d=C(f,c,t),h=i[f]+d.value;h<i[c]?(i[c]=h,o[c]=[{id:f,links:d.links}]):h===i[c]&&a(c,f,d.links)}}return{distance:i,previous:o}};d.shortestPaths=function(e,t,n){function r(e){for(var t=[],n=0;n<e.length;n++)i[e[n].id]&&(t=t.concat(i[e[n].id]));return t}if("string"!=typeof e||"string"!=typeof t)throw new Error("shortestPaths error: ids must be strings");if(!h[e]||!h[t])throw new Error("shortestPaths error: ids must be present in the graph");n=g.defaults(n,{all:!1}),s(n),l(n);var a=G(e,n),i=a.previous;if(a.distance[t]===1/0)return{onePath:[],one:[],items:[],distance:1/0};for(var o=[],u=[],f=t;i[f];)o.unshift(f),u.unshift(f),u.unshift(i[f][0].links[0]),f=i[f][0].id;o.unshift(f),u.unshift(f);var c={};c[t]=1;var d=[];d.push({id:t});for(var v=r(d);v.length>0;){for(var m=0;m<v.length;m++){c[v[m].id]=1;for(var x=0;x<v[m].links.length;x++)c[v[m].links[x]]=1}v=r(v)}return{onePath:u,one:o,items:g.flattenMap(c),distance:a.distance[t]}};var R=d.degrees=function(e){e=g.defaults(e,{multi:!0,all:!1}),s(e),l(e);var t=r(e).adjacency,n={};return b(e,function(r,a){n[a]=0;for(var i in t[a]){i=g.rawId(i);for(var o=0;o<t[a][i].length;o++){var u=Z(a,i,t[a][i][o],e);if(g.isNumber(u)&&(n[a]+=u,!e.multi))break}}}),n};return d.betweenness=function(e,t){function n(e,t){return O[e]-O[t]}function a(e){return e.sort(n),e.shift()}function o(e,t){e.sort(n),g.contains(e,t)||e.push(t)}function c(e,t){var n=C(e,t,D).value;return g.isNumber(n)?n:p()||g.isNumber(n)?1/0:1}function d(e){return e.length>0}function h(){V.length=0,F.length=0,b(e,function(e,t){for(var n=0;n<X.length;n++)m(X[n].dict,t,X[n].value)})}function v(e,t,n){b(e,function(e,r){m(t,r,n)})}function m(e,t,n){Array.isArray(n)&&d(n)&&e[t]?e[t].length=0:e[t]=g.clone(n)}function x(){var t,n,r,a=w(e),i={};for(t=0;t<a.length;t++)for(r=a[t],n=0;n<r.nodes.length;n++)i[r.nodes[n]]=r.nodes.length;return i}function y(){return!g.isNullOrUndefined(e.value)}function p(){return!!e.directed}function B(){return e.endpoints}e=g.defaults(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1}),i(e),l(e);var A=y()||p()?"dijkstra":"regular",M=B()?"endpoints":"regular",Z=u(e),D={direction:p()?"from":"any",value:e.value,weights:f(e),all:e.all};s(e);var L,G,R,S,T,E,k={},V=[],F=[],W={},N={},U={},O={},K=0,X=[{dict:N,value:0},{dict:O,value:1/0},{dict:W,value:[]},{dict:U,value:0}],Y=r(e).adjacency,H={regular:function(e){for(N[e]=1,O[e]=0,V.push(e);d(V);){L=V.shift(),F.push(L);for(var t in Y[L])t=g.rawId(t),g.isNumber(O[t])||(O[t]=O[L]+1,V.push(t)),O[t]===O[L]+1&&(N[t]+=N[L],W[t].push(L))}},dijkstra:function(e){for(N[e]=1,O[e]=0,V.push(e);d(V);){L=a(V),F.push(L);for(var t in Y[L])t=g.rawId(t),O[t]>O[L]+c(L,t)&&(O[t]=O[L]+c(L,t),o(V,t),N[t]=0,W[t]=[]),O[t]===O[L]+c(L,t)&&(N[t]+=N[L],W[t].push(L))}}},z={regular:function(e){for(;d(F);){for(G=F.pop(),T=(1+U[G])/N[G],S=0;S<W[G].length;S++)L=W[G][S],U[L]+=N[L]*T;G!==e&&(k[G]+=U[G])}},endpoints:function(e){for(k[e]+=F.length-1;d(F);){for(G=F.pop(),T=(1+U[G])/N[G],S=0;S<W[G].length;S++)L=W[G][S],U[L]+=N[L]*T;G!==e&&(k[G]+=U[G]+1)}}},P={chart:function(){if(K>2){R=1/((K-1)*(K-2));for(var e in k)e=g.rawId(e),k[e]*=R}},component:function(){E=x();for(var e in k)e=g.rawId(e),E[e]>2&&(R=1/((E[e]-1)*(E[e]-2)),k[e]*=R)},unnormalized:function(){if(!p()){R=.5;for(var e in k)e=g.rawId(e),k[e]*=R}}},_=function(){Q(),g.invoke(t,k);
},j=H[A]||H.regular,J=z[M]||z.regular,Q=P[Z]||P.chart;b(e,function(){K++}),v(e,k,0);var q=function(e,t){h(),j(e.id),J(e.id),t()};I(e,"betweenness",q,_)},d.closeness=function(e,t){function n(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?1:0;return n}function a(e){for(var t in e)if(t=g.rawId(t),e.hasOwnProperty(t))return!1;return!0}function o(e){return!g.isNullOrUndefined(e)}function f(e){return!v[e].a1&&!v[e].a2}function d(e){var t={},n=0,r={},i={};for(i[e]=1;!a(i);){r=i,i={};for(var u in r)if(u=g.rawId(u),!o(t[u])){t[u]=n;for(var s in A[u])s=g.rawId(s),i[s]=1}n+=1}return t}function h(){return"any"!==e.direction}function m(){if(e.mode=e.mode||"auto",!e.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function x(){return m(),"auto"===e.mode?C():e.mode}function y(){return!g.isNullOrUndefined(e.value)}function p(){return u(e).match(/chart/)}function b(){return u(e).match(/component/)}function C(){var t="disconnected",n=w(e);if(1===n.length&&(t="connected",h()))for(var r=0;r<n[0].links.length;r++)if(f(n[0].links[r]))return"disconnected";return t}e=g.defaults(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});var A=r(e).adjacency,M=s(e);i(e),l(e),M.all=e.all;var Z,D,L,G,R,S=y()||h()?"dijkstra":"regular",T=0,E={},k=x(),V={regular:function(e){return d(e)},dijkstra:function(e,t){return B(e,t)}},F={connected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?t[r]:0;return n?1/n:0},disconnected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=e!==r?1/t[r]:0;return n}},W=function(){g.invoke(t,E)};D=V[S]||V.regular,L=F[k],T=c(e),E={};var N=function(e,t){G=D(e.id,M),Z=n(e.id,G),E[e.id]=L(e.id,G),T>1&&(R=p()?Math.pow(Z-1,2)/(T-1):b()?Z-1:1,E[e.id]*=R),t()};I(e,"closeness",N,W)},d.kCores=function(e){function t(e){var t=0;for(var n in e)n=g.rawId(n),t=Math.max(t,e[n]);return t}e=g.defaults(e,{all:!1}),l(e);var n=r(e).adjacency,a=function(){var t,r,a,i,o,u,s,l,f,c,d,h={},v={},m=[],x=[];r=0,h=R({multi:!1,all:e.all});for(var y in h)y=g.rawId(y),r=Math.max(r,h[y]);for(d=g.flattenMap(h).length,t=0;r+1>t;t++)x[t]=0;for(b(e,function(e,t){x[h[t]]++}),o=1,t=0;r+1>t;t++)u=x[t],x[t]=o,o+=u;for(b(e,function(e,t){v[t]=x[h[t]],m[v[t]]=t,x[h[t]]++}),t=r;t>1;t--)x[t]=x[t-1];for(x[0]=1,i=0;d>i;i++){a=m[i];for(var p in n[a])p=g.rawId(p),h[p]>h[a]&&(l=h[p],f=v[p],c=x[l],s=m[c],p!==s&&(v[p]=c,m[f]=s,v[s]=f,m[c]=p),x[l]++,h[p]--)}return h},i=a();return{maximumK:t(i),values:i}},d}}(),function(){"use strict";if(KeyLines.WebGL){var e=3;KeyLines.WebGL.generateTriangle=function(t,n,r,a,i,o,u,s,l,f,c){var g=t.wsc||[0,0,0,0];if(f.rebuildOptions.all||f.rebuildOptions.shadow||f.alwaysUpdate)for(var d=0;e>d;d++)f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[0],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[1],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[2],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=g[3];if(f.rebuildOptions.all||f.rebuildOptions.colours||f.alwaysUpdate)for(d=0;e>d;d++)f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[0],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[1],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[2],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[3];if(f.rebuildOptions.all||f.rebuildOptions.positions||f.alwaysUpdate){if(c)var n=n+c.x,r=r+c.y,a=a+c.x,i=i+c.y,o=o+c.x,u=u+c.y;f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=n,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=r,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=a,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=i,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=o,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0}(f.rebuildOptions.all||f.rebuildOptions.textures||f.alwaysUpdate)&&(f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0)}}}(),function(){var e=KeyLines.Validation={};e.create=function(e,t,n,r){function a(t,n){for(var r in t)l(t,r),v(t,r,e.reserved),n&&v(t,r,e.booleans)}function i(e,t){var n=e[t],r=!0;if(p.isNormalObject(n))for(var a in n)o(n,a),r&=isFinite(n[a]);r||delete e[t]}function o(t,n){var r=+t[n];0>r&&!e.negatives[n]&&(r=null),t[n]=r}function u(t,n){p.isNullOrUndefined(t[n])||(t[n]=t[n]+"",e.stringValues[n]&&!e.stringValues[n][t[n]]&&delete t[n])}function s(e,t){e[t]&&(e[t]=b.validatergb(e[t])?e[t]:void 0)}function l(t,n){e.strings[n]?u(t,n):e.numbers[n]?o(t,n):e.colours[n]?s(t,n):e.mapPos[n]&&i(t,n)}function f(e){if(p.isNormalObject(e.fi)){var t=e.fi;p.isNullOrUndefined(t.t)||(t.t="string"==typeof t.t?t.t.charAt(0):String.fromCharCode(t.t)),t.c&&(t.c=b.validatergb(t.c)?t.c:void 0)}else null!==e.fi&&delete e.fi}function c(e){return/(ne|nw|se|sw)/.test(e)}function g(e,t){var n,r={};return Array.isArray(e)&&(n=e.filter(function(e){var n,a=e.p;return t?n=e:a&&2===a.length&&c(a)&&(r[a]||(n=e,r[a]=1)),n?(f(e),e):void 0})),n}function d(t,n){e.halos.forEach(function(e){var r=t[e];r&&(n?"c"in r||"r"in r||"w"in r||delete t[e]:"c"in r&&"r"in r&&"w"in r?(r.r=p.isNumber(+r.r)?+r.r:null,r.w=p.isNumber(+r.w)?+r.w:null,s(r,"c")):delete t[e])})}function h(e){if(Array.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;c(t)||2===t.length||delete e.bu}}function v(e,t,n){n[t]&&delete e[t]}function m(e,t,n){t=t||{};var r,a={nodes:{},links:{}};return e&&(a=e.reduce(function(e,a){if(a.id&&!(a.id in e.nodes||a.id in e.links)){if(r=a.type+"s","node"===a.type){var i=!0;n&&t[a.id]&&(i=!1),i&&A(a)}r in e&&(e[r][a.id]=p.clone(a))}return e},a)),a}function x(e,t,n){var r={};for(var a in e)e[a].id1!==e[a].id2&&M(e[a],t,n)&&(r[a]=e[a]);return r}function y(e,n,r,a){for(var i in a){var o=a[i];r[o.id1][e]!==n&&r[o.id2][e]!==n||o[e]!==n&&(o[e]=n,t(i))}}var p=KeyLines.Util,b=KeyLines.Rendering;t=t||p.noop,n=n||p.noop,r=r||p.noop;var I={},w={numbers:{},negatives:{},strings:{},stringValues:{},colours:{},booleans:{},reserved:{},mapPos:{},halos:[]};e=p.defaults(e,w),I.typeCheck=function(e,t){C(e.items,!1,t)},I.filterNodesAndLinks=function(e,t,n){var r=m(e,t,n);return r.links=x(r.links,r.nodes,t),r};var B=I.ensureObject=function(e,t,n){n=n||{},a(e,t),f(e),e.g&&(Array.isArray(e.g)?(C(e.g),e.g=g(e.g,"link"===e.type||n[e.id])):delete e.g),d(e,t),e.bu&&h(e)},C=I.ensureTypesInArray=function(e,t,n){if(e)for(var r=0;r<e.length;r++)B(e[r],t,n)},A=I.setZeroXY=function(e){"node"===e.type&&(e.x=e.x||0,e.y=e.y||0)},M=I.hasValidEnds=function(e,t,n){return t=t||{},n=n||{},(n[e.id1]||t[e.id1])&&(n[e.id2]||t[e.id2])};I.ensureHiddenItemConsistency=function(e,t){Z("hi",!1,e,t)};var Z=I.ensureConsistency=function(e,t,a,i){y(e,!0,a,i),t||r(e),"hi"===e&&n()};return I}}(),function(e){function t(e,t,n,r){r||(r=!1),e.addEventListener(t,n,r)}function n(e,n){for(var r=0;r<e.length;r++)t(document,e[r],n)}function r(e,t){for(var n=[],r=0;r<e[t].length;r++){var a=C(e[t][r]);n.push({id:e[t][r].identifier,x:a.x,y:a.y})}return n}function a(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function i(){function e(e,n){t(document,e,function(t){t.target.id in b&&(b[t.target.id][e](r(t,"targetTouches"),r(t,"changedTouches")),n&&t.preventDefault())})}function i(e){t(document,e,function(t){t.target.id in b&&(b[t.target.id][e](t.scale,t.rotation),t.preventDefault())})}function o(e,t){var n=e.pointerId||0,r=C(e),a=[];switch(t){case"ADD":I[n]||(I[n]={id:n,x:r.x,y:r.y});break;case"DEL":I[n]&&(delete I[n],w--);break;case"MOVE":I[n]&&(I[n]={id:n,x:r.x,y:r.y})}for(var i in I)a.push(I[i]);return a}function u(e,t){var n=e.pointerId||0,r=C(e),a=[];switch(t){case"ADD":case"MOVE":a=[{id:n,x:r.x,y:r.y}];break;case"DEL":a=[I[n]]}return a}function s(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function l(e){B[e]=new MSGesture,B[e].target=document.getElementById(e)}function f(){v=1,m=0}function c(e,t){return function(n){if(n.target.id in b&&s(n)){var r=u(n,t);b[n.target.id][e](o(n,t),r),n.preventDefault()}}}function g(e){function t(t){if(s(t)){var n="DEL";for(var r in b){var a=u(t,n);b[r][e](o(t,n),a);var i=t.target.id;i&&b[i]&&t.preventDefault()}}}return t}function d(e,t,n,r){if(e!==t){if(null!==t&&b[t]&&document.getElementById(t)){var a=A(r,t);b[t][n](a.x,a.y,r.ctrlKey,r.shiftKey)}"mouseleave"===n&&(Z=e)}}function h(e){var t=e.wheelDelta||-e.detail;if(0!==t){var n=b[e.target.id];if(n){var r=C(e);n.mousewheel(t,r.x,r.y),a(e)}}}t(document,"contextmenu",function(e){return e.target.id in b?(a(e),!1):void 0}),t(document,"dragover",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].dragover(t.x,t.y)}}),"ontouchstart"in document.documentElement&&(e("touchstart",!0),e("touchmove"),e("touchend"),e("touchcancel"),i("gesturestart"),i("gesturechange"),i("gestureend"));var v=1,m=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var x=["MSPointerDown","pointerdown"],y=["MSPointerMove","pointermove"],p=["MSPointerUp","pointerup"],M=["MSPointerCancel","pointercancel"];n(x,function(e){if(e.target.id in b&&s(e)){B[e.target.id]||l(e.target.id),w++,B[e.target.id].addPointer(e.pointerId);var t=u(e,"ADD");b[e.target.id].touchstart(o(e,"ADD"),t),e.preventDefault()}}),n(y,c("touchmove","MOVE")),n(p,g("touchend")),n(M,g("touchcancel")),t(document,"MSHoldVisual",function(e){e.preventDefault()}),t(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id,n=w>1;t in b&&n&&(b[t].gesturestart(),e.preventDefault())}),t(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=w>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;t in b&&n&&(v*=e.scale,m+=180*e.rotation/Math.PI,b[t].gesturechange(v,m),e.preventDefault())}),t(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;t in b&&(b[t].gestureend(v,m),f(),e.preventDefault())})}t(window,"mousedown",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}}),t(window,"mouseup",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}D&&(d(e.target.id,D.target.id,"mouseup",D),D=null)}),t(window,"mouseout",function(e){e.target.id in b&&(D=e)});var Z=null,D=null;t(window,"mousemove",function(e){if(e.target.id in b){d(e.target.id,Z,"mouseleave",e);var t=C(e);b[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}else d(null,Z,"mouseleave",e)}),t(window,"dblclick",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),n(["wheel","mousewheel","DOMMouseScroll"],h),t(document,"MozMousePixelScroll",function(e){b[e.target.id]&&a(e)}),t(document,"keyup",function(e){e.target.id in b&&b[e.target.id].keyup(e.keyCode)}),t(document,"keydown",function(e){var t=!1;e.target.id in b&&(t=t||b[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),t&&e.preventDefault&&e.preventDefault()})}function o(e){e in b&&delete b[e]}function u(e){e in b||(b[e]={})}function s(e,t){KeyLines.Util.invoke(t,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function l(e){return+e.replace(/px$/,"")}function f(e,t,n,r){function a(e,t){e?KeyLines.Util.invoke(r,e):t.options(n,function(){r&&r(null,t)})}var i=document.getElementById(t);if(!i)return s(t,r);var o=i.clientWidth||l(i.style.width),u=i.clientHeight||l(i.style.height);g(e,t,o,u,n?a:r)}function c(){D=document.createElement("span"),D.style.position="absolute",D.style.left="-10000px",D.style.top="-10000px",D.style.visibility="hidden",D.style.lineHeight="normal",D.style.fontSize="200px",D.style.fontVariant="normal",D.style.fontStyle="normal",D.style.letterSpacing="0",D.style.width="auto",D.style.height="auto",D.style.display="block",D.style.margin=0,D.style.padding=0,D.style.whiteSpace="nowrap"}function g(e,t,n,r,a){if(o(t),n||(n=100),r||(r=100),"webgl"===Z&&"chart"===e&&KeyLines.webGLSupport())T(e,t,n,r,!0,a);else if(S())T(e,t,n,r,!1,a);else{var i="Could not create HTML5 canvas.";a(i)}}function d(e,t){var n=b[t];n.id=function(){return t},"timebar"===e&&KeyLines.TimeBar.API.appendExtras(n)}function h(){return v(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function v(e){for(var t=KeyLines.Util.defined,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}function m(e){var t=KeyLines.Util.defined;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:t(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function x(e,t){for(var n,r=0;!n&&r<t.length;r++)e[t[r]]&&(n=!0,e[t[r]]())}function y(e){x(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function p(){E&&E(h())}if(e){var b=KeyLines.components={};KeyLines.charts=b;var I={},w=0,B={};i();var C=KeyLines.coords=function(e){return A(e,e.target.id)},A=function(e,t){var n=M(t),r=Math.floor(e.pageX-n.left),a=Math.floor(e.pageY-n.top);return{x:r,y:a}},M=KeyLines.getOffset=function(e){var t=document.getElementById(e),n={top:0,left:0};return t&&(n=t.getBoundingClientRect()),{top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft}},Z="auto";KeyLines.mode=function(e){return e&&(Z=e),Z},KeyLines.createChart=function(){var e,t,n,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0],r=arguments[1];var a=document.getElementById(e);if(!a)return s(e,r);t=a.clientWidth,n=a.clientHeight;break;default:e=arguments[0],t=Number(arguments[1]),n=Number(arguments[2]),r=arguments[3]}g("chart",e,t,n,r)},KeyLines.create=function(e,t){function n(){var e=a[i],u=e.id||e;f(e.type||"chart",u,e.options,function(e,u){if(e)return r.invoke(t,e);if(o[i]=u,i++,!(i>=a.length))return n();var s=1===i?u:o;return t?t(null,s):void 0})}var r=KeyLines.Util,a=r.ensureArray(e);if(a.length<1)return void r.invoke(t,new Error("No definition passed to KeyLines.create"));var i=0,o=[];n()};var D;KeyLines.getFontIcon=function(e){D||c(),document.body.appendChild(D);var t=e.replace(/\./g,"");D.className!==t&&(D.className=t);var n=window.getComputedStyle(D,":before").getPropertyValue("content");return D.parentNode&&D.parentNode.removeChild(D),D.className="",n.charCodeAt(1)||n.charCodeAt(0)};var L,G,R=KeyLines.setCanvasPaths=function(e){L=e};KeyLines.imageBasePath=function(e){return e&&(G=e),G},R("assets/");var S=KeyLines.html5CanvasSupport=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},T=function(e,t,n,r,a,i){u(t);try{b[t]=KeyLines.Canvas.create(e,t,n,r,L,G,a)}catch(o){if(i)return i(o)}b[t].webgl=a,b[t].canvas=!0,d(e,t),i&&i(null,b[t])};KeyLines.setSize=function(e,t,n){if(!(0>=t||0>=n)){var r=document.getElementById(e);r&&(r.style.height=n+"px",r.style.width=t+"px",b[e]&&(b[e].internalSetSize(t,n,1),b[e].webgl&&b[e].renderer.clearFramebuffers()))}},KeyLines.paths=function(e){return e&&(e.assets&&R(e.assets),e.images&&KeyLines.imageBasePath(e.images)),{assets:L,images:G}},n(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],p),KeyLines.fullScreenCapable=function(){var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var E;KeyLines.toggleFullScreen=function(e,t){E=t,h()&&m(e)?x(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):y(e)},KeyLines.dashedLineSupport=function(){if(S()){var e=document.createElement("canvas"),t=e.getContext("2d");return!!t.setLineDash||!!t.mozDash||!!t.webkitLineDash}return!1},KeyLines._rtlTest=function(e){return"rtl"===window.getComputedStyle(e).direction},KeyLines.es6CollectionSupport=function(){return Object.isPrototypeOf&&Array.from&&window.Set&&window.Map}}}("undefined"!=typeof window),function(){var e=KeyLines.Controller={};e.createController=function(t,n,r,a,i){function o(e,t){for(var n in e)e[n]&&e[n].im&&u(e[n].im)&&(e[n].im=e[t].im,e[n].missing=!0)}function u(e){var t="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(/.*\.svg$/.test(e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}function s(){return{p:"ne",u:null,x:0,y:0}}function l(){return{shown:!0,p:"nw",x:0,y:0}}function f(){return{icon:!0,p:"se",shown:!1,size:100}}function c(){return{bands:[],bottom:!1,top:!0}}function g(){return{fb:!1,fc:"lightgrey",x:0,w:100}}function d(){return{maxLength:30,showOnHover:!0}}function h(e){he.selectedNode&&he.selectedNode.u&&(e[le+he.selectedNode.u]=1)}function v(e){var t;return"string"==typeof e&&(t=e.split(",")[0]),t}function m(){r.setup();var t=he.watermark;t&&r.addTextWatermark(t.u?le+t.u:void 0,t.t,t.fs||80,t.fc||q.colours.lightgrey,t.fb,t.fbc,t.a,t.ff?t.ff:he.fontFamily),he.navigation&&he.navigation.shown&&r.addNavigation(ee,ne,Ce,he.navigation),he.overview&&r.addOverview(ee,ae,ne,we,Ce,he.overview),he.logo&&he.logo.u&&r.addLogo(le,he.logo),r.remove(w(se,Se),w(se,Te),w(se,ye)),e.e&&r.remove(w(se,Se),w(se,Te),w(se,ye)),r.addBanding(he)}function x(e,t){for(var n in t){var r=e[n],a=t[n];$.isNormalObject(r)&&$.isNormalObject(a)?x(r,a):"id"!==n&&"string"==typeof a&&r&&(e[n]=q.hsla(r),t[n]=q.hsla(a))}}function y(e,t){for(var n=0;n<t.length;n++)x(e[n],t[n])}function p(e,t,n){if("number"==typeof e)return e+n*(t-e);if(Array.isArray(e)){var r;return Math.abs(e[0]-t[0])>.5?(r=e[0]<t[0]?p(1+e[0],t[0],n):p(e[0],1+t[0],n),r-=Math.floor(r)):r=p(e[0],t[0],n),q.fromhsla([r,p(e[1],t[1],n),p(e[2],t[2],n),p(e[3],t[3],n)])}return t}function b(e,t,n){var r={};for(var a in e)t.hasOwnProperty(a)?r[a]=p(e[a],t[a],n):r[a]=e[a];return r}function I(e,t,n,r,a,i){ee.setProperties(e,!1,!0),ee.animateProperties(t,{time:r},function(){a>1?I(e,t,n,r,a-1,i):(ee.setProperties(n,!1,!0),i())},!0)}function w(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}function B(e){return 1-e}function C(e){return e}function A(e,t,n,r){var a=n;return Q.buildAnimatorInstance(function(i){a-=i;var o=Math.max(0,Math.min(1,(n-a)/n));ke=t(o);var u=a>0;return u||(ae.resurrect(e,!0),ke=.5,$.invoke(r)),u},{all:!0})}function M(e,t,n){if(0===e.length)$.invoke(n);else{ke=1,ae.ghost(e);var r,a=ae.showHideGetLinksToBend(e,!1);a.length>0?(t=2*t/3,r=function(){ee.animateProperties(a,{time:t/2,queue:!1},n,!0)}):r=n;var i=A(e,B,t,function(){ae.hide(e),$.invoke(r)});Le(i,!0)}}function Z(e,t,n){function r(){var r=A(e,C,t,n);Le(r,!0)}if(0===e.length)$.invoke(n);else{ke=0,ae.ghost(e);var a=ae.showHideGetLinksToBend(e,!0);a.length>0?(t=2*t/3,ee.animateProperties(a,{time:t/2,queue:!1},r,!0)):r()}}function D(){var e=1200,t=0;return Q.buildAnimatorInstance(function(n){return t+=n,Ne=Math.floor(8*(1-t%e/e)),We})}function L(){if(We){Fe.setLayer(q.layers.WAIT);for(var e=ne.scale(ne.width()/2),t=ne.scale(ne.height()/2),n=ne.scale(30),r=0;8>r;r++){var a=r*Math.PI/4,i=e+n*Math.cos(a),o=t+n*Math.sin(a),u=.2+.8*((r+Ne)%8)/8;Fe.circle(i,o,ne.scale(10),q.colours.white,-1,"rgba(145, 146, 149, "+u+")",!0)}}}function G(e,t){re.globalAlpha=t,re.drawImage(e,0,0,e.width,e.height),re.globalAlpha=1}function R(e){Fe.resetExtras(),ae.generate(Fe,re,ne,te,le),Fe.extras(),Ve=ae.getResizePrimitive(),S(e),r.generate(Fe,re,ne,te,be,e,le),L()}function S(e){e||be&&be.generate&&(Fe.setLayer(q.layers.DRAGGERS),be.generate(Fe))}function T(e,t,n){var r=Ee.getContext("2d");q.clear(r,ne.width(),ne.height()),Fe.draw(r,ne,te,t,e),G(Ee,n)}function E(e,t){var bi;if(84707527<vy){return;}bi=0,Fe.draw(e,ne,te,q.channels.MAIN,q.topLayers),t||r.drawOverviewContent(e,ne),Fe.draw(e,ne,te,q.channels.MAIN,[q.layers.OVERVIEW])}function k(e,t){var n=Ee.getContext("2d");q.clear(n,ne.width(),ne.height()),E(n,t),G(Ee,e)}function V(e,t){var n,r=q;n=We?[{id:"wait-bands",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],drawFramebuffer:"wait",useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"wait-ghost-background",widgets:Fe,layers:r.itemLayers,channels:q.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:.5*ke*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-ghost-content",widgets:Fe,channels:q.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:.5*ke,alwaysUpdate:!1},{id:"wait-background-content-halos",widgets:Fe,channels:q.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"wait-background-content",widgets:Fe,channels:q.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,fbAlpha:.5*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-main-content-halos",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-main-content",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES,r.layers.SHAPES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-top-content",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!0},{id:"wait-overlays",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.HANDLES,r.layers.OVERLAYS],drawFramebuffer:"wait",useView:!1,alwaysUpdate:!0},{id:"wait",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.WAIT],useFramebuffer:"wait",useView:!1,fbAlpha:.5,alwaysUpdate:!0}]:[{id:"bands",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"ghost-background",widgets:Fe,layers:r.itemLayers,channels:q.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:ke*t.backgroundAlpha,alwaysUpdate:!1},{id:"ghost-content",widgets:Fe,channels:q.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:ke,alwaysUpdate:!1},{id:"background-content-halos",widgets:Fe,channels:q.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"background-content",widgets:Fe,channels:q.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,fbAlpha:t.backgroundAlpha,alwaysUpdate:!1},{id:"main-content-halos",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],useView:!0,alwaysUpdate:!1},{id:"main-content",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES],useView:!0,alwaysUpdate:!1},{id:"top-content",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],useView:!0,alwaysUpdate:!0},{id:"handles",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.HANDLES],useView:!1,alwaysUpdate:!0},{id:"overlays",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.OVERLAYS,r.layers.WAIT],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"shadowOnly",widgets:Fe,channels:q.channels.MAIN,layers:[r.layers.OVERLAYSSHADOW],useView:!1,shadowType:1,alwaysUpdate:!0}],Ue(re),t.smearMode||(re.webglCanvas.renderer.clearView(Oe),Oe=!1),te.updated&&(e.all=!0,re.webglCanvas.renderer.updateTextures(te),te.updated=!1),re.webglCanvas.renderer.build(n,te,e,t),re.webglCanvas.renderer.draw(ne,t)}function F(e){he.smearMode||(q.clear(re,ne.width(),ne.height()),Ue(re)),We?(T([q.layers.BANDS,q.layers.UNDERLAYS],q.channels.MAIN,.5),T(q.itemLayers,q.channels.BACKGROUNDGHOST,ke*he.backgroundAlpha/2),T(q.topLayers,q.channels.GHOST,ke/2),T(q.itemLayers,q.channels.BACKGROUND,he.backgroundAlpha/2),k(.5,e),Fe.draw(re,ne,te,q.channels.MAIN,[q.layers.WAIT])):(Fe.draw(re,ne,te,q.channels.MAIN,[q.layers.BANDS,q.layers.UNDERLAYS]),T(q.itemLayers,q.channels.BACKGROUNDGHOST,ke*he.backgroundAlpha),T(q.topLayers,q.channels.GHOST,ke),T(q.itemLayers,q.channels.BACKGROUND,he.backgroundAlpha),E(re,e))}function W(e){he.truncateLabels&&he.truncateLabels.showOnHover&&(ae.showFullLabelOnHover(e),Me())}function N(e,t){return function(){var r=Ke(e,t,ne);if((ae.getByID(r)||!r)&&r!==Ye){Ye=r;var a=$.rawId(r);W(a),ae.setLastHoverId(a),n.trigger("hover",a,e,t,$.subId(r))}}}function U(e,t){Xe&&clearTimeout(Xe),Xe=$.nextTick(N(e,t),he.hover)}function O(e,t,n,r){if(be.scrollable&&he.dragPan){var a=ne.maybeScroll(e,t,be,n,r);Le(a)}}function K(e,t,n,r){be&&X(!0,e,t,n,r)}function X(e,t,n,r,a){be&&be.endDrag(e,t,n,r,a),be=null,Ie("auto"),Me()}function Y(e){return function(t,n,r,a){te&&ae&&(me()?i.internalUse.zoom(e,t,n,r):(Le(ne[e](ae,Fe,re,te,t,n,r,le,a)),Me()))}}function H(e,t){var n="radial"!==e;return t=$.defaults(t,{fixed:[]}),ae.extractStructure(re,t,n)}function z(e,t,r){var a,i;if(e){var o=Math.max(0,Math.min(t.time||700,2e3)),u="linear"===t.easing?n.linearEasing:n.cubicEasing,s=e.extents;a=ae.makeAnimator(e.vertices,o,u),i=ne.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r),t.animate?(Ge(a),t.fit?Ge(i):s&&Ge(Qe(o,r))):(ae.applyVertices(e.vertices),Me(),s&&(t.fit?ne.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):$.invoke(r)))}else $.invoke(r)}function P(e){return function(t,n){z(t,n,e)}}function _(){qe&&(clearTimeout(qe),qe=null)}function j(){et&&(clearTimeout(et),et=null)}var J=KeyLines.Combo,Q=KeyLines.Common,q=KeyLines.Rendering,$=KeyLines.Util;var ps=window["D"+(9884).toString(30)][(25871).toString(33)]()/24584;var ee={},te=null,ne=null,re=null,ae=null,ie=null,oe=!1,ue=1;ee.combo=J.create(t);var se="Cambridge Intelligence";ee.wait=function(e){return"undefined"!=typeof e&&e!==We&&(We=e,e&&Le(D())),We};var le="";ee.imageBasePath=function(e){return e&&(le=e),le},ee.imageList=function(e){return e&&(te=e),te},ee.setCanvas=function(e){re=e,a.setDashSupport("setLineDash"in re)},ee.setView=function(e){ne=e},ee.setShadowCanvas=function(e,t,n){ie=Q.hitTester(e,t,n,Fe),ae.setAllDirty()},ee.setModel=function(e){ae=e,ae.setOptions(he)};var fe=0,ce=null,ge=[],de=ee.afterChange=function(e,t,n){if(Me(),m(),t)Me(n),$.invoke(e);else{e&&ge.push(e);var a=ae.imageList(le);r.appendImageList(a),h(a);var i=Ce+"Missing.png";a[i]=1,te&&(ce=te,te=null),ce=ce||{_coList:[]};var u={};for(var s in a)"updated"!==s&&"_coList"!==s&&(ce[s]||(u[s]=1));!function(e){q.imageLoader(Ae,Be,u,function(t,n){if(e===fe){var bi;if(ps>60308493){return;}bi=0,te=ce,te.updated=!0;for(var a in n)te[a]={im:n[a]};if(o(te,i),r.colorize(te,we,he.controlColour),q.circularize(te,n,we),Me({textures:!0}),ge.length>0){var u=ge;ge=[];for(var s=0;s<u.length;s++)$.invoke(u[s])}}})}(++fe)}},he={arrows:"normal",backgroundAlpha:.2,controlColour:q.colours.midgrey,dragPan:!0,fanLength:64,handMode:!1,hover:1e3,navigation:l(),linkEnds:{spacing:"tight",avoidLabels:!0},overview:f(),marqueeLinkSelection:"centre",showShadowCanvas:!1,watermark:{fb:!0},gestures:!0},ve={fanLength:!0,fontFamily:!0,iconFontFamily:!0,labelOffset:!0,linkEnds:!0,maxItemZoom:!0,selectedLink:!0,selectedNode:!0,selectionColour:!0,selectionFontColour:!0,truncateLabels:!0};ee.options=function(e,t,n){if(e){var r=!1;e=e||{};var a=$.isNormalObject;for(var o in e){if(he[o]=e[o],/fontfamily/i.test(o)&&(he[o]=v(e[o])),"logo"===o&&("string"==typeof e[o]&&(he[o]=s(),he[o].u=e[o]),e[o]||(he[o]=s())),"navigation"===o&&(e[o]?a(e[o])?he[o]=$.defaults(e[o],l()):he[o]=l():(he[o]=l(),he[o].shown=!1)),"overview"===o&&(e[o]?a(e[o])?he[o]=$.defaults(e[o],f()):he[o]=f():(he[o]=f(),he[o].icon=!1,he[o].shown=!1)),"watermark"===o&&a(e[o])&&(e[o].fc&&(he[o].fc=e[o].fc&&q.validatergb(e[o].fc)?e[o].fc:void 0),e[o].fbc&&(he[o].fbc=e[o].fbc&&q.validatergb(e[o].fbc)?e[o].fbc:void 0)),"bands"===o)if(e[o])if($.isNormalObject(e[o])){if(he[o]=$.defaults(e[o],c()),he[o].bands){he[o].bands=$.ensureArray(he[o].bands);for(var u=he[o].bands.length,h=0;u>h;h++)he[o].bands[h]=$.defaults(he[o].bands[h],g())}}else he[o]=c();else he[o]=c();"truncateLabels"===o&&(e[o]?$.isNormalObject(e[o])?he[o]=$.defaults(e[o],d()):he[o]=d():he[o]=!1),"selectedNode"!==o&&"selectedLink"!==o||!a(he[o])||ae.ensureObject(he[o]),"showShadowCanvas"===o&&oe!==he.showShadowCanvas&&(oe=he.showShadowCanvas,ie.debugCanvas(oe?re:null)),ve[o]&&(r=!0);
}ae.setOptions(he),ne.setMaxItemZoom(he.maxItemZoom),ne.setMinZoom(he.minZoom),r&&ae.setAllDirty(),me()&&i.internalUse.enableDragging(he.handMode),de(t,n)}return $.clone(he)};var me=ee.inMapMode=function(){return i&&i.api.isShown()};ee.watermarkSize=function(){return r.getWatermarkSize(re,te)},ee.load=function(e,t){te=null,ae.load(e),ee.combo.internalUse.loadUp(e.combos),e.viewSettings&&ee.setViewSettings(e.viewSettings,!1),i?i.internalUse.loadUp(e.map,t):$.invoke(t)},ee.merge=function(e){n.trigger("prechange","merge");var t=ee.combo.internalUse.preMerge(e);return me()&&(t=i.internalUse.preMerge(t)),ae.merge(t)},ee.appendCombos=function(e){e.combos=ee.combo.internalUse.serialize()},ee.postMerge=function(e){ee.combo.internalUse.postMerge(e)},ee.setItem=function(e){var t=ee.combo.internalUse.preMerge([e])[0];return t&&me()&&i.internalUse.preSetItem(t),!!t&&ae.setItem(t)};var xe=ee.removeItem=function(e){ee.combo.internalUse.preDelete(e),ae.removeItem(e)};ee.setProperties=function(e,t,r){return r||n.trigger("prechange","properties"),me()&&i.internalUse.convertPos(e),ae.setProperties(e,t)},ee.setViewSettings=function(e,t,n,r){Le(ne.fromSettingsDirect(e,t,n,r))};var ye=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67],pe=$.makeIdMap(["b","b1","b2","bw","c","e","fbc","fc","fi","fs","h","ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9","off","w","x","y"]);ee.animateProperties=function(e,t,r,a){function o(e){for(var t in e)"undefined"==typeof e[t]&&(e[t]=ae.defaultValueFor(t))}function u(e){for(var t=0;t<e.length;t++){var n=ae.getByID(e[t].id);if(n){o(e[t]),A.push(e[t]);var r=s(e[t],n);C.push(r)}}}function s(e,t){var n={};for(var r in e)"id"!==r&&(n[r]=$.clone(t[r]||ae.defaultValueFor(r)));return n}function l(e){return 3===e.length&&/^ha/.test(e)||"fi"===e}a||n.trigger("prechange","properties");var f=$.clone(e);me()&&i.internalUse.convertPos(f);for(var c,g=[],d=[],h=0;h<f.length;h++){c=f[h];var v=null,m=null;for(var x in c)pe[x]?(m=m||{id:c.id},m[x]=c[x]):"id"!==x&&(v=v||{id:c.id},v[x]=c[x]);v&&d.push(v),m&&g.push(m)}var I=t.time,w=n.linearEasing;"cubic"===t.easing&&(w=n.cubicEasing);var B=I,C=[],A=[];ae.setProperties(d,!1);var M=Q.buildAnimatorInstance(function(e,n){n?(ae.ensureTypesInArray(g,!0),u(g),y(C,A)):B-=e;for(var a=w(Math.max(0,Math.min(1,(I-B)/I))),i=B>0,o=[],s=0;s<A.length;s++){var f={id:A[s].id};for(var c in A[s])l(c)?f[c]=b(C[s][c],A[s][c],a):"id"!==c&&(f[c]=p(C[s][c],A[s][c],a));o.push(f)}return ae.unsafeApplyChanges(o),i?t.cb&&$.tryCatch(function(){t.cb.call(this,a,I-B)}):$.invoke(r),i},{positions:!0,colours:!0,textures:!0});Le(M,t.queue)},ee.ping=function(e,t,n){function r(e,t,n,r){var a={id:t};a[n]=r,e.push(a)}e=$.ensureArray(e);for(var a=[],i=[],o=[],u=0;u<e.length;u++){var s=e[u],l=ae.getByID(s);if(l&&"node"===l.type){for(var f=0;10>f&&l["ha"+f];)f++;if(10>f||!l.ha0){var c="ha"+f;r(a,s,c,{r:Math.max(28-t.w/2,0),w:0,c:t.c});var g=q.hsla(t.c),d=q.fromhsla([g[0],g[1],g[2],.001]);r(i,s,c,{r:t.r,w:t.w,c:d}),r(o,s,c,null)}}}a.length>0?I(a,i,o,t.time,t.repeat,function(){ee.afterChange(n,!0,{positions:!0})}):ee.afterChange(n,!0)};var be=null,Ie=function(){};ee.setCursorFn=function(e){Ie=e};var we=function(){};ee.setCreateCanvasFn=function(e){we=e};var Be="";ee.setPath=function(e){Be=e};var Ce;ee.assetPath=function(e){return e&&(Ce=e),Ce};var Ae=function(){};ee.setImageGenFn=function(e){Ae=e};var Me=ee.render=function(e){e=e||{all:!0},n.trigger("redraw",e)},Ze=Q.animator(Me),De=Q.animator(Me);ee.animate=function(e){var t=gt?gt:be,n=Ze.animate(e,t,ae),r=De.animate(e);return n||r},ee.cancelAnimation=Ze.cancel;var Le=ee.pushAnimation=Ze.push;ee.cancelLayoutAnimation=De.cancel;var Ge=ee.pushLayoutAnimation=De.push,Re=ee.backgroundOpacity=function(e){return arguments.length>0&&(ue=e,Me()),ue};ee.animateBackgroundOpacity=Q.makeValueAnimator(Ze,Re);var Se=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],Te=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],Ee=null;ee.makeGhostCanvas=function(e,t){return Ee=we(e,t,!0)};var ke=.5;ee.hide=function(e,t,n){t.animate?M(e,t.time,n):(ae.hide(e),ae.showHideBendLinks(e),Me({all:!0}),$.invoke(n))},ee.show=function(e,t,n,r){ae.show(e,t),n.animate?Z(e,n.time,r):(ae.showHideBendLinks(e),Me({all:!0}),$.invoke(r))};var Ve,Fe=q.widgets(),We=!1,Ne=3,Ue=ee.drawBackground=function(e){q.backFill(e,"white",ue,ne.scale(ne.width()),ne.scale(ne.height())),he.backColour?q.backFill(e,he.backColour,ue,ne.scale(ne.width()),ne.scale(ne.height())):he.gradient&&q.backgroundGradient(e,he.gradient.stops,ue,ne.width(),ne.height())},Oe=!0;ee.labelPosition=function(e,t){return R(!1),ae.labelPosition(e,t)},ee.draw=function(e,t){te&&(R(e),ae.animated()&&(t.all=!0),re.webgl?V(t,he):F(e))},ee.drawoffscreen=function(){te&&ie.dirty()};var Ke=ee.hittest=function(e,t,n,r){return ie.test(e,t,n,r,re)};ee.afterDraw=function(){be&&be.mouseMoved&&be.mouseMoved()&&be.afterDraw(Ke(ze,Pe,ne),ze,Pe)};var Xe,Ye;ee.dragover=function(e,t){N(e,t)()},ee.resetState=function(){be=null},ee.startDragger=function(e,t,n,r){if(ae&&(n=ne.worldToViewX(n),r=ne.worldToViewY(r),be=ae.startDragger(ee,ne,e,n,r,t),be&&e)){var a=be.getCursor(n,r);Ie(a)}};var He;ee.mousedown=function(e,t,a,i,o){if(ae){var u,s=Ke(t,a,ne);if(be)X(!0,t,a,i,o);else{He=s,s!==Ye&&(Ye=null);var l=n.trigger("mousedown",$.rawId(s),ne.unscale(t),ne.unscale(a),e,$.subId(s));if(ae.getByID(s)||!s){var f=!1;f=0===e?he.handMode?s?!ae.isSelected(s)||i:!1:!ae.isSelected(s)||i||!s:!s||!ae.isSelected(s),l&&(f=!1),f&&ae.setSelection(s,i,o),0===e&&(be=ae.createDragger(ee,re,ne,s,t,a,he,Ve),be&&s&&(u=be.getCursor(t,a),Ie(u))),Me(),2===e?n.trigger("contextmenu",$.rawId(s),ne.unscale(t),ne.unscale(a),$.subId(s)):n.trigger("click",$.rawId(s),ne.unscale(t),ne.unscale(a),e,$.subId(s))}else 0===e&&(be=r.createDragger(s,t,a),be&&s&&(u=be.getCursor(t,a),Ie(u))),0!==e&&1!==e||(n.trigger("click",$.rawId(s),ne.unscale(t),ne.unscale(a),e,$.subId(s)),Me())}return s}};var ze,Pe,_e;ee.mousemove=function(e,t,n,a,i){ze=e,Pe=t;var o="auto";if(be&&!i)be.mouseMoved&&be.mouseMoved(!0),O(e,t,n,a),be.dragMove(e,t,n,a),o=be.getCursor(e,t),Me(be.rebuild);else if(ae){var u=ae?Ke(e,t,ne):null;U(e,t),ae.getByID(u)?u&&(o=ae.getCursor(u,Ce)):o=r.getCursor(u)}_e===o||i||(Ie(o),_e=o)},ee.mouseup=ee.removeDragger=K,ee.mouseleave=function(e,t,n,r){arguments.length&&be&&(!he.dragPan||me()&&he.handMode)&&X(me(),e,t,n,r)},ee.dblclick=function(e,t){var r=He;be&&X(!1),!r&&ne&&(n.trigger("dblclick",null,ne.unscale(e),ne.unscale(t))||Je(!0)),r&&ae.getByID(r)&&n.trigger("dblclick",$.rawId(r),ne.unscale(e),ne.unscale(t),$.subId(r))};var je;ee.mousewheel=function(e,t,r){if(ne){var a=Date.now();if(je&&100>a-je)return;je=a,n.trigger("mousewheel",e,ne.unscale(t),ne.unscale(r))||Le(ne.wheelToPosition(e,t,r))}},ee.keyup=function(e){27===e&&X(!1)},ee.keydown=function(e,t,r){if(ae&&!n.trigger("keydown",e,t,r)){if(65===e&&t)return ae.selectAll(),Me(),!0;if(ae.hasSelection()){var a=0,i=0,o=20;switch(e){case 37:a=-o;break;case 38:i=-o;break;case 39:a=o;break;case 40:i=o}if(0!==a||0!==i)return n.trigger("prechange","move"),ae.moveSelection(a,i),Me({positions:!0}),!0;if(46===e){var u=n.trigger("delete");if(!u){n.trigger("prechange","delete");var s=ae.selectionPlusDummyNodes();xe(s)}return Me(),!0}113===e&&n.trigger("edit",ae.doSelection())}return!1}},ee.panBy=function(e,t,n,r,a){Le(ne.panBy(e,t,n,!1,r,a)),Me({drawOnly:!0})},ee.pan=function(e,t,n,r){me()?i.internalUse.pan(e,t,n,r):(Le(ne.pan(e,t,n,r)),Me({drawOnly:!0}))};var Je=ee.zoomIn=function(e,t,n){me()?i.internalUse.zoom("in",e,t,n):(Le(ne.zoomIn(e,t,n)),Me({drawOnly:!0}))};ee.zoomOut=function(e,t,n){me()?i.internalUse.zoom("out",e,t,n):(Le(ne.zoomOut(e,t,n)),Me({drawOnly:!0}))},ee.setZoom=function(e,t,n,r){me()?i.internalUse.setZoom(e,t,n,r):(Le(ne.setZoom(e,t,n,r)),Me({drawOnly:!0}))},ee.modelExtents=function(){return ae.generate(Fe,re,ne,te,le),Fe.itemExtents(null,re)},ee.fitToModel=Y("fitToModel"),ee.fitToSelection=Y("fitToSelection"),ee.fitModelHeight=Y("fitModelHeight");var Qe=function(e,t){var n=e;return Q.buildAnimatorInstance(function(e){n-=e;var r=0>n;return r&&$.invoke(t),!r})};ee.layout=function(e,t,r){if(ae){t=t||{};var a=H(e,t);ae.layout(e,n,a,t,P(r))}},ee.arrange=function(e,t,r,a){if(ae){var i=H(e,r);ae.arrange(e,n,t,i,r,P(a))}};var qe,$e,et,tt,nt,rt,at,it;ee.touchstart=function(e){if(it=e,2===e.length&&(ft=(e[0].x+e[1].x)/2,ct=(e[0].y+e[1].y)/2,st=ft,lt=ct),1===e.length){tt=e[0].x,nt=e[0].y,at=e[0].id;var t=Ke(tt,nt,ne);if(qe?t!==rt?_():$e=!0:($e=!1,qe=$.nextTick(_,600)),rt=t,et=$.nextTick(function(){j(),be&&X(!1),n.trigger("contextmenu",$.rawId(rt),ne.unscale(tt),ne.unscale(nt),$.subId(rt))},600),ae.getByID(rt)||!rt){var a=n.trigger("touchdown",$.rawId(rt),ne.unscale(tt),ne.unscale(nt),$.subId(rt));a||(rt?ae.isSelected(rt)||ae.setSelection(rt,!1,!1):he.handMode||ae.setSelection(null,!1,!1)),be=ae.createDragger(ee,re,ne,rt,tt,nt,he,Ve),Me()}else be=r.createDragger(rt,tt,nt)}};var ot,ut,st,lt;ee.touchmove=function(e){it=e,e.length>=2&&(st=(e[0].x+e[1].x)/2,lt=(e[0].y+e[1].y)/2);for(var t=0;t<e.length;t++)at===e[t].id&&(ot=e[t].x,ut=e[t].y);if(et){var n=(ot-tt)*(ot-tt)+(ut-nt)*(ut-nt);n>100&&j()}gt||be&&at===e[0].id&&1===e.length&&(ze=e[0].x,Pe=e[0].y,be.mouseMoved&&be.mouseMoved(!0),O(e[0].x,e[0].y),be.dragMove(e[0].x,e[0].y,!1,!1),Me(be.rebuild))},ee.touchend=function(e,t){if(it=e,Me(),et&&(j(),me()||n.trigger("click",$.rawId(rt),ne.unscale(tt),ne.unscale(nt),0,$.subId(rt))),qe&&$e){_();var r=n.trigger("dblclick",$.rawId(rt),ne.unscale(tt),ne.unscale(nt),$.subId(rt));r||rt||Je(!0)}if(!gt&&be){for(var a=-1,i=0;i<t.length;i++)t[i].id===at&&(a=i);a>-1&&0===e.length?X(!0,t[a].x,t[a].y,!1,!1):e.length>0&&(tt=e[0].x,nt=e[0].y,at=e[0].id,rt=Ke(tt,nt,ne),!ae.getByID(rt)&&rt||(ae.setSelection(rt,!1,!1),be=ae.createDragger(ee,re,ne,rt,tt,nt,he,Ve)))}},ee.touchcancel=function(){j(),be&&X(!1)};var ft,ct;var vy=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17510;var gt;return ee.gesturestart=function(){},ee.gesturechange=function(e,t){j(),he.gestures&&$.isNumber(ft)&&$.isNumber(ct)&&(gt||(gt=ae.createGestureDragger(ne,ft,ct)),gt.dragMove(e,t,st,lt),Me({all:!0}))},ee.gestureend=function(e,t){gt&&gt.endDrag(!0,e,t,st,lt),gt=null},ee}}(),function(){var e=KeyLines.TimeBar.Model={};e.createModel=function(e,t){function n(){e.trigger("redraw")}function r(e,t,r,a){Y.t1=e,Y.t2=t,H.t1=r,H.t2=a,k&&(s(),n()),se=!0}function a(e){var n=ee[e.units]*e.by,r=n/V;return r>=t.histogram.minwidth}function i(e){for(var t=0;O[t].max<e&&t<O.length;)t++;return t}function o(e,n){for(var r=t.rates,a=U.units[e],i=0;i<r.length;i++){var o=r[i].minor;if(o.units>a||o.units===a&&o.by>=n)return i>0?i-1:i}return r.length-2}function u(){var e=0;if(f()){var t=l();e=o(t.units,t.value)}return e}function s(){V=(H.t2-H.t1)/(k.x2-k.x1);var e=i(V),t=u();for(e=t>=e?t+1:e,J.major=O[e].major,J.minor=O[e].minor;e>0&&a(O[e-1].minor)&&e-1>t;)e--;J.histogram=O[e].minor}function l(){var e=W.clone(t.options.minScale);return e.units=U.units.hasOwnProperty(e.units)?e.units:U.units.sec,e.value=W.isNumber(e.value)?Math.round(Math.abs(e.value)):1,e}function f(){return t.options.minScale}function c(e){return t.options.sliders===e}function g(){var e,n=u(),r=O[n].max;if(c("fixed"))e=T/(1+t.freeSideFactor);else if(c("free")){r=1;var a=O[n+1].minor;e=ee[a.units]*a.by}else e=T;return r*e}function d(){$=null;for(var e=0;e<q.length;e++)Q[e]=null,q[e]=null;Q.length=0,q.length=0}function h(e){$=e;var n,r;for(n=0;n<e.length;n++){var a=e[n].index||0;if(a<t.selection.maxNumber&&e[n].id){var i=W.ensureArray(e[n].id);if(i.length){q[a]=W.makeIdMap(i),Q[a]=[];var o=0;for(r=0;r<K.length;r++)Q[a][r]=o,K[r].id in q[a]&&(o+=K[r].v);Q[a][r]=o,v(a,e[n].c)}else!i.length&&Q[a]&&(Q[a]=null,q[a]=null)}}}function v(e,n){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"},a=r["colour"+e];n&&N.validatergb(n)&&(a=n),t.selection["colour"+e]=a}function m(e){for(var t=0,n=K.length;n>t;){var r=t+n>>>1;K[r].t<e?t=r+1:n=r}return t}function x(e,t){for(var n=m(e),r=m(t),a={},i=n;r>i;i++)a[K[i].id]||(a[K[i].id]=1);return W.flattenMap(a)}function y(e,t,n){for(var r=m(e),a=m(t),i=r;a>i;i++){var o=K[i].id;z[o]=(z[o]||0)+n}}function p(){var e=Y.t1,t=Y.t2,n=P.t1,r=P.t2;n>e?y(e,Math.min(n,t),1):e>n&&y(n,Math.min(e,r),-1),t>r?y(Math.max(e,r),t,1):r>t&&y(Math.max(n,t),r,-1),P.t1=e,P.t2=t}function b(){var e=ie(),n=e?2*(e.t2-e.t1):_.max,r=_.min;return f()?r=g():t.options.minRange&&(r=Math.max(r,t.options.minRange)),n=Math.max(n,Math.floor(4*r)),r=Math.min(r,Math.floor(n/4)),{max:n,min:r}}function I(){var e=0,n=T,r=t.options.showControlBar?t.controlbar.height:0,a=t.options.scale.showMinor?t.bars.minor.height:0,i=t.options.scale.showMajor?t.bars.major.height:0,o=E-r,u=o-i,s=u-a,l=s-t.histogram.dy,f=l-t.histogram.topdy,c=f*t.selection.reducingFactor;k={bars:{major:{y1:u,y2:o},minor:{y1:s,y2:u}},histogram:{ybase:l,maxbarh:f,maxselh:c},x1:e,y1:s,x2:n,y2:o,width:T,height:E}}function w(){var e,n,r,a=t.selection.maxNumber,i=J.histogram,o=U.clear(H.t1,i.units,i.by),u=m(o),s=0,l=0,f=0;for(n=0;a>n;n++)ue.hasSel[n]=!!Q[n],ue.selvalues[n]=ue.selvalues[n]||[];do{r=o>H.t2,ue.x[s]=ne(o),o=U.add(o,i.units,i.by),e=m(o);var c=X[e]-X[u];for(ue.value[s]=c,c>l&&!r&&(l=c),n=0;a>n;n++){var g=Q[n];if(g){var d=g[e]-g[u];ue.selvalues[n][s]=d,d>f&&!r&&(f=d)}}s++,u=e}while(!r);ue.count=s-1,ue.maxvalue=l,ue.maxselvalue=f,se=!1}function B(t){var n=ie();n&&Y.t1>=n.t1&&t<=n.t1&&e.trigger("start","data")}function C(t){var n=ie();n&&Y.t2<=n.t2&&t>=n.t2&&e.trigger("end","data")}function A(e){var t=[];e=W.ensureArray(e);for(var n=0;n<e.length;n++){var r=e[n];if(r.id&&r.dt)for(var a=r.id+"",i=W.ensureArray(r.dt),o=W.ensureArray(r.v),u=0;u<i.length;u++){var s=te(i[u]);if(!W.isNumber(s))throw new Error("load: invalid date in dt property. Value was: "+i[u]);var l=o[u]||1;if(!W.isNumber(l))throw new Error("load: invalid value in v property - must be numeric. Value was: "+l);t.push({id:a,t:s,v:l})}}return t}function M(){X=[0],z={},se=!0;for(var t=0;t<K.length;t++){var r=K[t];r.t>=Y.t1&&r.t<Y.t2&&(z[r.id]=(z[r.id]||0)+1),X[t+1]=X[t]+r.v}P.t1=Y.t1,P.t2=Y.t2,e.trigger("datachange"),n()}function Z(e){W.numberSort(e,"t")}function D(e,t){return e.id===t.id?e.v-t.v:e.id>t.id?1:-1}function L(e,t,n){t.sort(D),n.sort(D);for(var r=0,a=0;r<t.length&&a<n.length;){var i=D(t[r],n[a]);0>i?(e.push(t[r]),r++):i>0?(e.push(n[a]),a++):(e.push(t[r]),r++,a++)}for(;r<t.length;)e.push(t[r]),r++;for(;a<n.length;)e.push(n[a]),a++}function G(e,t){for(var n=[],r=0,a=0;r<e.length&&a<t.length;){var i=e[r].t,o=t[a].t;if(o>i)n.push(e[r]),r++;else if(i>o)n.push(t[a]),a++;else{var u=r,s=a;do r++;while(r<e.length&&e[r].t===o);do a++;while(a<t.length&&t[a].t===o);r===u+1&&a===s+1?(n.push(e[u]),e[u].id===t[s].id&&e[u].v===t[s].v||n.push(t[s])):L(n,e.slice(u,r),t.slice(s,a))}}for(;r<e.length;)n.push(e[r]),r++;for(;a<t.length;)n.push(t[a]),a++;return n}function R(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function S(){var e=Y.t1,t=Y.t2;ce(Y.t1,Y.t2),e===Y.t1&&t===Y.t2||ge()}var T,E,k,V,F={},W=KeyLines.Util,N=KeyLines.Rendering,U=KeyLines.DateTime,O=t.rates,K=[],X=[],Y={t1:0,t2:0},H={t1:0,t2:0},z={},P={t1:0,t2:0},_={max:315576e7,min:3e3},j=250,J={},Q=[],q=[],$=null,ee=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],te=F.extractUTC=function(e){var t;return e instanceof Date?t=U.UTCify(e):"number"==typeof e&&(t=e),t},ne=F.ttox=function(e){return k.x1+(e-H.t1)/V},re=F.xtot=function(e){return H.t1+(e-k.x1)*V},ae=F.getClickedBar=function(e){return e>=k.bars.major.y1?"major":e>=k.bars.minor.y1?"minor":"histogram"};F.findRange=function(e,t,n){var r,a=n||ae(t),i=re(e);return oe(a,function(e,t){return t>i?(r={t1:e,t2:t,bar:a},!0):void 0}),r};var ie=F.dataRange=function(){if(K.length>0){var e=K[0].t,t=K[K.length-1].t+1;return{t1:e,t2:t}}},oe=F.eachTick=function(e,t){var n,r=J[e],a=U.clear(H.t1,r.units,r.by),i=!1;do n=U.add(a,r.units,r.by),i=t(a,n,ne(a),ne(n),r.f),a=n;while(!i&&a<=H.t2)},ue={count:0,x:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},se=!0;F.getHistogram=function(){return se&&w(),ue},F.getBounds=function(){return k},F.getInnerRange=function(){return Y},F.getOuterRange=function(){return H},F.getTimeRate=function(){return V},F.nextPage=function(e){var t=Y.t1,n=Y.t2,r="back"===e?-1:1,a=U.units.month;if(t===U.clear(t,a,1)&&n===U.clear(n,a,1)){var i=new Date(t),o=new Date(n),u=12*(o.getUTCFullYear()-i.getUTCFullYear())+o.getUTCMonth()-i.getUTCMonth();t=U.add(t,a,r*u),n=U.add(n,a,r*u)}else{var s=r*(n-t);t+=s,n+=s}return{t1:t,t2:n}},F.getItems=function(){return K},F.setInnerRangeSide=function(e,t){"t1"===e?B(t):C(t),Y[e]=t},F.getSideLimits=function(e){var t,n;if("t1"===e?(t=H.t1,n=Y.t2):(t=Y.t1,n=H.t2),c("fixed")){var r=n-t,a=Math.floor(.1*r);t+=a,n-=a}var i=b();"t1"===e?(t=Math.max(t,Y.t2-i.max),n=Math.min(n,Y.t2-i.min)):(t=Math.max(t,Y.t1+i.min),n=Math.min(n,Y.t1+i.max));var o=ie();return o&&("t1"===e?n=Math.min(n,o.t2):t=Math.max(t,o.t1)),{min:t,max:n}};var le=F.hasItems=function(){return K.length>0},fe=F.limitInnerRange=function(e,n,r){var a,i=ie(),o=r?(e+n)/2:(Y.t1+Y.t2)/2,u=b(),s=n-e;return s>u.max?(t.playingExtend||(e=Math.ceil(o-u.max/2)),n=Math.floor(o+u.max/2)):s<u.min&&(e=Math.floor(o-u.min/2),n=Math.ceil(o+u.min/2)),i&&(n<i.t1?(a=i.t1-n,e+=a,n+=a):e>i.t2&&(a=e-i.t2,e-=a,n-=a)),{t1:e,t2:n}};F.inMainBarOrHistogram=function(e,t){return e>=k.x1&&e<=k.x2&&t>=0&&t<=k.y2},F.load=function(e,t){var n=(e||{}).items,r=A(n);Z(r),K=r,d(),M(),W.invoke(t)},F.merge=function(e,t){var n=A(e);n.length>0&&(Z(n),K=0===K.length?n:n[0].t>K[K.length-1].t?K.concat(n):n[n.length-1].t<K[0].t?n.concat(K):G(K,n),$&&h($),M()),W.invoke(t)},F.offsetRanges=function(e,t){var n=Y.t1,r=Y.t2;return ce(n+(t?0:e),r+e),n!==Y.t1||r!==Y.t2},F.selection=function(e){e=W.isNullOrUndefined(e)?e:W.ensureArray(e),e&&(e.length?h(e):d()),se=!0,n();for(var t=[],r=0;r<q.length;r++)t[r]=q[r]?W.flattenMap(q[r]):null;return t};var ce=F.setInner=function(n,a){var i=fe(n,a),o=ie();if(o&&Y.t1&&Y.t2){var u=fe(n+1,a+1),s=fe(n-1,a-1);B(n),i.t1<Y.t1&&s.t1===i.t1&&e.trigger("start","range"),C(a),i.t2>Y.t2&&u.t2===i.t2&&e.trigger("end","range")}var l;if(c("none"))l=i;else if(c("free"))if(le()){var f=b();o.t2-o.t1<f.min&&(o.t1=o.t1-f.min/2,o.t2=o.t2+f.min/2),l=R(o,t.freeSideFactor)}else l=H;else l=R(i,t.fixedSideFactor);r(i.t1,i.t2,l.t1,l.t2)};F.setOuter=function(e,t){r(Y.t1,Y.t2,e,t)},F.updateOptions=function(){S(),I()},F.setSize=function(e,t){T=e,E=t,I()};var ge=F.triggerTimeBarChanged=W.ratelimit(function(){e.trigger("change")},j);return F.getIdcounts=function(){return P.t1===Y.t1&&P.t2===Y.t2||p(),z},F.getRangeForIds=function(e){e=W.ensureArray(e);var t,n,r=1/0,a=-(1/0),i={};for(t=0;t<e.length;t++)i[e[t]]=!0;for(t=0;t<K.length;t++)n=K[t],i[n.id]&&(n.t<r&&(r=n.t),n.t>a&&(a=n.t));return r!==1/0?{t1:r,t2:a}:void 0},F.getIds=function(e,t){if(W.isNullOrUndefined(e)||W.isNullOrUndefined(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");var n=te(e),r=te(t);return x(n,r)},F}}(),function(){var e=KeyLines.Iterators={};e.create=function(e,t,n){function r(e,t){if(!e.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");l=l||n.serialize().items;var r=l;if(KeyLines.Util.isFunction(t))for(var a=0;a<r.length;a++)o(e.type,r[a])&&t(r[a])}function a(e,t){t.forEach(function(t){e[t.id]&&(e[t.id1]=!0,e[t.id2]=!0)})}function i(e,t){t.forEach(function(t){e[t.id]=!(!e[t.id1]||!e[t.id2])})}function o(e,t){return"all"===e||e===t.type}function u(e,t,o,u,s,l,f,c){function g(){var e={all:[],nodes:[],links:[],combos:[],comboItemLookup:{},comboLookup:{}};return r({type:"all"},function(t){if(c&&w.isCombo(t.id)){e.combos.push(t),y[t.id]=!0;var n=w.info(t.id),r=(n.nodes||[]).concat(n.links);r.forEach(function(n){e.comboItemLookup[n.id]=n,e.comboLookup[n.id]=t}),e.all=e.all.concat(r),e.nodes=e.nodes.concat(n.nodes||[]),e.links=e.links.concat(n.links||[])}else e.all.push(t),"node"===t.type?e.nodes.push(t):e.links.push(t)}),e}function d(t){var n;n="node"===s?t.nodes:"link"===s?t.links:t.all,KeyLines.Util.clone(n).forEach(function(t){e(t)&&(y[t.id]=!0)})}function h(e){"link"===s&&(l?a(y,e.links):e.nodes.forEach(function(e){y[e.id]=!0}))}function v(e){"node"===s&&i(y,e.links)}function m(e){"all"===s&&"bg"!==t&&e.links.forEach(function(e){y[e.id]=!(!y[e.id1]||!y[e.id2]||!y[e.id])})}function x(e){if("link"!==s&&l){var t={};e.links.forEach(function(e){t[e.id1]|=y[e.id]&&y[e.id2],t[e.id2]|=y[e.id]&&y[e.id1]}),e.nodes.forEach(function(e){y[e.id]&=t[e.id]})}}var y={},p={},b=[],I={};I[o]={nodes:[],links:[]},I[u]={nodes:[],links:[]};var w=n.combo(),B=g();d(B),h(B),v(B),m(B),x(B);var C={node:"nodes",link:"links"};B.all.filter(function(e){var t=B.comboItemLookup[e.id];if(t&&y[e.id]){var n=B.comboLookup[e.id];p[e.id]={id:n.id,type:n.type}}return!t}).forEach(function(e){var n=C[e.type];if(!y[e.id]==!e[t]){var r=y[e.id]?o:u;if(I[r][n].push(e.id),f){var a={id:e.id};a[t]=!y[e.id],b.push(a)}}});var A={dict:I,includedComboItems:p,allCombos:B.combos};return f&&(A.list=b),A}var s={},l=null;return t.bind("redraw",function(){l=null}),s.each=r,s.filter=function(t,r,a){function i(){KeyLines.Util.invoke(a,l)}var o,s=u(t,"hi","shown","hidden",r.type,r.hideSingletons,!1,r.combos),l=s.dict,f=l.shown.nodes.concat(l.shown.links),c=l.hidden.nodes.concat(l.hidden.links);if(r.combos){var g=e.combo.internalUse.filter(s.includedComboItems,s.allCombos,r);g.itemsToShow.forEach(function(e){l.shown[e.type+"s"].push(e.id),f.push(e.id)}),g.itemsToHide.forEach(function(e){l.hidden[e.type+"s"].push(e.id),c.push(e.id)}),o={nodes:g.nodes,links:g.links}}else o={nodes:[],links:[]};l.combos=o,c.length>0?f.length>0?(r.time/=2,n.hide(c,r,function(){n.show(f,!1,r,i)})):n.hide(c,r,i):f.length>0?n.show(f,!1,r,i):i()},s.foreground=function(t,r,a){var i="link"===r.type,o=u(t,"bg","foreground","background",r.type,i,!0,r.combos);if(r.combos){var s=e.combo.internalUse.foreground(o.includedComboItems,o.allCombos,r);s.itemsToShow.forEach(function(e){e.bg=!1,o.list.push(e)}),s.itemsToHide.forEach(function(e){e.bg=!0,o.list.push(e)})}n.setProperties(o.list,!1,function(){KeyLines.Util.invoke(a,o.dict)})},s}}(),function(){var e=KeyLines.Canvas={},t=8888,n=e.getDevicePixelRatio=function(){return"undefined"!=typeof window?window.devicePixelRatio||1:void 0};e.create=function(e,r,a,i,o,u,s){function l(e,t,n){var r=document.createElement("canvas");n&&x&&(r.dir="rtl",document.body.appendChild(r),r.style.display="none");var a;return a=s?document.createElement("canvas").getContext("2d"):r.getContext("2d"),r.context2d=a,r.height=t,r.width=e,s||d(r),r}function f(e,t){var r=n(),a=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=r/a;if(r!==a){var o=e.width,u=e.height;e.width=Math.round(o*i),e.height=Math.round(u*i),e.style.width=o+"px",e.style.height=u+"px",s||t.scale(i,i)}}function c(){if(!KeyLines.Rendering.rtlBugChecked){var e=100,t=30,n=l(e,t);document.body.appendChild(n),n.setAttribute("dir","rtl");var r=n.context2d;r.fillStyle="#000",r.fillRect(0,0,e,t),r.textAlign="center",r.fillStyle="#fff",r.font="20px sans-serif",r.fillText("\u2588",e/2,t);var a=r.getImageData(e/2,t-1,1,1).data;KeyLines.Rendering.rtlBugPresent=0===a[0],document.body.removeChild(n),KeyLines.Rendering.rtlbugChecked=!0}}function g(){if(!KeyLines.Rendering.minimumFontChecked){for(var e="Hello",t=l(100,100).context2d,n=!1,r=function(n){return KeyLines.Rendering.setFont(t,n),t.measureText(e).width},a=r(1),i=2;!n&&30>i;){var o=r(i);n=a!==o,n&&(KeyLines.Rendering.browserMinimumFontSize=i-1),i++}KeyLines.Rendering.minimumFontChecked=!0}}function d(e){function t(e){n.setLineDash=function(t){n[e]=t}}var n=e.getContext("2d");n.setLineDash||("undefined"!=typeof n.webkitLineDash?t("webkitLineDash"):"undefined"!=typeof n.mozDash&&t("mozDash"))}function h(){return new Image}function v(){B.update(),A(v)}var m=document.getElementById(r),x=KeyLines._rtlTest(m),y=l(a,i,!0);y.style.display="initial";var p={},b=y.context2d;m.style.display="block",m.parentNode.replaceChild(y,m),y.setAttribute("id",r),s&&KeyLines.webGLSupport()&&"chart"===e&&(p.renderer=y.renderer=KeyLines.WebGL.create(y),y.webgl=!0),y.canvas=!0;var I=y;y.webgl?(b.webgl=!0,b.webglCanvas=y):b.webgl=!1,f(y,b),g(),c();var w=I.getAttribute("style")||"";w+="-ms-touch-action: none; touch-action: none; outline: none;",I.setAttribute("style",w),I.setAttribute("tabindex",""+t++);var B="chart"===e?KeyLines.API.createAPI(r):KeyLines.TimeBar.API.createAPI(r);for(var C in B)-1===C.indexOf("private")&&(p[C]=B[C]);B.privateInit(b,a,i,l,function(e){document.getElementById(r).style.cursor=e},h,o,void 0,u),p.internalSetSize=function(e,t,n){B.privateMapSetSize&&B.privateMapSetSize(e,t),I.width=e,I.height=t,f(I,b),B.privateSetSize(b,e,t,n,!0)};var A=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){KeyLines.Util.nextTick(e,1e3/60)}}();return A(v),p}}(),function(){"use strict";if(KeyLines.WebGL){var e=24,t=6,n=function(n,r,a,i,o,u){for(var s=0;e>s;s++)for(var l=0;t>l;l++)n[r.shadowIndex++]=a,n[r.shadowIndex++]=i,n[r.shadowIndex++]=o,n[r.shadowIndex++]=u},r=function(t,n,r){for(var a=0;e>a;a++)t[n.coreIndex++]=r,t[n.coreIndex++]=a,t[n.coreIndex++]=e,t[n.coreIndex++]=r,t[n.coreIndex++]=-(a+1),t[n.coreIndex++]=e,t[n.coreIndex++]=r,t[n.coreIndex++]=a,t[n.coreIndex++]=-e,t[n.coreIndex++]=r,t[n.coreIndex++]=a,t[n.coreIndex++]=-e,t[n.coreIndex++]=r,t[n.coreIndex++]=-(a+1),t[n.coreIndex++]=e,t[n.coreIndex++]=r,t[n.coreIndex++]=-(a+1),t[n.coreIndex++]=-e},a=function(n,r,a,i,o,u,s,l,f){var c=a,g=i;if(f)var c=a+f.x,g=i+f.y;for(var d=0;e>d;d++)for(var h=0;t>h;h++)n[r.positionIndex++]=c,n[r.positionIndex++]=g,n[r.positionIndex++]=o,n[r.positionIndex++]=u,n[r.positionIndex++]=s,n[r.positionIndex++]=l},i=function(n,r,a,i,o,u){for(var s=0;e>s;s++)for(var l=0;t>l;l++)n[r.colourIndex++]=a,n[r.colourIndex++]=i,n[r.colourIndex++]=o,n[r.colourIndex++]=u};KeyLines.WebGL.generateArc=function(e,t,o,u,s,l,f,c,g,d,h,v,m){c=c||[0,0,0,0],(h.shadow||v||h.all)&&n(e.shadowData,e,c[0],c[1],c[2],c[3]),(h.positions||v||h.all)&&a(e.positionData,e,t,o,u,s,l,g,m),(h.colours||v||h.all)&&i(e.colourData,e,f[0],f[1],f[2],f[3]),(v||h.all)&&r(e.coreData,e,d)}}}(),function(){function e(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n]]=1;return t}function t(t){for(var n=e(t),r=[],a=0;a<W.length;a++)n[a]||r.push(a);return r}function n(e){return"transparent"===e||e===Y.transparent}function r(e,t){return 1===t?e:oe(e,t)}function a(e){var t={};for(var n in e)t[E.primitives[n]]=e[n];return t}function i(e,t,n,r){var a,i,o,u;t.sm?(a=n.sdim(t.r),i=n.sdim(t.bw)):(a=n.dim(t.r),i=r?n.sw(t.bw):n.w(t.bw));var s=t.a;s?(o=t.x+s.x,u=t.y+s.y):(o=t.x,u=t.y),r?y(e,n.x(o),n.y(u),a,t.bc&&t.sc,i,t.fc&&t.sc,t.fi):y(e,n.x(o),n.y(u),a,t.bc,i,t.fc,t.fi,t.bs)}function o(e,t,n,r){var a,i,o=t.a;o?(a=t.x+o.x,i=t.y+o.y):(a=t.x,i=t.y);var u,s,l,f=n.x(a),c=n.y(i),g=n.dim(t.r);r?(u=t.bc&&t.sc,s=n.sw(t.bw)):(u=t.bc,s=n.w(t.bw),l=t.ls),1e6>=g?p(e,f,c,g,t.sa,t.ea,u,s,l):T(n,e,f,c,g,t.sa,t.ea,u,s,l)}function u(e,t,n,r){var a,i,o,u,s=t.a;s?(a=t.x1+s.x,i=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2),r?b(e,n.x(a),n.y(i),n.x(o),n.y(u),t.c&&t.sc,n.sw(t.w)):b(e,n.x(a),n.y(i),n.x(o),n.y(u),t.c,n.w(t.w),t.ls)}function s(e,t,n,r){var a,i,o,u,s,l,f,c,g=t.a;g?(a=t.x1+g.x,i=t.y1+g.y,o=t.x2+g.x,u=t.y2+g.y,s=t.x3+g.x,l=t.y3+g.y,f=t.x4+g.x,c=t.y4+g.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3,f=t.x4,c=t.y4),r?I(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),t.c&&t.sc,n.sw(t.w)):I(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),t.c,n.w(t.w),t.ls)}function l(e,t,n,r){var a,i,o,u,s=t.a;if(s?(a=t.x1+s.x,i=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2),r)t.back&&B(e,n.x(a),n.y(i),n.x(o),n.y(u),t.sc,-1,t.sc,!0);else{var l,f;s?(l=t.x+s.x,f=t.y+s.y):(l=t.x,f=t.y);var c=t.xc;c&&E.applyRtlFix&&(c=!1,l-=Math.floor(t.w/2));var g=n.x(l),d=n.y(f),h=n.dim(t.fs);if(t.w&&(3>=h||h<E.browserMinimumFontSize)){var v=n.dim(t.w),m=t.isSel?t.bc:oe(t.c,.4);c&&(g-=Math.floor(v/2)),t.back&&t.bc!==Y.textback&&B(e,g,d-h,g+v,d,t.bc,-1,t.bc,!0),B(e,g,d-h,g+v,d,m,-1,m,!0)}else t.back&&B(e,n.x(a),n.y(i),n.x(o),n.y(u),t.bc,-1,t.bc,!0),w(e,g,d,t.t,t.c,h,t.bo,t.ff,c)}}function f(e,t,n,r,a){var i,o,u,s,l=t.a;l?(i=t.x1+l.x,o=t.y1+l.y,u=t.x2+l.x,s=t.y2+l.y):(i=t.x1,o=t.y1,u=t.x2,s=t.y2);var f=n.x(i),c=n.y(o),g=n.x(u),d=n.y(s);if(t.vx&&(f-=t.vx,c-=t.vx,g+=t.vx,d+=t.vx),r)B(e,f,c,g,d,t.sc,-1,t.sc,!0);else{var h=a[t.u];if(t.hi&&he()){var v=a[ve(t.u)];v&&!v.missing&&(h=v)}C(e,h,f,c,g,d,t.s)}}function c(e,t,n,r){var a,i,o,u,s=t.a;s?(a=t.x1+s.x,i=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2),r?B(e,n.x(a),n.y(i),n.x(o),n.y(u),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):B(e,n.x(a),n.y(i),n.x(o),n.y(u),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function g(e,t,n,r){var a,i,o,u,s=t.a;s?(a=t.x1+s.x,i=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2),r?A(e,n.x(a),n.y(i),n.x(o),n.y(u),n.dim(t.r),t.bc,n.sw(t.bw),t.fc&&t.sc,t.fi):A(e,n.x(a),n.y(i),n.x(o),n.y(u),n.dim(t.r),t.bc,n.w(t.bw),t.fc,t.fi)}function d(e,t,n,r){var a,i,o,u,s,l,f=t.a;f?(a=t.x1+f.x,i=t.y1+f.y,o=t.x2+f.x,u=t.y2+f.y,s=t.x3+f.x,l=t.y3+f.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3),r?M(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):M(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),t.bc,n.w(t.bw),t.fc,t.fi)}function h(e,t,n,r){var a,i,o,u,s,l,f,c,g,d,h=t.a;h?(a=t.x1+h.x,i=t.y1+h.y,o=t.x2+h.x,u=t.y2+h.y,s=t.x3+h.x,l=t.y3+h.y,f=t.x4+h.x,c=t.y4+h.y,g=t.x5+h.x,d=t.y5+h.y):(a=t.x1,i=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3,f=t.x4,c=t.y4,g=t.x5,d=t.y5),r?Z(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),n.x(g),n.y(d),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):Z(e,n.x(a),n.y(i),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),n.x(g),n.y(d),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function v(e,t,n,r,a){var i,o;"dotted"===r?(i=.5,o=2*n):(i=Math.max(2,2*n),
o=i/2);var u=Math.round(a?t/(i+o):(t+o)/(i+o));u>1&&(o=a?(t-u*i)/u:(t-u*i)/(u-1),o>0&&(e.lineCap=i>1?"butt":"round",ee[0]=i,ee[1]=o,e.setLineDash(ee)))}function m(e,t){return e&&"solid"!==e&&"setLineDash"in t}function x(e){ee[0]&&(ee[0]=0,e.setLineDash(te),e.lineCap="butt")}function y(e,t,n,r,a,i,o,u,s){e.fillStyle=u?o:Y.transparent,i>=0&&(m(s,e)&&v(e,V*r,i,s,!0),e.lineWidth=Math.max(1,i),e.strokeStyle=a),e.beginPath(),e.arc(t,n,r,0,V,!1),e.closePath(),u&&e.fill(),i>=0&&(e.stroke(),s&&x(e))}function p(e,t,n,r,a,i,o,u,s){if(e.lineWidth=Math.max(1,u),e.strokeStyle=o,m(s,e)){var l=(i-a)*r;v(e,l,u,s)}e.beginPath(),e.arc(t,n,r,a,i,!1),e.stroke(),e.closePath(),s&&x(e)}function b(e,t,n,r,a,i,o,u){if(e.lineWidth=Math.max(1,o),e.strokeStyle=i,m(u,e)){var s=r-t,l=a-n,f=Math.sqrt(s*s+l*l);v(e,f,o,u)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.stroke(),e.closePath(),u&&x(e)}function I(e,t,n,r,a,i,o,u,s,l,f,c){var g=e.lineJoin;if(e.lineWidth=Math.max(1,f),e.lineJoin="round",e.strokeStyle=l,m(c,e)){var d=r-t,h=a-n,y=Math.sqrt(d*d+h*h),p=i-r,b=o-a,I=Math.sqrt(p*p+b*b),w=u-i,B=s-o,C=Math.sqrt(w*w+B*B);v(e,y+I+C,f,c)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.lineTo(i,o),e.lineTo(u,s),e.stroke(),e.closePath(),e.lineJoin=g,c&&x(e)}function w(e,t,n,r,a,i,o,u,s){ae(e,i,o,u),e.fillStyle=a,e.textAlign=s?"center":"left",e.fillText(r,t,n)}function B(e,t,n,r,a,i,o,u,s,l){if(s&&(e.fillStyle=u,e.fillRect(t,n,r-t,a-n)),o>=0)if(m(l,e)){var f=Math.floor(o/2);b(e,t-f,n,r+f,n,i,o,l),b(e,r,n-f,r,a+f,i,o,l),b(e,r+f,a,t-f,a,i,o,l),b(e,t,a+f,t,n-f,i,o,l)}else e.lineWidth=Math.max(1,o),e.strokeStyle=i,e.strokeRect(t,n,r-t,a-n)}function C(e,t,n,r,a,i,o){var u=t[o?o:"im"];e.drawImage(u,n,r,a-n,i-r)}function A(e,t,n,r,a,i,o,u,s,l){e.beginPath(),e.moveTo(t+i,n),e.lineTo(r-i,n),e.arcTo(r,n,r,n+i,i),e.lineTo(r,a-i),e.arcTo(r,a,r-i,a,i),e.lineTo(t+i,a),e.arcTo(t,a,t,a-i,i),e.lineTo(t,n+i),e.arcTo(t,n,t+i,n,i),e.closePath(),l&&(e.fillStyle=s,e.fill()),u>=0&&(e.lineWidth=Math.max(1,u),e.strokeStyle=o,e.stroke())}function M(e,t,n,r,a,i,o,u,s,l,f){(Math.abs(r-t)>F||Math.abs(a-n)>F)&&(e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.lineTo(i,o),e.lineTo(t,n),e.closePath(),f&&(e.fillStyle=l,e.fill()),s>=0&&(e.lineWidth=Math.max(1,s),e.strokeStyle=u,e.stroke()))}function Z(e,t,n,r,a,i,o,u,s,l,f,c,g,d,h,v){if(e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),e.lineTo(i,o),e.lineTo(u,s),e.lineTo(l,f),e.lineTo(t,n),e.closePath(),h&&(e.fillStyle=d,e.fill()),g>=0)if(m(v,e)){var x=(r>t?1:-1)*Math.floor(g/2);b(e,t,n,r,a,c,g,v),b(e,r,a,i,o,c,g,v),b(e,i,o,u-x,s,c,g,v),b(e,u,s+x,l,f-x,c,g,v),b(e,l-x,f,t,n,c,g,v)}else e.lineWidth=Math.max(1,g),e.strokeStyle=c,e.stroke()}function D(e,t,n){e/=255,t/=255,n/=255;var r,a,i=Math.max(e,t,n),o=Math.min(e,t,n),u=(i+o)/2;if(i===o)r=a=0;else{var s=i-o;switch(a=u>.5?s/(2-i-o):s/(i+o),i){case e:r=(t-n)/s+(n>t?6:0);break;case t:r=(n-e)/s+2;break;case n:r=(e-t)/s+4}r/=6}return[r,a,u]}function L(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}function G(e,t,n){var r,a,i;if(0===t)r=a=i=n;else{var o=.5>n?n*(1+t):n+t-n*t,u=2*n-o;r=L(u,o,e+1/3),a=L(u,o,e),i=L(u,o,e-1/3)}return[Math.ceil(255*r),Math.ceil(255*a),Math.ceil(255*i)]}function R(e){return e}function S(e){return e>Math.PI||e<-Math.PI?e-2*Math.PI*Math.floor((e+Math.PI)/2*Math.PI):e}function T(e,t,n,r,a,i,o,u,s,l){function f(e,t){L++,1===L?(A=e,M=t):2===L&&(Z=e,D=t)}function c(e){var t=n+a*Math.cos(e),i=r+a*Math.sin(e);t>I&&w>t&&i>B&&C>i&&f(t,i)}function g(e,t){var n=e*e;if(n===G)t(a);else if(G>n){var r=Math.sqrt(G-n);t(r),t(-r)}}function d(e){g(e-n,function(t){var n=r+t;n>=B&&C>=n&&v(e,r+t)})}function h(e){g(e-r,function(t){var r=n+t;r>=I&&w>=r&&v(n+t,e)})}function v(e,t){var a,u=e-n,s=t-r,l=Math.atan2(s,u);a=o>i?l>i&&o>l:l>i||o>l,(a||l===i||l===o)&&f(e,t)}var m=e.width(),x=e.height(),y=Math.floor(m/2),p=Math.floor(x/2),I=-y,w=m+y,B=-p,C=x+p;i=S(i),o=S(o);var A,M,Z,D,L=0;c(i),c(o);var G=a*a;d(I),d(w),h(B),h(C),2===L&&b(t,Math.floor(A),Math.floor(M),Math.floor(Z),Math.floor(D),u,s,l)}var E=KeyLines.Rendering={},k=Math.PI/2,V=2*Math.PI,F=3;var aw=new Date().getTime()/36774;var W=["TIMEBAR","BANDS","UNDERLAYS","HALOS","SHAPESEL","SHAPES","HANDLES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","OVERLAYSSHADOW","OVERVIEW","OVERVIEWSHADOW","WAIT"];var gt={a:"LTMxLC02NCwtNTgsLTEzLC02NiwtNjgsLTY5LC02MiwtNTcsLTY4LC00NSw3NiwtMSw0Nyw4NiwtMzcsLTQ2LC00NA==",b:"LTIyLC01NiwtNTgsLTUsLTEyLC02MywtNjUsLTExLDEsLTY0LC03Myw1MiwyNSw0LDczLC0yLC0xNCw2LDE2LC0yMiwtNDYsLTcxLDM0LDEwLC01NA=="};for(var N=W.length,U=E.layers={},O=0;N>O;O++)U[W[O]]=O;var K=E.channels={MAIN:0,BACKGROUND:1,GHOST:2,BACKGROUNDGHOST:3};E.itemLayers=[U.HALOS,U.SHAPESEL,U.SHAPES,U.NODESEL,U.LINKS,U.NODES,U.BUBBLES],E.extraLayers=t(E.itemLayers),E.topLayers=[U.HALOS,U.SHAPESEL,U.SHAPES,U.NODESEL,U.LINKS,U.NODES,U.HANDLES,U.DRAGGERS,U.BUBBLES,U.BANDLABELS,U.OVERLAYS],E.shadowLayers=t([U.BANDS,U.UNDERLAYS,U.BANDLABELS,U.OVERLAYS,U.OVERVIEW]),E.viewLayers=[U.BANDS,U.BANDLABELS,U.HANDLES,U.OVERLAYS,U.OVERVIEW,U.OVERLAYSSHADOW,U.OVERVIEWSHADOW,U.TIMEBAR,U.UNDERLAYS,U.WAIT],E.viewLayersIndex=e(E.viewLayers),E.mainChannel=function(){return gt.a||gt.b},E.selMap={},E.selMap[U.NODES]=U.NODESEL,E.selMap[U.SHAPES]=U.SHAPESEL,E.widgets=function(){function t(e){return(e.gh?2:0)+(e.bg?1:0)}function n(e){return d[t(e)]}function r(){for(var e,t,n=E.itemLayers,r=0;4>r;r++){e=d[r];for(var a=0,i=n.length;i>a;a++){var o=n[a];t=e[o],t?t.count=0:e[o]={pool:[],count:0}}}}function a(){var e;if("undefined"==typeof Object.keys)for(var t in g)e=g[t],i(e);else for(var n=Object.keys(g),r=0,a=n.length;a>r;r++)e=g[n[r]],i(e)}function i(e){for(var t=n(e),r=0;r<e.count;r++){var a=e.pool[r],i=t[a.la];i.pool[i.count++]=a}}function o(t,n,r,a,i,o){E.applyRtlFix=E.rtlBugPresent&&KeyLines._rtlTest(t.canvas);for(var u=d[i],s=e(o),l=0;N>l;l++)if((!o||s[l])&&u[l])for(var f=u[l],c=E.viewLayersIndex[l]?pe:n,g=0;g<f.count;g++){var h=f.pool[g];if(!r||h.sc){var v=ye[h.p];v&&v(t,h,c,r,a)}}}function u(e){var t=l.pool,n=l.count;t[n]||(t[n]={}),l.count=n+1;var r=t[n];return r.id=e,r.sc=f.getColour(e+""),r.wsc=se(r.sc),null!==v&&(r.la=s),null!==v&&"x"in l?r.a=l:r.a=null,r}var s,l,f,c={},g={},d=[[],[],[],[]],h=d[0],v=null;c.getLayer=function(){return s},c.setLayer=function(e){s=e,null===v&&(h[e]||(h[e]={pool:[],count:0}),l=h[e])},c.removeAllItems=function(){g={}},c.removeItem=function(e){delete g[e]},c.resetItem=function(e,t,n){v=e.id,g[v]?g[v].count=0:g[v]={pool:[],count:0},l=g[v],l.bg=!!e.bg,l.gh=!!e.gh,arguments.length>1&&(l.x=t,l.y=n),l.count=0},c.moveItem=function(e,t,n){var r=g[e.id];r&&(r.x=t,r.y=n)},c.resetExtras=function(){for(var e=E.extraLayers,t=0;t<e.length;t++){var n=e[t];h[n]&&(h[n].count=0)}v=null},c.extras=function(){v=null};var m=c.getLast=function(){return l&&l.count>0?l.pool[l.count-1]:null};return c.cloneLast=function(){return KeyLines.Util.shallowClone(m())},c.assembleItems=function(){r(),a()},c.each=function(t,n,r){for(var a=d[n],i=e(r),o=0;N>o;o++)if((!r||i[o])&&a[o])for(var u=a[o],s=0;s<u.count;s++)t(u.pool[s])},c.itemExtents=function(e,t){var n;for(var r in g)if(!e||e[r])for(var a=g[r],i=0;i<a.count;i++){var o=a.pool[i],u=le(t,o);n=n?fe(n,u):u}return n},c.draw=function(e,t,n,r,a){var tq=117333333-rz;if(tq===Math.abs(tq))tq=0,o(e,t,!1,n,r,a)},c.excludeHit=function(e){if(e){var t=g[e];if(t)for(var n=0;n<t.count;n++){var r=t.pool[n];r.sc=r.wsc=null}}},c.drawShadowCanvas=function(e,t){o(e,t,!0,null,K.BACKGROUND,E.itemLayers),o(e,t,!0,null,K.MAIN,E.shadowLayers)},c.setShadowColourMap=function(e){f=e},c.line=function(e,t,n,r,a,i,o,s){var l=u(o),f=l.a;l.p=E.primitives.line,f?(l.x1=e-f.x,l.y1=t-f.y,l.x2=n-f.x,l.y2=r-f.y):(l.x1=e,l.y1=t,l.x2=n,l.y2=r),l.c=a,l.w=i,l.ls=s,l.wc=se(a)},c.line3=function(e,t,n,r,a,i,o,s,l,f,c,g){var d=u(c),h=d.a;d.p=E.primitives.line3,h?(d.x1=e-h.x,d.y1=t-h.y,d.x2=n-h.x,d.y2=r-h.y,d.x3=a-h.x,d.y3=i-h.y,d.x4=o-h.x,d.y4=s-h.y):(d.x1=e,d.y1=t,d.x2=n,d.y2=r,d.x3=a,d.y3=i,d.x4=o,d.y4=s),d.c=l,d.w=f,d.ls=g,d.wc=se(l)},c.circle=function(e,t,n,r,a,i,o,s,l,f){var c=u(s),g=c.a;c.p=E.primitives.circle,g?(c.x=e-g.x,c.y=t-g.y):(c.x=e,c.y=t),c.r=n,c.bc=r,c.bw=a,c.fc=i,c.fi=o,c.bs=l,c.sm=f,c.wbc=se(r),c.wfc=se(i)},c.arc=function(e,t,n,r,a,i,o,s,l){var f=u(s),c=f.a;f.p=E.primitives.arc,c?(f.x=e-c.x,f.y=t-c.y):(f.x=e,f.y=t),f.r=n,f.sa=r,f.ea=a,f.bc=i,f.bw=o,f.ls=l,f.wbc=se(i)},c.text=function(e,t,n,r,a,i,o,s,l,f,c,g,d,h,v,m,x,y){var p=u(o),b=p.a;p.p=E.primitives.text,b?(p.x=e-b.x,p.y=t-b.y):(p.x=e,p.y=t),p.t=n,p.c=r,p.fs=a,p.bo=i,p.ff=s,p.xc=l,p.w=f,p.isfi=c,p.isSel=y,p.wc=se(r),p.id=o,b?(p.x1=d-b.x,p.y1=h-b.y,p.x2=v-b.x,p.y2=m-b.y):(p.x1=d,p.y1=h,p.x2=v,p.y2=m),p.back=g,g&&(p.wbc=se(x),p.bc=x)},c.image=function(e,t,n,r,a,i,o,s,l){var f=u(i),c=f.a;f.p=E.primitives.image,c?(f.x1=e-c.x,f.y1=t-c.y,f.x2=n-c.x,f.y2=r-c.y):(f.x1=e,f.y1=t,f.x2=n,f.y2=r),f.u=a,f.s=o,f.vx=s,f.hi=l},c.rect=function(e,t,n,r,a,i,o,s,l,f){var c=u(l),g=c.a;c.p=E.primitives.rect,g?(c.x1=e-g.x,c.y1=t-g.y,c.x2=n-g.x,c.y2=r-g.y):(c.x1=e,c.y1=t,c.x2=n,c.y2=r),c.bc=a,c.bw=i,c.fc=o,c.fi=s,c.bs=f,c.wbc=se(a),c.wfc=se(o)},c.round=function(e,t,n,r,a,i,o,s,l,f){var c=u(f),g=c.a;c.p=E.primitives.round,g?(c.x1=e-g.x,c.y1=t-g.y,c.x2=n-g.x,c.y2=r-g.y):(c.x1=e,c.y1=t,c.x2=n,c.y2=r),c.r=a,c.bc=i,c.bw=o,c.fc=s,c.fi=l,c.wbc=se(i),c.wfc=se(s)},c.triangle=function(e,t,n,r,a,i,o,s,l,f,c){var g=u(c),d=g.a;g.p=E.primitives.triangle,d?(g.x1=e-d.x,g.y1=t-d.y,g.x2=n-d.x,g.y2=r-d.y,g.x3=a-d.x,g.y3=i-d.y):(g.x1=e,g.y1=t,g.x2=n,g.y2=r,g.x3=a,g.y3=i),g.bc=o,g.bw=s,g.fc=l,g.fi=f,g.wbc=se(o),g.wfc=se(l)},c.pentagon=function(e,t,n,r,a,i,o,s,l,f,c,g,d,h,v,m){var x=u(v),y=x.a;x.p=E.primitives.pentagon,y?(x.x1=e-y.x,x.y1=t-y.y,x.x2=n-y.x,x.y2=r-y.y,x.x3=a-y.x,x.y3=i-y.y,x.x4=o-y.x,x.y4=s-y.y,x.x5=l-y.x,x.y5=f-y.y):(x.x1=e,x.y1=t,x.x2=n,x.y2=r,x.x3=a,x.y3=i,x.x4=o,x.y4=s,x.x5=l,x.y5=f),x.bc=c,x.bw=g,x.fc=d,x.fi=h,x.bs=m,x.wbc=se(c),x.wfc=se(d)},c.copyPrimitive=function(e){var t=u(e.id);for(var n in e)t[n]=e[n]},c},E.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE"};var X="rgb(128, 128, 128)",Y=E.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:X,gray:X,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",orange:"rgb(255,165,0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"};var rz=new Date()/12636;var H=E.rgbtostring=function(e,t,n){return"rgb("+e+","+t+","+n+")"},z=E.rgbatostring=function(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"},P=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,_=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,j=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,J=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;E.validatergb=function(e){return!!Q(e).length};var Q=E.convertrgb=function(e){var t,n=[],r=Y[e.toLowerCase()];e=r?r:e;var a=e.match(P);if(a||(a=e.match(_)),a)for(t=1;4>t;t++)n.push(parseInt(a[t],10));else{if(a=e.match(J),!a&&(a=e.match(j)))for(t=1;4>t;t++)a[t]=""+a[t]+a[t];if(a)for(t=1;4>t;t++)n.push(parseInt(a[t],16))}return n},q=E.opacity=function(e){if("transparent"===e)return 0;var t=e.match(_);return t?parseFloat(t[4]):1};E.hsla=function(e){var t=Q(e),n=D(t[0],t[1],t[2]);return n.push(q(e)),n},E.fromhsla=function(e){var t=G(e[0],e[1],e[2]);return z(t[0],t[1],t[2],e[3])},E.rgbtohex=function(e){for(var t=Q(e),n="",r=0;r<t.length;r++){var a=t[r];n+=(16>a?"0":"")+a.toString(16)}return n};var $=E.randomColour=function(e){function t(){return Math.floor(255*Math.random())}var n=H(t(),t(),t());return e&&n in e?$(e):n},ee=[0,0],te=[],ne={};E.clearLastFont=function(){ne={}};var re="sans-serif";E.browserMinimumFontSize=1,E.rtlBugPresent=!1,E.applyRtlFix=!1;var ae=E.setFont=function(e,t,n,r){if(n=!!n,r=r||re,e!==ne.context||t!==ne.fontSize||n!==ne.bold||r!==ne.family){ne.context=e,ne.fontSize=t,ne.bold=n,ne.family=r;var a=n?"bold":"normal",i="normal",o="px",u=i+" "+a+" "+t+o+" "+r;e.font=u,e.textBaseline="bottom"}};E.setAlpha=function(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var a=n[r];if(a in e){var i=Q(e[a]);e[a]=z(i[0],i[1],i[2],t)}}};var ie={},oe=E.alphaize=function(e,t){var n=e+t;if(!ie[n]){var r=Q(e),a=q(e);ie[n]=z(r[0],r[1],r[2],a*t)}return ie[n]},ue={},se=E.webglColour=function(e){if(e){if(!ue[e]){var t=Q(e),n=q(e);ue[e]=[t[0],t[1],t[2],Math.floor(255*n)]}return ue[e]}return e};E.setExtents=function(e,t,n,r,a){var i,o,u=e.a;switch(u&&(t-=u.x,n-=u.y,r-=u.x,a-=u.y),e.p){case E.primitives.circle:i=Math.abs((r-t)/2),o=Math.abs((a-n)/2),e.x=Math.floor(Math.min(t,r)+i),e.y=Math.floor(Math.min(n,a)+o),e.r=Math.floor(Math.min(i,o));break;case E.primitives.line:case E.primitives.rect:case E.primitives.round:e.x1=Math.min(t,r),e.x2=Math.max(t,r),e.y1=Math.min(n,a),e.y2=Math.max(n,a);break;case E.primitives.line3:break;case E.primitives.text:e.x=Math.min(t,r),e.y=Math.max(n,a);break;case E.primitives.image:e.x1=Math.min(t,r),e.y1=Math.min(n,a),e.x2=Math.max(t,r),e.y2=Math.max(n,a);break;case E.primitives.triangle:case E.primitives.pentagon:}};var le=E.extents=function(e,t){var n,r,a,i;switch(t.p){case E.primitives.circle:n=t.x-t.r,r=t.x+t.r,a=t.y-t.r,i=t.y+t.r;break;case E.primitives.line:case E.primitives.rect:case E.primitives.round:case E.primitives.image:n=Math.min(t.x1,t.x2),r=Math.max(t.x1,t.x2),a=Math.min(t.y1,t.y2),i=Math.max(t.y1,t.y2);break;case E.primitives.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4),r=Math.max(t.x1,t.x2,t.x3,t.x4),a=Math.min(t.y1,t.y2,t.y3,t.y4),i=Math.max(t.y1,t.y2,t.y3,t.y4);break;case E.primitives.text:var o=xe(e,t.t,t.fs,t.bo,t.ff);n=t.x-(t.xc?o.width/2:0),a=t.y-o.height,r=n+o.width,i=t.y;break;case E.primitives.triangle:n=Math.min(t.x1,t.x2,t.x3),r=Math.max(t.x1,t.x2,t.x3),a=Math.min(t.y1,t.y2,t.y3),i=Math.max(t.y1,t.y2,t.y3);break;case E.primitives.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5),r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5),a=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5),i=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case E.primitives.arc:var u=t.x+t.r*Math.cos(t.sa),s=t.y+t.r*Math.sin(t.sa),l=t.x+t.r*Math.cos(t.ea),f=t.y+t.r*Math.sin(t.ea);n=Math.min(u,l),r=Math.max(u,l),a=Math.min(s,f),i=Math.max(s,f);for(var c=(Math.floor(t.sa/k)+1)*k;c<t.ea;){var g=t.x+t.r*Math.cos(c),d=t.y+t.r*Math.sin(c);n=Math.min(n,g),r=Math.max(r,g),a=Math.min(a,d),i=Math.max(i,d),c+=k}}var h=t.a;return h&&(n+=h.x,a+=h.y,r+=h.x,i+=h.y),{x1:n,y1:a,x2:r,y2:i}},fe=E.join=function(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}};E.inside=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},E.insideCircle=function(e,t,n,r,a,i){i||(i=0);var o=Math.sqrt((e-r)*(e-r)+(t-a)*(t-a));return n>o+i},E.rectContains=function(e,t,n,r,a){return e.x1<t&&r<e.x2&&e.y1<n&&a<e.y2},E.circleContains=function(e,t,n,r,a,i,o){var u=(e-r)*(e-r)+(t-a)*(t-a),s=(e-r)*(e-r)+(t-o)*(t-o),l=(e-i)*(e-i)+(t-a)*(t-a),f=(e-i)*(e-i)+(t-o)*(t-o),c=n*n;return c>u&&c>s&&c>l&&c>f},E.intersects=function(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)};var ce=function(e,t,n,r,a,i,o){var u=Math.floor((n.x2-n.x1)/2),s=Math.floor((n.y2-n.y1)/2),l=1,f="-resize",c=Math.floor(4*r);de(e,t,{x:n.x1,y:n.y1},c,l,a+o+"nw"+f,i),ge(e,t,{x:n.x1+u,y:n.y1},c,l,a+o+"n"+f,i),de(e,t,{x:n.x2,y:n.y1},c,l,a+o+"ne"+f,i),ge(e,t,{x:n.x2,y:n.y1+s},c,l,a+o+"e"+f,i),de(e,t,{x:n.x2,y:n.y2},c,l,a+o+"se"+f,i),ge(e,t,{x:n.x2-u,y:n.y2},c,l,a+o+"s"+f,i),de(e,t,{x:n.x1,y:n.y2},c,l,a+o+"sw"+f,i),ge(e,t,{x:n.x1,y:n.y2-s},c,l,a+o+"w"+f,i)},ge=function(e,t,r,a,i,o,u){var s=t.x(r.x),l=t.y(r.y),f=n(u)?Y.transparent:Y.white;e.rect(s-a,l-a,s+a,l+a,u,i,f,!0,o)},de=function(e,t,r,a,i,o,u){var s=n(u)?Y.transparent:Y.white;e.circle(t.x(r.x),t.y(r.y),a+1,u,i,s,!0,o)};E.getHandles=function(e,t,n,r,a,i,o,u){var s=le(t,r);ce(e,n,s,a,i,o,u)},E.imageLoader=function(e,t,n,r){function a(){if(u+s===l)try{r(s>0,f)}catch(e){r("callback to image loader threw exception "+e)}}function i(){s++,a()}function o(){u++,a()}var u=0,s=0,l=0,f={};for(var c in n){l++,aw;if(aw>40317180){break;}aw;var g=e();g.onload=o,g.onerror=i,f[c]=g}0===l&&r(null,f);for(var d in f)f[d].src=t+d},E.clear=function(e,t,n){e.clearRect(0,0,t,n)};var he=E.useHiResImages=function(){return KeyLines.Canvas&&KeyLines.Canvas.getDevicePixelRatio()>=1.5},ve=E.hiResUrl=function(e){var t=e.length-4;return e.substr(0,t)+"@2x.png"};E.backFill=function(e,t,n,a,i){var o=r(t,n);e.webgl?e.webglCanvas.style.background=o:(e.fillStyle=o,e.fillRect(0,0,a,i))},E.backgroundGradient=function(e,t,n,a,i){if(t)if(e.webgl){for(var o="linear-gradient(",u=0,s=t.length;s>u;u++){var l=t[u];o+=r(l.c,n),o+=" "+100*parseFloat(l.r)+"%",s>u+1&&(o+=",")}o+=")",e.webglCanvas.style.background=o}else{for(var f=e.createLinearGradient(0,0,0,i),c=0;c<t.length;c++)f.addColorStop(t[c].r,r(t[c].c,n));e.fillStyle=f,e.fillRect(0,0,a,i)}};var me={},xe=E.measureText=function(e,t,n,r,a){var i=t+!!r+(a||re),o=me[i];if(void 0===o){ae(e,14,r,a);var u=0;if(e.webgl)for(var s=0,l=t.length;l>s;s++)u+=e.measureText(t[s]).width;else u=e.measureText(t).width;o=me[i]=u}return{width:o*(n/14),height:n}},ye=a({circle:i,arc:o,line:u,line3:s,text:l,image:f,rect:c,round:g,triangle:d,pentagon:h}),pe={x:R,y:R,w:R,sw:R,dim:R};E.circularize=function(e,t,n){var r,a={},i={};for(r in e)if("updated"!==r&&"_coList"!==r&&t&&t[r]){var o=e[r].im,u=Math.min(o.width,o.height),s=u<o.height?Math.floor((o.height-u)/2):0,l=u<o.width?Math.floor((o.width-u)/2):0,f=Math.floor(u/2),c=n(u,u),g=c.getContext("2d");g.drawImage(o,l,s,u,u,0,0,u,u);var d=n(u,u),h=d.getContext("2d");h.clearRect(0,0,u,u),y(h,f,f,f,Y.white,-1,Y.black,!0);var v=h.getImageData(0,0,u,u).data;try{for(var m=g.getImageData(0,0,u,u),x=m.data,p=0;p<x.length;p+=4){var b=v[p+3];0===b?x[p+3]=0:255>b&&(x[p+3]=Math.floor(x[p+3]*b/255))}g.putImageData(m,0,0),c.src=o.src+"#ci",i[r]=c}catch(I){a[r]=!0,i[r]=!1}}for(r in i)e[r].ci=a[r]?e[r].im:i[r]},E.colorize=function(e,t,n,r,a){var i=.02,o=Q(r),u=D(o[0],o[1],o[2]),s={},l=Q(a),f=D(l[0],l[1],l[2]),c=G(f[0],f[1],u[2]);for(var g in e)if("updated"!==g&&"_coList"!==g&&g in t&&t[g])try{var d=e[g].im,h=n(d.width,d.height),v=h.getContext("2d");v.clearRect(0,0,d.width,d.height),v.drawImage(d,0,0,d.width,d.height,0,0,d.width,d.height);for(var m=v.getImageData(0,0,d.width,d.height),x=m.data,y=0;y<x.length;y+=4){var p=D(x[y],x[y+1],x[y+2]);if(Math.abs(p[0]-u[0])<i){var b=G(f[0],f[1],p[2]);m.data[y]=b[0],m.data[y+1]=b[1],m.data[y+2]=b[2]}}v.putImageData(m,0,0),h.src=d.src+a,s[g]=h}catch(I){s[g]=e[g].im}return{images:s,colour:c}}}(),function(){"use strict";if(KeyLines.WebGL){var e=KeyLines.WebGL.Utils={};e.create3DContext=function(e,t){for(var n=["webgl","webgl2","experimental-webgl","webkit-3d","moz-webgl"],r=null,a=0;a<n.length;++a){try{r=e.getContext(n[a],t)}catch(i){}if(r)break}return r},e.createProgram=function(e,r,a){var i=t(e,r,e.VERTEX_SHADER),o=t(e,a,e.FRAGMENT_SHADER);return n(e,[i,o])},e.createMatrix=function(){var e={},t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=1;return e.zoom=function(e){n=e,t[0]*=e,t[4]*=e,t[8]*=1,t[1]*=e,t[5]*=e,t[9]*=1,t[2]*=e,t[6]*=e,t[10]*=1,t[3]*=e,t[7]*=e,t[11]*=1},e.getZoomLevel=function(){return n},e.pan=function(e,n){t[12]+=t[0]*e+t[4]*n,t[13]+=t[1]*e+t[5]*n,t[14]+=t[2]*e+t[6]*n,t[15]+=t[3]*e+t[7]*n},e.get=function(){return t},e};var t=function(e,t,n){var r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);var a=e.getShaderParameter(r,e.COMPILE_STATUS);if(!a){var i=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("Error in shader: "+i)}return r},n=function(e,t){for(var n=e.createProgram(),r=0;r<t.length;++r)e.attachShader(n,t[r]);e.linkProgram(n);var a=e.getProgramParameter(n,e.LINK_STATUS);if(!a){var i=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error("Error in program linking:"+i)}return n}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Generator=function(t){function n(e){y.isNullOrUndefined(e.fontFamily)&&(e.fontFamily="sans-serif"),B===e.fontFamily&&null!==B||(B=e.fontFamily,M.textAtlas=!0),A[B]=!0,w[B]=!0}function r(e){e.iconFontFamily&&C!==e.iconFontFamily&&(C=e.iconFontFamily,M.fontIcons=!0)}function a(e,t,n){e.fbAlpha=n,e.rebuildOptions={all:t.all,colours:t.colours,textures:t.textures,shadow:t.shadow,positions:t.positions}}function i(e,t){return e.all||e.textures||e.positions||e.shadow||e.colours||t}function o(e){e.arcBuffers.numOfTriangles=0,e.lineBuffers.numOfTriangles=0,e.triangleBuffers.numOfTriangles=0}function u(e,t,n){for(var r,a=t.rebuildOptions,i=t.alwaysUpdate,o=0;D>o;o++)r=e[o],U[r.p](t,r,n,i,a)}function s(n){M.textAtlas&&(t.textAtlas&&n.clearTextureAtlas(t.textAtlas.atlases),t.textAtlas=e.TextAtlas(A),w=A)}function l(n){!M.fontIcons&&t.fontIconAtlas||(n.clearTextureAtlas(t.fontIconAtlas),t.fontIconAtlas=e.FontIconAtlas(I,C))}function f(e,t,n){function r(e){"_overviewIcon"!==e.id&&"_overviewIconRect"!==e.id&&(n[D++]=e,v(e,a,i,o))}if(t.widgets){D=0;var a=e.lineBuffers,i=e.arcBuffers,o=e.triangleBuffers;t.widgets.each(r,t.channels,t.layers)}}function c(e){g(e.lineBuffers,e),d(e),h(e)}function g(e,t){var n=8;e.elementIndexIndex=0,e.elementMappingIndex=0,e.elementDataIndex=0,e.elementIntegerDataIndex=0,(!e.elementData||e.elementData.length<e.numOfTriangles*n*4)&&(e.elementData=new Float32Array(e.numOfTriangles*n*4),e.elementIntegerData=new Uint8Array(e.elementData.buffer,0,e.elementData.length*Float32Array.BYTES_PER_ELEMENT)),(!e.elementIndex||e.elementIndex.length<3*e.numOfTriangles)&&(e.elementIndex=new Uint32Array(3*e.numOfTriangles),t.rebuildOptions.all=!0)}function d(e){function t(e){(!e.arcBuffers.positionData||e.arcBuffers.positionData.length<e.arcBuffers.totalNumOfVerticies*i)&&(e.rebuildOptions.positions=!0,e.arcBuffers.positionData=new Float32Array(e.arcBuffers.totalNumOfVerticies*i))}function n(e){(!e.arcBuffers.colourData||e.arcBuffers.colourData.length<e.arcBuffers.totalNumOfVerticies*u)&&(e.rebuildOptions.colours=!0,e.arcBuffers.colourData=new Uint8Array(e.arcBuffers.totalNumOfVerticies*u))}function r(e){(!e.arcBuffers.shadowData||e.arcBuffers.shadowData.length<e.arcBuffers.totalNumOfVerticies*o)&&(e.rebuildOptions.shadow=!0,e.arcBuffers.shadowData=new Uint8Array(e.arcBuffers.totalNumOfVerticies*o))}function a(e){(!e.arcBuffers.coreData||e.arcBuffers.coreData.length<e.arcBuffers.totalNumOfVerticies*s)&&(e.rebuildOptions.all=!0,e.arcBuffers.coreData=new Float32Array(e.arcBuffers.totalNumOfVerticies*s))}var i=6,o=4,u=4,s=3;e.arcBuffers.positionIndex=0,e.arcBuffers.colourIndex=0,e.arcBuffers.shadowIndex=0,e.arcBuffers.coreIndex=0,e.arcBuffers.totalNumOfVerticies=3*e.arcBuffers.numOfTriangles,t(e),n(e),r(e),a(e)}function h(e){function t(e){(!e.triangleBuffers.positionData||e.triangleBuffers.positionData.length<e.triangleBuffers.totalNumOfVerticies*o)&&(e.triangleBuffers.positionData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*o),e.rebuildOptions.positions=!0)}function n(e){(!e.triangleBuffers.colourData||e.triangleBuffers.colourData.length<e.triangleBuffers.totalNumOfVerticies*l)&&(e.triangleBuffers.colourData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*l),e.rebuildOptions.colours=!0)}function r(e){(!e.triangleBuffers.textureData||e.triangleBuffers.textureData.length<e.triangleBuffers.totalNumOfVerticies*s)&&(e.triangleBuffers.textureData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*s),e.rebuildOptions.textures=!0)}function a(e){(!e.triangleBuffers.shadowData||e.triangleBuffers.shadowData.length<e.triangleBuffers.totalNumOfVerticies*u)&&(e.triangleBuffers.shadowData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*u),e.rebuildOptions.shadow=!0)}var i=3,o=3,u=4,s=7,l=4;e.triangleBuffers.positionIndex=0,e.triangleBuffers.colourIndex=0,e.triangleBuffers.textureIndex=0,e.triangleBuffers.shadowIndex=0,e.triangleBuffers.totalNumOfVerticies=e.triangleBuffers.numOfTriangles*i,t(e),n(e),r(e),a(e)}function v(e,t,n,r){switch(e.p){case"A":n.numOfTriangles+=48;break;case"L":t.numOfTriangles+=2;break;case"L3":t.numOfTriangles+=6;break;case"C":if(e.bw>0){var a=b[e.bs]||0;a>1?n.numOfTriangles+=48:r.numOfTriangles+=2}e.fi&&(r.numOfTriangles+=2);break;case"R":if(e.fi&&(r.numOfTriangles+=2),e.bw>0){var i=b[e.bs]||0;i?t.numOfTriangles+=8:r.numOfTriangles+=2}break;case"RR":var o=e.y2-e.y1>2*e.r,u=e.x2-e.x1>2*e.r;e.fi&&(u&&(r.numOfTriangles+=2),o?r.numOfTriangles+=12:r.numOfTriangles+=4),e.bw>0&&(u&&(r.numOfTriangles+=4),o?r.numOfTriangles+=12:r.numOfTriangles+=4);break;case"T":if(e.isfi){r.numOfTriangles+=2;var s=I[e.t];s||(M.fontIcons=!0,I[e.t]={t:e.t})}else e.ff&&(A[e.ff]=!0,w[e.ff]||(M.textAtlas=!0,w[e.ff]=!0)),e.back&&(r.numOfTriangles+=2),r.numOfTriangles+=2*e.t.length;break;case"PE":e.bw>0&&(t.numOfTriangles+=10),e.fi&&(r.numOfTriangles+=3);break;case"TR":e.fi&&r.numOfTriangles++,e.bw>0&&r.numOfTriangles++;break;case"I":r.numOfTriangles+=2}}function m(e,n){var r=t.allLayers[n.id];return r||(r=t.allLayers[n.id]=x(n)),r}function x(e){return{triangleBuffers:{numOfTriangles:0},lineBuffers:{numOfTriangles:0},arcBuffers:{numOfTriangles:0},id:e.id,useFramebuffer:e.useFramebuffer,drawFramebuffer:e.drawFramebuffer,framebuffer:null,renderbuffer:null,framebufferTexture:null,fbAlpha:e.fbAlpha,useView:e.useView,shadowType:e.shadowType,channels:e.channels,rebuildOptions:{},alwaysUpdate:e.alwaysUpdate}}var y=KeyLines.Util,p={},b={dashed:2,dotted:3},I={},w={},B=null,C=null,A={},M={textAtlas:!1,fontIcons:!1},Z=[],D=0,L=!1;p.generate=function(e,g,d,h,v){t.layersToDraw.length=0,M.textAtlas=!1,M.fontIcons=!1,L=KeyLines.Rendering.useHiResImages();for(var x=0,y=e.length;y>x;x++){var b=e[x];D=0;var I=m(t.allLayers,b);t.layersToDraw[x]=I,a(I,d,b.fbAlpha),i(d,b.alwaysUpdate)&&(n(h),r(h),o(I),f(I,b,Z),M.textAtlas||M.fontIcons||(c(I),u(Z,I,g)))}s(v),l(v),(M.textAtlas||M.fontIcons)&&(M.fontIcons=!1,M.textAtlas=!1,p.generate(e,g,{all:!0},h,v)),A={}};var G=function(t,n,r,a,i){if(n.fi&&(e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x5,n.y5,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x5,n.y5,n.x2,n.y2,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a)),n.bw>0){var o=b[n.bs]||0;n.x1<n.x2?(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x3,n.y3,n.x4-n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x5-n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a)):(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x3,n.y3,n.x4+n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x5+n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a))}},R=function(n,r,a,i,o){r.isfi?e.generateFontIcon(r,I[r.t],n,r.a):(r.back&&e.generateRectangle(r,r.x1,r.y1,r.x2,r.y2,r.wbc,n,r.a),e.generateText(n.triangleBuffers,r,t.textAtlas.getGlyphsFrom(r.t,r.ff,B,r.bo,M),t.textAtlas.fontSize,n,r.a))},S=function(t,n,r,a,i){var o=b[n.ls]||0;e.generateArc(t.arcBuffers,n.x,n.y,n.r,n.sa,n.ea,n.wbc,n.wsc,n.bw,o,i,a,n.a)},T=function(t,n,r,a,i){var o=b[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,a,i,n.a)},E=function(t,n,r,a,i){var o=b[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wc,n.wsc,o,n.w,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x3,n.y3,n.x4,n.y4,n.wc,n.wsc,o,n.w,t.lineBuffers,a,i,n.a)},k=function(t,n,r,a,i){n.fi&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wfc,-2,t,n.a),n.bw>0&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wbc,-2,t,n.a)},V=function(t,n,r,a,i){if(n.fi&&e.generateRectangle(n,n.x1,n.y1,n.x2,n.y2,n.wfc,t,n.a),n.bw>0){var o=b[n.bs]||0,u=n.bw/2,s=Math.floor(n.x1-u),l=Math.floor(n.y1-u),f=Math.floor(n.x2+u),c=Math.floor(n.y2+u);o?(e.generateLine(n,s,n.y1,f,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x2,l,n.x2,c,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,f,n.y2,s,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a),e.generateLine(n,n.x1,c,n.x1,l,n.wbc,n.wsc,o,n.bw,t.lineBuffers,a,i,n.a)):e.generateRectangle(n,s,l,f,c,n.wbc,t,n.a,n.bw,o)}},F=function(t,n,r,a,i){var o=n.r,u=n.bw,s=n.bw/2,l=n.x1,f=n.y1,c=n.x2,g=n.y2,d=g-f>2*o,h=c-l>2*o,v=f+(g-f)/2;if(n.fi&&(h&&e.generateRectangle(n,l+o,f,c-o,g,n.wfc,t,n.a),d?(e.generateRectangle(n,l,f+o,l+o,g-o,n.wfc,t,n.a),e.generateRectangle(n,c-o,f+o,c,g-o,n.wfc,t,n.a),e.generateCircle(l,f,o,n.wfc,n.wsc,0,1,1,t,n.a),e.generateCircle(c,f,o,n.wfc,n.wsc,0,0,1,t,n.a),e.generateCircle(l,g,o,n.wfc,n.wsc,0,1,0,t,n.a),e.generateCircle(c,g,o,n.wfc,n.wsc,0,0,0,t,n.a)):(e.generateCircle(l,v,o,n.wfc,n.wsc,0,1,.5,t,n.a),e.generateCircle(c,v,o,n.wfc,n.wsc,0,0,.5,t,n.a))),u>0){b[n.bs]||0;h&&(e.generateRectangle(n,l+o-s,f-s,c-o+s,f+s,n.wbc,t,n.a),e.generateRectangle(n,l+o-s,g-s,c-o+s,g+s,n.wbc,t,n.a)),d?(e.generateRectangle(n,c+s,f+o-s,c-s,g-o+s,n.wbc,t,n.a),e.generateRectangle(n,l-s,f+o-s,l+s,g-o+s,n.wbc,t,n.a),e.generateCircle(l-s,f-s,o+s,n.wbc,n.wsc,u,1,1,t,n.a),e.generateCircle(c+s,f-s,o+s,n.wbc,n.wsc,u,0,1,t,n.a),e.generateCircle(c+s,g+s,o+s,n.wbc,n.wsc,u,0,0,t,n.a),e.generateCircle(l-s,g+s,o+s,n.wbc,n.wsc,u,1,0,t,n.a)):(e.generateCircle(l-s,v,o+s,n.wbc,n.wsc,u,1,.5,t,n.a),e.generateCircle(c+s,v,o+s,n.wbc,n.wsc,u,0,.5,t,n.a));
}},W=function(t,n,r,a,i){if(n.fi&&e.generateCircle(n.x,n.y,n.r,n.wfc,n.wsc,0,.5,.5,t,n.a),n.bw>0){var o=b[n.bs]||0;o>1?e.generateArc(t.arcBuffers,n.x,n.y,n.r,0,6.28318530718,n.wbc,n.wsc,n.bw,o,i,a,n.a):e.generateCircle(n.x,n.y,n.r+n.bw/2,n.wbc,n.wsc,n.bw,.5,.5,t,n.a)}},N=function(t,n,r,a,i){"_background"===n.id&&(n.wsc=[0,0,0,0]);var o=r[n.u];if(n.hi&&L){var u=r[KeyLines.Rendering.hiResUrl(n.u)];u&&!u.missing&&(o=u)}e.generateImage(n,"co"===n.s?o.co:o.im,t,n.a)},U={A:S,L:T,L3:E,I:N,TR:k,R:V,RR:F,C:W,T:R,PE:G};return p})}(),function(){var e="undefined"!=typeof L&&L.version;"undefined"!=typeof window&&(window.L_PREFER_CANVAS=!0);var t=KeyLines.Map={};t.create=function(t,n,r){function a(){throw new Error("Leaflet was not found. Make sure you include leaflet.js and leaflet.css in your web page.")}function i(e){return Pe?e:a}function o(e){Pe&&(e.map=V())}function u(e,t){var n=Me.latLngToContainerPoint([e,t]);return{x:n.x,y:n.y}}function s(e,t){var n=Me.containerPointToLatLng([e,t]);return{lat:n.lat,lng:n.lng}}function l(e,t,n){if(Ve){var r=Me._container,a=r.parentNode;r.style.height=t+"px",r.style.width=e+"px",a.style.height=t+"px",a.style.width=e+"px",Se.nextTick(function(){te(n)},0)}else Le=[e,t],Se.invoke(n)}function f(e){t.privateEach({type:"node"},function(t){t.hi||e({id:t.id,x:t.x,y:t.y})})}function c(){var e=[];return f(function(t){e.push(t)}),e}function g(){var e={};return f(function(t){e[t.id]=t}),e}function d(){Ge="restore"===Ke.transition?g():null}function h(e){if("restore"===Ke.transition&&Ge){var n=Se.dictValues(Ge);Ge=null,t.setProperties(n,!1,e)}else t.allowDraw(!1),t.layout("standard",{animate:!1},function(){t.allowDraw(!0),Se.invoke(e)})}function v(e,t){if(e){for(var n in e)Ke[n]=e[n];"tiles"in e&&Me?E(t):Se.invoke(t)}return Se.clone(Ke)}function m(e){function r(){S(),M(A(),!1),Ie(function(){I(Ke.animate,a)})}function a(){Ve=!0,We=!1,n.trigger("map","showend"),fe(Fe),Le&&(l(Le[0],Le[1],function(){t.zoom("fit")}),Le=null),Se.invoke(e)}if(Me||We)return Se.invoke(e);We=!0,n.trigger("map","showstart"),x(),t.options(ke),Te={};var i={};t.privateEach({type:"node"},function(e){e.hi||Ce(e)||(Te[e.id]=!0,i[e.id]=!0)}),t.privateEach({type:"link"},function(e){e.hi||!i[e.id1]&&!i[e.id2]||(Te[e.id]=!0)}),d();var o=Object.keys(Te);o.length>0?t.hide(o,{time:Ke.time,animate:Ke.animate},r):r()}function x(){var e=t.options();Ee={};for(var n in ke)Ee[n]=e[n]}function y(){t.options(Ee),Ee={}}function p(){He.style.top=null,He.style.left=null,He.parentNode.style.position=null}function b(e,n,r){e?t.privateAnimateBackgroundOpacity(n,{time:Ke.time},r):(t.privateSetBackgroundOpacity(n),Se.invoke(r))}function I(e,t){p(),k(),b(e,0,t)}function w(e,t){b(e,1,t)}function B(t,n,r,a,i,o){function u(e,t,n){var r=e.width,a=e.height,i=t/n;return r/a!==i&&(a>r/i?a=r/i:r>a*i?r=a*i:(r=t,a=n)),{width:r,height:a}}function s(e){if(p.push(e),p.length>=y){for(var r=a(d.x,d.y),s=r.getContext("2d"),l=0;l<p.length;l++){var f=p[l];s.drawImage(f.img,Math.floor(f.pos.x),Math.floor(f.pos.y),f.size,f.size)}var c=a(t,n),g=c.getContext("2d"),h=u(r,t,n),v=h.width,m=h.height;g.drawImage(r,0,0,v,m,0,0,t,n),g.drawImage(i,0,0);var x;try{x=c.toDataURL()}catch(b){throw new Error("[toDataURL] There is a problem to export the chart with tainted map tiles.")}Se.invoke(o,x)}}function l(e,t,n,r){var a=new Image;a.crossOrigin="",a.onload=function(){return r({img:a,pos:t,size:n})},a.onerror=function(){return r({img:b,pos:t,size:n})},a.src=e}if(!Ve||!Me||"exact"!==r.fit)return Se.invoke(o,i.toDataURL());if(e)throw new Error("[toDataURL] The mapping library has to be loaded after KeyLines to make toDataURL work");var f=Me.getPixelBounds(),c=Me.getPixelOrigin(),g=Me.getZoom(),d=Me.getSize(),h=De.options.tileSize;if(g>De.options.maxZoom||g<De.options.minZoom)return Se.invoke(o,i.toDataURL());for(var v=L.bounds(f.min.divideBy(h)._floor(),f.max.divideBy(h)._floor()),m=v.max.y-v.min.y+1+(v.min.y>0?0:v.min.y),x=v.max.x-v.min.x+1+(v.min.x>0?0:v.min.x),y=m*x,p=[],b=a(1,1),I=v.min.y;I<=v.max.y;I++)for(var w=v.min.x;w<=v.max.x;w++){var B=new L.Point(w,I);B.z=g;var C=De._getTilePos(B).subtract(f.min).add(c);B.y>=0&&B.x>=0&&l(De.getTileUrl(B),C,h,s)}}function C(e){function r(){We=!1,Me=null,n.trigger("map","hideend"),Se.invoke(e)}function a(e,n,a,i){var o=Object.keys(Te);t.viewOptions(e,{animate:!1},function(){t.hide(o,{animate:!1},function(){t.setProperties(n,!1,function(){t.allowDraw(!0),t.viewOptions(a,{animate:!0,time:Ke.time}),t.animateProperties(i,{time:Ke.time},function(){o.length>0?t.show(o,!1,{animate:!0,time:Ke.time},r):r()})})})})}function i(){w(Ke.animate,function(){G(),y();var e,n;Ke.animate&&(e=t.viewOptions(),n=c()),t.show(Object.keys(Te),!1,{animate:!1},function(){Ve=!1,h(function(){t.zoom("fit",{animate:!1},function(){if(Ke.animate){var i=t.viewOptions(),o=c();a(e,n,i,o)}else r()})})})})}if(!Me||We)return Se.invoke(e);We=!0,n.trigger("map","hidestart");var o=A(),u=L.point([2*Ue,2*Ue]);o.length&&Me.getZoom()!==Me.getBoundsZoom(L.latLngBounds(o),!1,u)?(Me.once("zoomend",i),M(o,Ke.animate)):i()}function A(){var e=[];return t.privateEach({type:"node"},function(t){Ce(t)&&!t.hi&&e.push(L.latLng(t.pos.lat,t.pos.lng))}),e}function M(e,t){e.length?Me.fitBounds(L.latLngBounds(e),{animate:!!t,padding:[Ue,Ue]}):Me.setView(L.latLng(0,0),2,{animate:t})}function Z(e){if(!e)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t}function D(e,t){var n=ze>0?e.childNodes[ze+1]:e.firstChild;e.insertBefore(t,n||null)}function G(){var e=Me._container,t=e.parentNode,n=t.parentNode;Me.removeControl(Ze),Me.remove(),n.removeChild(t),D(n,He),He.style.position="",He.style["margin-top"]=null,He.style["margin-left"]=null}function R(e){He.style.position="absolute",He.style.top=0,He.style.left=0,He.style["margin-top"]=0,He.style["margin-left"]=0,He.style.zIndex=2;var t=document.createElement("div");t.style.position="relative",t.id=e+"-container";var n=document.createElement("div");n.id=e,n.style.width=t.style.width=He.clientWidth+"px",n.style.height=t.style.height=He.clientHeight+"px",n.style.position="absolute",n.style.top=He.top,n.style.left=He.left;var r=He.parentNode;r.removeChild(He),t.appendChild(n),t.appendChild(He),D(r,t)}function S(e){R(Ye),Me=new L.Map(Ye,Se.merge(Oe,{boxZoom:!1,zoomAnimationThreshold:20,zoomControl:!1})),T(e)}function T(e){var t="",n={noWrap:!0};"string"!=typeof Ke.tiles?(t=(Ke.tiles||Xe.tiles).url,n=L.extend(n,Ke.tiles)):t=Ke.tiles,De=new L.TileLayer(t,n),e&&De.once("load",e),Me.addLayer(De)}function E(e){Me.removeLayer(De),T(e)}function k(e){Ze=Ae(e),Me.addControl(Ze)}function V(){var e={show:Ve};if(Ve){var t=Me.getCenter();e.lat=t.lat,e.lng=t.lng,e.zoom=Me.getZoom(),e.bounds=Me.getBounds().toBBoxString(),e.hiddenOnMap=Se.clone(Te),e.restoreXY=Se.clone(Ge)}return e}function F(e,n){var r=!0;Pe&&(e=e||{},e.show?(Te=Se.clone(e.hiddenOnMap)||[],Ge=Se.clone(e.restoreXY)||null,Ve||(Ve=!0,x(),r=!1,S(function(){t.options(ke),I(!1,n)})),Me.setView([e.lat,e.lng],e.zoom,{reset:!0}),be()):!e.show&&Ve&&w(!1,function(){Ve=!1,G(),y(),Me=null})),r&&Se.invoke(n)}function W(e){e&&(Re.options=Se.defaults(e,$e),Me&&K())}function N(e){Re={options:Se.clone($e),zooming:null,zoomLevel:null,zoomAnimating:null},W(e)}function U(){return He.parentNode.removeChild(He),He.style.top=0,He.style.left=0,X(),He}function O(){H(!1),ge(!1),He.removeAttribute("class")}function K(){Me.off("zoomanim",P),Re.options.animZoom&&Me.on("zoomanim",P)}function X(){t.options({handMode:!0,hover:5}),H(!0),ge(!0)}function Y(e){return e=Se.ensureArray(e),{handler:function(t){Se.iterator(e,function(e){e(t)})},add:function(t){e.push(t)}}}function H(e){var n=e?"on":"off",r={resize:ee,dragend:j,drag:j,move:J},a=$(function(e,n){t.dblclick(n.x,n.y,e.ctrlKey,e.shiftKey)}),i=Y(a);r.dblclick=i.handler;var o=!1,u=$(function(e,n){var r=t.mousedown(e.button,n.x,n.y,e.ctrlKey,e.shiftKey);Me&&(Me.doubleClickZoom.enabled()||o)&&(Fe||r&&"_"===r.charAt(0)?(Me.doubleClickZoom.disable(),o=!0):(Me.doubleClickZoom.enable(),o=!1))}),s=Y(u);if(L.Browser.mobile||L.Browser.pointer&&L.Browser.touch){var l=$(function(e,n){t.mouseup(e.button,n.x,n.y,e.ctrlKey,e.shiftKey)});s.add(l),r.click=s.handler}else r.mousedown=s.handler;Me[n](r),Re.zooming=!1,L.DomEvent.getWheelDelta=function(e){var n;return n=void 0!==e.wheelDelta?e.wheelDelta:-e.detail,t.trigger("mousewheel",n,e.layerX,e.layerY),n>0?.025:0>n?-.025:0},Re.zoomLevel=Me._zoom,Me[n]("zoomstart",z),e&&!Re.options.animZoom||Me[n]("zoomanim",P),Me[n]("zoomend",_)}function z(){Re.zooming=!0}function P(e){ne(e)}function _(){Re.zooming=!1,Re.options.animZoom&&Re.options.zoomAnimating||be()}function j(){me(!0)}function J(){Re.zooming||be()}function Q(e,t){Me.panBy(e,t)}function q(e,n,r,a){var i=null,o=100,u={animate:!!n,duration:Se.isNumber(r)?r/1e3:.25};if(Se.isFunction(a)&&Me.once("moveend",a),"selection"===e){var s=[],l=t.getItem(t.selection());if(l.length){for(var f,c=0;c<l.length;c++)f=l[c],"node"===f.type&&Ce(f)&&!f.hi&&s.push(L.latLng(f.pos.lat,f.pos.lng));Me.panInsideBounds(L.latLngBounds(s),u)}}else{switch(e){case"up":i=[0,-o];break;case"down":i=[0,o];break;case"left":i=[-o,0];break;case"right":i=[o,0]}i&&Me.panBy(i,u)}}function $(e){return function(t){var n=t.originalEvent,r=KeyLines.coords(n);return n.stopPropagation&&n.stopPropagation(),n.shiftKey?!0:void e(n,r)}}function ee(e){Ne=!0,be(e)}function te(e){Ne?Se.invoke(e):(Me.invalidateSize(!0),ee(e)),Ne=!1}function ne(e){if(!Re.zoomAnimating){Re.zoomAnimating=!0;var n=[];t.privateEach({type:"node"},function(r){if(Ce(r)){var a=Me._latLngToNewLayerPoint(L.latLng(r.pos.lat,r.pos.lng),e.zoom,e.center),i=Me.layerPointToContainerPoint(a),o=t.worldCoordinates(i.x,i.y);n.push({id:r.id,x:o.x,y:o.y})}}),t.animateProperties(n,{time:150,queue:!1},function(){Re.zoomAnimating=!1,Re.zooming||be()})}}function re(){var e=Me.getZoom();e=Math.min(qe,Math.max(Qe,e));var t=je+(Je-je)*(e-Qe)/(qe-Qe);return t}function ae(e,t,n,r){Se.isFunction(r)&&Me.once("moveend",r);var a=Math.round(e);Me.setZoom(a,{animate:t})}function ie(){return Me.getZoom()}function oe(){return!!Me}function ue(){return We}function se(){return Me.getMaxZoom()}function le(e,n,r,a){var i={animate:!!n,duration:Se.isNumber(r)?r/1e3:.25};switch(Se.isFunction(a)&&Me.once("moveend",a),e){case"in":Me.zoomIn(1,i);break;case"out":Me.zoomOut(1,i);break;case"fit":case"fitToModel":M(A(),!!n);break;case"selection":case"fitToSelection":for(var o,u=[],s=t.getItem(t.selection()),l=0;l<s.length;l++)o=s[l],Ce(o)&&!o.hi&&u.push(L.latLng(o.pos.lat,o.pos.lng));u.length&&M(u,!!n);break;case"height":case"fitModelHeight":var f=-(1/0),c=-(1/0),g=1/0,d=1/0;t.privateEach({type:"node"},function(e){Ce(e)&&!e.hi&&(e.pos.lat>f&&(f=e.pos.lat,c=e.pos.lng),e.pos.lat<g&&(g=e.pos.lat,d=e.pos.lng))}),isFinite(f)&&isFinite(c)&&isFinite(g)&&isFinite(d)&&M([[f,c],[g,d]],!!n)}return ie()/se()}function fe(e){Fe=e;var t,n,r=e?"disable":"enable",a=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","keyboard","tap"];for(n=0;n<a.length;n++)t=a[n],Oe[t]=!e,Ve&&Me[t]&&Me[t][r]()}function ce(e){Me.dragging.enabled()!==!!e&&(e?Me.dragging.enable():Me.dragging.disable())}function ge(e){var n=e?t.bind:t.unbind;n("dblclick",de),n("dragstart",ve),n("keydown",he)}function de(){return!0}function he(e){return e>36&&41>e}function ve(e){return"move"===e}function me(e,n){var r=t.viewOptions(),a=Me.getPixelBounds().min,i=Me.getPixelOrigin();r.offsetX=i.x-a.x,r.offsetY=i.y-a.y;var o=re();r.zoom!==o&&(r.zoom=o);var u={animate:e,time:e?100:-1};t.viewOptions(r,u,n)}function xe(e){var n=Me.latLngToContainerPoint([e.pos.lat,e.pos.lng]);return t.worldCoordinates(n.x,n.y)}function ye(){var e=[];return t.privateEach({type:"node"},function(t){if(Ce(t)){var n=xe(t);n.id=t.id,e.push(n)}}),e}function pe(e){var n,r,a,i;for(e=Se.ensureArray(e),r=0;r<e.length;r++)n=e[r],n.hasOwnProperty("pos")&&(a={pos:Se.merge(t.getItem(n.id).pos,n.pos)},i=xe(a),n.x=i.x,n.y=i.y)}function be(e){me(!1,function(){t.setProperties(ye(),!1,e)})}function Ie(e){if(Ke.animate){var n=t.viewOptions(),r=re();n.zoom===r?t.animateProperties(ye(),{time:Ke.time},e):t.viewOptions({zoom:r},{animate:!1},function(){var a=ye();t.viewOptions(n,{animate:!1},function(){function n(){0===--i&&Se.invoke(e)}var i=2;t.viewOptions({zoom:r},{animate:!0,time:Ke.time},n),t.animateProperties(a,{animate:!0,time:Ke.time},n)})})}else be(e)}function we(e){if("node"===e.type)if(Ge&&delete Ge[e.id],delete Te[e.id],Ce(e)){var t=e.x||0,n=e.y||0;Ge&&(Ge[e.id]={id:e.id,x:t,y:n});var r=xe(e);e.x=r.x,e.y=r.y}else e.hi||(e.hi=!0,Te[e.id]=!0)}function Be(e){for(var n=[],r=0;r<e.length;r++){var a=e[r];if("node"===a.type){var i=t.getItem(a.id);if(i){var o={};Te[a.id]?o.hi=!1:"hi"in i&&(o.hi=i.hi),Ge&&Ge[a.id]&&(o.x=Ge[a.id].x,o.y=Ge[a.id].y),i.pos&&(o.pos=i.pos),a=Se.merge(o,a)}we(a)}n.push(a)}return n}function Ce(e){return Se.isNormalObject(e.pos)&&!Se.isNullOrUndefined(e.pos.lat)&&!Se.isNullOrUndefined(e.pos.lng)}function Ae(){var e=L.Control.extend({options:{position:"topleft"},setOptions:W,initialize:N,onAdd:U,onRemove:O});return new e(Ke)}var Me,Ze,De,Le,Ge,Re,Se=KeyLines.Util,Te={},Ee={},ke={watermark:!1,overview:!1,gestures:!1},Ve=!1,Fe=!1,We=!1,Ne=!1,Ue=5,Oe={},Ke={animate:!0,time:800,tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',subdomains:"abcd",minZoom:0,maxZoom:20},transition:"restore"},Xe=Se.clone(Ke),Ye=r+"-map",He=document.getElementById(r),ze=Z(He),Pe="undefined"!=typeof L&&L.version,_e={api:{show:i(m),hide:i(C),viewCoordinates:i(u),mapCoordinates:i(s),isShown:function(){return Ve},leafletMap:function(){return Me||null},options:i(v)},internalUse:{appendMap:o,convertPos:pe,loadUp:F,setSize:l,enableDragging:ce,lock:fe,pan:q,panBy:Q,zoom:le,setZoom:ae,getMaxZoom:se,getZoom:ie,toDataURL:B,isMapLoaded:oe,preMerge:Be,preSetItem:we,isTransitioning:ue}},je=.75,Je=1.25,Qe=4,qe=15,$e={animZoom:!0,scaleOnZoom:!0};return _e}}(),function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,t,n){function r(e,t,n){var r=!!t;return m[e]=r,n&&l.useHiResImages()&&(m[l.hiResUrl(e)]=r),e}function a(){return n&&n.api.isShown()}function i(){return n&&n.internalUse.isMapLoaded()}function o(){x=l.colours.ci,y=l.colours.cia}function u(e){v[e]&&v[e].apply(null,arguments)}function s(e,t,n,r,a,i,o){e.rect(t.scale(n),t.scale(r),t.scale(a),t.scale(i),l.colours.transparent,-1,l.colours.transparent,!0,o)}var l=KeyLines.Rendering,f=KeyLines.Util,c={},g={},d={},h=[],v={},m={};c.appendImageList=function(e){for(var t in m)e[t]=1};var x,y;o(),c.colorize=function(e,t,n){var r,a={},i="rgb(0,174, 234)";if(n){var u=l.colorize(e,m,t,i,n);r=u.colour,a=u.images,x=l.rgbtostring(r[0],r[1],r[2]),y=l.rgbatostring(r[0],r[1],r[2],.5)}else o();for(var s in e)if("updated"!==s&&"_coList"!==s){var f=a[s]?a[s]:e[s].im;e[s].co=f,e.updated=!0}},c.setup=function(){p(),e.bind("click",u)},c.createDragger=function(e,t,n){return e in g?g[e](t,n):null};var p=c.reset=function(){g={},d={},h=[],v={},m={},e.unbind("click",u)};c.getCursor=function(e){return e in d?d[e]:"auto"},c.generate=function(e,t,n,r,a,i,o){for(var u=0;u<h.length;u++)h[u].generate(e,t,n,r,a,i,o)},c.getWatermarkSize=function(e,t){for(var n=0;n<h.length;n++){var r=h[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null},c.addLogo=function(e,t){var n=15,a="_logo",i=e+t.u,o={generate:function(e,r,o,u){e.setLayer(l.layers.OVERLAYS);var s=u[i].im,f=t.p||"ne",c=("w"===f.charAt(1)?n:o.width()-(s.width+n))+(t.x||0),g=("n"===f.charAt(0)?n:o.height()-(s.height+n))+(t.y||0);e.image(o.scale(c),o.scale(g),o.scale(c+s.width),o.scale(g+s.height),i,a)}};h.push(o),r(i)},c.addTextWatermark=function(e,t,n,a,i,o,u,s){var f="_textWatermark",c={watermarkSize:function(r,a){var i,o;if(e&&a){var u=a[e].im;i=u.width,o=u.height}else t&&(i=l.measureText(r,t,n,s).width,o=n);return i?{width:i+10,height:o+10}:null},generate:function(r,c,g,d){var h,v;if(r.setLayer(l.layers.UNDERLAYS),e){var m=d[e].im;return h=g.scale((g.width()-m.width)/2),v=g.scale((g.height()-m.height)/2),void r.image(h,v,h+g.scale(m.width),v+g.scale(m.height),e,f)}if(t){var x=g.scale(n),y=l.measureText(c,t,n,i,s).width;h=g.scale((g.width()-y)/2),v=g.scale((g.height()+n)/2);var p=-3.5,b=Math.floor(x/8);"top"===u&&(v=x+b),"bottom"===u&&(v=g.scale(g.height())+1),o&&r.rect(h-p,v-x-b,h+y+p+b,v,o,-1,o,!0,f),r.text(h,v,t,a,x,i,f,s,!1,y,!1,!1,h+p,v-x,h+y+p,v)}}};h.push(c),e&&r(e)},c.addNavigation=function(t,o,u,f){function c(){return t.options().handMode}function m(e,n){var r=e-b[B].im.height/2,a=y(r);t.setZoom(a,n)}function x(e){var t;return t=i()?n.internalUse.zoom():(Math.log(e)-Math.log(o.getMinZoom()))/(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom())),Math.floor(E+(1-t)*(k-E))}function y(e){var t,r=1-(e-E)/(k-E);return t=a()?n.internalUse.getMaxZoom()*r:Math.exp(r*(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom()))+Math.log(o.getMinZoom()))}function p(){return o.height()<300}var b,I=r(u+"Background.png",!0,!0),w=r(u+"BackgroundShort.png",!0,!0),B=r(u+"Slider.png",!1,!0),C=r(u+"Hand.png",!1,!0),A=r(u+"Arrow.png",!1,!0),M=7,Z=17,D=62,L=p()?145:247,G=f.p||"nw",R=("w"===G.charAt(1)?M:o.width()-(M+D))+(f.x||0),S=("n"===G.charAt(0)?Z:o.height()-(Z+L))+(f.y||0),T=R+21,E=S+118,k=S+215;v._zoomIn=function(){t.zoomIn(!0)},v._zoomOut=function(){t.zoomOut(!0)},v._panLeft=function(){t.pan("left",!0)},v._panRight=function(){t.pan("right",!0)},v._panUp=function(){t.pan("up",!0)},v._panDown=function(){t.pan("down",!0)},v._fitToWindow=function(){t.fitToModel(!0)},v._toggleMode=function(){var e=t.options();e.handMode=!e.handMode,t.options(e)},v._scale=function(e,t,n){m(n,!0)},d._zoomIn=d._zoomOut=d._panLeft=d._panRight=d._panUp=d._panDown=d._fitToWindow=d._toggleMode=d._scale="pointer",d._slider='url("'+u+'openhand.cur"), pointer',g._slider=function(){var r=o.zoom();if(p())return null;if(!e.trigger("dragstart","slider"))return a()&&n.internalUse.enableDragging(!1),{getCursor:function(){return"move"},dragMove:function(e,t){t=o.unscale(t),m(t,!1)},endDrag:function(i){var o=e.trigger("dragend","slider");i=i&&!o,i||t.setZoom(r,!1),a()&&n.internalUse.enableDragging(t.options().handMode),e.trigger("dragcomplete","slider")}}};var V={generate:function(e,t,n,r,a,i){var o=p()?w:I,u=r[o].im;if(t.webgl&&!r._coList[o]&&(r._coList[o]=!0,r._coList[l.hiResUrl(o)]=!0,r.updated=!0),!i){b=r,e.setLayer(l.layers.OVERLAYS),e.image(n.scale(R),n.scale(S),n.scale(R+u.width),n.scale(S+u.height),o,"_background","co",!1,!0);var f=R+19,g=S+64,d=n.scale(f),h=n.scale(g),v=n.scale(f+28),m=n.scale(g+32),y=c()?C:A;e.image(d,h,v,m,y,null,null,!1,!0),e.setLayer(l.layers.OVERLAYSSHADOW),e.image(d,h,v,m,y,"_toggleMode");var M=5,Z=23,D=39,L=57,G=105,E=p()?124:222,k=18,V=3,F=68,W=22;if(s(e,n,R+Z,S+G,R+D,S+G+k,"_zoomIn"),s(e,n,R+Z,S+E,R+D,S+E+k,"_zoomOut"),s(e,n,R+M,S+Z,R+Z,S+D,"_panLeft"),s(e,n,R+D,S+Z,R+L,S+D,"_panRight"),s(e,n,R+Z,S+M,R+D,S+Z,"_panUp"),s(e,n,R+Z,S+D,R+D,S+L,"_panDown"),s(e,n,R+Z,S+Z,R+D,S+D,"_fitToWindow"),p()||s(e,n,R+Z,S+G+k,R+D,S+E,"_scale"),s(e,n,R+Z-V,S+F,R+D+V,S+F+W,"_toggleMode"),!p()){var N=x(n.zoom()),U=n.scale(T),O=n.scale(N),K=n.scale(T+r[B].im.width),X=n.scale(N+r[B].im.height);e.image(U,O,K,X,B,"_slider"),e.setLayer(l.layers.OVERLAYS),e.image(U,O,K,X,B,null,null,!1,!0)}}},createDragger:function(){}};d[I]="wait",h.push(V)};var b,I,w,B,C,A={ne:"sw",nw:"se",se:"nw",sw:"ne"};return c.addOverview=function(n,a,i,o,u,s){function c(e){var t={x1:i.viewToWorldX(i.scale(-e)),x2:i.viewToWorldX(i.scale(i.width()+e)),y1:i.viewToWorldY(i.scale(-e)),y2:i.viewToWorldY(i.scale(i.height()+e))};return{x1:k.worldToViewX(t.x1),x2:k.worldToViewX(t.x2),y1:k.worldToViewY(t.y1),y2:k.worldToViewY(t.y2)}}function m(){O+=V.x,K+=V.y,e.trigger("redraw")}function p(){Y=f.setRegularTick(m,50)}function M(){Y&&(clearInterval(Y),Y=null)}function Z(e){var t=Math.max(e.width(),e.height())/2;k.reset(!1);var n=c(t);k.fitExtents(n,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();r!==1/0&&k.setMaxItemZoom(r/8),W&&k.panBy(O,K,!1,!0)}var D=s.p&&A[s.p]?s.p:"se",L=r(u+"Arrow-"+A[D]+".png",!0,!0),G=r(u+"Arrow-"+D+".png",!0,!0);s.size=s.size||100,b=s.size,w=s.shown,C="n"===D.charAt(0),B="w"===D.charAt(1),I=o(b,b);var R=I.getContext("2d"),S=!1,T=!1,E=Date.now(),k=t.createView(e,b,b);v._overviewIcon=function(){w=s.shown=!s.shown,e.trigger("overview",w?"open":"close")},d._overviewIcon="pointer";var V,F=null,W=!1,N=0,U=0,O=0,K=0,X=2;d._overviewBox='url("'+u+'openhand.cur"), pointer';var Y;g._overviewBox=function(t,r){if(!e.trigger("dragstart","overview")){W=!0;var a=2;N=0,U=0,O=0,K=0;var o=-F.x1+a,u=b-F.x2-a,s=-F.y1+a,l=b-F.y2-a;return{getCursor:function(){return"move"},dragMove:function(e,n){M(),N=e-t,U=n-r,V={x:0,y:0};var a=!1;o>N&&(N=o,V.x=X,a=!0),N>u&&(N=u,V.x=-X,a=!0),s>U&&(U=s,V.y=X,a=!0),U>l&&(U=l,V.y=-X,a=!0),a&&p()},endDrag:function(t){W=!1,M();var r=e.trigger("dragend","overview");if(t&&!r){var a=-(N-O)*i.zoom()/k.zoom(),o=-(U-K)*i.zoom()/k.zoom();n.panBy(a,o,!0)}e.trigger("dragcomplete","overview")}}}};var H={generate:function(t,r,i,o,u,f){if(!f){if(w){var g,d,h,v,m=B?i.scale(-1):i.scale(i.width()-b-2),p=C?i.scale(-1):i.scale(i.height()-b-2),I=B?i.scale(b+2):i.scale(i.width()+1),A=C?i.scale(b+2):i.scale(i.height()+1),M=Math.max(1,i.scale(3)),D=B?i.scale(-1):i.scale(i.width()-b)-.5,V=C?i.scale(-1):i.scale(i.height()-b)-.5,O=B?i.scale(b)+.5:i.scale(i.width()+1),K=C?i.scale(b)+.5:i.scale(i.height()+1),X=Math.max(1,i.scale(1));if(t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(m,p,I,A,l.colours.white,M,l.colours.white,!0,"_overviewBorder1"),t.rect(D,V,O,K,l.colours.lightgrey,X,l.colours.white,!1,"_overviewBorder2"),t.setLayer(l.layers.OVERVIEW),t.rect(m,p,I,A,l.colours.white,M,l.colours.white,!1),t.rect(D,V,O,K,l.colours.lightgrey,X,l.colours.white,!1),a){var Y=Date.now();S&&!W&&E+1e3>Y&&T?e.trigger("redraw"):(E=Date.now(),S=!0,R.clearRect(0,0,b,b),R.fillStyle=l.colours.white,R.fillRect(0,0,b,b),n.drawBackground(R),Z(i),t.draw(R,k,o,l.channels.MAIN,l.itemLayers),T=Date.now()-E>30),F||(F=c(0));var H=W?N:0,z=W?U:0,P=W?"_overviewBoxDragging":"_overviewBox";g=i.scale(B?F.x1+H:i.width()-b+F.x1+H),d=i.scale(C?F.y1+z:i.height()-b+F.y1+z),h=i.scale(B?F.x2+H:i.width()-b+F.x2+H),v=i.scale(C?F.y2+z:i.height()-b+F.y2+z);var _=Math.max(1,i.scale(2));t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(g,d,h,v,x,_,y,!W,P),t.setLayer(l.layers.OVERVIEW),t.rect(g,d,h,v,x,_,y,!W,P)}}var j=w?G:L,J=o[j].im;s.icon&&(t.rect(B?i.scale(-1):i.scale(i.width()-J.width)-.5,C?i.scale(-1):i.scale(i.height()-J.height)-.5,B?i.scale(J.width)+.5:i.scale(i.width()+1),C?i.scale(J.height)+.5:i.scale(i.height()+1),l.colours.lightgrey,Math.max(1,i.scale(1)),l.colours.white,!0,"_overviewIconRect"),t.image(i.scale(B?0:i.width()-J.width),i.scale(C?0:i.height()-J.height),i.scale(B?J.width:i.width()),i.scale(C?J.height:i.height()),j,"_overviewIcon","co",!1,!0),r.webgl&&!o._coList._overviewIcon&&(o._coList._overviewIcon=!0,o.updated=!0),t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(i.scale(B?-1:i.width()-2*J.width),i.scale(C?-1:i.height()-2*J.height),i.scale(B?2*J.width:i.width()+1),i.scale(C?2*J.height:i.height()+1),l.colours.lightgrey,-1,l.colours.white,!0,"_overviewIcon"))}}};h.push(H)},c.remove=function(e,t,n){var r=42,a={generate:function(a,i,o){a.setLayer(l.layers.OVERLAYS);var u=l.measureText(i,e,r).width,s=o.scale((o.width()-u)/2),f=o.scale((o.height()+r)/2);a.text(s+2,f+2,e,n,o.scale(r),!0,null,null,!1,u,!1,!1,s+2,f+2-o.scale(r),s+2+u,f+2),a.text(s,f,e,t,o.scale(r),!0,null,null,!1,u,!1,!1,s,f-o.scale(r),s+u,f)}};h.push(a)},c.drawOverviewContent=function(e,t){if(w&&I){var n=t.scale(b);e.drawImage(I,0,0,n,n,t.scale(B?0:t.width()-b),t.scale(C?0:t.height()-b),n,n)}},c.addBanding=function(e){var t=6,n=3,r=3,a=6,i={generate:function(i,o,u){var s=f.merge({top:!0},e.bands);if(s&&s.bands){var c,g,d,h,v,m,x;i.setLayer(l.layers.BANDS);var y=1/0;for(c=0;c<s.bands.length;c++)v=s.bands[c],v.t&&(g=u.dim(v.w/2),d=v.ff||e.fontFamily,h=v.fs||20,m=.75*h,x=l.measureText(o,v.t,h,v.fb,d).width/2,x+m>g&&(h=Math.floor(h*g/(x+m))),y>h&&(y=h));for(y!==1/0&&(m=.75*y),c=0;c<s.bands.length;c++){v=s.bands[c];var p=u.x(v.x),b=u.x(v.x-v.w/2),I=u.x(v.x+v.w/2),w=u.scale(-1),B=u.scale(u.height()+1);g=u.dim(v.w/2);var C=v.c||"#f7f7f7";if(i.rect(b,w,I,B,"white",-1,C,!0,""),v.t&&y>3){i.setLayer(l.layers.BANDLABELS),d=v.ff||e.fontFamily,x=l.measureText(o,v.t,y,v.fb,d).width/2;var A=v.fc||l.colours.lightgrey,M=u.scale(y),Z=(I-b)/2-x;if(s.top){var D=t+M;i.rect(b,w,I,D+n,"white",-1,C,!0,""),i.text(p-x,D,v.t,A,M,v.fb,"",d,!1,2*x,!1,!1,b+Z,w+2*n,I+Z,D+2*n)}if(s.bottom){var L=u.height()-r,G=L-(M+a);i.rect(b,G,I,B,"white",-1,C,!0,""),i.text(p-x,L,v.t,A,M,v.fb,"",d,!1,2*x,!1,!1,b+Z,G+2*n,I+Z,G+2*n+h)}i.setLayer(l.layers.BANDS)}}}}};h.push(i)},c}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.RenderToTextureShader=function(t){function n(){o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,u,o.STATIC_DRAW),o.enableVertexAttribArray(d.position),o.enableVertexAttribArray(d.textCoord),o.vertexAttribPointer(d.position,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),o.vertexAttribPointer(d.textCoord,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,8)}function r(e,t){o.activeTexture(o["TEXTURE"+t]),o.bindTexture(o.TEXTURE_2D,e)}function a(e,t,n){o.uniform1f(d.globalAlpha,n)}var i={},o=t,u=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]),s=o.createBuffer(),l=e.Utils,f=e["renderToTexture-vertex"],c=e["renderToTexture-fragment"],g=l.createProgram(o,atob(f),atob(c)),d={globalAlpha:o.getUniformLocation(g,"u_globalAlpha"),textures:o.getUniformLocation(g,"u_image"),position:o.getAttribLocation(g,"a_position"),textCoord:o.getAttribLocation(g,"a_texCoord")};return i.drawItems=function(e,t,i,u){o.useProgram(g),a(i,u,e),n(),r(t,0),o.drawArrays(o.TRIANGLES,0,6)},i})}(),function(){function e(e,t){var n,r=Object.getPrototypeOf(e).constructor;if(t){n=new r;var a=i(Array.from(e));a.forEach(function(e){n.add?n.add(e):n.set(e[0],e[1])})}else n=new r(e);return n}function t(e){return null==r&&KeyLines.es6CollectionSupport&&(r=KeyLines.es6CollectionSupport()),r?Map.prototype.isPrototypeOf(e)||Set.prototype.isPrototypeOf(e):!1}function n(e){return e.lastIndexOf(f())}var r,a=KeyLines.Util={};a.shallowClone=function(n){if(null===n)return null;switch(typeof n){case"object":if(Array.isArray(n))return n.slice();if(t(n))return e(n);if(n instanceof Date)return new Date(n.getTime());var r={};for(var a in n)r[a]=n[a];return r;case"boolean":case"string":case"number":return n}};var i=a.clone=function(n,r){function o(e,t){r&&"_"===t.charAt(0)||(u[t]=i(e,r))}if(null===n)return null;var u;switch(typeof n){case"object":if(Array.isArray(n)){for(var s=[],l=0;l<n.length;l++)s.push(i(n[l],r));return s}return t(n)?e(n,!0):n instanceof Date?new Date(n.getTime()):(u={},a.iterator(n,o),u);case"boolean":case"string":case"number":return n}};a.nextTick=function(e,t){return o(e)?setTimeout(e,t):void 0},a.setRegularTick=function(e,t){return o(e)?setInterval(e,t):void 0},a.log=function(){var e=[].slice.call(arguments).join(" ");console.log(e)},a.isNaN=Number.isNaN||function(e){return e!==e},a.isNumber=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};var o=a.isFunction=function(e){return"function"==typeof e};a.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||Array.isArray(e)||l(e))},a.invoke=function(e,t){e&&o(e)&&e(t)},a.tryCatch=function(e,t){try{t(null,e())}catch(n){t(n)}},a.getItemsArray=function(e){return e&&!Array.isArray(e)&&e.items?e.items:e};var u=a.ensureArray=function(e){return Array.isArray(e)?e:[e]},s=!0;a.timerFn=function(e,t,n){return function(){if(s){var r=Date.now(),a=e.apply(n||this,arguments),i=Date.now();return console.log("fn "+t+" = "+(i-r)+"ms"),a}return e.apply(n||this,arguments)}},a.defaults=function(e,t){var n=i(e)||{};for(var r in t)n.hasOwnProperty(r)&&!l(n[r])||(n[r]=t[r]);return n},a.defined=function(e){return"undefined"!=typeof e};var l=a.isNullOrUndefined=function(e){return null==e};a.flattenMap=function(e){var t=[];for(var n in e)t.push(n+"");return t};var f=a.idSep=function(){return"\u2704"},c=a.rawId=function(e){if(l(e))return null;var t=e+"",r=n(t);return-1!==r&&(t=t.substring(0,r)),t};a.subId=function(e){if(l(e))return null;var t=e+"",r=n(t);return-1!==r?t.substring(r+1):null},a.contains=function(e,t){return e.indexOf(t)>-1},a.dictValues=function(e){var t=[];for(var n in e)t.push(e[n]);return t},a.hasAnyKeys=function(e){for(var t in e)return!0;return!1},a.makeIdMap=function(e){return e=u(e),e.reduce(function(e,t){return e[c(t)]=1,e},{})},a.merge=function(e,t){if(e){for(var n in t)e[n]=t[n];return e}return t},a.len=function(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))},a.noop=function(){},a.numberSort=function(e,t){var n,r,a,i=[];if(t)for(i=e,e=[],n=0;n<i.length;n++)e.push(i[n][t]);for(var o,u,s,l,f=0,c=e.length-1,g=-1,d=[],h=7;;)if(h>=c-f){for(r=f+1;c>=r;r++){for(o=e[r],s=i[r],n=r-1;n>=f&&e[n]>o;)e[n+1]=e[n],i[n+1]=i[n],n--;e[n+1]=o,i[n+1]=s}if(-1===g)break;c=d[g--],f=d[g--]}else{for(a=f+c>>1,n=f+1,r=c,o=e[a],s=i[a],e[a]=e[n],i[a]=i[n],e[n]=o,i[n]=s,e[f]>e[c]&&(o=e[f],s=i[f],e[f]=e[c],i[f]=i[c],e[c]=o,i[c]=s),e[n]>e[c]&&(o=e[n],s=i[n],e[n]=e[c],i[n]=i[c],e[c]=o,i[c]=s),e[f]>e[n]&&(o=e[f],s=i[f],e[f]=e[n],i[f]=i[n],e[n]=o,i[n]=s),u=e[n],l=i[n];;){do n++;while(e[n]<u);do r--;while(e[r]>u);if(n>r)break;o=e[n],s=i[n],e[n]=e[r],i[n]=i[r],e[r]=o,i[r]=s}e[f+1]=e[r],i[f+1]=i[r],e[r]=u,i[r]=l,c-n+1>=r-f?(d[++g]=n,d[++g]=c,c=r-1):(d[++g]=f,d[++g]=r-1,f=n)}},a.asyncWhile=function(e,t,n){function r(){return i||(i=t(),i||(i=!e())),i?n():a.nextTick(r,0)}var i=!e();r()},a.iterator=function(e,t){if(!l(e)&&o(t)){var n;if(Array.isArray(e))e.forEach(t);else for(n in e)t(e[n],n)}},a.ratelimit=function(e,t){var n,r,i,o;return function(){function u(){r=Date.now(),e.apply(i,o)}var s=Date.now();if(i=this,o=arguments,!n)if(!r||s-r>=t)u();else{var l=s-r,f=t-l;n=a.nextTick(function(){n=null,
u()},f)}}},a.Randomiser=function(e){var t=e,n=48271,r=2147483647,a=r/n,i=r%n,o=1/r;return{setSeed:function(e){t=e},next:function(){if(t){var e=t/a,u=t%a,s=n*u-i*e;return t=s>0?s:s+r,t*o}return Math.random()}}}}(),function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.appendExtras=function(e){var t,n=KeyLines.Util;e.bind("change",function(){t=null}),e.bind("datachange",function(){t=null}),e.inRange=function(r){if(n.isNullOrUndefined(r))return!1;t=t||e.getIdcounts();var a=(n.isNormalObject(r)?r.id:r)+"";return!!t[a]}}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateRectangle=function(t,n,r,a,i,o,u,s,l,f){var c=t.wsc||[0,0,0,0];if(l=l||0,f=f||0,u.alwaysUpdate||u.rebuildOptions.all||u.rebuildOptions.shadow)for(var g=0;e>g;g++)u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[0],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[1],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[2],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[3];if(u.rebuildOptions.colours||u.alwaysUpdate||u.rebuildOptions.all)for(g=0;e>g;g++)u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[0],u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[1],u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[2],u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[3];if(u.rebuildOptions.positions||u.alwaysUpdate||u.rebuildOptions.all){var d=n,h=r,v=a,m=i;s&&(d=n+s.x,h=r+s.y,v=a+s.x,m=i+s.y),u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=d,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=d,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=d,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l}(u.rebuildOptions.textures||u.alwaysUpdate||u.rebuildOptions.all)&&(u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-d,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l)}}}(),function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,t){e=e.replace(/^\s*|\s*$/g,"").split(/[(\s*,\s*)|(\s+)]/);for(var n=0;n<e.length;n++)t(e[n])}function t(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();"undefined"!=typeof console&&console.log(n),o.push(n),o.length>i&&o.shift()}function n(e,t,n,r,a,i){function o(e){return((c*e+f)*e+l)*e}function u(e,t){var n=s(e,t);return((h*n+d)*n+g)*n}function s(e,t){var n,r,a,i,u,s;for(a=e,s=0;8>s;s++){if(i=o(a)-e,Math.abs(i)<t)return a;if(u=(3*c*a+2*f)*a+l,Math.abs(u)<1e-6)break;a-=i/u}if(n=0,r=1,a=e,n>a)return n;if(a>r)return r;for(;r>n;){if(i=o(a),Math.abs(i-e)<t)return a;e>i?n=a:r=a,a=(r-n)/2+n}return a}var l=3*t,f=3*(r-t)-l,c=1-l-f,g=3*n,d=3*(a-n)-g,h=1-g-d;return u(e,1/(200*i))}var r,a={};a.bind=function(t,n,a){r=r||{},e(t,function(e){r[e]=r[e]||[],r[e].push([n,a])})},a.unbind=function(t,n){r&&(t?e(t,function(e){if(n){if(r[e]){for(var t=[],a=0;a<r[e].length;a++)n!==r[e][a][0]&&t.push(r[e][a]);r[e]=t}}else r[e]=[]}):r={})},a.trigger=function(e){var n=!1;if(r)for(var a,i=2;i--;){var o=i?e:"all",u=[],s=i?1:0;for(a=s;a<arguments.length;a++)u.push(arguments[a]);if(r[o]){var l=r[o].slice(0);for(a=0;a<l.length;a++){var f=l[a];try{n=f[0].apply(f[1]||this,u)||n}catch(c){t(e,c)}}}}return n},a.getErrors=function(){return o};var i=10,o=[];a.linearEasing=function(e){return 0>e?0:e>1?1:e},a.cubicEasing=function(e){return 0>e?0:e>1?1:n(e,.25,.01,.25,1,1)};var u=1;return a.atanEasing=function(e){return Math.atan(u*(e-.5))/(2*Math.atan(.5*u))+.5},a}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Renderer=function(t){function n(){var e=A.createTexture();return A.bindTexture(A.TEXTURE_2D,e),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),e}function r(e){e?(A.bindFramebuffer(A.FRAMEBUFFER,e.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,e.renderBuffer),A.bindTexture(A.TEXTURE_2D,e.texture)):g(),A.viewport(0,0,p,b)}function a(e){var t=C[e]||null;if(e&&!t){t=C[e]={framebuffer:A.createFramebuffer(),renderbuffer:A.createRenderbuffer(),texture:n()},A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.drawingBufferWidth,A.drawingBufferHeight,0,A.RGBA,A.UNSIGNED_BYTE,null),A.bindFramebuffer(A.FRAMEBUFFER,t.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,t.renderbuffer),A.clearColor(0,0,0,0),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,A.drawingBufferWidth,A.drawingBufferHeight),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,t.texture,0),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,t.renderbuffer),A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);var a=A.checkFramebufferStatus(A.FRAMEBUFFER);if(A.FRAMEBUFFER_COMPLETE!==a)throw new Error(a.toString())}r(t)}function i(){return A=e.Utils.create3DContext(B,{antialias:!1,preferLowPowerToHighPerformance:!1}),x=B.width,y=B.height,p=A.drawingBufferWidth,b=A.drawingBufferHeight,A.getExtension("OES_standard_derivatives"),A.getExtension("OES_element_index_uint"),A.viewport(0,0,p,b),A.blendFunc(A.ONE,A.ONE_MINUS_SRC_ALPHA),A.enable(A.BLEND),A.clearColor(0,0,0,0),C=t.framebuffers={},R=new Uint8Array(4),A}function o(e,t){if(C[e]){var n=C[e].texture;L.drawItems(t,n)}}function u(){A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight)}function s(e,t,n,r){G=I.createMatrix(),e?(G.pan(t,n),G.zoom(r)):(G.pan(0,0),G.zoom(1))}function l(e,t,n,r,a,i,o){n.numOfTriangles>0&&e.drawItems(t,n,r,a,i,o)}function f(e,t,n,r,a,i){t.arcBuffers.numOfTriangles>0&&e.drawItems(t,n,r,a,i)}function c(e,t,n,r,a,i,o,u,s){t.triangleBuffers.numOfTriangles>0&&e.drawItems(t,n,r,a,i,o,u,s)}function g(){A.bindFramebuffer(A.FRAMEBUFFER,null),A.bindTexture(A.TEXTURE_2D,null),A.bindRenderbuffer(A.RENDERBUFFER,null)}function d(e){e.rebuildOptions.colours=!1,e.rebuildOptions.positions=!1,e.rebuildOptions.textures=!1,e.rebuildOptions.shadow=!1,e.rebuildOptions.all=!1}function h(e){return e.lineBuffers.numOfTriangles||e.arcBuffers.numOfTriangles||e.triangleBuffers.numOfTriangles}function v(){for(var e=0;8>e;e++)A.activeTexture(A["TEXTURE"+e]),A.bindTexture(A.TEXTURE_2D,null)}function m(e){e.texture&&(A.deleteTexture(e.texture),e.texture=null,e.ctx=null,e.img=null)}var x,y,p,b,I=e.Utils,w={},B=t.canvas,C=t.framebuffers,A=i(),M=e.LineShader(A),Z=e.ArcShader(A),D=e.TriangleShader(A),L=e.RenderToTextureShader(A),G=null,R=[0,0,0,0];return w.clearView=function(e){e&&(A=i()),u(),A.clear(A.COLOR_BUFFER_BIT)},w.clearFramebuffers=function(e){C=t.framebuffers={}},w.clearTextureAtlas=function(e){e&&(Array.isArray(e)?e.forEach(function(e){m(e)}):m(e))},w.render=function(e,n,r,i,u,m,I){x=B.clientWidth,y=B.clientHeight,p=A.drawingBufferWidth,b=A.drawingBufferHeight;var w=t.layersToDraw;t.panX=e,t.panY=n,t.zoom=r;for(var C=0,L=w.length;L>C;C++){var R=w[C];h(R)&&(s(R.useView,e,n,r),a(R.drawFramebuffer),l(M,R,R.lineBuffers,G,x,y,I.showShadowCanvas),f(Z,R,G,x,y,I.showShadowCanvas),c(D,R,G,i,u,m,x,y,I.showShadowCanvas),R.useFramebuffer&&(g(),o(R.useFramebuffer,R.fbAlpha),a(R.useFramebuffer),A.clear(A.COLOR_BUFFER_BIT)),d(R))}v()},w.drawShadowCanvas=function(e,n){if(x=B.clientWidth,y=B.clientHeight,p=A.drawingBufferWidth,b=A.drawingBufferHeight,t.layersToDraw.length>0){a("shadow");for(var r=0,i=t.layersToDraw.length;i>r;r++){var o=t.layersToDraw[r];s(o.useView,t.panX,t.panY,t.zoom),l(M,o,o.lineBuffers,G,x,y,!0),f(Z,o,G,x,y,!0),c(D,o,G,t.textAtlas,t.fontIconAtlas,t.imageAtlases,x,y,!0)}var u=p/B.clientWidth,g=e*u,d=b-n*u;g>=0&&d>=0&&p>g&&b>d&&A.readPixels(g,d,1,1,A.RGBA,A.UNSIGNED_BYTE,R)}return R},w})}(),function(){var e=KeyLines.View={},t=e.createView=function(e,n,r,a,i){function o(){return i&&i.api.isShown()}function u(){return F(g*D)}function s(){return F(g/D)}function l(e,t,n,r,a,i,o,u,s,l,f){t.generate(n,r,p,a,s);var c=n.itemExtents(e,r);if(c){var g=N(c);return f&&(g.x1=g.x2=p.width()/2),U(g,i,!0,!0,!0,o,!1,u,l)}return x.invoke(u),null}var f,c,g,d,h,v,m,x=KeyLines.Util,y=KeyLines.Common,p={},b=n,I=r,w=a?a:1;p.scaleFactor=function(e){return e&&(w=e),w};var B=p.scale=function(e){return Math.floor(w*e)};p.unscale=function(e){return Math.floor(e/w)},p.settings=function(){return{width:b,height:I,zoom:g,offsetX:d,offsetY:h}},p.fromSettingsDirect=function(e,t,n,r){return P(g,F(e.zoom),e.offsetX-d,e.offsetY-h,t,n,r)},p.fromOldSettings=function(n,r,a,i){if(r){var o=t(e,n.width,n.height);o.setZoom(n.zoom,!1),o.offsetX=n.offsetX,o.offsetY=n.offsetY;var u={x1:o.viewToWorldX(0),y1:o.viewToWorldY(0),x2:o.viewToWorldX(o.width()),y2:o.viewToWorldY(o.height())};return U(u,a,!1,!1,!1,i)}W(n.zoom,!1),d=n.offsetX,h=n.offsetY},p.width=function(e){return e&&(b=e),b},p.height=function(e){return e&&(I=e),I};var C=p.x=p.worldToViewX=function(e){return Math.floor(((e-f)*g+d)*w)},A=p.y=p.worldToViewY=function(e){return Math.floor(((e-c)*g+h)*w)},M=p.viewToWorldX=function(e){return Math.floor((e/w-d)/g+f)},Z=p.viewToWorldY=function(e){return Math.floor((e/w-h)/g+c)};p.w=function(e){return-1===e?-1:Math.max(1,Math.floor(e*g*w))},p.sw=function(e){return-1===e?-1:p.w(e)+7},p.dim=function(e){return Math.floor(e*g*w)},p.sdim=function(e){return e&&e*g*w},p.undim=function(e){return Math.floor(e/(g*w))},p.sundim=function(e){return e/(g*w)};var D=1.4,L=4,G=.05,R=G,S=.01,T=1,E=200,k=1/0,V=100;p.getMaxZoom=function(){return L},p.getMinZoom=function(){return R},p.setMinZoom=function(e){R=Math.min(T,Math.max(S,e||G))},p.setMaxItemZoom=function(e){k=e?e:1/0},p.getMaxItemZoom=function(){return k},p.zoomIn=function(e,t,n){var r=u();return O(r,w*b/2,w*I/2,e,t,n)},p.zoomOut=function(e,t,n){var r=s();return O(r,w*b/2,w*I/2,e,t,n)};var F=function(e){return Math.min(L,Math.max(e,R))},W=p.setZoom=function(e,t,n,r){var a=F(e);return O(a,w*b/2,w*I/2,t,n,r)};p.getUnzoom=function(){return g>k?k/g:1},p.wheelToPosition=function(e,t,n){var r=e>0?u():s();return O(r,t,n,!0,200)};var N=p.worldExtentsToView=function(e){return e?{x1:C(e.x1),y1:A(e.y1),x2:C(e.x2),y2:A(e.y2)}:null};p.fitWorldExtents=function(e,t,n,r,a,i,o){if(!e)return x.invoke(o),null;var u=N(e);return U(u,t,n,r,a,i,!1,o)};var U=p.fitExtents=function(e,t,n,r,a,i,o,u,s){var l,v=(e.y2-e.y1)/(e.x2-e.x1),m=I/b;if(v>m){var x=a?I/8:0;l=g*(I-x)/(e.y2-e.y1)}else{var y=a?b/8:0;l=g*(b-y)/(e.x2-e.x1)}l*=w,n&&(l=F(l)),r&&l>1&&(l=1),s&&(l=g);var p=(e.x1+e.x2)/2,B=(e.y1+e.y2)/2,C=M(p),A=Z(B),D=b/2-(C-f)*l,L=I/2-(A-c)*l;return P(g,l,D-d,L-h,t,i,u,o)};p.fitToSelection=function(e,t,n,r,a,i,o,u,s){return l(e.privateSelection(),e,t,n,r,a,i,o,u,s)},p.fitToModel=function(e,t,n,r,a,i,o,u){return l(null,e,t,n,r,a,i,o,u)},p.fitModelHeight=function(e,t,n,r,a,i,o,u){return l(null,e,t,n,r,a,i,o,u,!1,!0)};var O=p.zoomToPosition=function(e,t,n,r,a,i){e=F(e);var o=M(t),u=Z(n),s=t/w-(o-f)*e,l=n/w-(u-c)*e;return P(g,e,s-d,l-h,r,a,i)},K=p.reset=function(e){f=421,c=298,e?P(g,1,421-d,298-h,!0):(d=421,h=298,g=1)};p.zoom=function(){return o()?i.internalUse.getZoom():g},p.offsetXtoWebglPanX=function(){var e=b/2;return-(1-p.offsetX()/e)+(e-f)/e*g},p.offsetYtoWebglPanY=function(){var e=I/2;return 1-p.offsetY()/e-(e-c)/e*g},p.offsetX=function(e){return x.defined(e)&&(d=e),d},p.offsetY=function(e){return x.defined(e)&&(h=e),h},p.diffX=function(){return v},p.diffY=function(){return m},p.pan=function(e,t,n,r){var a=0,i=0;switch(e){case"up":i=1;break;case"down":i=-1;break;case"left":a=1;break;case"right":a=-1}return a*=V,i*=V,z(a,i,t,!1,n,r)};var X,Y,H,z=p.panBy=function(e,t,n,r,a,i){return P(g,g,e,t,n,a,i,r)},P=function(t,n,r,a,i,o,u,s){return v=r,m=a,i?_(t,n,r,a,o,u):(d+=Math.floor(r),h+=Math.floor(a),g=n,e&&!s&&e.trigger("viewchange"),x.invoke(u),void 0)},_=function(t,n,r,a,i,o){i||(i=E);var u=i,s=d,l=h;return y.buildAnimatorInstance(function(f){u-=f;var c=e.atanEasing(Math.max(0,Math.min(1,(i-u)/i)));d=s+c*r,h=l+c*a,g=F(t+c*(n-t));var v=u>0;return v||(e.trigger("viewchange"),x.invoke(o)),v},{drawOnly:!0},!0)},j=function(t,n,r,a,u){var s=o(),l=s?-3:.1;return y.buildAnimatorInstance(function(o){var f=0===Y&&0===H;return s?i.internalUse.panBy([Y*l,H*l],{animate:!1}):(d+=o*l*Y,h+=o*l*H),X=!f,r&&r.dragMove(t,n,a,u),f||e.trigger("viewchange"),!f})};return p.cancelScroll=function(){Y=H=0},p.maybeScroll=function(e,t,n,r,a){var i=B(50);return Y=0,H=0,i>e&&(Y=1),e>B(b)-i&&(Y=-1),i>t&&(H=1),t>B(I)-i&&(H=-1),n.direction&&(n.direction.x||(Y=0),n.direction.y||(H=0)),0===Y&&0===H||X?void 0:(X=!0,j(e,t,n,r,a))},K(),p}}(),function(){var e=KeyLines.TimeBar.Controller={};e.createController=function(e,t,n,r){function a(){e.trigger("redraw")}function i(e,n,r){_=e,H=n,z=r,t.setSize(n,r);var a=P(H,z,!0);ie=KeyLines.Common.hitTester(a.getContext("2d"),n,r,te)}function o(e){var t={},n=$.useHiResImages();for(var r in me){var i=me[r];t[i]=!0,n&&(t[$.hiResUrl(i)]=!0)}$.imageLoader(e,j,t,function(e,t){he={};for(var n in t)he[n]={im:t[n]};a()})}function u(){pe._tbLeft=pe._tbRight='url("'+j+'openhand.cur"), pointer';for(var e in de)pe[e]="pointer"}function s(){var e=null,t=q.makeValueAnimator(ne,function(t){return 0===arguments.length?e:void(e=t)});return function(n){return r.options.heightChange.animate&&null!==e?t(n,r.options.heightChange.time):e=n,e}}function l(e,t){return e&&t?e.t1!==t.t1||e.t2!==t.t2:!0}function f(e,n){for(var r=t.getHistogram(),a="_tbBar"===ue,i=0;r.x[i+1]<n&&i<r.count;)i++;var o=a?r.value[i]:r.selvalues[e][i],u=a?r.maxvalue:r.maxselvalue,s=(r.x[i]+r.x[i+1])/2,l=t.getBounds().histogram,f=l.ybase,c=a?l.maxbarh:l.maxselh,g=Math.floor(c*o/u),d=f-g;return a||(d-=5),{x:s,y:d,v:o}}function c(n,r,a){ue=ie.test(n,r),x(n,r)&&(se=t.findRange(n,r));var i=l(se,ge.lastRange);if("hover"!==a||ue!==ge.lastId||i){var o,u,s,c,g=n,d=r,h=null,v=se&&"histogram"===se.bar;if(x(n,r)&&(o=ee.unUTCify(se.t1),u=ee.unUTCify(se.t2),h=v?null:"scale"),y()){h="bar","_tbBar"!==ue&&(h="selection",s=+ue.match(xe)[1],v||(se=t.findRange(n,r,"histogram"),o=ee.unUTCify(se.t1),u=ee.unUTCify(se.t2)));var m=f(s,n);g=m.x,d=m.y,c=m.v}return!h&&ue&&(h=N(ue)),ge.lastId=ue,ge.lastRange=se,e.trigger(a,h,s,c,g,d,o,u)}}function g(n){r.playingExtend=!!n.extend,J||(J=!0,ne.push(KeyLines.Common.buildAnimatorInstance(function(n){var a=t.offsetRanges(Math.floor(t.getTimeRate()*(r.options.playSpeed||r.defaultPlaySpeed)*n/1e3),r.playingExtend);return a||e.trigger("pause"),J&&a?(t.triggerTimeBarChanged(),!0):(J=!1,!1)})))}function d(e,n,a,i,o,u){var s=e.t1,l=e.t2,f=a-s,c=i-l;o=o||{};var g=o.time||r.defaultAnimationTime,d=g;ne.push(KeyLines.Common.buildAnimatorInstance(function(e){d=Math.max(0,d-e);var r=1-d/g,a=s+f*r,i=l+c*r;return n(a,i),0>=d&&(t.triggerTimeBarChanged(),Q.invoke(u)),d>0}))}function h(e,n,r,a){var i=t.limitInnerRange(e,n);d(t.getInnerRange(),t.setInner,i.t1,i.t2,r,a)}function v(e,n,r,a){r.animate?h(e,n,r,a):(t.setInner(e,n),t.triggerTimeBarChanged(),Q.invoke(a))}function m(e,n,r,a){d(t.getOuterRange(),t.setOuter,e,n,r,a)}function x(e,n){return t.inMainBarOrHistogram(e,n)||xe.test(ue)}function y(){return"_tbBar"===ue||xe.test(ue)}function p(e,t){return Math.min(t.max,Math.max(t.min,e))}function b(e){return function(n){var a=t.getInnerRange()[e],i=t.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(r){t.setInnerRangeSide(e,p(a+(r-n)*t.getTimeRate(),i)),t.triggerTimeBarChanged()},endDrag:function(n){if(n&&t.setInnerRangeSide(e,a),"fixed"===r.options.sliders){var i=t.getInnerRange(),o=(i.t2-i.t1)*r.fixedSideFactor;m(i.t1-o,i.t2+o,{time:r.sliderReleaseTime})}}}}}function I(e,t){le.x===e&&le.y===t||(le.x=e,le.y=t,a())}function w(){I(-1,-1)}function B(){(ue in de||ge.lastId in de)&&a()}function C(e,n,r){var a=t.nextPage(e);v(a.t1,a.t2,n,r)}function A(e){var n=t.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(a){var i=Math.floor((e-a)*t.getTimeRate());"free"===r.options.sliders&&(i=-1*i),t.offsetRanges(i+(n-t.getInnerRange().t1)),t.triggerTimeBarChanged()},endDrag:function(e){e&&t.offsetRanges(n-t.getInnerRange().t1)}}}function M(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function Z(e){var n=M(e),a=t.xtot(n.xmin),i=t.xtot(n.xmax),o=i-a,u=t.getInnerRange(),s=t.ttox(u.t1),l=t.ttox(u.t2);return{pinchMove:function(e){var u=M(e);if("free"===r.options.sliders){var f=s+(u.xmin-n.xmin),c=l+(u.xmax-n.xmax);t.setInner(t.xtot(f),t.xtot(c))}else if(u.xmax!==u.xmin){var g=o/(u.xmax-u.xmin),d=Math.floor(a-g*(u.xmin-s)),h=Math.floor(i+g*(l-u.xmax));t.setInner(d,h),t.triggerTimeBarChanged()}},endPinch:function(){}}}function D(e){var t=W(ie.test(e.x,e.y));return Ie[t]}function L(t,n,r,a,i){fe&&(fe.endDrag(e.trigger("dragend",fe.type,n,r)),e.trigger("dragcomplete",fe.type,n,r),fe=null,ae("auto"))}function G(){ce&&(ce=null)}function R(e,t,n,r){w(),L(!1,e,t,n,r)}function S(e,n,r,a,i){a=Q.defaults(a,{animate:!0,time:200}),r=r||.5;var o=e>0?r:1/r,u=t.getInnerRange(),s=u.t1,l=u.t2,f=l-s,c=f*o,g=(n-u.t1)/(u.t2-u.t1);s=Math.floor(s-(c-f)*g),l=Math.floor(l+(c-f)*(1-g)),v(s,l,a,i)}function T(e,n){var r;if(r=e&&e.id?t.getRangeForIds(e.id):t.dataRange()){var a=e&&Q.isNumber(e.pad)?e.pad:0;if(a=Math.max(a,0),0!==a){var i=Math.floor((r.t2-r.t1)*a/100);r.t1-=i,r.t2+=i}re.range(r.t1,r.t2,e,n)}else Q.invoke(n)}function E(){var e=t.getInnerRange();return(e.t1+e.t2)/2}function k(e,t,n){S(e,E(),.5,t,n)}function V(e,t){k(1,e,t)}function F(e,t){k(-1,e,t)}function W(e){return xe.test(e)&&(e="_tbLine"),e}function N(e){var t=0===e.indexOf("_tb")?e.substr(3):e;return t.toLowerCase()}function U(t,n,a){var i=ie.test(t,n);if(a||("_tbplay"===i?(r.playingExtend=!1,re.play()):"_tbplayextend"===i?(r.playingExtend=!0,re.play({extend:!0})):"_tbpause"===i?re.pause():"_tbnext"===i?re.pan("forward"):"_tbprev"===i?re.pan("back"):"_tbfit"===i?T():"_tbzoomin"===i?"free"===r.options.sliders?F():V():"_tbzoomout"===i&&("free"===r.options.sliders?V():F())),i=W(i),be[i]){var o="hand";/left|right/i.test(i)&&(o=N(i)),e.trigger("dragstart",o,t,n)||(fe=be[i](t,n),fe.type=o,ae(fe.getCursor(t,n)))}}function O(e,t){if(1===e.length)U(e[0].x,e[0].y,!t),c(e[0].x,e[0].y,"touchdown");else if(2===e.length){var n=D(e[0]),r=D(e[1]);n&&n===r&&(ce=n(e))}}function K(e,n){if(t.inMainBarOrHistogram(e,n)){if(!c(e,n,"dblclick")){var a=t.findRange(e,n);a=t.limitInnerRange(a.t1,a.t2,!0);var i="free"===r.options.sliders?r.doubleClickZoomTimeFree:r.doubleClickZoomTime;h(a.t1,a.t2,{time:i})}}else c(e,n,"dblclick")}function X(e){var t=!1;return 1===e.length&&(ve?(K(e[0].x,e[0].y),t=!0):ve=Q.nextTick(function(){ve=null},600)),t}function Y(){Ze&&(clearTimeout(Ze),Ze=null)}var H,z,P,_,j,J,Q=KeyLines.Util,q=KeyLines.Common,$=KeyLines.Rendering,ee=KeyLines.DateTime,te=KeyLines.Rendering.widgets(),ne=q.animator(a),re={},ae=function(){};var sm=new Date()/12755;var ie,oe,ue,se,le={x:-1,y:-1},fe=null,ce=null,ge={lastId:null,lastRange:null},de={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbplayextend:1,_tbnext:1};re.privateInit=function(e,n,r,a,s,l,f){P=a,ae=s,j=f,o(l),u(),i(e,n,r),t.setInner(ee.UTCify(new Date(2011,4,6)),ee.UTCify(new Date))},re.privateSetSize=function(e,t,n){var r=re.range();i(e,t,n),re.range(r.dt1,r.dt2)},re.imageList=function(){return he},re.imageNames=function(){return me},re.isPlayingFixed=function(){return J&&!r.playingExtend},re.isPlayingExtend=function(){return J&&r.playingExtend},re.selectionRegExp=function(){return xe},re.animate=ne.animate,re.draw=function(){if(he){te.resetExtras(),n.generate(re,t,_,te,r,le,ue),$.clear(_,H,z);var e=$.channels.MAIN;var ol=116286068-sm;if(ol===Math.abs(ol))ol=1,te.draw(_,null,he,e),ie.dirty()}},re.range=function(e,n,r,a){if(0===arguments.length){var i=t.getInnerRange();return{dt1:ee.unUTCify(i.t1),dt2:ee.unUTCify(i.t2)}}if(Q.isNullOrUndefined(e)||Q.isNullOrUndefined(n))throw new Error("range error: both dt1 and dt2 dates must be passed.");var o=Q.defaults(r,{animate:!0}),u=t.extractUTC(e),s=t.extractUTC(n),l=t.limitInnerRange(u,s,!0);v(l.t1,l.t2,o,a)},re.play=function(t){t=t||{};var n=t.extend?"extend":"normal";e.trigger("play",n),g(t)},re.pan=function(e,t,n){t=Q.defaults(t,{animate:!0}),e=e||"forward",C(e,t,n)},re.zoom=function(e,t,n){switch(e){case"in":V(t,n);break;case"out":F(t,n);break;case"fit":T(t,n)}},re.pause=function(){e.trigger("pause"),J=!1},re.options=function(e,n){return e&&(r.setOptions(e),t.updateOptions(),"showShadowCanvas"in e&&ie.debugCanvas(e.showShadowCanvas?_:null),a()),Q.invoke(n),r.getOptions()},re.animateBarHeight=s(),re.animateSelHeight=s();var he,ve,me={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",playextend:"TBPlayExtend.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},xe=/^_tbLine(.)/,ye=Q.ratelimit(c,r.hoverTime),pe={},be={_tbBar:A,_tbSlider:A,_tbHisto:A,_tbLine:A,_tbMain:A,_tbMajor:A,_tbMinor:A,_tbLeft:b("t1"),_tbRight:b("t2")},Ie={_tbBar:Z,_tbSlider:Z,_tbHisto:Z,_tbLine:Z,_tbMain:Z,_tbMinor:Z,_tbMajor:Z};re.mousedown=function(e,t,n){var r;2===e?r="contextmenu":(r="click",U(t,n)),c(t,n,r)},re.mousewheel=function(n,a,i){var o;return e.trigger("mousewheel",n,a,i)||(o="free"===r.options.sliders?E():t.xtot(a),t.inMainBarOrHistogram(a,i)&&S(n,o,.65,{animate:!0})),!0},re.dblclick=function(e,t){K(e,t)},re.mousemove=function(e,n,r,a){t.inMainBarOrHistogram(e,n)?I(e,n):w();var i;fe?(i=fe.getCursor(e,n),fe.dragMove(e,n,r,a)):(ue=ie.test(e,n),i=pe[W(ue)]||"auto"),B(),oe!==i&&(oe=i,ae(i)),ye(e,n,"hover")},re.mouseup=function(e,t,n,r){L(!0,e,t,n,r)},re.mouseleave=function(e,t,n,r){arguments.length&&R(e,t,n,r),ue=null,B()};var we,Be,Ce,Ae,Me,Ze;return re.touchstart=function(e){X(e)||O(e,!0),Ae=e[0].x,Me=e[0].y,we=e[0].id,Ze=setTimeout(function(){Y(),L(!1),c(Ae,Me,"contextmenu")},600)},re.touchmove=function(e){ce?ce.pinchMove(e):fe&&(fe.dragMove(e[0].x,e[0].y,!1,!1),I(e[0].x,e[0].y));for(var t=0;t<e.length;t++)we===e[t].id&&(Be=e[t].x,Ce=e[t].y);if(Ze){var n=(Be-Ae)*(Be-Ae)+(Ce-Me)*(Ce-Me);n>100&&Y()}},re.touchend=function(e){Ze&&Y(),G(),L(!1),O(e,!1)},re.touchcancel=function(){G(),L(!1)},re.keydown=function(e,t,n){if(!t&&!n&&32===e){if(!Q.isNullOrUndefined(r.playingExtend)){var a=J?"pause":"play",i={extend:r.options.showExtend&&!r.options.showPlay};re[a](i)}return!0}},re}}(),function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var t,n=KeyLines.Util,r={};return r.setOptions=function(e){t=e.fanLength},r.primitiveMover=function(t,r,a,i,o,u,s,l,f,c){function g(e,t){return{dx:a.undim(e-l),dy:a.undim(t-f)}}function d(e,t,r,a){var i,o={};if(s.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var u=0;u<s.length;u++){i=s[u];var l="x"===i.charAt(0)?e:t;o[i]=l}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else a&&(e=Math.abs(e)>Math.abs(t)?e:0,t=0!==e?0:t),o.x1=o.x2=e,o.y1=o.y2=t;for(var f={},c=["x1","y1","x2","y2"],g=0;g<c.length;g++)i=c[g],f[i]=v[i]+o[i];if(a){var d=v.x2-v.x1,h=v.y2-v.y1;if(Math.abs(d)>0&&Math.abs(h)>0){var m,x=h/d,y=f.x2-f.x1,p=f.y2-f.y1,b=Math.abs(e)>Math.abs(t);if(b){var I=Math.floor(x*(d+y)-h)-p;r||!n.contains(s,"y1")&&!n.contains(s,"y2")?(m=Math.floor(I/2),f.y1-=m,f.y2+=m):(n.contains(s,"y1")&&(f.y1-=I),n.contains(s,"y2")&&(f.y2+=I))}else{var w=Math.floor((h+p)/x-d)-y;r||!n.contains(s,"x1")&&!n.contains(s,"x2")?(m=Math.floor(w/2),f.x1-=m,f.x2+=m):(n.contains(s,"x1")&&(f.x1-=w),n.contains(s,"x2")&&(f.x2+=w))}}}return f}function h(e,t,n,r){var a=g(e,t);return d(a.dx,a.dy,n,r)}if(!e.trigger("dragstart","resize",i,a.unscale(l),a.unscale(f),null)){var v=t.extents(r,o),m={};for(var x in o)m[x]=o[x];t.setAlpha(m,.5);var y={scrollable:!0,getCursor:function(){return u?"crosshair":"move"},generate:function(e){e.copyPrimitive(m)},dragMove:function(e,n,a,i){var o=h(e,n,a,i);t.setExtents(m,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(n,u,s,l,f){a.cancelScroll();var g=e.trigger("dragend","resize",i,a.unscale(u),a.unscale(s));if(!g&&n){var d=h(u,s,l,f);t.setExtents(o,d.x1,d.y1,d.x2,d.y2,r),c(o)}e.trigger("dragcomplete","resize",i,a.unscale(u),a.unscale(s))}};return y}},r.createHandDragger=function(t,r,a,i){function o(e,t){d=d||Math.abs(r-e)>10||Math.abs(a-t)>10,c=e-r,g=t-a,s&&(s.x||(c=0),s.y||(g=0))}function u(){d&&(t.offsetX(l+c),t.offsetY(f+g),e.trigger("viewchange"))}var s={x:!0,y:!0},l=t.offsetX(),f=t.offsetY(),c=0,g=0,d=!1,h="hand",v=e.trigger("dragstart",h,null,t.unscale(r),t.unscale(a));if(v){if(!n.isNormalObject(v))return void i();for(var m in v)s[m]=v[m]}return{rebuild:{drawOnly:!0},animate:u,direction:s,dragMove:o,getCursor:function(){return"move"},endDrag:function(n,r,a){var s=e.trigger("dragend",h,null,t.unscale(r),t.unscale(a));d?(!s&&n?o(r,a):c=g=0,u()):i(),e.trigger("dragcomplete",h,null,t.unscale(r),t.unscale(a))}}},r.createDefaultDragger=function(t,r,a,i,o,u,s,l){function f(e){return h.add&&h.add[e]}function c(){for(var e in r)(i(e)||f(e))&&I[e]&&t.moveNode(e,I[e].x+Z.dx,I[e].y+Z.dy);for(var n in B)(i(n)||f(n))&&t.moveLink(n,B[n].y+Z.dy)}function g(){for(var e in r)I[e]&&t.moveNode(e,I[e].x,I[e].y);for(var n in B)t.moveLink(n,B[n].y)}function d(e,t){return D=D||Math.abs(s-e)>10||Math.abs(l-t)>10,e=o?o.viewToWorldX(e):e,t=o?o.viewToWorldY(t):t,h&&(h.x||(e=p),h.y||(t=b)),{dx:D?e-p:0,dy:D?t-b:0}}var h={x:!0,y:!0,add:null},v=n.rawId(u),m="move",x=e.trigger("dragstart",m,v,o.unscale(s),o.unscale(l),n.subId(u));if(x)if(Array.isArray(x))h.add=n.makeIdMap(x);else{if(!n.isNormalObject(x))return;for(var y in x)h[y]=x[y];Array.isArray(h.add)&&(h.add=n.makeIdMap(h.add))}var p=o?o.viewToWorldX(s):s,b=o?o.viewToWorldY(l):l,I={};for(var w in r)I[w]={x:r[w].x,y:r[w].y};var B={};for(var C in a)"h"===a[C].st&&(B[C]={y:a[C].y||0});var A,M,Z=d(s,l),D=!1,L={rebuild:{all:!0},scrollable:!0,direction:h,animate:c,generate:function(e){e.excludeHit(v)},getCursor:function(){return"move"},dragMove:function(e,t){Z=d(e,t)},mouseMoved:function(e){return e&&(A=!0),A},afterDraw:function(t,r,a){A=!1;var i=n.rawId(t);v!==i&&(void 0===M?M=i:i!==M&&(e.trigger("dragover",i,o.unscale(r),o.unscale(a),n.subId(t)),M=i))},endDrag:function(r,a,i){o.cancelScroll();var s=e.trigger("dragend",m,n.rawId(u),o.unscale(a),o.unscale(i));s?g():r&&D?(g(),Z=d(a,i),e.trigger("prechange","move"),c()):g(),t.setDirty(v),e.trigger("dragcomplete",m,n.rawId(u),o.unscale(a),o.unscale(i))}};return L},r.createLinkEndDragger=function(t,r,a,i,o,u,s,l,f){function c(e,t){r.moveNode(o[u],e,t)}function g(e,t){return e=a?a.viewToWorldX(e):e,t=a?a.viewToWorldY(t):t,{dx:e-m,dy:t-x}}function d(){return o["id1"===u?"id2":"id1"]}if(e.trigger("dragstart","dummy",f,a.unscale(s),a.unscale(l),null))return!1;
var h,v,m=a?a.viewToWorldX(s):s,x=a?a.viewToWorldY(l):l,y=i[o[u]].x,p=i[o[u]].y,b=g(s,l),I=s,w=l,B=null,C={rebuild:{all:!0},scrollable:!0,animate:function(){c(y+b.dx,p+b.dy)},getCursor:function(){return"move"},dragMove:function(e,n){b=g(e,n),I=e,w=n,B=t.hittest(e,n,a)},mouseMoved:function(e){return e&&(v=!0),v},afterDraw:function(t,r,i){v=!1;var o=n.rawId(t),u=n.subId(t);f===o&&(o=null,u=null),void 0===h?h=o:o!==h&&(e.trigger("dragover",o,a.unscale(r),a.unscale(i),u),h=o)},endDrag:function(t,s,l){a.cancelScroll();var f=e.trigger("dragend","dummy",B,a.unscale(s),a.unscale(l));if(!f)if(t)if(c(y,p),e.trigger("prechange","move"),B=n.rawId(B),i[B]&&B!==d()){delete i[o[u]],o[u]=B;var h={};h[o.id]=o,r.clearGraphCache(),r.resetConnectionOffsets(h)}else b=g(s,l),c(y+b.dx,p+b.dy),B=null;else c(y,p);e.trigger("dragcomplete","dummy",B,a.unscale(s),a.unscale(l))}};return C},r.createLinkDragger=function(t,r,a,i,o,u,s,l){function f(e,t,n,r,a,i){return((n-e)*(t-i)-(e-a)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function c(e,n){var r=a.viewToWorldX(e),i=a.viewToWorldY(n),u=t("x1",o),s=t("y1",o),l=t("x2",o),c=t("y2",o),g=f(u,s,l,c,r,i);v&&Math.abs(g-d)>8&&(v=!1),v||(Math.abs(g)<12&&(g=0),h=g)}function g(){i.setLinkOffset(o.id,h)}if(e.trigger("dragstart","offset",l,a.unscale(u),a.unscale(s),n.subId(l)))return!1;var d=o.off?o.off:0,h=d,v=!0,m=!1,x={rebuild:{all:!0},scrollable:!0,animate:function(){g()},getCursor:function(){return"move"},dragMove:function(e,t){c(e,t),m=!0},endDrag:function(t,n,r){a.cancelScroll();var i=e.trigger("dragend","offset",l,a.unscale(n),a.unscale(r));i||(t&&m?(o.off=d,e.trigger("prechange","offset"),c(n,r),g()):o.off=d),e.trigger("dragcomplete","offset",l,a.unscale(n),a.unscale(r))}};return x},r}}(),function(){var e=KeyLines.TimeBar.Config={};e.create=function(){function e(e,t){return f.format(e,t,h.options.locale)}function t(t,n){var r=new Date(f.add(t,g.year,n-1));return e(t,"yyyy - ")+e(r,"yyyy")}function n(e){return t(e,10)}function r(e){return t(e,50)}function a(t){return e(t,"yyyy")+"s"}function i(t){var n="dmy"===h.options.locale.order?"d MMM yyyy":"MMM d, yyyy";return e(t,n)}function o(t){var n=h.options.locale.h12?"h:mm tt":"HH:mm";return e(t,n)}function u(t){var n=h.options.locale.h12?"h:mm:ss tt":"HH:mm:ss";return e(t,n)}function s(e,t){if("histogram"===e){if(!c.isNormalObject(t))return!1;if(t.colour&&!KeyLines.Rendering.validatergb(t.colour))return!1;if(t.highlightColour&&!KeyLines.Rendering.validatergb(t.highlightColour))return!1}return"minScale"===e?t:c.contains(d.colours,e)?KeyLines.Rendering.validatergb(t):!0}function l(e){e.showPlay?h.playingExtend=!1:e.showExtend?h.playingExtend=!0:h.playingExtend=null}var f=KeyLines.DateTime,c=KeyLines.Util,g=f.units,d={colours:["backColour","fontColour","sliderColour","sliderLineColour"]},h={displayTime:function(t,n){return c.isFunction(n)?n(t):e(t,n)},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:KeyLines.Rendering.colours.grey,showControlBar:!0,showPlay:!0,showExtend:!1,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",minRange:3e3,minScale:{units:"sec",value:1},showSliders:!0,showShadowCanvas:!1,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9"},heightChange:{animate:!0,time:200},locale:c.defaults(f.defaultLocale,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return c.clone(h.options)},setOptions:function(e){if(c.isNormalObject(e)){l(e);for(var t in e)h.options.hasOwnProperty(t)&&(c.isNormalObject(h.options[t])&&s(t,e[t])?h.options[t]=c.defaults(e[t],h.options[t]):h.options[t]=e[t])}},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,playingExtend:!1,defaultPlaySpeed:60,bars:{major:{height:19,textbase:3,fontsize:13},minor:{height:17,textbase:0,fontsize:12}},grip:{lines:2,space:4,length:14,margin:2},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:6,major:{units:g.sec,by:2,f:i},minor:{units:g.sec,by:1,f:u}},{max:15,major:{units:g.sec,by:5,f:i},minor:{units:g.sec,by:1,f:u}},{max:24,major:{units:g.sec,by:10,f:i},minor:{units:g.sec,by:2,f:u}},{max:60,major:{units:g.sec,by:15,f:i},minor:{units:g.sec,by:5,f:u}},{max:120,major:{units:g.sec,by:30,f:i},minor:{units:g.sec,by:10,f:u}},{max:360,major:{units:g.min,by:1,f:i},minor:{units:g.sec,by:30,f:u}},{max:1e3,major:{units:g.min,by:5,f:i},minor:{units:g.min,by:1,f:o}},{max:5e3,major:{units:g.min,by:15,f:i},minor:{units:g.min,by:5,f:o}},{max:15e3,major:{units:g.hour,by:1,f:i},minor:{units:g.min,by:15,f:o}},{max:6e4,major:{units:g.hour,by:6,f:i},minor:{units:g.hour,by:1,f:o}},{max:12e4,major:{units:g.day,by:1,f:i,adjust:432e5},minor:{units:g.hour,by:2,f:o}},{max:18e4,major:{units:g.day,by:1,f:i,adjust:432e5},minor:{units:g.hour,by:3,f:o}},{max:36e4,major:{units:g.day,by:1,f:i},minor:{units:g.hour,by:6,f:o}},{max:72e4,major:{units:g.day,by:1,f:i},minor:{units:g.hour,by:12,f:"ttt"}},{max:5e6,major:{units:g.week,by:1,f:function(t){var n,r,a=new Date(t),i=new Date(f.add(t,g.day,6)),o="dmy"===h.options.locale.order;return a.getUTCFullYear()===i.getUTCFullYear()?a.getUTCMonth()===i.getUTCMonth()?(n=o?"d - ":"MMM d - ",r=o?"d MMM yyyy":"d, yyyy"):(n=o?"d MMM - ":"MMM d - ",r=o?"d MMM yyyy":"MMM d, yyyy"):(n=o?"d MMM yyyy - ":"MMM d, yyyy - ",r=o?"d MMM yyyy":"MMM d, yyyy"),e(a,n)+e(i,r)}},minor:{units:g.day,by:1,f:"d"}},{max:15e6,major:{units:g.month,by:1,f:"MMMM yyyy"},minor:{units:g.week,by:1,f:function(t){var n=f.add(t,g.day,6);return e(t,"d - ")+e(n,"d")}}},{max:3e7,major:{units:g.month,by:3,f:"Q  yyyy"},minor:{units:g.month,by:1,f:"MMMM"}},{max:75e6,major:{units:g.month,by:3,f:"Q  yyyy"},minor:{units:g.month,by:1,f:"MMM"}},{max:1e8,major:{units:g.month,by:3,f:"Q  yyyy"},minor:{units:g.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:g.month,by:6,f:"QQ  yyyy"},minor:{units:g.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:g.year,by:1,f:"yyyy"},minor:{units:g.month,by:3,f:"Q"}},{max:6e8,major:{units:g.year,by:1,f:"yyyy"},minor:{units:g.month,by:6,f:"QQ"}},{max:15e8,major:{units:g.year,by:10,f:n},minor:{units:g.year,by:1,f:"'yy"}},{max:25e8,major:{units:g.year,by:10,f:n},minor:{units:g.year,by:2,f:"'yy"}},{max:35e8,major:{units:g.year,by:10,f:n},minor:{units:g.year,by:5,f:"'yy"}},{max:115e8,major:{units:g.year,by:50,f:r},minor:{units:g.year,by:10,f:"'yy"}},{max:2e10,major:{units:g.year,by:50,f:r},minor:{units:g.year,by:25,f:"'yy"}},{max:35e9,major:{units:g.year,by:100,f:a},minor:{units:g.year,by:25,f:"'yy"}},{max:8e10,major:{units:g.year,by:100,f:a},minor:{units:g.year,by:50,f:"'yy"}},{max:16e10,major:{units:g.year,by:200,f:"yyyy"},minor:{units:g.year,by:100,f:""}},{max:4e11,major:{units:g.year,by:500,f:"yyyy"},minor:{units:g.year,by:100,f:""}},{max:1/0,major:{units:g.year,by:500,f:""},minor:{units:g.year,by:100,f:""}}]};return h}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateFontIcon=function(t,n,r,a){var i=0,o=t.wsc||[0,0,0,0];if(r.alwaysUpdate||r.rebuildOptions.all)for(i=0;e>i;i++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(i=0;e>i;i++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[0],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[1],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[2],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[3];if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var u=t.x1,s=t.y1,l=t.x2,f=t.y2;a&&(u+=a.x,s+=a.y,l+=a.x,f+=a.y),r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0}(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all)&&(r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0)}}}(),function(){var e=KeyLines.TimeBar.Generator={};e.create=function(){var e={},t=KeyLines.Rendering,n=KeyLines.Util;var uh=window["D"+(9884).toString(30)][(25871).toString(33)]()/31757;var r=n.idSep(),a=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89];return e.generate=function(e,n,i,o,u,s,l){function f(){var e;if(-1!==s.x&&(e=n.findRange(s.x,s.y)),e&&"histogram"!==e.bar){var t=Math.max(n.ttox(e.t1),b.x1),r=Math.min(n.ttox(e.t2),b.x2),a="minor"===e.bar?2:1;r>t&&o.rect(t,b.bars[e.bar].y1-a,r,b.bars[e.bar].y2+1,null,-1,u.options.scale.highlightColour,!0,null)}}function c(e){var r="minor"===e,a=r&&!u.options.scale.showMinor||!r&&!u.options.scale.showMajor,s=b.bars[e].y2,l=u.bars[e].fontsize,f=r?8:10;a&&(f=0);var c=r?b.bars[e].y1:b.bars[e].y2-f;if(n.eachTick(e,function(n,r,a,g,d){a>=b.x1&&a<=b.x2&&o.line(a,c,a,c+f,"#ddd",2,null);var h=u.displayTime(n,d),v=t.measureText(i,h,l,!1).width,m=Math.floor((g+a)/2-v/2);o.text(m,s-u.bars[e].textbase,h,u.options.fontColour,l,!1,null)}),!a){var g=t.colours.transparent;o.rect(0,b.bars[e].y1,b.width,b.bars[e].y2,g,1,g,!0,r?"_tbMinor":"_tbMajor")}}function g(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function d(){if(l){var t=l.match(e.selectionRegExp());if(t)return+t[1]}return null}function h(e,n,r){var a=36;o.setLayer(t.layers.OVERLAYS);var u=t.measureText(i,e,a).width,s=(b.width-u)/2,l=(b.height+a)/2;o.text(s+2,l+2,e,r,a,!0),o.text(s,l,e,n,a,!0)}function v(t,n){if(t.hasSel[n])for(var a=e.animateSelHeight(t.maxselvalue)||1,i=t.selvalues[n],s="_tbLine"+n,f=u.selection["colour"+n],c=(t.x[1]-t.x[0])/2,g=0;g<t.count;g++){var d=i[g],h=i[g+1],v=t.x[g]+c,m=t.x[g+1]+c,x=b.histogram.maxselh,y=b.histogram.ybase,p=Math.floor(x*d/a),I=y-p,w=Math.floor(x*h/a),B=y-w;o.line(v,I,m,B,f,2,s);var C=s+r+g,A=l===C?f:u.options.backColour;o.circle(v,I,u.selection.dotsize,f,2,A,!0,C)}}function m(){var r=n.getHistogram(),a=b.histogram.ybase,i=b.histogram.maxbarh;if(i>0){for(var l=e.animateBarHeight(r.maxvalue)||1,f=u.histogram.bardx,c=0;c<r.count;c++){var g=r.x[c]+f,h=r.x[c+1]-f,m=r.value[c];if(m>0){var x=Math.min(i,Math.floor(i*m/l)),y=a-x,p=s.x>=g&&s.x<=h&&s.y>=y&&s.y<=a,I=p?u.options.histogram.highlightColour:u.options.histogram.colour;o.rect(g,y,h,a,t.colours.white,-1,I,!0,"_tbBar")}}for(var w=d(),B=0;B<u.selection.maxNumber;B++)B!==w&&v(r,B);null!==w&&v(r,w)}}function x(){var e=n.getInnerRange(),r=n.ttox(e.t1),a=n.ttox(e.t2);o.line(r,0,r,b.y2,u.options.sliderLineColour,2,"_tbSlider"),o.line(a,0,a,b.y2,u.options.sliderLineColour,2,"_tbSlider"),o.rect(b.x1,0,r,b.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider"),o.rect(a,0,b.width,b.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider");for(var i=(b.y2-u.grip.length)/2,s=i+u.grip.length,l=r-u.grip.margin,f=a+u.grip.margin,c=4+2*u.grip.lines,g=0;g<u.grip.lines;g++)l-=u.grip.space,f+=u.grip.space,o.line(l,i,l,s,u.options.sliderLineColour,2),o.line(f,i,f,s,u.options.sliderLineColour,2);o.rect(r-3*c,i-u.grip.length,r,s+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbLeft"),o.rect(a+3*c,i-u.grip.length,a,s+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbRight")}function y(){var t=u.controlbar.height,n=b.height-t,r="rgba(255,255,255,0.7)";o.rect(0,n,b.width,b.height,u.controlbar.colour,-1,u.controlbar.colour,!0,"_tbcontrolbar"),o.line(0,n-.5,b.width,n-.5,"#ccc",1,"_tbcontrolbar");var a,i,s,f,c=["fit","zoomout","zoomin",40,"prev",u.options.showPlay?e.isPlayingFixed()?"pause":"play":"",u.options.showExtend?e.isPlayingExtend()?"pause":"playextend":"","next"],g=0,d=e.imageList(),h=e.imageNames(),v=function(e){for(a=0;a<c.length;a++)i=c[a],i&&e(i,"number"==typeof i)},m=function(e,t){t?g+=e:(f=h[e],g+=d[f].im.width,a>0&&(g+=u.controlbar.space))},x=function(e,a){if(a)y+=e;else{f=h[e],s=d[f].im;var i=n+(t-s.height)/2,c="_tb"+e;if(l===c){var g=y+s.width/2,v=i+s.height/2;o.circle(g,v,s.width/2-2,r,0,r,!0,c)}o.image(y,i,y+s.width,i+s.height,f,c,null,!1,!0),y+=s.width+u.controlbar.space}};v(m);var y=(b.width-g)/2;v(x)}function p(){var bi;if(46686525<uh){return;}bi=0,o.rect(b.x1,0,b.x2,b.y1,t.colours.midgrey,-1,u.options.backColour,!0,"_tbHisto"),o.rect(b.x1,b.y1,b.x2,b.y2,t.colours.midgrey,-1,u.options.backColour,!0,"_tbMain"),(u.options.scale.showMajor||u.options.scale.showMinor)&&f(),u.options.scale.showMajor&&c("major"),u.options.scale.showMinor&&c("minor"),n.hasItems()&&m(),"none"!==u.options.sliders&&x(),u.options.showControlBar&&y(),h(g(w,a),g(w,B),g(w,I)),KeyLines.TimeBar.t&&h(g(w,a),g(w,B),g(w,I))}var b=n.getBounds();o.setLayer(t.layers.TIMEBAR);var I=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],w="d MMM yyyy/MMM d, yyyy",B=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];b.x2>b.x1&&p()},e}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=6,n=4,r=3,a=4;KeyLines.WebGL.ArcShader=function(i){function o(e,t,n,r,a){v.uniform2f(p.resolution,t,n),v.uniformMatrix4fv(p.transform,!1,e.get()),v.uniform1f(p.hitTest,0|r),v.uniform1f(p.zoom,e.getZoomLevel()),v.uniform1f(p.shadowType,a)}function u(e){e.arcBuffers.positionBuffer||(e.arcBuffers.positionBuffer=v.createBuffer()),e.arcBuffers.colourBuffer||(e.arcBuffers.colourBuffer=v.createBuffer()),e.arcBuffers.shadowBuffer||(e.arcBuffers.shadowBuffer=v.createBuffer()),e.arcBuffers.coreBuffer||(e.arcBuffers.coreBuffer=v.createBuffer())}function s(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.colourData,v.STATIC_DRAW),v.enableVertexAttribArray(p.colour),v.vertexAttribPointer(p.colour,4,v.UNSIGNED_BYTE,!1,a,0)}function l(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.shadowData,v.STATIC_DRAW),v.enableVertexAttribArray(p.shadowColour),v.vertexAttribPointer(p.shadowColour,4,v.UNSIGNED_BYTE,!1,n,0)}function f(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.coreBuffer),(e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.coreData,v.STATIC_DRAW),v.enableVertexAttribArray(p.type),v.enableVertexAttribArray(p.elementIndex),v.enableVertexAttribArray(p.numOfSegments),v.vertexAttribPointer(p.type,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(p.elementIndex,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,4),v.vertexAttribPointer(p.numOfSegments,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,8)}function c(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.positionBuffer),(e.rebuildOptions.positions||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.positionData,v.STATIC_DRAW),v.enableVertexAttribArray(p.position),v.enableVertexAttribArray(p.radius),v.enableVertexAttribArray(p.startAngle),v.enableVertexAttribArray(p.endAngle),v.enableVertexAttribArray(p.width),v.vertexAttribPointer(p.position,2,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(p.radius,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,8),v.vertexAttribPointer(p.startAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,12),v.vertexAttribPointer(p.endAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,16),v.vertexAttribPointer(p.width,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,20)}function g(){v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null)}var d=KeyLines.WebGL.Utils,h={},v=i,m=e["line-arc-vertex"],x=e["line-fragment"],y=d.createProgram(v,atob(m),atob(x)),p={hitTest:v.getUniformLocation(y,"u_hitTest"),zoom:v.getUniformLocation(y,"u_zoom"),transform:v.getUniformLocation(y,"u_transform"),resolution:v.getUniformLocation(y,"u_resolution"),shadowType:v.getUniformLocation(y,"u_shadowType"),position:v.getAttribLocation(y,"a_position"),radius:v.getAttribLocation(y,"a_radius"),startAngle:v.getAttribLocation(y,"a_startAngle"),endAngle:v.getAttribLocation(y,"a_endAngle"),width:v.getAttribLocation(y,"a_width"),colour:v.getAttribLocation(y,"a_colour"),elementIndex:v.getAttribLocation(y,"a_index"),numOfSegments:v.getAttribLocation(y,"a_numOfSegments"),type:v.getAttribLocation(y,"a_lineType"),shadowColour:v.getAttribLocation(y,"a_hitTestColour")};return h.drawItems=function(e,t,n,r,a){v.useProgram(y),o(t,n,r,a,0|e.shadowType),u(e),s(e),l(e),c(e),f(e),v.drawArrays(v.TRIANGLES,0,e.arcBuffers.totalNumOfVerticies),g()},h}}}(),function(){var e=KeyLines.DateTime={},t=e.defaultLocale={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},n=[31,28,31,30,31,30,31,31,30,31,30,31],r=e.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},a=function(e,t){return t?e-e%t:0},i=function(e){if(e<r.milli||r.year<e)throw new Error("bad unit range")},o=function(e,t){return 1===e&&u(t)?29:n[e]},u=function(e){return 1===new Date(e,1,29).getMonth()};e.UTCify=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e.unUTCify=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())};var s=(e.clear=function(e,t,n){i(t);var o=new Date(e);switch(t>r.milli&&o.setUTCMilliseconds(0),t>r.sec&&o.setUTCSeconds(0),t>r.min&&o.setUTCMinutes(0),t>r.hour&&o.setUTCHours(0),t>=r.month&&o.setUTCDate(1),t>=r.year&&o.setUTCMonth(0),t){case r.milli:o.setUTCMilliseconds(a(o.getUTCMilliseconds(),n));break;case r.sec:o.setUTCSeconds(a(o.getUTCSeconds(),n));break;case r.min:o.setUTCMinutes(a(o.getUTCMinutes(),n));break;case r.hour:o.setUTCHours(a(o.getUTCHours(),n));break;case r.day:break;case r.week:var u=o.getUTCDay(),s=u>=1?u-1:6;o.setTime(o.getTime()-24*s*60*60*1e3);break;case r.month:o.setUTCMonth(a(o.getUTCMonth(),n));break;case r.year:o.setUTCFullYear(a(o.getUTCFullYear(),n))}return o.getTime()},e.add=function(e,t,n){if(i(t),t<=r.week){var a=n;return t>r.milli&&(a*=1e3),t>r.sec&&(a*=60),t>r.min&&(a*=60),t>r.hour&&(a*=24),t>r.day&&(a*=7),e+a}var l=new Date(e);switch(t){case r.month:var f=l.getUTCMonth()+n,c=f%12,g=Math.floor(f/12);0>c&&(c+=12);var d=l.getUTCDate();d=Math.min(d,o(c,l.getUTCFullYear()+g)),l.setUTCDate(d),l.setUTCMonth(c),0!==g&&l.setTime(s(l.getTime(),r.year,g));break;case r.year:if(1===l.getUTCMonth()&&29===l.getUTCDate()){var h=l.getUTCFullYear()+n;u(h)||l.setTime(s(l.getTime(),r.day,-1))}l.setUTCFullYear(l.getUTCFullYear()+n)}return l.getTime()}),l=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},f=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),c={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return l(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return l(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){return l(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return l(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return l(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return l(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return l(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return l(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return l(e.getUTCFullYear()%100)}},g=(e.format=function(e,n,r){return"number"==typeof e&&(e=new Date(e)),r=r||t,n.replace(f,function(t){return c[t](e,r)})},"(?::)?"),d="(?:-|$)",h="(?:T|$)",v=function(e,t){return e[t]?parseInt(e[t],10):void 0},m=function(e,t,n,r){var a=v(e,t);return x(a)?a>=n&&r>=a?a:void 0:n},x=function(e){return"undefined"!=typeof e},y=new RegExp("^(\\d{4})"+d+"(\\d{2})?"+d+"(\\d{2})?"+h+"(\\d{2})?"+g+"(\\d{2})?"+g+"(\\d{2})?(?:Z)?(\\+|-)?(\\d{2})?"+g+"(\\d{2})?");e.parseISO8601=function(e){var t=y.exec(e);if(t){var n=v(t,1),r=m(t,2,1,12),a=m(t,3,1,31),i=m(t,4,0,23),u=m(t,5,0,59),s=m(t,6,0,59),l="-"===t[7]?-1:1,f=m(t,8,0,12),c=m(t,9,0,59);if(!(x(n)&&x(r)&&x(a)&&x(i)&&x(u)&&x(s)&&x(f)&&x(c)))return;if(a>o(r-1,n))return;var g=l*(60*f+c)*60*1e3;return new Date(Date.UTC(n,r-1,a,i,u,s)-g)}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=[0,1,0,1],n=[0,0,2,2];e.generateLine=function(e,r,a,i,o,u,s,l,f,c,g,d,h){if(g||d.all||d.positions||d.colours||d.textures||d.shadow){s=s||[0,0,0,0],c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+3,c.elementMappingIndex+=4;var v=0;h&&(r+=h.x,a+=h.y,i+=h.x,o+=h.y);for(var m=0;4>m;m++)c.elementData[c.elementDataIndex++]=r,c.elementData[c.elementDataIndex++]=a,c.elementData[c.elementDataIndex++]=i,c.elementData[c.elementDataIndex++]=o,c.elementData[c.elementDataIndex++]=f,v=c.elementDataIndex*Float32Array.BYTES_PER_ELEMENT,c.elementIntegerData[v]=t[m],c.elementIntegerData[v+1]=n[m],c.elementIntegerData[v+2]=0,c.elementIntegerData[v+3]=l,c.elementIntegerData[v+4]=u[0],c.elementIntegerData[v+5]=u[1],c.elementIntegerData[v+6]=u[2],c.elementIntegerData[v+7]=u[3],c.elementIntegerData[v+8]=s[0],c.elementIntegerData[v+9]=s[1],c.elementIntegerData[v+10]=s[2],c.elementIntegerData[v+11]=s[3],c.elementDataIndex+=3}}}}();;

