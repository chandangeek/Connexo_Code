//
//     KeyLines v3.3.1-2702 professional eval
//     Licensed to Honeywell for Connexo expires on Tue Jan 10 2017
//
//     Copyright Â© 2011-2016 Cambridge Intelligence Limited.
//     All rights reserved.
//
/* @flow weak */
!function(){var e={},t="undefined"!=typeof window;t&&(window.KeyLines=e="undefined"!=typeof window.KeyLines?window.KeyLines:e),e.TimeBar={},"object"==typeof module&&"object"==typeof module.exports?(global.KeyLines=e,module.exports=e):"function"==typeof define&&define.amd&&define(e),e.webGLSupport=function(){if(!e.WebGL&&t){var n,r=["OES_standard_derivatives","OES_element_index_uint"],i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=document.createElement("canvas"),o=null;for(n=0;n<i.length;++n){try{o=a.getContext(i[n])}catch(u){}if(o)break}var s=o&&"getSupportedExtensions"in o;if(s){var l=o.getSupportedExtensions(),f={};for(n=0;n<l.length;n++)f[l[n]]=!0;for(n=0;s&&n<r.length;n++)s=f[r[n]]}return s}return!0},e.webGLSupport()&&(e.WebGL={})}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.create=function(t){var n={},r={bidi:KeyLines.Bidi,canvas:t,layersToDraw:[],textAtlas:null,fontIconAtlas:null,imageAtlases:[],allLayers:{},framebuffers:{}},i=e.Generator(r),a=e.Renderer(r);return n.clearView=function(e){a.clearView(e)},n.clearFramebuffers=function(){a.clearFramebuffers()},n.updateTextures=function(t){a.clearTextureAtlas(r.imageAtlases),r.imageAtlases=e.ImageAtlas(t)},n.build=function(e,t,n,r){i.generate(e,t,n,r,a)},n.draw=function(e,t){var n=0,i=0,o=1;e&&(n=e.offsetXtoWebglPanX(),i=e.offsetYtoWebglPanY(),o=e.settings().zoom),a.render(n,i,o,r.textAtlas,r.fontIconAtlas,r.imageAtlases,t)},n.drawShadowCanvas=function(e,t){return a.drawShadowCanvas(e,t)},n},e.getNumOfSegments=function(e,t){return 0|Math.max(16,Math.min(64,(t-e)/(2*Math.PI)*64))})}(),function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.createAPI=function(){var e=KeyLines.Common,t=KeyLines.Util,n={},r=KeyLines.Events.createEventBus(),i=KeyLines.TimeBar.Config.create(),a=KeyLines.TimeBar.Model.createModel(r,i),o=KeyLines.TimeBar.Generator.create(),u=KeyLines.TimeBar.Controller.createController(r,a,o,i);n.clear=function(){return u.load({items:[]})},n.getIds=function(e,t){return a.getIds(e,t)},n.load=function(e,t){if(e&&e.items)return u.load(e,t);throw Error("Unknown data format passed")},n.options=function(e,t){return u.options(e,t)},n.pan=function(e,t,n){return u.pan(e,t,n)},n.pause=function(){return u.pause()},n.play=function(e){return u.play(e)},n.range=function(e,t,n,r){return 0!==arguments.length?u.range(e,t,n,r):u.range()},n.merge=function(e,n){return e=t.ensureArray(t.getItemsArray(e)),u.merge(e,n)},n.selection=function(e){return a.selection(e)},n.zoom=function(e,n,r){return e=e||"in",n=t.defaults(n,{animate:!0,time:200}),u.zoom(e,n,r)},n.privateInit=u.privateInit,n.privateSetSize=u.privateSetSize,n.getIdcounts=a.getIdcounts,e.appendActions(n,u),t.merge(n,r);var s=KeyLines.Common.frameManager(u.draw,u.animate);return t.merge(n,s),n.bind("redraw",s.redraw),n.getItems=a.getItems,n}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=[0,1,0,1],n=[0,0,2,2];e.generateLine=function(e,r,i,a,o,u,s,l,f,c,d,g,h){if(d||g.all||g.positions||g.colours||g.textures||g.shadow){s=s||[0,0,0,0],c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+2,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+1,c.elementIndex[c.elementIndexIndex++]=c.elementMappingIndex+3,c.elementMappingIndex+=4;var v=0;h&&(r+=h.x,i+=h.y,a+=h.x,o+=h.y);for(var m=0;4>m;m++)c.elementData[c.elementDataIndex++]=r,c.elementData[c.elementDataIndex++]=i,c.elementData[c.elementDataIndex++]=a,c.elementData[c.elementDataIndex++]=o,c.elementData[c.elementDataIndex++]=f,v=c.elementDataIndex*Float32Array.BYTES_PER_ELEMENT,c.elementIntegerData[v]=t[m],c.elementIntegerData[v+1]=n[m],c.elementIntegerData[v+2]=0,c.elementIntegerData[v+3]=l,c.elementIntegerData[v+4]=u[0],c.elementIntegerData[v+5]=u[1],c.elementIntegerData[v+6]=u[2],c.elementIntegerData[v+7]=u[3],c.elementIntegerData[v+8]=s[0],c.elementIntegerData[v+9]=s[1],c.elementIntegerData[v+10]=s[2],c.elementIntegerData[v+11]=s[3],c.elementDataIndex+=3}}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=6,n=function(e,n,r,i,a,o,u){for(var s=0;u>s;s++)for(var l=0;t>l;l++)e[n.shadowIndex++]=r,e[n.shadowIndex++]=i,e[n.shadowIndex++]=a,e[n.shadowIndex++]=o},r=function(e,t,n,r){for(var i=0;r>i;i++)e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=-r,e[t.coreIndex++]=n,e[t.coreIndex++]=i,e[t.coreIndex++]=-r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=r,e[t.coreIndex++]=n,e[t.coreIndex++]=-(i+1),e[t.coreIndex++]=-r},i=function(e,n,r,i,a,o,u,s,l,f){var c=r,d=i;l&&(c=r+l.x,d=i+l.y);for(var g=0;f>g;g++)for(var h=0;t>h;h++)e[n.positionIndex++]=c,e[n.positionIndex++]=d,e[n.positionIndex++]=a,e[n.positionIndex++]=o,e[n.positionIndex++]=u,e[n.positionIndex++]=s},a=function(e,n,r,i,a,o,u){for(var s=0;u>s;s++)for(var l=0;t>l;l++)e[n.colourIndex++]=r,e[n.colourIndex++]=i,e[n.colourIndex++]=a,e[n.colourIndex++]=o};KeyLines.WebGL.generateArc=function(t,o,u,s,l,f,c,d,g,h,v,m,x){var y=e.getNumOfSegments(l,f);d=d||[0,0,0,0],(v.shadow||m||v.all)&&n(t.shadowData,t,d[0],d[1],d[2],d[3],y),(v.positions||m||v.all)&&i(t.positionData,t,o,u,s,l,f,g,x,y),(v.colours||m||v.all)&&a(t.colourData,t,c[0],c[1],c[2],c[3],y),r(t.coreData,t,h,y)}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.TriangleShader=function(t){function n(e,t,n){for(var r=0,i=e.atlases.length;i>r;r++)u(e.atlases[r],r);t&&u(t,3);for(var r=0,i=n.length;i>r;r++)u(n[r],r+4)}function r(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.shadowData,c.STATIC_DRAW),c.enableVertexAttribArray(m.shadowColour),c.vertexAttribPointer(m.shadowColour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function i(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.textureBuffer),(e.rebuildOptions.textures||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.textureData,c.STATIC_DRAW),c.enableVertexAttribArray(m.textCoord),c.enableVertexAttribArray(m.textureBank),c.enableVertexAttribArray(m.circleRadius),c.vertexAttribPointer(m.textCoord,4,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.textureBank,2,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(m.circleRadius,1,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,24)}function a(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.colourData,c.STATIC_DRAW),c.enableVertexAttribArray(m.colour),c.vertexAttribPointer(m.colour,4,c.UNSIGNED_BYTE,!1,4*Uint8Array.BYTES_PER_ELEMENT,0)}function o(e){c.bindBuffer(c.ARRAY_BUFFER,e.triangleBuffers.positionBuffer),(e.rebuildOptions.positions||e.rebuildOptions.all||e.alwaysUpdate)&&c.bufferData(c.ARRAY_BUFFER,e.triangleBuffers.positionData,c.STATIC_DRAW),c.enableVertexAttribArray(m.position),c.enableVertexAttribArray(m.width),c.vertexAttribPointer(m.position,2,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(m.width,1,c.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8)}function u(e,t){if(c.activeTexture(c["TEXTURE"+t]),e.texture)c.bindTexture(c.TEXTURE_2D,e.texture);else{e.texture=c.createTexture();var n=e.alphaChannel?c.RGBA:c.RGB;c.bindTexture(c.TEXTURE_2D,e.texture),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(c.TEXTURE_2D,0,n,n,c.UNSIGNED_BYTE,e.img),c.generateMipmap(c.TEXTURE_2D),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e.img=null}}function s(e){e.triangleBuffers.positionBuffer||(e.triangleBuffers.positionBuffer=c.createBuffer()),e.triangleBuffers.textureBuffer||(e.triangleBuffers.textureBuffer=c.createBuffer()),e.triangleBuffers.colourBuffer||(e.triangleBuffers.colourBuffer=c.createBuffer()),e.triangleBuffers.shadowBuffer||(e.triangleBuffers.shadowBuffer=c.createBuffer())}function l(e,t,n,r,i){c.uniform2f(m.resolution,t,n),c.uniform1f(m.hitTest,0|r),c.uniform1iv(m.textures,[0,1,2,3,4,5,6,7]),c.uniformMatrix4fv(m.transform,!1,e.get()),c.uniform1f(m.shadowType,i),c.uniform1f(m.zoom,e.getZoomLevel())}var f={},c=t,d=e.Utils,g=e["triangle-vertex"],h=e["triangle-fragment"],v=(c.getExtension("OES_standard_derivatives"),d.createProgram(c,atob(g),atob(h))),m={transform:c.getUniformLocation(v,"u_transform"),textures:c.getUniformLocation(v,"u_image[0]"),resolution:c.getUniformLocation(v,"u_resolution"),hitTest:c.getUniformLocation(v,"u_hitTest"),shadowType:c.getUniformLocation(v,"u_shadowType"),zoom:c.getUniformLocation(v,"u_zoom"),position:c.getAttribLocation(v,"a_position"),circleRadius:c.getAttribLocation(v,"a_circleRadius"),width:c.getAttribLocation(v,"a_width"),colour:c.getAttribLocation(v,"a_colour"),textCoord:c.getAttribLocation(v,"a_texCoord"),shadowColour:c.getAttribLocation(v,"a_hitTestColour"),textureBank:c.getAttribLocation(v,"a_textureBank")};f.drawItems=function(e,t,u,f,d,g,h,m){c.useProgram(v),l(t,g,h,m,0|e.shadowType),s(e),r(e),i(e),a(e),o(e),n(u,f,d),c.drawArrays(c.TRIANGLES,0,3*e.triangleBuffers.numOfTriangles)};return f})}(),function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.appendExtras=function(e){var t,n=KeyLines.Util;e.bind("change",function(){t=null}),e.bind("datachange",function(){t=null}),e.inRange=function(r){if(n.isNullOrUndefined(r))return!1;t=t||e.getIdcounts();var i=(n.isNormalObject(r)?r.id:r)+"";return!!t[i]}}}(),function(){var e=KeyLines.TimeBar.Config={};e.create=function(){function e(e,t){return c.format(e,t,x.options.locale)}function t(t,n){var r=new Date(c.add(t,h.year,n-1));return e(t,"yyyy - ")+e(r,"yyyy")}function n(e){return t(e,10)}function r(e){return t(e,50)}function i(t){return e(t,"yyyy")+"s"}function a(t){var n="dmy"===x.options.locale.order?"d MMM yyyy":"MMM d, yyyy";return e(t,n)}function o(t){var n=x.options.locale.h12?"h:mm tt":"HH:mm";return e(t,n)}function u(t){var n=x.options.locale.h12?"h:mm:ss tt":"HH:mm:ss";return e(t,n)}function s(e,t){if("histogram"===e){if(!d.isNormalObject(t))return!1;if(t.colour&&!g.validatergb(t.colour))return!1;if(t.highlightColour&&!g.validatergb(t.highlightColour))return!1}return"minScale"===e?t:d.contains(m.colours,e)?g.validatergb(t):!0}function l(e,t){"fontFamily"===e&&(x.options.fontFamily=g.pickFirstFamily(t)||v.fontFamily),"fontSize"===e&&d.isNumber(+t)&&+t>0&&(x.options.fontSize=+t)}function f(e){e.showPlay?x.playingExtend=!1:e.showExtend?x.playingExtend=!1:x.playingExtend=null}var c=KeyLines.DateTime,d=KeyLines.Util,g=KeyLines.Rendering,h=c.units,v={fontFamily:"sans-serif",fontSize:12},m={colours:["backColour","fontColour","sliderColour","sliderLineColour"]},x={displayTime:function(t,n){return d.isFunction(n)?n(t):e(t,n)},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:g.colours.grey,fontFamily:v.fontFamily,fontSize:v.fontSize,showControlBar:!0,showPlay:!0,showExtend:!1,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",minRange:3e3,minScale:{units:"sec",value:1},showSliders:!0,showShadowCanvas:!1,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9"},heightChange:{animate:!0,time:200},locale:d.defaults(c.defaultLocale,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return d.clone(x.options)},setOptions:function(e){if(d.isNormalObject(e)){f(e);for(var t in e)x.options.hasOwnProperty(t)&&(v[t]?l(t,e[t]):d.isNormalObject(x.options[t])&&s(t,e[t])?x.options[t]=d.defaults(e[t],x.options[t]):x.options[t]=e[t])}},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,playingExtend:!1,defaultPlaySpeed:60,bars:{defaultFontFamily:v.fontFamily,defaultFontSize:v.fontSize,major:{height:19,textbase:3,tickHeight:10},minor:{height:17,textbase:0,tickHeight:8}},grip:{lines:2,space:4,length:14,margin:2},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:6,major:{units:h.sec,by:2,f:a},minor:{units:h.sec,by:1,f:u}},{max:15,major:{units:h.sec,by:5,f:a},minor:{units:h.sec,by:1,f:u}},{max:24,major:{units:h.sec,by:10,f:a},minor:{units:h.sec,by:2,f:u}},{max:60,major:{units:h.sec,by:15,f:a},minor:{units:h.sec,by:5,f:u}},{max:120,major:{units:h.sec,by:30,f:a},minor:{units:h.sec,by:10,f:u}},{max:360,major:{units:h.min,by:1,f:a},minor:{units:h.sec,by:30,f:u}},{max:1e3,major:{units:h.min,by:5,f:a},minor:{units:h.min,by:1,f:o}},{max:5e3,major:{units:h.min,by:15,f:a},minor:{units:h.min,by:5,f:o}},{max:15e3,major:{units:h.hour,by:1,f:a},minor:{units:h.min,by:15,f:o}},{max:6e4,major:{units:h.hour,by:6,f:a},minor:{units:h.hour,by:1,f:o}},{max:12e4,major:{units:h.day,by:1,f:a,adjust:432e5},minor:{units:h.hour,by:2,f:o}},{max:18e4,major:{units:h.day,by:1,f:a,adjust:432e5},minor:{units:h.hour,by:3,f:o}},{max:36e4,major:{units:h.day,by:1,f:a},minor:{units:h.hour,by:6,f:o}},{max:72e4,major:{units:h.day,by:1,f:a},minor:{units:h.hour,by:12,f:"ttt"}},{max:5e6,major:{units:h.week,by:1,f:function(t){var n,r,i=new Date(t),a=new Date(c.add(t,h.day,6)),o="dmy"===x.options.locale.order;return i.getUTCFullYear()===a.getUTCFullYear()?i.getUTCMonth()===a.getUTCMonth()?(n=o?"d - ":"MMM d - ",r=o?"d MMM yyyy":"d, yyyy"):(n=o?"d MMM - ":"MMM d - ",r=o?"d MMM yyyy":"MMM d, yyyy"):(n=o?"d MMM yyyy - ":"MMM d, yyyy - ",r=o?"d MMM yyyy":"MMM d, yyyy"),e(i,n)+e(a,r)}},minor:{units:h.day,by:1,f:"d"}},{max:15e6,major:{units:h.month,by:1,f:"MMMM yyyy"},minor:{units:h.week,by:1,f:function(t){var n=c.add(t,h.day,6);return e(t,"d - ")+e(n,"d")}}},{max:3e7,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMMM"}},{max:75e6,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMM"}},{max:1e8,major:{units:h.month,by:3,f:"Q  yyyy"},minor:{units:h.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:h.month,by:6,f:"QQ  yyyy"},minor:{units:h.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:h.year,by:1,f:"yyyy"},minor:{units:h.month,by:3,f:"Q"}},{max:6e8,major:{units:h.year,by:1,f:"yyyy"},minor:{units:h.month,by:6,f:"QQ"}},{max:15e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:1,f:"'yy"}},{max:25e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:2,f:"'yy"}},{max:35e8,major:{units:h.year,by:10,f:n},minor:{units:h.year,by:5,f:"'yy"}},{max:115e8,major:{units:h.year,by:50,f:r},minor:{units:h.year,by:10,f:"'yy"}},{max:2e10,major:{units:h.year,by:50,f:r},minor:{units:h.year,by:25,f:"'yy"}},{max:35e9,major:{units:h.year,by:100,f:i},minor:{units:h.year,by:25,f:"'yy"}},{max:8e10,major:{units:h.year,by:100,f:i},minor:{units:h.year,by:50,f:"'yy"}},{max:16e10,major:{units:h.year,by:200,f:"yyyy"},minor:{units:h.year,by:100,f:""}},{max:4e11,major:{units:h.year,by:500,f:"yyyy"},minor:{units:h.year,by:100,f:""}},{max:1/0,major:{units:h.year,by:500,f:""},minor:{units:h.year,by:100,f:""}}]};return x}}(),function(){var e=KeyLines.Model={};e.createModel=function(e,t,n){function r(){N=K=null}function i(e){for(var t in oe)c(oe[t],e);for(t in ae)c(ae[t],e)}function a(e,t){switch(e){case"x1":return ae[t.id1].x;case"y1":return ae[t.id1].y;case"x2":return ae[t.id2].x;case"y2":return ae[t.id2].y}}function o(e){fe=!1,le=e||{},ce=0}function u(e){le[e]||(ce++,le[e]=ue)}function s(){return fe?!0:_.hasAnyKeys(le)}function l(){function e(e){var n=_.clone(e,!0);n.id=_.rawId(e.id),t.push(n)}var t=[];return _.iterator(oe,e),_.iterator(ae,e),t}function f(e){for(var t in e)_.isNullOrUndefined(e[t])&&delete e[t]}function c(e,t){e[t]&&Ge(e.id)}function d(e,t,n){for(var r="x"===t||"y"===t?u:ve,i=0;i<e.length;i++){var a=e[i],o=ae[a];if(o)o[t]=n,r(a);else{var s=oe[a];s&&(s[t]=n,ve(a))}}}function g(e,t){var n=!1;return ae[e]&&(n=v(ae[e],t)),oe[e]&&(n=v(oe[e],t)),n}function h(e){return(ae[e]||oe[e])&&!(g(e,"hi")||g(e,"gh"))}function v(e,t){return!!e[t]}function m(e,t,n){e=_.ensureArray(e),d(e,t,!1);var r;if(me.ensureConsistency(t,!1,ae,oe),n){var i={};for(r=0;r<e.length;r++)i[e[r]]=1;for(r in oe)v(oe[r],t)&&(v(ae[oe[r].id1],t)||v(ae[oe[r].id2],t)||(i[oe[r].id1]||i[oe[r].id2])&&(oe[r][t]=!1))}}function x(e){var t,n=[];for(t in ae)t=_.rawId(t),ae[t][e]&&n.push(t);for(t in oe)t=_.rawId(t),oe[t][e]&&n.push(t);return n}function y(e,t){e=_.ensureArray(e),d(e,t,!0),me.ensureConsistency(t,!1,ae,oe)}function p(e){var t={};for(var n in e)oe[n]&&"undefined"==typeof oe[n].off&&(t[n]=oe[n]);return t}function b(){var e=I(ae);return e=I(oe)||e}function I(e){var t=!1;for(var r in e){var i=e[r];if(t=w(i)||t,n.itemHasGlyph(i))for(var a=0;a<i.g.length;a++)t=w(i.g[a])||t;i.bu&&(t=w(i.bu.g)||t)}return t}function w(e){if(e){var t=e.u;if(t&&!(t in Ce))return Ce[t]=1,!0}}function B(e){var t={};for(var n in e){var r=e[n];r.hi||(t[n]=r)}return t}function C(){N||(N=B(ae),K=B(oe))}function A(){fe||(ce>100?M():xe().internalMarkLinks(le))}function M(){for(var e in K)if(!le[e]){var t=oe[e];(le[t.id1]||le[t.id2])&&(le[e]=se)}}function Z(e){for(var t in e)De(t,!0)}function D(t){var n=KeyLines.Graph.create(e);return n.privateSetProperties(ae,t),n}function G(){return xe().connections({all:!1,self:!0})}function L(e,t){var n=[],r={};if(_.hasAnyKeys(e)){var i=D(e).findAdjacency;n=G();for(var a=0;a<n.length;a++){var o=oe[n[a][0]];i({all:!0},o.id1,o.id2)&&(r[a]=1)}}t(n,r)}function R(e){for(var t={},n=0;n<e.length;n++){var r=e[n],i=oe[r];i&&(t[r]=i)}return t}function S(){k(G())}function T(){for(var e in oe){var t=oe[e];delete t.st}}function E(e,t,n,r){function i(e,t){return a(oe[e])-a(oe[t])}function a(e){var t=_.defined(e.off)?e.off:s;return e.id1>e.id2&&(t=-t),t}function o(e,t){r(e,e.id1<=e.id2?t:-t)}var u,s=1e6,l=t||e;_.iterator(l,function(t,r){if(u=e[+r],n||(u=u.filter(function(e){return!oe[e].gh})),u.length>0){u.sort(i);for(var a=oe[u[0]],s=a.id1===a.id2,l=u.length,f=s?20:40,c=s?0:-.5*f*(l-1),d=0;l>d;d++){var g=oe[u[d]];o(g,c+d*f)}}})}function k(e,t){function n(e,t){e.off=t,ve(e.id)}E(e,t,!0,n)}function F(e,t,n){function r(e,t){i.push({id:e.id,off:t})}var i=[];return E(e,t,n,r),i}function V(){for(var e=G(),t={},n=0;n<e.length;n++){var r=!1,i=e[n];if(i.length>1){for(var a=0;a<i.length;a++){var o=oe[i[a]];o&&(r=r||_.defined(o.off))}r||(t[n]=1)}}k(e,t)}function W(e){return(e+"").match(ke)}function U(e){var t=W(e);return Fe[t[2]]}function O(e){var t=W(e);return t?t[1]:null}var N,K,H,X,Y,z=KeyLines.Common,P=KeyLines.Rendering,_=KeyLines.Util,j={x:1,y:1,w:1,h:1,e:1,fs:1,off:1,b1:1,b2:1,bw:1},J={t:1,u:1,id:1,id1:1,id2:1,ff:1,sh:1,p:1,ls:1,bs:1},Q={c:1,b:1,fc:1,fbc:1},q={hi:1,bg:1,ci:1,du:1,fb:1,a1:1,a2:1,re:1,tc:1,a:1},$={gh:1},ee={pos:1},te={x:1,y:1,off:1,lat:1,lng:1},ne={ls:{solid:!0,dashed:!0,dotted:!0},bs:{solid:!0,dashed:!0}},re=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"],ie={},ae={},oe={},ue=1,se=2,le={},fe=!1,ce=0,de=_.idSep(),ge=null,he=KeyLines.Layouts.create(),ve=ie.setDirty=function(e){le[e]||ce++,le[e]=se},me=KeyLines.Validation.create({numbers:j,negatives:te,strings:J,stringValues:ne,colours:Q,booleans:q,reserved:$,mapPos:ee,halos:re},ve,r,i),xe=ie.graph=function(){return ge||(ge=KeyLines.Graph.create(e),ge.privateSetProperties(ae,oe)),ge},ye=ie.setAllDirty=function(){fe=!0},pe=ie.moveNode=function(e,t,n){var r=ae[e];r&&(r.x=t,r.y=n,u(e))};ie.moveLink=function(e,t){var n=oe[e];n&&(n.y=t,ve(e))},ie.setLinkOffset=function(e,t){var n=oe[e];n&&(n.off=t,ve(e))},ie.ensureObject=me.ensureObject,ie.ensureTypesInArray=me.ensureTypesInArray,ie.load=function(e){if(e){ae={},oe={},Re(!0),e=_.clone(e),me.typeCheck(e,oe);var t=me.filterNodesAndLinks(e.items,ae,{selfLinks:X});oe=t.links,ae=t.nodes,me.ensureHiddenItemConsistency(ae,oe),ge=null,V(),ye()}b()},ie.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return n.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"c":case"b":return P.colours.midgrey;case"fc":return P.colours.black;case"fbc":return P.colours.textback}},ie.bothEndsShown=function(e){return!(ae[e.id1].hi||ae[e.id2].hi)},ie.ensureBackgroundConsistency=function(){me.ensureConsistency("bg",!0,ae,oe)},ie.resurrect=function(e,t){m(e,"gh",t)},ie.ghost=function(e){y(e,"gh")},ie.show=function(e,t){m(e,"hi",t),Ae()},ie.hidden=function(){return x("hi")},ie.hide=function(e){y(e,"hi"),Ae()},ie.each=function(e,t){if(e.type.match(/^(node|all)$/))for(var n in ae)t(ae[n]);if(e.type.match(/^(link|all)$/))for(var r in oe)t(oe[r])},ie.setItem=function(e){e=_.clone(e),me.ensureObject(e,!1,oe);var t=null;return"node"===e.type&&(t=ae),"link"!==e.type||(t=oe,me.hasValidEnds(e,{},ae,X))?(me.setZeroXY(e),e.id&&(t[e.id]=e,e.hi?me.ensureHiddenItemConsistency(ae,oe):r(),Ae(),ve(e.id)),b()):!1};var be=ie.type=function(){return"LinkChart"};ie.setOptions=function(e){X=e.selfLinks,Y=e.marqueeLinkSelection,t.setOptions(e),n.setOptions(e),ye()};var Ie;ie.setLastHoverId=function(e){Ie=e},ie.showFullLabelOnHover=function(e){Ie&&ve(Ie),e?(ve(e),n.setSpecialOptions("showFullLabel",e)):n.setSpecialOptions("showFullLabel",null)},ie.serialize=function(){return{type:be(),items:l()}};var we=ie.applyChanges=function(e,t){var n,r,i,a,o,s,l;for(n=0;n<e.length;n++){if(r=_.rawId(e[n].id))if(s=[],t){l=new RegExp(r,"im");for(i in ae)l.test(i)&&s.push(ae[i]);for(a in oe)l.test(a)&&s.push(oe[a])}else ae[r]&&s.push(ae[r]),oe[r]&&s.push(oe[r]);var c=_.clone(e[n]);for(delete c.id,delete c.type,o=0;o<s.length;o++){var d=!0,g=s[o],h=c.id1||g.id1,v=c.id2||g.id2,m=h===v;for(var x in c)switch(x){case"x":case"y":g[x]=c[x];break;case"id1":if(!ae[c.id1])throw Error("Unexisting node id '"+c.id1+"' for link property id1");case"id2":if(m)break;if(!ae[c.id2])throw Error("Unexisting node id '"+c.id2+"' for link property id2");default:g[x]=c[x],d=!1}f(g),d?u(g.id):ve(g.id)}}};ie.unsafeApplyChanges=function(e){var t,n,r,i;for(t=0;t<e.length;t++)for(n=_.rawId(e[t].id),n&&(i=[],ae[n]&&i.push(ae[n]),oe[n]&&i.push(oe[n])),r=0;r<i.length;r++){var a=!0,o=i[r];_.merge(o,e[t]);for(var s in e[t])"id"!==s&&"x"!==s&&"y"!==s&&(a=!1);f(o),a?u(o.id):ve(o.id)}},ie.setProperties=function(e,t){e=_.clone(e),e=_.ensureArray(e),me.ensureTypesInArray(e,!1,oe),we(e,t),me.ensureHiddenItemConsistency(ae,oe),Ae();var n=b();return n},ie.merge=function(e){e=_.clone(e),me.ensureTypesInArray(e,!1,oe);var t={carefulWithXandY:!0,selfLinks:X},n=me.filterNodesAndLinks(e,ae,t);for(var r in n.nodes)ae[r]=_.merge(ae[r],n.nodes[r]),ve(r);for(var i in n.links)oe[i]=_.merge(oe[i],n.links[i]),ve(i);Ae();var a=p(n.links);Te(a),me.ensureHiddenItemConsistency(ae,oe);var o=b();return o},ie.getItem=function(e){var t=Be(e);return _.clone(t,!0)};var Be=ie.getByID=function(e){return e=_.rawId(e),ae[e]||oe[e]},Ce={};ie.imageList=function(e){var t={updated:!1,_coList:{}};for(var n in Ce)t[e+n]=1;return t};var Ae=ie.clearGraphCache=function(){ge&&ge.clearCache()};ie.generate=function(e,t,r,i,a){var u=r.getUnzoom();if(u!==H&&ye(),s()){C(),A();var l=n.generate(N,K,fe,le,e,t,r,i,a,Le);o(l),H=u}return n.generateHandles(e,t,r,Ze),n.animated()},ie.contains=function(e){return n.contains(e,ae)},ie.animated=function(){return n.animated()};var Me={},Ze=[];ie.setSelection=function(e,t,n){e=_.rawId(e),t||n||Re(e),Me[e]?t&&Ge(e):De(e)};var De=ie.addToSelection=function(t,n){t=_.rawId(t),t&&(Me[t]||h(t)&&(Me[t]=1,Ze.push(t),ve(t),n||e.trigger("selectionchange")))},Ge=ie.removeFromSelection=function(t,n){if(t=_.rawId(t),Me[t]){ve(t),delete Me[t];var r=Ze.indexOf(t);r>-1&&Ze.splice(r,1),n||e.trigger("selectionchange")}};ie.hasSelection=function(){return Ze.length>0};var Le=ie.isSelected=function(e){return e=_.rawId(e),e in Me},Re=ie.clearSelection=function(t){for(var n=0;n<Ze.length;n++)ve(Ze[n]);Me={},Ze=[],t||e.trigger("selectionchange")};ie.selectAll=function(){Z(ae),Z(oe),e.trigger("selectionchange")};var Se=ie.doSelection=function(e){if(e){Re(!0);for(var t=0;t<e.length;t++)De(e[t],!0)}return _.clone(Ze)};ie.privateSelection=function(){return Me},ie.moveSelection=function(e,t){var n=[];if(Me){for(var r in ae)Le(r)&&n.push(r);for(var i in oe)Le(i)&&(ae[oe[i].id1].du&&n.push(oe[i].id1),ae[oe[i].id2].du&&n.push(oe[i].id2))}for(var a=0;a<n.length;a++){var o=ae[n[a]];o.x+=e,o.y+=t,u(o.id)}},ie.removeItem=function(e){var t;e=_.ensureArray(e);for(var n={},i={},a=0;a<e.length;a++)t=e[a],oe[t]&&(n[t]=oe[t]),ae[t]&&(i[t]=1);for(t in oe)(i[oe[t].id1]||i[oe[t].id2])&&(n[t]=oe[t]);for(t in n)Ge(t,!0),ve(t),delete oe[t];for(t in i)Ge(t,!0),ve(t),delete ae[t];Ae(),Te(n),r()},ie.selectionPlusDummyNodes=function(){for(var e=Se(),t=0;t<e.length;t++){var n=oe[e[t]];n&&(ae[n.id1].du&&e.push(n.id1),ae[n.id2].du&&e.push(n.id2))}return e};var Te=ie.resetConnectionOffsets=function(e){L(e,k)},Ee=function(e,t){var n;return L(e,function(e,r){n=F(e,r,t)}),n};ie.showHideBendLinks=function(e){var t=R(e);Te(t)},ie.showHideGetLinksToBend=function(e,t){for(var n=R(e),r=Ee(n,t),i=[],a=0;a<r.length;a++){var o=r[a];oe[o.id].off!==o.off&&i.push(o)}return i},ie.getCursor=function(e,t){var n=O(e);return n?n:e?'url("'+t+'openhand.cur"), pointer':"auto"},ie.getResizePrimitive=function(){return n.getResizePrimitive()};var ke=new RegExp(de+"((\\S+)(?:\\-resize))$"),Fe={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},Ve=new RegExp(de+"(id[1|2])$");ie.startDragger=function(e,n,r,i,a,o){var u=(o+"").match(Ve),s=_.rawId(r);return t.createLinkEndDragger(e,ie,n,ae,oe[s],u[1],i,a,s)},ie.createDragger=function(n,r,i,o,u,s,l,f){var c=l.handMode,d=_.rawId(o),g=W(o);if(g){var h=U(o),v=f;return t.primitiveMover(P,r,i,d,v,!0,h,u,s,function(t){e.trigger("prechange","resize");var n=ae[_.rawId(o)],r=t.a,i=r?r.x:0,a=r?r.y:0;if("C"===t.p)n.x=i+t.x,n.y=a+t.y,n.w=n.h=2*t.r;else{var u=i+t.x1,s=a+t.y1,l=i+t.x2,f=a+t.y2;n.x=u+Math.floor((l-u)/2),n.y=s+Math.floor((f-s)/2),n.w=l-u,n.h=f-s}ve(n.id)})}if(null!==d&&oe[d]&&"h"!==oe[d].st){if(oe[d].id1===oe[d].id2)return null;var m=(o+"").match(Ve);return m?t.createLinkEndDragger(n,ie,i,ae,oe[d],m[1],u,s,d):t.createLinkDragger(a,r,i,ie,oe[d],u,s,d)}return c&&null===o?t.createHandDragger(i,u,s,Re):null!==d?(C(),t.createDefaultDragger(ie,N,K,Le,i,o,u,s)):We(i,u,s)};var We=function(t,n,r){function i(e,n){l.x1=Math.min(t.worldToViewX(f),e),l.y1=Math.min(t.worldToViewY(c),n),l.x2=Math.max(t.worldToViewX(f),e),l.y2=Math.max(t.worldToViewY(c),n),d.x1=t.viewToWorldX(l.x1),d.y1=t.viewToWorldY(l.y1),d.x2=t.viewToWorldX(l.x2),d.y2=t.viewToWorldY(l.y2)}function a(e,t,n){for(var r in e)e[r]?De(r,!0):t||n?u[r]||Ge(r,!0):Ge(r,!0)}function o(e,t,n,r){C(),i(e,t);var o={};for(var u in N)o[u]=P.inside(d,N[u].x,N[u].y);if("off"!==Y)for(var s in K)if("centre"===Y)o[s]=P.inside(d,K[s]._x,K[s]._y);else if("ends"===Y){var l=N[K[s].id1],f=N[K[s].id2];o[s]=P.inside(d,l.x,l.y)&&P.inside(d,f.x,f.y)}a(o,n,r)}if(!e.trigger("dragstart","area",null,t.unscale(n),t.unscale(r),null)){var u={};for(var s in Me)u[s]=1;var l={p:P.primitives.rect,x1:n,y1:r,x2:n,y2:r,bc:P.colours.midgrey,bw:1,fc:P.colours.blue,fi:!1},f=t.viewToWorldX(n),c=t.viewToWorldY(r),d={x1:f,y1:c,x2:f,y2:c};l.wbc=P.webglColour(l.bc),l.wfc=P.webglColour(l.fc);var g={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){var t=e.getLayer();e.setLayer(P.layers.HANDLES),e.copyPrimitive(l),e.setLayer(t)},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(n,r,i){t.cancelScroll();var a=e.trigger("dragend","area",null,t.unscale(r),t.unscale(i));a||(n?e.trigger("selectionchange"):Re()),e.trigger("dragcomplete","area",null,t.unscale(r),t.unscale(i))}};return g}};return ie.createGestureDragger=function(t,n,r){function i(e,n,r){var i=2*-e*Math.PI/360;i*=2;var a=Math.sin(i),o=Math.cos(i);for(var u in ae){var s=(d[u].x-f)*o+(d[u].y-c)*a+f,l=-(d[u].x-f)*a+(d[u].y-c)*o+c;pe(u,s,l)}var g=t.viewToWorldX(n),h=t.viewToWorldY(r);for(var v in ae)pe(v,ae[v].x+g-f,ae[v].y+h-c)}function a(e){e=Math.pow(e,2),t.zoomToPosition(e*l,n,r)}function o(e,t,n,r){h=e,v=t,m=n,x=r}function u(){a(h),y=y||Math.abs(v)>12,b=b||Math.abs(m-f)>p||Math.abs(x-c)>p,i(y?v:0,b?m:f,b?x:c)}function s(){for(var e in ae)pe(e,d[e].x,d[e].y)}var l=t.zoom(),f=t.viewToWorldX(n),c=t.viewToWorldY(r),d={};for(var g in ae)d[g]={x:ae[g].x,y:ae[g].y};var h,v,m,x;o(1,0,f,c);var y=!1,p=60,b=!1,I={animate:function(){u()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(t,n,r,i,a){o(n,r,i,a),t?(s(),e.trigger("prechange","move"),u()):s()}};return I},ie.labelPosition=function(e,t){var r=Be(e);return n.labelPosition(r,t)},ie.extractStructure=function(e,t,r){return t.straighten&&S(),T(),he.extractStructure(n,e,ae,oe,xe,t.fixed,r)},ie.layout=function(e,t,n,r,i,a){he.layout(e,t,n,xe,r,i,a)},ie.arrange=function(e,t,n,r,i,a){he.arrange(e,t,n,r,i,a)},ie.applyVertices=function(e){for(var t in ae)e[t]&&pe(t,e[t].x,e[t].y)},ie.makeAnimator=function(e,t,n){var r=t,i={};for(var a in ae)i[a]={x:ae[a].x,y:ae[a].y};return z.buildAnimatorInstance(function(a){r-=a;var o=n(Math.max(0,(t-r)/t));for(var u in ae)if(e[u]){var s=i[u].x+o*(e[u].x-i[u].x),l=i[u].y+o*(e[u].y-i[u].y);pe(u,s,l)}return r>0},{all:!0})},ie}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateRectangle=function(t,n,r,i,a,o,u,s,l,f){var c=t.wsc||[0,0,0,0];if(l=l||0,f=f||0,u.alwaysUpdate||u.rebuildOptions.all||u.rebuildOptions.shadow)for(var d=0;e>d;d++)u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[0],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[1],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[2],u.triangleBuffers.shadowData[u.triangleBuffers.shadowIndex++]=c[3];if(u.rebuildOptions.colours||u.alwaysUpdate||u.rebuildOptions.all)for(d=0;e>d;d++)u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[0],
u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[1],u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[2],u.triangleBuffers.colourData[u.triangleBuffers.colourIndex++]=o[3];if(u.rebuildOptions.positions||u.alwaysUpdate||u.rebuildOptions.all){var g=n,h=r,v=i,m=a;s&&(g=n+s.x,h=r+s.y,v=i+s.x,m=a+s.y),u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=g,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=g,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=g,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=h,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=v,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=m,u.triangleBuffers.positionData[u.triangleBuffers.positionIndex++]=l}(u.rebuildOptions.textures||u.alwaysUpdate||u.rebuildOptions.all)&&(u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=v-g,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=m-h,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-1,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=0,u.triangleBuffers.textureData[u.triangleBuffers.textureIndex++]=-l)}}}(),function(){var e=KeyLines.Combo={};e.create=function(e){function t(t,n){function r(e){t[e.id]&&i.push(e.id)}var i=[];return e.privateEach({type:n},r),i}function n(e){for(var t={},n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function r(e){var t=[];for(var n in e)n=Y.rawId(n),t.push(e[n]);return t}function i(e){return e+Math.floor(1e7*Math.random())}function a(e,t){var n=i(t);return e[n]?a(e):n}function o(e,t){return e.substring(0,t.length)===t}function u(e){return o(e,z)&&!!P[e]}function s(e){var t=[];if(u(e))for(var n=P[e].nodes,r=0;r<n.length;r++)u(n[r].id)?t=t.concat(s(n[r].id)):t.push(n[r]);return t}function l(e){var t=[];if(u(e))for(var n=P[e].nodes,r=0;r<n.length;r++)u(n[r].id)&&(t.push(n[r].id),t=t.concat(l(n[r].id)));return t}function f(e,t){var n=_[e.id];if("undefined"==typeof n)return 0;var r=P[n],i=+e[t]-r[t];return i+f(r,t)}function c(e,t,n){var r=a(P,z);return P[r]={id:r,nodes:e,x:t,y:n},r}function d(e){var t=P[e];return delete P[e],t}function g(){var e={};for(var t in P){t=Y.rawId(t);for(var n=0;n<P[t].nodes.length;n++)e[P[t].nodes[n].id]=t}return e}function h(){_=g()}function v(e){for(var t;e;)t=e,e=_[e];return t}function m(e){return e!==v(e)}function x(e){return o(e,j)}function y(){var t=i(j);return e.getItem(t)?y():t}function p(e,t,n){var r=v(e.id1),i=v(e.id2);return r===t&&i===n||r===n&&i===t}function b(t){if(x(t)){var n=e.getItem(t);if(n){var r=[];for(var i in J)i=Y.rawId(i),p(J[i],n.id1,n.id2)&&r.push(J[i]);return r}}return null}function I(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r].id]=1;for(var i in J){i=Y.rawId(i);var a=J[i];n[a.id1]&&n[a.id2]&&t.push(a)}return t}function w(t){function n(e,t,n){var r=t>e?e:t,i=e>t?e:t;c[r]||(c[r]={}),c[r][i]||(c[r][i]=[]),c[r][i].push(n)}function r(e){return e.some(function(e){return!e.hi})}function i(e){return!(o(e,z)&&!P[e])}function a(e){for(var t={},n=s(e),r=0;r<n.length;r++)t[n[r].id+""]=1;return t}function l(e,t,n,r){var i,o,s,l;u(t)?s=a(t):(s={},s[t+""]=1),u(n)?l=a(n):(l={},l[n+""]=1);for(var f=0;(!i||!o)&&f<r.length;f++){var c=r[f];i=i||c.a1&&c.id1 in s,i=i||c.a2&&c.id2 in s,o=o||c.a2&&c.id2 in l,o=o||c.a1&&c.id1 in l}e.a1=i,e.a2=o}var f={};e.privateEach({type:"node"},function(e){f[e.id]={}}),e.privateEach({type:"link"},function(e){f[e.id1][e.id2]=f[e.id2][e.id1]=!0});var c={};for(var d in J){d=Y.rawId(d);var g=J[d],h=v(g.id1),m=v(g.id2),x=i(h)&&i(m);x&&(t||h!==m)&&(f[h][m]||n(h,m,g))}var p=[];for(var b in c){b=Y.rawId(b);for(var I in c[b])if(I=Y.rawId(I),u(b)||u(I)){var w=c[b][I],B=Y.clone(w[0]);B.id1=b,B.id2=I,B.id=y(),B.hi&&r(w)&&delete B.hi,B.off=void 0,l(B,b,I,w),p.push(B)}else for(var C=c[b][I],A=0;A<C.length;A++)p.push(C[A]),delete J[C[A].id]}return p}function B(t,n,r){for(var i=e.privateGraph().shortestPaths(n,r,{all:!0}).items,a=0;a<i.length;a++)if(i[a]!==n&&i[a]!==r&&x(i[a]))for(var o=b(i[a]),u=0;u<o.length;u++)if(t===o[u].id)return i[a]}function C(e){var t,n=J[e],r=v(n.id1),i=v(n.id2),a=r&&i&&r!==i,o=r&&r===i;return t=a?B(e,r,i):o?r:r||i}function A(e){e=Y.ensureArray(e);for(var t=[],n=0;n<e.length;n++){var r=null;if(e[n]){r=v(e[n]);var i=u(r),a=e[n]in J;i||(r=a?C(e[n]):null)}t.push(r)}return t}function M(e){if(Y.isNullOrUndefined(e))throw new Error("[Find] Undefined argument passed");return Array.isArray(e)?A(e):A(e)[0]}function Z(e,t){if(Y.isNullOrUndefined(t.label)){for(var n="",r=0;r<e.length;r++)Y.isNullOrUndefined(e[r].t)||(n+=e[r].t,r<e.length-1&&(n+="\n"));return n}return t.label}function D(e,t,n){var r,i=0,a=0;for(r=0;r<e.length;r++)i+=e[r].x,a+=e[r].y;i/=e.length,a/=e.length;var o="average"===t.position?i:e[0].x,u="average"===t.position?a:e[0].y,s=Y.isNumber(t.dx)?t.dx:0,l=Y.isNumber(t.dy)?t.dy:0;for(r=0;r<e.length;r++)n.push({id:e[r].id,x:o,y:u}),e[r].x+=s,e[r].y+=l;return{x:o,y:u}}function G(e,t,n){var r=Y.isNormalObject(t.style)?t.style:Y.clone(e[0]),i=L(e);i&&(r.pos=i),delete r.id;var a=t.style&&t.style.hi;Y.isNullOrUndefined(a)&&(a=e.reduce(function(e,t){return e&&t.hi},!0)),r.hi=a;var o={p:"ne",c:"rgb(255, 0, 0)",t:n},u=[];return Y.isNormalObject(t.glyph)&&(o=Y.merge(o,t.glyph),t.glyph.c||t.glyph.u||(o.c="rgb(255, 0, 0)")),null!==t.glyph&&u.push(o),Array.isArray(r.g)&&(u=u.concat(r.g)),r.g=u,Y.isNormalObject(t.d)&&(r.d=Y.clone(t.d)),r.type="node",r}function L(e){for(var t=0;t<e.length;t++)if(e[t].pos)return e[t].pos;return null}function R(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id);return t}function S(e){for(var t,n=[],r={},i=0;i<e.length;i++)for(var a=0;a<e[i].ids.length;a++){if(t=e[i].ids[a],r[t])throw new Error("[Combine] nodes should be only in one combo");r[t]=1,n.push(t)}return n}function T(t){for(var n,r,i={},a=[],o=e.getItem(t),u=0;u<t.length;u++)if(n=t[u],!i[n]){if(r=o[u],!r||"node"!==r.type)throw new Error("[Combine] function must be passed valid ids");"node"===r.type&&(a.push(r),i[n]=1)}if(a.length<1)throw new Error("[Combine] function must be passed at least one node id");return a}function E(e,t,n){var r=c(e,n.x,n.y),i=s(r),a=G(e,t,i.length),o=Y.merge(a,{id:r,t:Z(e,t),x:n.x,y:n.y});return o}function k(t,n,r){function i(){for(var i=[],a=0;a<t.length;a++){var o=E(l[a],t[a],g[a]);i.push(o)}h(),e.merge(i,function(){e.privateRemoveItem(c);var t=w(!1);e.privateMerge(t,function(){var t=R(i);n.select&&(e.selection(t),e.trigger("selectionchange")),Y.invoke(r,t)})})}var a,o,u,s,l=[];for(n=Y.defaults(n,{animate:!0,select:!0,time:250}),t=Y.ensureArray(t),a=0;a<t.length;a++)s=t[a],t[a]=Y.defaults(s,{position:"average",dx:0,dy:0,label:null,style:null,d:null}),t[a].ids=Y.ensureArray(t[a].ids),u=T(t[a].ids),l.push(u);var f,c=S(t),d=[],g=[];for(a=0;a<t.length;a++)f=D(l[a],t[a],d),g.push(f);var v=e.privateGraph().neighbours(c,{all:!0});for(o=0;o<v.links.length;o++){var m=v.links[o];x(m)||(J[m]=e.getItem(m))}e.trigger("prechange","combine");var y=d.length?n.time:0;n.animate?e.animateProperties(d,{time:y},i):e.setProperties(d,!1,i)}function F(t){for(var n=0;n<t.length;n++){var r=t[n];r.hi=!e.privateBothEndsShown(r)}}function V(t,n,r){function i(e){var t=P[e.id].nodes;e.hi=!0,e.bg=!0;for(var n=0,r=t.length;r>n;n++){var a=t[n];if(u(a.id)&&i(a),a.hi||(e.hi=!1),a.bg||(e.bg=!1),!e.hi&&!e.bg)return}}function a(){n.select&&(e.selection(y),e.trigger("selectionchange")),Y.invoke(r)}e.trigger("prechange","uncombine"),n=Y.defaults(n,{animate:!0,time:250,full:!1,select:!0}),h();for(var o,c=Y.ensureArray(t),g={},v=0,m={},x=[],y=[],p=[],b=0;b<c.length;b++)if(M=c[b],u(M)){var I=e.getItem(M);if(I)if(v++,g[M]=I,n.full)m[M]=s(M),x=x.concat(l(M));else{m[M]=P[M].nodes;for(var B=0,C=P[M].nodes.length;C>B;B++){var A=P[M].nodes[B];u(A.id)&&i(A)}}}if(0===v)return void Y.invoke(r);for(var M in g)for(M=Y.rawId(M),B=0;B<m[M].length;B++)o=m[M][B],y.push(o.id),p.push({id:o.id,x:g[M].x+f(o,"x"),y:g[M].y+f(o,"y"),pos:o.pos});for(var Z=0;Z<x.length;Z++)d(x[Z]);var D=[],G=[];for(var L in g){L=Y.rawId(L);for(var R=m[L],S=0;S<R.length;S++){var T=R[S];T.x=g[L].x,T.y=g[L].y}D=D.concat(R),G.push(L)}for(e.privateMerge(D),B=0;B<G.length;B++)d(G[B]);e.privateRemoveItem(G),h();var E=w(!0);F(E),e.privateMerge(E,function(){n.animate?e.animateProperties(p,{time:n.time},a):e.setProperties(p,!1,a)})}function W(e){return U(e,!0)}function U(e,t){var n;if(u(e)){var r=s(e);return n=I(r),{nodes:t?Y.clone(r):r,links:t?Y.clone(n):n}}return x(e)?(n=b(e),{nodes:null,links:t?Y.clone(n):n}):null}function O(e,t){var n=Y.ensureArray(e);if(t=Y.defaults(t,{type:"all"}),!t.type.match(/^(node|link|all)$/))throw new TypeError("[isCombo] opts type property should be either 'node', 'link' or 'all'");for(var r=0;r<n.length;r++){if(u(n[r])&&"link"!==t.type)return!0;if(x(n[r])&&"node"!==t.type)return!0}return!1}function N(e){for(var t=["id","id1","id2"],n=0;n<t.length;n++)t[n]in e&&(e[t[n]]+="")}function K(e,t,n,r){function i(){t.forEach(function(e){var t=e.id,n=s(t),r=x(t)?"link":"node";f[t]={id:t,nodes:[],links:[],updated:!1},a(t,n),o(e,r)})}function a(t,r){r.forEach(function(r){var i=e[r.id];i?(r[n]&&(f[t].updated=!0,r[n]=!1),f[t][r.type+"s"].push(r)):r[n]||(r[n]=!0,f[t].updated=!0)})}function o(e,t){u(e.id,t)?e[n]||(c.itemsToHide.push({id:e.id,type:t}),f[e.id].updated=!1):e[n]&&c.itemsToShow.push({id:e.id,type:t})}function u(e,t){return 0===f[e][t+"s"].length}function s(e){var t=U(e,!1),n=t.nodes||[];return n.concat(t.links)}function l(){for(var e in f){var t=f[e];t.updated&&(x(e)?c.links.push(f[e]):c.nodes.push(f[e]))}}var f={},c={nodes:[],links:[],itemsToShow:[],itemsToHide:[]};return i(),l(),Y.clone(c)}function H(t,n){if(n.updateGlyph){var r=[];t.forEach(function(t){var n=t.nodes.length,i=e.getItem(t.id);i.g&&i.g.forEach(function(e){"ne"===e.p&&(e.t=n,r.push({id:i.id,g:i.g}))})}),e.setProperties(r)}}function X(e){e&&(P=n(e.nodes),J=n(e.links));var t=Y.clone(r(P)),i=Y.clone(r(J));return{nodes:t,links:i}}var Y=KeyLines.Util,z="_combo_",P={},_={},j="_combolink_",J={},Q={api:{combine:k,uncombine:V,info:W,isCombo:O,find:M},internalUse:{filter:function(e,t,n){var r=K(e,t,"hi",n);return H(r.nodes,n),r},foreground:function(e,t,n){return K(e,t,"bg",n)},preMerge:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(N(r),"node"===r.type)m(r.id)||t.push(r);else{if("link"!==r.type)throw new Error("The type of the item should be specified.");m(r.id1)||m(r.id2)?J[r.id]=r:t.push(r)}}return t},postMerge:function(t){var n=w(!1);e.privateMerge(n,t)},preDelete:function(n){var r,i,a;n=Y.ensureArray(n);var o=Y.makeIdMap(n),s=t(o,"node"),l=t(o,"link"),f=e.privateGraph().neighbours(s,{all:!0}).links,c=Y.makeIdMap(f.concat(l));for(var g in J)if(g in c){if(x(g))for(a=b(g),r=0;r<a.length;r++)J[a[r].id]&&delete J[a[r].id]}else{var m=J[g],y=v(m.id1),p=v(m.id2);(y in o||p in o)&&delete J[g]}var I;for(r=0;r<l.length;r++)if(I=l[r],x(I))for(a=b(I),i=0;i<a.length;i++)delete J[a[r].id];for(r=0;r<s.length;r++)I=s[r],u(I)&&d(I);h()},serialize:X,loadUp:function(e){e?X(e):(P={},J={}),h()}}};return Q}}(),function(){var e=KeyLines.Canvas={},t=8888,n=e.getDevicePixelRatio=function(){return"undefined"!=typeof window?window.devicePixelRatio||1:void 0};e.create=function(e,r,i,a,o,u,s){function l(e,t,n){var r=document.createElement("canvas");n&&x&&(r.dir="rtl",document.body.appendChild(r),r.style.display="none");var i;return i=s?document.createElement("canvas").getContext("2d"):r.getContext("2d"),r.context2d=i,r.height=t,r.width=e,s||g(r),r}function f(e,t){var r=n(),i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,a=r/i;if(r!==i){var o=e.width,u=e.height;e.width=Math.round(o*a),e.height=Math.round(u*a),e.style.width=o+"px",e.style.height=u+"px",s||t.scale(a,a)}}function c(){if(!KeyLines.Rendering.rtlBugChecked){var e=100,t=30,n=l(e,t);document.body.appendChild(n),n.setAttribute("dir","rtl");var r=n.context2d;r.fillStyle="#000",r.fillRect(0,0,e,t),r.textAlign="center",r.fillStyle="#fff",r.font="20px sans-serif",r.fillText("\u2588",e/2,t);var i=r.getImageData(e/2,t-1,1,1).data;KeyLines.Rendering.rtlBugPresent=0===i[0],document.body.removeChild(n),KeyLines.Rendering.rtlbugChecked=!0}}function d(){if(!KeyLines.Rendering.minimumFontChecked){for(var e="Hello",t=l(100,100).context2d,n=!1,r=function(n){return KeyLines.Rendering.setFont(t,n),t.measureText(e).width},i=r(1),a=2;!n&&30>a;){var o=r(a);n=i!==o,n&&(KeyLines.Rendering.browserMinimumFontSize=a-1),a++}KeyLines.Rendering.minimumFontChecked=!0}}function g(e){function t(e){n.setLineDash=function(t){n[e]=t}}var n=e.getContext("2d");n.setLineDash||("undefined"!=typeof n.webkitLineDash?t("webkitLineDash"):"undefined"!=typeof n.mozDash&&t("mozDash"))}function h(){return document.createElement("img")}function v(){B.update(),A(v)}var m=document.getElementById(r),x=KeyLines._rtlTest(m),y=l(i,a,!0);y.style.display="block";var p={},b=y.context2d;m.style.display="block",m.parentNode.replaceChild(y,m),y.setAttribute("id",r),s&&KeyLines.webGLSupport()&&"chart"===e&&(p.renderer=y.renderer=KeyLines.WebGL.create(y),y.webgl=!0),y.canvas=!0;var I=y;y.webgl?(b.webgl=!0,b.webglCanvas=y):b.webgl=!1,f(y,b),d(),c();var w=I.getAttribute("style")||"";w+="-ms-touch-action: none; touch-action: none; outline: none;",I.setAttribute("style",w),I.setAttribute("tabindex",""+t++);var B="chart"===e?KeyLines.API.createAPI(r):KeyLines.TimeBar.API.createAPI(r);for(var C in B)-1===C.indexOf("private")&&(p[C]=B[C]);B.privateInit(b,i,a,l,function(e){document.getElementById(r).style.cursor=e},h,o,void 0,u),p.internalSetSize=function(e,t,n){B.privateMapSetSize&&B.privateMapSetSize(e,t),I.width=e,I.height=t,f(I,b),B.privateSetSize(b,e,t,n,!0)};var A=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){KeyLines.Util.nextTick(e,1e3/60)}}();return A(v),p}}(),function(){function e(e,n,i){return n.forEach(function(n){e[n]&&(e[n+l]=t(e[n],n,"create"===n))}),i&&i.forEach(function(t){e[t]&&(e[t+l]=r(e[t],h))}),e}function t(t,r,i){var a=function(){for(var a=Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];var l=Math.max(0,t.length-1),f=n(r,a);return f?t.apply(null,a):new u(function(n,r){function u(t,i){if(t)return r(t);var a=Array.isArray(i);i=a?i:[i];var o=i.map(function(t){return e(t,d,g)});return n(a?o:o[0])}var s=a.length===t.length&&o.Util.isFunction(a[l]);s&&(a.pop(),o.Util.log("A callback has been passed, but the function will return a Promise instead")),a[l]=i?u:n,t.apply(null,a)})};return a}function n(e,t){return/options$/i.test(e)&&o.Util.isNullOrUndefined(t[0])?!0:"range"===e&&!t.length}function r(e,n){var r=function(){var r=Array.prototype.slice.call(arguments),i=e.apply(null,r),a={},u=o.Util.makeIdMap(n);return Object.keys(i).forEach(function(e){e in u?a[e+l]=t(i[e],e):a[e]=i[e]}),a};return r}function i(e){var t=e||u,n="undefined"!=typeof t&&"resolve"in t&&"reject"in t;return new t(function(e){n=n&&"function"==typeof e}),n}var a="undefined"!=typeof window?window:global,o=a.KeyLines,u=a.Promise,s=u,l="",f=!1,c=["create"],d=["arrange","createLink","filter","foreground","range","animateProperties","expand","hide","layout","load","merge","options","pan","ping","setItem","setProperties","show","toDataURL","viewOptions","zoom"],g=["combo","graph","map","getGraphEngine"],h=["combine","uncombine","closeness","betweenness","show","hide","options"];o.promisify=function(t){if(arguments.length>1&&arguments[1]&&(l=arguments[1]),null==s&&!u&&!t)throw Error("[promisify] There's no valid Promise constructor available. It is not possible to promisify.");if(!i(t))throw Error("[promisify] Promise constructor not valid. Please use a valid Promise implementation.");if(u=t||s,!f){e(o,c,g);var n=o.Util.values(o.components||{});n.forEach(function(t){e(t,d,g)})}f=!0}}(),function(){"use strict";if(KeyLines.WebGL){var e=3;KeyLines.WebGL.generateTriangle=function(t,n,r,i,a,o,u,s,l,f,c){var d=t.wsc||[0,0,0,0];if(f.rebuildOptions.all||f.rebuildOptions.shadow||f.alwaysUpdate)for(var g=0;e>g;g++)f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=d[0],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=d[1],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=d[2],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=d[3];if(f.rebuildOptions.all||f.rebuildOptions.colours||f.alwaysUpdate)for(g=0;e>g;g++)f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[0],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[1],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[2],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=s[3];if(f.rebuildOptions.all||f.rebuildOptions.positions||f.alwaysUpdate){if(c)var n=n+c.x,r=r+c.y,i=i+c.x,a=a+c.y,o=o+c.x,u=u+c.y;f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=n,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=r,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=i,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=a,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=o,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=0}(f.rebuildOptions.all||f.rebuildOptions.textures||f.alwaysUpdate)&&(f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0)}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Renderer=function(t){function n(){var e=A.createTexture();return A.bindTexture(A.TEXTURE_2D,e),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),e}function r(e){e?(A.bindFramebuffer(A.FRAMEBUFFER,e.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,e.renderBuffer),A.bindTexture(A.TEXTURE_2D,e.texture)):d(),A.viewport(0,0,p,b)}function i(e){var t=C[e]||null;if(e&&!t){t=C[e]={framebuffer:A.createFramebuffer(),renderbuffer:A.createRenderbuffer(),texture:n()},A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.drawingBufferWidth,A.drawingBufferHeight,0,A.RGBA,A.UNSIGNED_BYTE,null),A.bindFramebuffer(A.FRAMEBUFFER,t.framebuffer),A.bindRenderbuffer(A.RENDERBUFFER,t.renderbuffer),A.clearColor(0,0,0,0),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,A.drawingBufferWidth,A.drawingBufferHeight),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,t.texture,0),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,t.renderbuffer),A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight);var i=A.checkFramebufferStatus(A.FRAMEBUFFER);if(A.FRAMEBUFFER_COMPLETE!==i)throw new Error(i.toString())}r(t)}function a(){return A=e.Utils.create3DContext(B,{antialias:!1,preferLowPowerToHighPerformance:!1}),x=B.width,y=B.height,p=A.drawingBufferWidth,b=A.drawingBufferHeight,A.getExtension("OES_standard_derivatives"),A.getExtension("OES_element_index_uint"),A.viewport(0,0,p,b),A.blendFunc(A.ONE,A.ONE_MINUS_SRC_ALPHA),A.enable(A.BLEND),A.clearColor(0,0,0,0),C=t.framebuffers={},R=new Uint8Array(4),A}function o(e,t){if(C[e]){var n=C[e].texture;G.drawItems(t,n)}}function u(){A.viewport(0,0,A.drawingBufferWidth,A.drawingBufferHeight)}function s(e,t,n,r){L=I.createMatrix(),e?(L.pan(t,n),L.zoom(r)):(L.pan(0,0),L.zoom(1))}function l(e,t,n,r,i,a,o){n.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o)}function f(e,t,n,r,i,a){t.arcBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a)}function c(e,t,n,r,i,a,o,u,s){t.triangleBuffers.numOfTriangles>0&&e.drawItems(t,n,r,i,a,o,u,s)}function d(){A.bindFramebuffer(A.FRAMEBUFFER,null),A.bindTexture(A.TEXTURE_2D,null),A.bindRenderbuffer(A.RENDERBUFFER,null)}function g(e){e.rebuildOptions.colours=!1,e.rebuildOptions.positions=!1,e.rebuildOptions.textures=!1,e.rebuildOptions.shadow=!1,e.rebuildOptions.all=!1}function h(e){return e.lineBuffers.numOfTriangles||e.arcBuffers.numOfTriangles||e.triangleBuffers.numOfTriangles}function v(){for(var e=0;8>e;e++)A.activeTexture(A["TEXTURE"+e]),A.bindTexture(A.TEXTURE_2D,null)}function m(e){e.texture&&(A.deleteTexture(e.texture),e.texture=null,e.ctx=null,e.img=null)}var x,y,p,b,I=e.Utils,w={},B=t.canvas,C=t.framebuffers,A=a(),M=e.LineShader(A),Z=e.ArcShader(A),D=e.TriangleShader(A),G=e.RenderToTextureShader(A),L=null,R=[0,0,0,0];return w.clearView=function(e){e&&(A=a()),u(),A.clear(A.COLOR_BUFFER_BIT)},w.clearFramebuffers=function(e){C=t.framebuffers={}},w.clearTextureAtlas=function(e){e&&(Array.isArray(e)?e.forEach(function(e){m(e)}):m(e))},w.render=function(e,n,r,a,u,m,I){x=B.clientWidth,y=B.clientHeight,p=A.drawingBufferWidth,b=A.drawingBufferHeight;var w=t.layersToDraw;t.panX=e,t.panY=n,t.zoom=r;for(var C=0,G=w.length;G>C;C++){var R=w[C];h(R)&&(s(R.useView,e,n,r),i(R.drawFramebuffer),l(M,R,R.lineBuffers,L,x,y,I.showShadowCanvas),f(Z,R,L,x,y,I.showShadowCanvas),c(D,R,L,a,u,m,x,y,I.showShadowCanvas),R.useFramebuffer&&(d(),o(R.useFramebuffer,R.fbAlpha),i(R.useFramebuffer),A.clear(A.COLOR_BUFFER_BIT)),g(R))}v()},w.drawShadowCanvas=function(e,n){if(x=B.clientWidth,y=B.clientHeight,p=A.drawingBufferWidth,b=A.drawingBufferHeight,t.layersToDraw.length>0){i("shadow");for(var r=0,a=t.layersToDraw.length;a>r;r++){var o=t.layersToDraw[r];s(o.useView,t.panX,t.panY,t.zoom),l(M,o,o.lineBuffers,L,x,y,!0),f(Z,o,L,x,y,!0),c(D,o,L,t.textAtlas,t.fontIconAtlas,t.imageAtlases,x,y,!0)}var u=p/B.clientWidth,d=e*u,g=b-n*u;d>=0&&g>=0&&p>d&&b>g&&A.readPixels(d,g,1,1,A.RGBA,A.UNSIGNED_BYTE,R)}return R},w})}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.RenderToTextureShader=function(t){function n(){o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,u,o.STATIC_DRAW),o.enableVertexAttribArray(g.position),o.enableVertexAttribArray(g.textCoord),o.vertexAttribPointer(g.position,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),o.vertexAttribPointer(g.textCoord,2,o.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,8)}function r(e,t){o.activeTexture(o["TEXTURE"+t]),o.bindTexture(o.TEXTURE_2D,e)}function i(e,t,n){o.uniform1f(g.globalAlpha,n)}var a={},o=t,u=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]),s=o.createBuffer(),l=e.Utils,f=e["renderToTexture-vertex"],c=e["renderToTexture-fragment"],d=l.createProgram(o,atob(f),atob(c)),g={globalAlpha:o.getUniformLocation(d,"u_globalAlpha"),textures:o.getUniformLocation(d,"u_image"),position:o.getAttribLocation(d,"a_position"),textCoord:o.getAttribLocation(d,"a_texCoord")};return a.drawItems=function(e,t,a,u){o.useProgram(d),i(a,u,e),n(),r(t,0),o.drawArrays(o.TRIANGLES,0,6)},a})}(),function(){function e(e){return e.split("").map(function(e){return G(e)||0})}function t(e){o(e),u(e),s(e),l(e),f(e),c(e),d(e)}function n(e){g(e),h(e)}function r(e){function t(e,t){return se>e?(o.push({level:e,override:t}),e):void 0}var n=0,r=1,i=2,a=e.level,o=[];o.push({level:e.level,override:n});var u=0,s=o[0],l=s.level,f=[];e.characters.forEach(function(e){var c=e.type;c===j?(l+=R(l)?2:1,a=t(l,n)):c===_?(l+=L(l)?2:1,a=t(l,n)):c===q?(l+=R(l)?2:1,a=t(l,i)):c===Q&&(l+=L(l)?2:1,a=t(l,r)),c===J?o.length>2&&(s=o.pop()):s=o[o.length-1],l=a=s.level,-1===[$,j,_,q,Q,J].indexOf(c)&&(s.override>n&&(e.type=s.override===i?F:k),e.level=a,e.index=u,f.push(e),u++)}),e.characters=f}function i(e,t){var n=[],r=[];t.forEach(function(e){e!==O?r.push(e):(n.push(r),r=[])}),r.length>0&&n.push(r);var i,a=0;return n.map(function(t){i=a;var n=t.map(function(t){return{text:e[i++],level:0,type:t}});return e=e.substring(a,a+t.length),a+=t.length,{text:e,level:0,characters:n}})}function a(e){e.level=1}function o(e){e.characters.filter(S(P)).forEach(function(t){if(t.isNSM=!0,t.index>0){var n=e.characters[t.index-1].type;n===K&&(t.type=K),F===n&&(t.type=F)}})}function u(e){e.characters.filter(S(V)).forEach(function(t){for(var n=t.index-1;n>=0;n--){var r=e.characters[n].type;if(r===K){t.type=W;break}if([F,k].indexOf(r)>-1)break}})}function s(e){e.characters.filter(S(K)).forEach(function(e){e.type=F,e.isAL=!0})}function l(e){e.characters.filter(S([Y,X])).forEach(function(t){var n=t.index;if(n>0&&n<e.characters.length-1){var r=e.characters[n-1].type,i=e.characters[n+1].type;r!==i||r!==V&&r!==W||(t.type=r)}})}function f(e){e.characters.filter(S(z)).forEach(function(t){var n=t.index,r=n;if(n>0){for(var i=e.characters[n-1].type;r-- >0&&i===z;)i=e.characters[r].type;if(i===V)return void(t.type=V)}if(n<e.characters.length-1){var a=e.characters[n+1].type;for(r=n;r++<e.characters.length-1&&a===z;)a=e.characters[r].type;if(a===V)return void(t.type=V)}})}function c(e){e.characters.filter(S([z,X,Y,W])).forEach(function(e){e.type=U})}function d(e){e.characters.filter(S(V)).forEach(function(t){for(var n=t.index,r=n-1;r>=0;r--){var i=e.characters[r].type;if(i===F)return;if(i===k)return void(t.type=k)}})}function g(e){e.characters.filter(S([O,N,H,U])).forEach(function(t){var n=t.index;if(0!==n&&n!==e.characters.length-1&&n>0&&n<e.characters.length-1){for(var r=e.characters[n-1].type,i=e.characters[n+1].type,a=n;a-- >0&&-1===[F,K,V,W,k].indexOf(r);)r=e.characters[a].type;for(a=n;a++<e.characters.length-1&&-1===[F,K,V,W,k].indexOf(i);)i=e.characters[a].type;[F,K,V,W].indexOf(r)>-1&&[F,K,V,W].indexOf(i)>-1?t.type=F:r===k&&i===k?t.type=k:t.type=L(e.level)?k:F;
}})}function h(e){e.characters.filter(S([O,N,H,U])).forEach(function(t){t.type=L(e.level)?k:F})}function v(e){var t;e.characters.forEach(function(e){var n=e.type;t=e.level,n===k?R(t)&&t++:n===F||n===K?L(t)&&t++:n!==V&&n!==W||(L(t)?t+=2:t++),e.level=t})}function m(e){e.characters.filter(function(e){return ue[e.text]&&R(e.level)}).forEach(function(e){e.text=ue[e.text]})}function x(e){var t=e.highestLevel;for(e.reorderedCharacters=KeyLines.Util.clone(e.characters);t>0;)y(e,t),t--}function y(e,t){var n,r=[];e.levelRuns.forEach(function(e){e.level>=t?n?n.endIndex+=e.length:(n={startIndex:e.idx,endIndex:e.idx+e.length},r.push(n)):n=null}),r.forEach(function(t){p(e,t)})}function p(e,t){var n=t.startIndex,r=t.endIndex,i=e.reorderedCharacters.slice(n,r).reverse();e.reorderedCharacters=e.reorderedCharacters.slice(0,n).concat(i).concat(e.reorderedCharacters.slice(r))}function b(e){var t=0;e.characters.forEach(function(e){e.level>t&&(t=e.level)}),e.highestLevel=t}function I(e){var t=[],n=0,r=0,i={idx:0,length:0,level:e.characters[0].level};e.characters.forEach(function(e){e.level!==n&&0!==r&&(t.push(i),i={idx:r,length:0,level:e.level}),i.length++,r++,n=e.level}),t.push(i),e.levelRuns=t}function w(e){B(e,ie,!0),A(e),Z(e),D(e)}function B(e,t,n){for(var r=e.reorderedCharacters.reverse(),i=[],a=0,o=r.length;o>a;a++){var u=r[a],s=C(a,r,t);a+=s.length,n||(u.text+=s.join("")),i.push(u)}var l=0;e.reorderedCharacters=i.reverse(),e.reorderedCharacters.forEach(function(e){e.index=l++})}function C(e,t,n){for(var r=[],i=e+1;i<t.length;i++){var a=t[i].text.charCodeAt(0);if(!n[a])return r;r.push(t[i].text)}return r}function A(e){for(var t=e.reorderedCharacters.reverse(),n=[],r=0,i=t.length;i>r;r++){var a=t[r],o=oe[a.text[0]];if(o){var u=M(r,o,t);u&&(r+=u.length,a.text=u.text)}n.push(a)}var s=0;e.reorderedCharacters=n.reverse(),e.reorderedCharacters.forEach(function(e){e.index=s++})}function M(e,t,n){for(var r=0,i=e+1;i<n.length;i++){var a=n[i].text[0],o=t[a];if(!o)return!1;if(r++,"string"==typeof o)return{text:o,length:r};t=o}return!1}function Z(e){var t=function(){e.arabicTextRuns.push(r),r=null},n=e.reorderedCharacters;e.arabicTextRuns=[];for(var r,i=0,a=n.length;a>i;i++){var o=n[i],u=o.text.charCodeAt(0),s=re[u];if(s&&[F,ee,k].indexOf(s.t)>-1){if(r||(r={startIndex:i}),r.endIndex=i+1,a>i+1){var l=n[i+1].text.charCodeAt(0),f=re[l];f&&f.t===F&&t()}else t();s.t===k&&t()}else{if(s&&s.t===te)continue;r&&t()}}r&&t()}function D(e){e.arabicTextRuns.forEach(function(t){for(var n,r=t.startIndex,i=t.endIndex,a=r;i>a;a++){var o=e.reorderedCharacters[a],u=re[o.text.charCodeAt(0)];n=null,i-r>1?a===r?n=u.initial:a===i-1?n=u["final"]:a>r&&i-1>a&&(n=u.median):n=u.isolated,n&&(o.text=String.fromCharCode(n)+o.text.substring(1))}})}function G(e){for(var t=e.charCodeAt(0),n=0;n<ne.length;n+=2)if(t<ne[n])return ne[n+1];return U}function L(e){return e%2===0}function R(e){return e%2!==0}function S(e){return e=KeyLines.Util.ensureArray(e),function(t){return e.indexOf(t.type)>-1}}var T=KeyLines.Bidi={},E={},k=0,F=1,V=2,W=3,U=4,O=5,N=6,K=7,H=8,X=9,Y=10,z=11,P=12,_=13,j=14,J=15,Q=16,q=17,$=18,ee=2,te=5,ne=[9,$,10,N,11,O,12,N,13,H,14,O,28,$,31,O,32,N,33,H,35,U,38,z,43,U,44,Y,45,X,46,Y,48,X,58,V,59,X,65,U,91,k,97,U,123,k,127,U,133,$,134,O,160,$,161,X,162,U,166,z,170,U,171,k,173,U,174,$,176,U,178,z,180,V,181,U,182,k,185,U,186,V,187,k,192,U,215,k,216,U,247,k,248,U,697,k,699,U,706,k,720,U,722,k,736,U,741,k,750,U,751,k,768,U,880,P,884,k,886,U,894,k,895,U,900,k,902,U,903,k,904,U,1014,k,1015,U,1155,k,1162,P,1418,k,1423,U,1425,z,1470,P,1471,F,1472,P,1473,F,1475,P,1476,F,1478,P,1479,F,1488,P,1536,F,1542,W,1544,U,1545,K,1547,z,1548,K,1549,X,1550,K,1552,U,1563,P,1611,K,1632,P,1642,W,1643,z,1645,W,1648,K,1649,P,1750,K,1757,P,1758,W,1759,U,1765,P,1767,K,1769,P,1770,U,1774,P,1776,K,1786,V,1809,K,1810,P,1840,K,1869,P,1958,K,1969,P,1984,K,2027,F,2036,P,2038,F,2042,U,2070,F,2074,P,2075,F,2084,P,2085,F,2088,P,2089,F,2096,P,2137,F,2142,P,2208,F,2260,K,2274,P,2275,W,2307,P,2362,k,2363,P,2364,k,2365,P,2369,k,2377,P,2381,k,2382,P,2385,k,2392,P,2402,k,2404,P,2433,k,2434,P,2492,k,2493,P,2497,k,2503,P,2509,k,2510,P,2530,k,2534,P,2546,k,2548,z,2555,k,2561,z,2563,P,2620,k,2622,P,2625,k,2649,P,2672,k,2674,P,2677,k,2691,P,2748,k,2749,P,2753,k,2761,P,2765,k,2768,P,2786,k,2790,P,2801,k,2809,z,2817,k,2818,P,2876,k,2877,P,2879,k,2880,P,2881,k,2887,P,2893,k,2903,P,2914,k,2918,P,2946,k,2947,P,3008,k,3009,P,3021,k,3024,P,3059,k,3065,U,3066,z,3072,U,3073,P,3134,k,3137,P,3142,k,3160,P,3170,k,3174,P,3192,k,3199,U,3201,k,3202,P,3260,k,3261,P,3276,k,3285,P,3298,k,3302,P,3329,k,3330,P,3393,k,3398,P,3405,k,3406,P,3426,k,3430,P,3530,k,3535,P,3538,k,3544,P,3633,k,3634,P,3636,k,3647,P,3648,z,3655,k,3663,P,3761,k,3762,P,3764,k,3773,P,3784,k,3792,P,3864,k,3866,P,3893,k,3894,P,3895,k,3896,P,3897,k,3898,P,3902,U,3953,k,3967,P,3968,k,3973,P,3974,k,3976,P,3981,k,4030,P,4038,k,4039,P,4141,k,4145,P,4146,k,4152,P,4153,k,4155,P,4157,k,4159,P,4184,k,4186,P,4190,k,4193,P,4209,k,4213,P,4226,k,4227,P,4229,k,4231,P,4237,k,4238,P,4253,k,4254,P,4957,k,4960,P,5008,k,5024,U,5120,k,5121,U,5760,k,5761,H,5787,k,5792,U,5906,k,5920,P,5938,k,5941,P,5970,k,5984,P,6002,k,6016,P,6068,k,6070,P,6071,k,6078,P,6086,k,6087,P,6089,k,6100,P,6107,k,6108,z,6109,k,6112,P,6128,k,6155,U,6158,P,6160,$,6277,k,6279,P,6313,k,6314,P,6432,k,6435,P,6439,k,6441,P,6450,k,6451,P,6457,k,6464,P,6470,U,6622,k,6656,U,6679,k,6681,P,6683,k,6686,P,6742,k,6743,P,6744,k,6753,P,6754,k,6755,P,6757,k,6765,P,6771,k,6784,P,6832,k,6916,P,6964,k,6965,P,6966,k,6971,P,6972,k,6973,P,6978,k,6979,P,7019,k,7028,P,7040,k,7042,P,7074,k,7078,P,7080,k,7082,P,7083,k,7086,P,7142,k,7143,P,7144,k,7146,P,7149,k,7150,P,7151,k,7154,P,7212,k,7220,P,7222,k,7227,P,7376,k,7379,P,7380,k,7393,P,7394,k,7401,P,7405,k,7406,P,7412,k,7413,P,7416,k,7424,P,7616,k,7680,P,8125,k,8126,U,8127,k,8130,U,8141,k,8144,U,8157,k,8160,U,8173,k,8178,U,8189,k,8192,U,8203,H,8206,$,8207,k,8208,F,8232,U,8233,H,8234,O,8235,_,8236,j,8237,J,8238,Q,8239,q,8240,X,8245,z,8260,U,8261,X,8287,U,8288,H,8294,$,8298,null,8304,$,8305,V,8308,k,8314,V,8316,Y,8319,U,8320,k,8330,V,8332,Y,8336,U,8352,k,8400,z,8448,P,8450,U,8451,k,8455,U,8456,k,8458,U,8468,k,8469,U,8470,k,8473,U,8478,k,8484,U,8485,k,8486,U,8487,k,8488,U,8489,k,8490,U,8494,k,8495,z,8506,k,8508,U,8512,k,8517,U,8522,k,8526,U,8528,k,8544,U,8585,k,8722,U,8723,Y,8724,z,9014,U,9083,k,9109,U,9110,k,9352,U,9372,V,9450,k,9900,U,9901,k,10240,U,10496,k,11264,U,11493,k,11499,U,11503,k,11506,P,11513,k,11520,U,11647,k,11648,P,11744,k,11776,P,12288,U,12289,H,12293,U,12296,k,12321,U,12330,k,12334,P,12336,k,12337,U,12342,k,12344,U,12349,k,12353,U,12441,k,12443,P,12445,U,12448,k,12449,U,12539,k,12540,U,12736,k,12784,U,12829,k,12832,U,12880,k,12896,U,12924,k,12927,U,12977,k,12992,U,13004,k,13008,U,13175,k,13179,U,13278,k,13280,U,13311,k,13312,U,19904,k,19968,U,42128,k,42192,U,42509,k,42512,U,42607,k,42611,P,42612,U,42622,P,42624,U,42654,k,42656,P,42736,k,42738,P,42752,k,42786,U,42888,k,42889,U,43010,k,43011,P,43014,k,43015,P,43019,k,43020,P,43045,k,43047,P,43048,k,43056,U,43064,k,43072,z,43124,k,43136,U,43204,k,43214,P,43232,k,43250,P,43302,k,43310,P,43335,k,43346,P,43392,k,43395,P,43443,k,43444,P,43446,k,43450,P,43452,k,43453,P,43493,k,43494,P,43561,k,43567,P,43569,k,43571,P,43573,k,43584,P,43587,k,43588,P,43596,k,43597,P,43644,k,43645,P,43696,k,43697,P,43698,k,43701,P,43703,k,43705,P,43710,k,43712,P,43713,k,43714,P,43756,k,43758,P,43766,k,43777,P,44005,k,44006,P,44008,k,44009,P,44013,k,44016,P,64285,k,64286,F,64287,P,64297,F,64298,Y,64336,F,64830,K,64848,U,65021,K,65024,U,65040,P,65056,U,65072,P,65104,U,65105,X,65106,U,65108,X,65109,U,65110,X,65119,U,65120,z,65122,U,65124,Y,65129,U,65131,z,65136,U,65279,K,65281,$,65283,U,65286,z,65291,U,65292,Y,65293,X,65294,Y,65296,X,65306,V,65307,X,65313,U,65339,k,65345,U,65371,k,65382,U,65504,k,65506,z,65509,U,65512,z,1114109,U],re={1536:{t:4},1537:{t:4},1538:{t:4},1539:{t:4},1540:{t:4},1541:{t:4},1544:{t:4},1547:{t:4},1568:{t:2},1569:{t:4,isolated:65152},1570:{t:1,isolated:65153,initial:65154},1571:{t:1,isolated:65155,initial:65156},1572:{t:1,isolated:65157,initial:65158},1573:{t:1,isolated:65159,initial:65160},1574:{t:2,isolated:65161,"final":65163,median:65164,initial:65162},1575:{t:1,isolated:65165,initial:65166},1576:{t:2,isolated:65167,"final":65169,median:65170,initial:65168},1577:{t:1,isolated:65171,initial:65172},1578:{t:2,isolated:65173,"final":65175,median:65176,initial:65174},1579:{t:2,isolated:65177,"final":65179,median:65180,initial:65178},1580:{t:2,isolated:65181,"final":65183,median:65184,initial:65182},1581:{t:2,isolated:65185,"final":65187,median:65188,initial:65186},1582:{t:2,isolated:65189,"final":65191,median:65192,initial:65190},1583:{t:1,isolated:65193,initial:65194},1584:{t:1,isolated:65195,initial:65196},1585:{t:1,isolated:65197,initial:65198},1586:{t:1,isolated:65199,initial:65200},1587:{t:2,isolated:65201,"final":65203,median:65204,initial:65202},1588:{t:2,isolated:65205,"final":65207,median:65208,initial:65206},1589:{t:2,isolated:65209,"final":65211,median:65212,initial:65210},1590:{t:2,isolated:65213,"final":65215,median:65216,initial:65214},1591:{t:2,isolated:65217,"final":65219,median:65220,initial:65218},1592:{t:2,isolated:65221,"final":65223,median:65224,initial:65222},1593:{t:2,isolated:65225,"final":65227,median:65228,initial:65226},1594:{t:2,isolated:65229,"final":65231,median:65232,initial:65230},1595:{t:2},1596:{t:2},1597:{t:2},1598:{t:2},1599:{t:2},1600:{t:3,isolated:1600,"final":1600,median:1600,initial:1600},1601:{t:2,isolated:65233,"final":65235,median:65236,initial:65234},1602:{t:2,isolated:65237,"final":65239,median:65240,initial:65238},1603:{t:2,isolated:65241,"final":65243,median:65244,initial:65242},1604:{t:2,isolated:65245,"final":65247,median:65248,initial:65246},1605:{t:2,isolated:65249,"final":65251,median:65252,initial:65250},1606:{t:2,isolated:65253,"final":65255,median:65256,initial:65254},1607:{t:2,isolated:65257,"final":65259,median:65260,initial:65258},1608:{t:1,isolated:65261,initial:65262},1609:{t:2,isolated:65263,initial:65264},1610:{t:2,isolated:65265,"final":65267,median:65268,initial:65266},1646:{t:2},1647:{t:2},1649:{t:1},1650:{t:1},1651:{t:1},1652:{t:4},1653:{t:1},1654:{t:1},1655:{t:1},1656:{t:2},1657:{t:2},1658:{t:2},1659:{t:2},1660:{t:2},1661:{t:2},1662:{t:2,isolated:64342,"final":64344,median:64345,initial:64343},1663:{t:2},1664:{t:2},1665:{t:2},1666:{t:2},1667:{t:2},1668:{t:2},1669:{t:2},1670:{t:2,isolated:64378,"final":64380,median:64381,initial:64379},1671:{t:2},1672:{t:1},1673:{t:1},1674:{t:1},1675:{t:1},1676:{t:1},1677:{t:1},1678:{t:1},1679:{t:1},1680:{t:1},1681:{t:1},1682:{t:1},1683:{t:1},1684:{t:1},1685:{t:1},1686:{t:1},1687:{t:1},1688:{t:1,isolated:64394,initial:64395},1689:{t:1},1690:{t:2},1691:{t:2},1692:{t:2},1693:{t:2},1694:{t:2},1695:{t:2},1696:{t:2},1697:{t:2},1698:{t:2},1699:{t:2},1700:{t:2},1701:{t:2},1702:{t:2},1703:{t:2},1704:{t:2},1705:{t:2,isolated:64398,"final":64400,median:64401,initial:64399},1706:{t:2},1707:{t:2},1708:{t:2},1709:{t:2},1710:{t:2},1711:{t:2,isolated:64402,"final":64404,median:64405,initial:64403},1712:{t:2},1713:{t:2},1714:{t:2},1715:{t:2},1716:{t:2},1717:{t:2},1718:{t:2},1719:{t:2},1720:{t:2},1721:{t:2},1722:{t:2},1723:{t:2},1724:{t:2},1725:{t:2},1726:{t:2},1727:{t:2},1728:{t:1},1729:{t:2},1730:{t:2},1731:{t:1},1732:{t:1},1733:{t:1},1734:{t:1},1735:{t:1},1736:{t:1},1737:{t:1},1738:{t:1},1739:{t:1},1740:{t:2,isolated:64508,"final":64510,median:64511,initial:64509},1741:{t:1},1742:{t:2},1743:{t:1},1744:{t:2},1745:{t:2},1746:{t:1},1747:{t:1},1749:{t:1},1757:{t:4},1774:{t:1},1775:{t:1},1786:{t:2},1787:{t:2},1788:{t:2},1791:{t:2},1808:{t:1},1810:{t:2},1811:{t:2},1812:{t:2},1813:{t:1},1814:{t:1},1815:{t:1},1816:{t:1},1817:{t:1},1818:{t:2},1819:{t:2},1820:{t:2},1821:{t:2},1822:{t:1},1823:{t:2},1824:{t:2},1825:{t:2},1826:{t:2},1827:{t:2},1828:{t:2},1829:{t:2},1830:{t:2},1831:{t:2},1832:{t:1},1833:{t:2},1834:{t:1},1835:{t:2},1836:{t:1},1837:{t:2},1838:{t:2},1839:{t:1},1869:{t:1},1870:{t:2},1871:{t:2},1872:{t:2},1873:{t:2},1874:{t:2},1875:{t:2},1876:{t:2},1877:{t:2},1878:{t:2},1879:{t:2},1880:{t:2},1881:{t:1},1882:{t:1},1883:{t:1},1884:{t:2},1885:{t:2},1886:{t:2},1887:{t:2},1888:{t:2},1889:{t:2},1890:{t:2},1891:{t:2},1892:{t:2},1893:{t:2},1894:{t:2},1895:{t:2},1896:{t:2},1897:{t:2},1898:{t:2},1899:{t:1},1900:{t:1},1901:{t:2},1902:{t:2},1903:{t:2},1904:{t:2},1905:{t:1},1906:{t:2},1907:{t:1},1908:{t:1},1909:{t:2},1910:{t:2},1911:{t:2},1912:{t:1},1913:{t:1},1914:{t:2},1915:{t:2},1916:{t:2},1917:{t:2},1918:{t:2},1919:{t:2},2208:{t:2},2209:{t:2},2210:{t:2},2211:{t:2},2212:{t:2},2213:{t:2},2214:{t:2},2215:{t:2},2216:{t:2},2217:{t:2},2218:{t:1},2219:{t:1},2220:{t:1},2221:{t:4},2222:{t:1},2223:{t:2},2224:{t:2},2225:{t:1},2226:{t:1},2227:{t:2},2228:{t:2},2230:{t:2},2231:{t:2},2232:{t:2},2233:{t:1},2234:{t:2},2235:{t:2},2236:{t:2},2237:{t:2},2274:{t:4},8204:{t:4},8205:{t:3},8239:{t:4},8294:{t:4},8295:{t:4},8296:{t:4},8297:{t:4},65269:{t:1,isolated:65269,initial:65270},65271:{t:1,isolated:65271,initial:65272},65273:{t:1,isolated:65273,initial:65274},65275:{t:1,isolated:65275,initial:65276}},ie={1611:1,1612:1,1613:1,1614:1,1615:1,1616:1,1617:1,1618:1,1619:1,1620:1,1621:1,1648:1},ae={1456:1,1457:1,1458:1,1459:1,1460:1,1461:1,1462:1,1463:1,1464:1,1465:1,1466:1,1467:1,1473:1,1474:1},oe={"\u0644":{"\u0627":"\ufefb","\u0622":"\ufef5","\u0623":"\ufef7","\u0625":"\ufef9"},"\u0627":{"\u0644":{"\u0644":{"\u0647":"\ufdf2"}}}},ue={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{",">":"<","<":">"},se=63;T.analyseText=function(o){if(E[o])return E[o];var u={characters:[],logicalOrder:o,reorderedCharacters:[],result:[]},s=e(o),l=i(o,s);return l.forEach(function(e){a(e),r(e),t(e),n(e),v(e),m(e),b(e),I(e),x(e),B(e,ae,!1),w(e),u.result=u.reorderedCharacters.concat(e.reorderedCharacters),u.characters=u.characters.concat(e.characters)}),u.types=s,E[o]=u},T.reorderText=function(e){return T.analyseText(e).result.map(function(e){return e.text}).join("")}}(),function(){function e(e,t,n){return function(){if(!n||!n()){var r,i=t[e];return i&&(r=i.apply(null,arguments)),r}}}var t=KeyLines.Common={};t.frameManager=function(e,t){function n(){return{all:!0,colours:!0,textures:!0,positions:!0,shadow:!0}}function r(){s.all=!1,s.colours=!1,s.textures=!1,s.positions=!1,s.shadow=!1}var i=Date.now(),a=i>>10,o=0,u=!1,s=n(),l=!0,f=0;return{frameRate:function(){return f},update:function(){var n=Date.now(),c=n>>10;c>a?(f=Math.round(o/(c-a)),o=0,a=c):o++;var d=t(n-i);i=n,u=u||d,u&&(u=!1,l&&(e(null,s),r()))},redraw:function(e){u=!0,e=e||n(),s.all||(s.all=e.all),s.positions||(s.positions=e.positions),s.shadow||(s.shadow=e.shadow),s.textures||(s.textures=e.textures),s.colours||(s.colours=e.colours)},allowDraw:function(e){e&&!l&&(u=!0),l=e}}},t.buildAnimatorInstance=function(e,t){var n=!0;return{rebuild:t,animate:function(t){var r=e(t,n);return n=!1,r}}},t.animator=function(e){var t=[],n=[];return{push:function(e,r){e&&(e.queue=r,r?n.push(e):t.push(e))},cancel:function(){t=[],n=[],e()},animate:function(r,i,a){var o=!1,u=!1;if(t.length>0){var s=t;t=[];for(var l=0;l<s.length;l++)s[l].animate(r)&&(u=u||s[l].queue,t.push(s[l])),e(s[l].rebuild);o=!0}return u||n.length>0&&(t.push(n.shift()),o=!0),i&&i.animate&&(i.animate(r),o=!0),a&&(o=o||a.animated()),o}}},t.makeValueAnimator=function(e,n){var r,i,a,o;return function(u,s,l){var f=n();f===u||o&&i===u||(r=f,i=u,a=0,o||(o=t.buildAnimatorInstance(function(e){a=Math.min(s,a+e);var t=0>=s?i:r+(i-r)*a/s;n(t);var u=s>a;return u||(o=null,KeyLines.Util.invoke(l)),u}),e.push(o,!1)))}};var n=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];t.appendActions=function(t,r,i){for(var a=0;a<n.length;a++)t[n[a]]=e(n[a],r,i)},t.hitTester=function(e,t,n,r){function i(e,i){o.clear(e,t,n),o.backFill(e,u,1,t,n),r.drawShadowCanvas(e,i),s=!1}var a,o=KeyLines.Rendering,u=o.randomColour(),s=!0,l=5,f=function(){var e={},t={};return{getColour:function(n){if(n in e)return e[n];var r=o.randomColour(t);return e[n]=r,t[r]=n,r},getId:function(e){return t[e]||null}}}();r.setShadowColourMap(f);var c={};return c.test=function(t,n,r,i,a){var d=[0,0,0];a&&a.webgl?d=a.webglCanvas.renderer.drawShadowCanvas(Math.floor(t),Math.floor(n)):(s&&c.draw(r),d=e.getImageData(Math.floor(t),Math.floor(n),1,1).data);var g=o.rgbtostring(d[0],d[1],d[2]);if(g===u)return null;var h=f.getId(g);return h?h:a&&a.webgl?null:(i=i||1,i>l?null:t+i>l&&n+i>l?c.test(t-1,n-1,r,++i,a):c.test(t+1,n+1,r,++i,a))},c.dirty=function(){s=!0},c.debugCanvas=function(e){a=e},c.draw=function(t){i(e,t),a&&i(a,t)},c}}(),function(){var e=KeyLines.DateTime={},t=e.defaultLocale={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},n=[31,28,31,30,31,30,31,31,30,31,30,31],r=e.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},i=function(e,t){return t?e-e%t:0},a=function(e){if(e<r.milli||r.year<e)throw new Error("bad unit range")},o=function(e,t){return 1===e&&u(t)?29:n[e]},u=function(e){return 1===new Date(e,1,29).getMonth()};e.UTCify=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e.unUTCify=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},e.clear=function(e,t,n){a(t);var o=new Date(e);switch(t>r.milli&&o.setUTCMilliseconds(0),t>r.sec&&o.setUTCSeconds(0),t>r.min&&o.setUTCMinutes(0),t>r.hour&&o.setUTCHours(0),t>=r.month&&o.setUTCDate(1),t>=r.year&&o.setUTCMonth(0),t){case r.milli:o.setUTCMilliseconds(i(o.getUTCMilliseconds(),n));break;case r.sec:o.setUTCSeconds(i(o.getUTCSeconds(),n));break;case r.min:o.setUTCMinutes(i(o.getUTCMinutes(),n));break;case r.hour:o.setUTCHours(i(o.getUTCHours(),n));break;case r.day:break;case r.week:var u=o.getUTCDay(),s=u>=1?u-1:6;o.setTime(o.getTime()-24*s*60*60*1e3);break;case r.month:o.setUTCMonth(i(o.getUTCMonth(),n));break;case r.year:o.setUTCFullYear(i(o.getUTCFullYear(),n))}return o.getTime()};var s=e.add=function(e,t,n){if(a(t),t<=r.week){var i=n;return t>r.milli&&(i*=1e3),t>r.sec&&(i*=60),t>r.min&&(i*=60),t>r.hour&&(i*=24),t>r.day&&(i*=7),e+i}var l=new Date(e);switch(t){case r.month:var f=l.getUTCMonth()+n,c=f%12,d=Math.floor(f/12);0>c&&(c+=12);var g=l.getUTCDate();g=Math.min(g,o(c,l.getUTCFullYear()+d)),l.setUTCDate(g),l.setUTCMonth(c),0!==d&&l.setTime(s(l.getTime(),r.year,d));break;case r.year:if(1===l.getUTCMonth()&&29===l.getUTCDate()){var h=l.getUTCFullYear()+n;u(h)||l.setTime(s(l.getTime(),r.day,-1))}l.setUTCFullYear(l.getUTCFullYear()+n)}return l.getTime()},l=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},f=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),c={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return l(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return l(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){return l(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return l(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return l(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return l(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return l(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return l(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return l(e.getUTCFullYear()%100)}};e.format=function(e,n,r){return"number"==typeof e&&(e=new Date(e)),r=r||t,n.replace(f,function(t){return c[t](e,r)})};var d="(?::)?",g="(?:-|$)",h="(?:T|$)",v=function(e,t){return e[t]?parseInt(e[t],10):void 0},m=function(e,t,n,r){var i=v(e,t);return x(i)?i>=n&&r>=i?i:void 0:n},x=function(e){return"undefined"!=typeof e},y=new RegExp("^(\\d{4})"+g+"(\\d{2})?"+g+"(\\d{2})?"+h+"(\\d{2})?"+d+"(\\d{2})?"+d+"(\\d{2})?(?:Z)?(\\+|-)?(\\d{2})?"+d+"(\\d{2})?");e.parseISO8601=function(e){var t=y.exec(e);if(t){var n=v(t,1),r=m(t,2,1,12),i=m(t,3,1,31),a=m(t,4,0,23),u=m(t,5,0,59),s=m(t,6,0,59),l="-"===t[7]?-1:1,f=m(t,8,0,12),c=m(t,9,0,59);if(!(x(n)&&x(r)&&x(i)&&x(a)&&x(u)&&x(s)&&x(f)&&x(c)))return;if(i>o(r-1,n))return;var d=l*(60*f+c)*60*1e3;return new Date(Date.UTC(n,r-1,i,a,u,s)-d)}}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.LineShader=function(t){function n(e,t,n,r,i,a){c.uniform2f(h.resolution,t,n),c.uniformMatrix4fv(h.transform,!1,e.get()),c.uniform1f(h.hitTest,0|r),c.uniform1f(h.zoom,e.getZoomLevel()),c.uniform1f(h.shadowType,i),c.uniform1f(h.viewIndependent,0|!a)}function r(e){e.elementBuffer||(e.elementBuffer=c.createBuffer()),e.indexBuffer||(e.indexBuffer=c.createBuffer())}function i(e){c.bindBuffer(c.ARRAY_BUFFER,e.elementBuffer),c.enableVertexAttribArray(h.position),c.enableVertexAttribArray(h.width),c.enableVertexAttribArray(h.vertexInfo),c.enableVertexAttribArray(h.colour),c.enableVertexAttribArray(h.shadowColour),c.vertexAttribPointer(h.position,4,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,0),c.vertexAttribPointer(h.width,1,c.FLOAT,!1,8*Float32Array.BYTES_PER_ELEMENT,16),c.vertexAttribPointer(h.vertexInfo,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,20),c.vertexAttribPointer(h.colour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,24),c.vertexAttribPointer(h.shadowColour,4,c.UNSIGNED_BYTE,!1,8*Float32Array.BYTES_PER_ELEMENT,28)}function a(e,t){(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.positions||e.rebuildOptions.colours||e.rebuildOptions.textures||e.rebuildOptions.shadow)&&(c.bindBuffer(c.ARRAY_BUFFER,t.elementBuffer),c.bufferData(c.ARRAY_BUFFER,t.elementData,c.DYNAMIC_DRAW),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,t.elementIndex,c.DYNAMIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null))}function o(e){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.indexBuffer),c.drawElements(c.TRIANGLES,3*e.numOfTriangles,c.UNSIGNED_INT,0)}function u(){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindBuffer(c.ARRAY_BUFFER,null)}var s=e.Utils,l=e["line-vertex"],f=e["line-fragment"],c=t,d={},g=s.createProgram(c,atob(l),atob(f));c.getExtension("OES_standard_derivatives"),c.getExtension("OES_element_index_uint");var h={hitTest:c.getUniformLocation(g,"u_hitTest"),zoom:c.getUniformLocation(g,"u_zoom"),transform:c.getUniformLocation(g,"u_transform"),resolution:c.getUniformLocation(g,"u_resolution"),shadowType:c.getUniformLocation(g,"u_shadowType"),viewIndependent:c.getUniformLocation(g,"u_viewIndependent"),position:c.getAttribLocation(g,"a_position"),colour:c.getAttribLocation(g,"a_colour"),width:c.getAttribLocation(g,"a_width"),vertexInfo:c.getAttribLocation(g,"a_vertexInfo"),shadowColour:c.getAttribLocation(g,"a_hitTestColour")};return d.drawItems=function(e,t,s,l,f,d){c.useProgram(g),u(),n(s,l,f,d,0|e.shadowType,e.useView),r(t),a(e,t),i(t),o(t),u()},d})}(),function(){function e(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n]]=1;return t}function t(t){for(var n=e(t),r=[],i=0;i<W.length;i++)n[i]||r.push(i);return r}function n(e){return"transparent"===e||e===X.transparent}function r(e,t){return 1===t?e:oe(e,t)}function i(e,t,n,r,i,a){var o,u,s=0;if(KeyLines.Util.isTextArabic(t)){var l=KeyLines.Bidi.analyseText(t).result;for(o=0,u=l.length;u>o;o++){var f=l[o];KeyLines.Util.isTextArabic(f.text)?ie(e,n,i,a):ie(e,r,i,a),s+=e.measureText(f.text).width}}else for(o=0,u=t.length;u>o;o++)s+=e.measureText(t[o]).width;return s}function a(e){var t={};for(var n in e)t[T.primitives[n]]=e[n];return t}function o(e,t,n,r){var i,a,o,u;t.sm?(i=n.sdim(t.r),a=n.sdim(t.bw)):(i=n.dim(t.r),a=r?n.sw(t.bw):n.w(t.bw));var s=t.a;s?(o=t.x+s.x,u=t.y+s.y):(o=t.x,u=t.y),r?p(e,n.x(o),n.y(u),i,t.bc&&t.sc,a,t.fc&&t.sc,t.fi):p(e,n.x(o),n.y(u),i,t.bc,a,t.fc,t.fi,t.bs)}function u(e,t,n,r){var i,a,o=t.a;o?(i=t.x+o.x,a=t.y+o.y):(i=t.x,a=t.y);var u,s,l,f=n.x(i),c=n.y(a),d=n.dim(t.r);r?(u=t.bc&&t.sc,s=n.sw(t.bw)):(u=t.bc,s=n.w(t.bw),l=t.ls),b(e,f,c,d,t.sa,t.ea,u,s,l)}function s(e,t,n,r){var i,a,o,u,s=t.a;s?(i=t.x1+s.x,a=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?I(e,n.x(i),n.y(a),n.x(o),n.y(u),t.c&&t.sc,n.sw(t.w)):I(e,n.x(i),n.y(a),n.x(o),n.y(u),t.c,n.w(t.w),t.ls)}function l(e,t,n,r){var i,a,o,u,s,l,f,c,d=t.a;d?(i=t.x1+d.x,a=t.y1+d.y,o=t.x2+d.x,u=t.y2+d.y,s=t.x3+d.x,l=t.y3+d.y,f=t.x4+d.x,c=t.y4+d.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3,f=t.x4,c=t.y4),r?w(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),t.c&&t.sc,n.sw(t.w)):w(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),t.c,n.w(t.w),t.ls)}function f(e,t,n,r){var i,a,o,u,s=t.a;if(s?(i=t.x1+s.x,a=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r)t.back&&C(e,n.x(i),n.y(a),n.x(o),n.y(u),t.sc,-1,t.sc,!0);else{var l,f;s?(l=t.x+s.x,f=t.y+s.y):(l=t.x,f=t.y);var c=t.xc;c&&T.applyRtlFix&&(c=!1,l-=Math.floor(t.w/2));var d=n.x(l),g=n.y(f),h=n.dim(t.fs);if(t.w&&(3>=h||h<T.browserMinimumFontSize)){var v=n.dim(t.w),m=t.isSel?t.bc:oe(t.c,.4);c&&(d-=Math.floor(v/2)),t.back&&t.bc!==X.textback&&C(e,d,g-h,d+v,g,t.bc,-1,t.bc,!0),C(e,d,g-h,d+v,g,m,-1,m,!0)}else t.back&&C(e,n.x(i),n.y(a),n.x(o),n.y(u),t.bc,-1,t.bc,!0),B(e,d,g,t.t,t.c,h,t.bo,t.ff,c)}}function c(e,t,n,r,i){var a,o,u,s,l=t.a;l?(a=t.x1+l.x,o=t.y1+l.y,u=t.x2+l.x,s=t.y2+l.y):(a=t.x1,o=t.y1,u=t.x2,s=t.y2);var f=n.x(a),c=n.y(o),d=n.x(u),g=n.y(s);if(t.vx&&(f-=t.vx,c-=t.vx,d+=t.vx,g+=t.vx),r)C(e,f,c,d,g,t.sc,-1,t.sc,!0);else{var h=i[t.u];if(t.hi&&he()){var v=i[ve(t.u)];v&&!v.missing&&(h=v)}A(e,h,f,c,d,g,t.s)}}function d(e,t,n,r){var i,a,o,u,s=t.a;s?(i=t.x1+s.x,a=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?C(e,n.x(i),n.y(a),n.x(o),n.y(u),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):C(e,n.x(i),n.y(a),n.x(o),n.y(u),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function g(e,t,n,r){var i,a,o,u,s=t.a;s?(i=t.x1+s.x,a=t.y1+s.y,o=t.x2+s.x,u=t.y2+s.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2),r?M(e,n.x(i),n.y(a),n.x(o),n.y(u),n.dim(t.r),t.bc,n.sw(t.bw),t.fc&&t.sc,t.fi):M(e,n.x(i),n.y(a),n.x(o),n.y(u),n.dim(t.r),t.bc,n.w(t.bw),t.fc,t.fi)}function h(e,t,n,r){var i,a,o,u,s,l,f=t.a;f?(i=t.x1+f.x,a=t.y1+f.y,o=t.x2+f.x,u=t.y2+f.y,s=t.x3+f.x,l=t.y3+f.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3),r?Z(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):Z(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),t.bc,n.w(t.bw),t.fc,t.fi)}function v(e,t,n,r){var i,a,o,u,s,l,f,c,d,g,h=t.a;h?(i=t.x1+h.x,a=t.y1+h.y,o=t.x2+h.x,u=t.y2+h.y,s=t.x3+h.x,l=t.y3+h.y,f=t.x4+h.x,c=t.y4+h.y,d=t.x5+h.x,g=t.y5+h.y):(i=t.x1,a=t.y1,o=t.x2,u=t.y2,s=t.x3,l=t.y3,f=t.x4,c=t.y4,d=t.x5,g=t.y5),r?D(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),n.x(d),n.y(g),t.bc&&t.sc,n.sw(t.bw),t.fc&&t.sc,t.fi):D(e,n.x(i),n.y(a),n.x(o),n.y(u),n.x(s),n.y(l),n.x(f),n.y(c),n.x(d),n.y(g),t.bc,n.w(t.bw),t.fc,t.fi,t.bs)}function m(e,t,n,r,i){var a,o;"dotted"===r?(a=.5,o=2*n):(a=Math.max(2,2*n),o=a/2);var u=Math.round(i?t/(a+o):(t+o)/(a+o));u>1&&(o=i?(t-u*a)/u:(t-u*a)/(u-1),o>0&&(e.lineCap=a>1?"butt":"round",ee[0]=a,ee[1]=o,e.setLineDash(ee)))}function x(e,t){return e&&"solid"!==e&&"setLineDash"in t}function y(e){ee[0]&&(ee[0]=0,e.setLineDash(te),e.lineCap="butt")}function p(e,t,n,r,i,a,o,u,s){e.fillStyle=u?o:X.transparent,a>=0&&(x(s,e)&&m(e,k*r,a,s,!0),e.lineWidth=Math.max(1,a),e.strokeStyle=i),e.beginPath(),e.arc(t,n,r,0,k,!1),e.closePath(),u&&e.fill(),a>=0&&(e.stroke(),s&&y(e))}function b(e,t,n,r,i,a,o,u,s){if(e.lineWidth=Math.max(1,u),e.strokeStyle=o,x(s,e)){var l=(a-i)*r;m(e,l,u,s)}e.beginPath(),e.arc(t,n,r,i,a,!1),e.stroke(),e.closePath(),s&&y(e)}function I(e,t,n,r,i,a,o,u){if(e.lineWidth=Math.max(1,o),e.strokeStyle=a,x(u,e)){var s=r-t,l=i-n,f=Math.sqrt(s*s+l*l);m(e,f,o,u)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.stroke(),e.closePath(),u&&y(e)}function w(e,t,n,r,i,a,o,u,s,l,f,c){var d=e.lineJoin;if(e.lineWidth=Math.max(1,f),e.lineJoin="round",e.strokeStyle=l,x(c,e)){var g=r-t,h=i-n,v=Math.sqrt(g*g+h*h),p=a-r,b=o-i,I=Math.sqrt(p*p+b*b),w=u-a,B=s-o,C=Math.sqrt(w*w+B*B);m(e,v+I+C,f,c)}e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(u,s),e.stroke(),e.closePath(),e.lineJoin=d,c&&y(e)}function B(e,t,n,r,i,a,o,u,s){ie(e,a,o,u),e.fillStyle=i,e.textAlign=s?"center":"left",e.fillText(r,t,n)}function C(e,t,n,r,i,a,o,u,s,l){if(s&&(e.fillStyle=u,e.fillRect(t,n,r-t,i-n)),o>=0)if(x(l,e)){var f=Math.floor(o/2);I(e,t-f,n,r+f,n,a,o,l),I(e,r,n-f,r,i+f,a,o,l),I(e,r+f,i,t-f,i,a,o,l),I(e,t,i+f,t,n-f,a,o,l)}else e.lineWidth=Math.max(1,o),e.strokeStyle=a,e.strokeRect(t,n,r-t,i-n)}function A(e,t,n,r,i,a,o){var u=t[o?o:"im"];e.drawImage(u,n,r,i-n,a-r)}function M(e,t,n,r,i,a,o,u,s,l){e.beginPath(),e.moveTo(t+a,n),e.lineTo(r-a,n),e.arcTo(r,n,r,n+a,a),e.lineTo(r,i-a),e.arcTo(r,i,r-a,i,a),e.lineTo(t+a,i),e.arcTo(t,i,t,i-a,a),e.lineTo(t,n+a),e.arcTo(t,n,t+a,n,a),e.closePath(),l&&(e.fillStyle=s,e.fill()),u>=0&&(e.lineWidth=Math.max(1,u),e.strokeStyle=o,e.stroke());
}function Z(e,t,n,r,i,a,o,u,s,l,f){(Math.abs(r-t)>F||Math.abs(i-n)>F)&&(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(t,n),e.closePath(),f&&(e.fillStyle=l,e.fill()),s>=0&&(e.lineWidth=Math.max(1,s),e.strokeStyle=u,e.stroke()))}function D(e,t,n,r,i,a,o,u,s,l,f,c,d,g,h,v){if(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(u,s),e.lineTo(l,f),e.lineTo(t,n),e.closePath(),h&&(e.fillStyle=g,e.fill()),d>=0)if(x(v,e)){var m=(r>t?1:-1)*Math.floor(d/2);I(e,t,n,r,i,c,d,v),I(e,r,i,a,o,c,d,v),I(e,a,o,u-m,s,c,d,v),I(e,u,s+m,l,f-m,c,d,v),I(e,l-m,f,t,n,c,d,v)}else e.lineWidth=Math.max(1,d),e.strokeStyle=c,e.stroke()}function G(e,t,n){e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),u=(a+o)/2;if(a===o)r=i=0;else{var s=a-o;switch(i=u>.5?s/(2-a-o):s/(a+o),a){case e:r=(t-n)/s+(n>t?6:0);break;case t:r=(n-e)/s+2;break;case n:r=(e-t)/s+4}r/=6}return[r,i,u]}function L(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}function R(e,t,n){var r,i,a;if(0===t)r=i=a=n;else{var o=.5>n?n*(1+t):n+t-n*t,u=2*n-o;r=L(u,o,e+1/3),i=L(u,o,e),a=L(u,o,e-1/3)}return[Math.ceil(255*r),Math.ceil(255*i),Math.ceil(255*a)]}function S(e){return e}var T=KeyLines.Rendering={},E=Math.PI/2,k=2*Math.PI,F=3,V={};var Ad=new Date().getTime()/36774;var W=["TIMEBAR","BANDS","UNDERLAYS","HALOS","SHAPESEL","SHAPES","HANDLES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","OVERLAYSSHADOW","OVERVIEW","OVERVIEWSHADOW","WAIT"];var at={a:"LTMxLC02NCwtNTgsLTEzLC02NiwtNjgsLTY5LC02MiwtNTcsLTY4LC00NSw3NiwtMSw0Nyw4NiwtMzcsLTQ2LC00NA==",b:"LTIyLC01NiwtNTgsLTUsLTEyLC02MywtNjUsLTExLDEsLTY0LC03Myw1MiwyNSw0LDczLC0yLC0xNCw2LDE2LC0yMiwtNDYsLTcxLDM0LDEwLC01NA=="};for(var U=W.length,O=T.layers={},N=0;U>N;N++)O[W[N]]=N;var K=T.channels={MAIN:0,BACKGROUND:1,GHOST:2,BACKGROUNDGHOST:3};T.itemLayers=[O.HALOS,O.SHAPESEL,O.SHAPES,O.NODESEL,O.LINKS,O.NODES,O.BUBBLES],T.extraLayers=t(T.itemLayers),T.topLayers=[O.HALOS,O.SHAPESEL,O.SHAPES,O.NODESEL,O.LINKS,O.NODES,O.HANDLES,O.DRAGGERS,O.BUBBLES,O.BANDLABELS,O.OVERLAYS],T.shadowLayers=t([O.BANDS,O.UNDERLAYS,O.BANDLABELS,O.OVERLAYS,O.OVERVIEW]),T.viewLayers=[O.BANDS,O.BANDLABELS,O.HANDLES,O.OVERLAYS,O.OVERVIEW,O.OVERLAYSSHADOW,O.OVERVIEWSHADOW,O.TIMEBAR,O.UNDERLAYS,O.WAIT],T.viewLayersIndex=e(T.viewLayers),T.mainChannel=function(){return at.a||at.b},T.selMap={},T.selMap[O.NODES]=O.NODESEL,T.selMap[O.SHAPES]=O.SHAPESEL,T.widgets=function(){function t(e){return(e.gh?2:0)+(e.bg?1:0)}function n(e){return g[t(e)]}function r(){for(var e,t,n=T.itemLayers,r=0;4>r;r++){e=g[r];for(var i=0,a=n.length;a>i;i++){var o=n[i];t=e[o],t?t.count=0:e[o]={pool:[],count:0}}}}function i(){for(var e,t=Object.keys(d),n=0;n<t.length;n++)e=d[t[n]],a(e)}function a(e){for(var t=n(e),r=0;r<e.count;r++){var i=e.pool[r],a=t[i.la];a.pool[a.count++]=i}}function o(t,n,r,i,a,o){V={},T.applyRtlFix=T.rtlBugPresent&&T.isRTL(t.canvas);for(var u=g[a],s=e(o),l=0;U>l;l++)if((!o||s[l])&&u[l])for(var f=u[l],c=T.viewLayersIndex[l]?be:n,d=0;d<f.count;d++){var h=f.pool[d];if(!r||h.sc){var v=pe[h.p];v&&v(t,h,c,r,i)}}}function u(e){var t=l.pool,n=l.count;t[n]||(t[n]={}),l.count=n+1;var r=t[n];return r.id=e,r.sc=f.getColour(e+""),r.wsc=se(r.sc),null!==v&&(r.la=s),null!==v&&"x"in l?r.a=l:r.a=null,r}var s,l,f,c={},d={},g=[[],[],[],[]],h=g[0],v=null;c.getLayer=function(){return s},c.setLayer=function(e){s=e,null===v&&(h[e]||(h[e]={pool:[],count:0}),l=h[e])},c.removeAllItems=function(){d={}},c.removeItem=function(e){delete d[e]},c.resetItem=function(e,t,n){v=e.id,d[v]?d[v].count=0:d[v]={pool:[],count:0},l=d[v],l.bg=!!e.bg,l.gh=!!e.gh,arguments.length>1&&(l.x=t,l.y=n),l.count=0},c.moveItem=function(e,t,n){var r=d[e.id];r&&(r.x=t,r.y=n)},c.resetExtras=function(){for(var e=T.extraLayers,t=0;t<e.length;t++){var n=e[t];h[n]&&(h[n].count=0)}v=null},c.extras=function(){v=null};var m=c.getLast=function(){return l&&l.count>0?l.pool[l.count-1]:null};return c.cloneLast=function(){return KeyLines.Util.shallowClone(m())},c.assembleItems=function(){r(),i()},c.each=function(t,n,r){for(var i=g[n],a=e(r),o=0;U>o;o++)if((!r||a[o])&&i[o])for(var u=i[o],s=0;s<u.count;s++)t(u.pool[s])},c.itemExtents=function(e,t){var n;for(var r in d)if(!e||e[r])for(var i=d[r],a=0;a<i.count;a++){var o=i.pool[a],u=le(t,o);n=n?fe(n,u):u}return n},c.draw=function(e,t,n,r,i){var yh=117449572-fG;if(yh===Math.abs(yh))yh=0,o(e,t,!1,n,r,i)},c.excludeHit=function(e){if(e){var t=d[e];if(t)for(var n=0;n<t.count;n++){var r=t.pool[n];r.sc=r.wsc=null}}},c.drawShadowCanvas=function(e,t){o(e,t,!0,null,K.BACKGROUND,T.itemLayers),o(e,t,!0,null,K.MAIN,T.shadowLayers)},c.setShadowColourMap=function(e){f=e},c.line=function(e,t,n,r,i,a,o,s){var l=u(o),f=l.a;l.p=T.primitives.line,f?(l.x1=e-f.x,l.y1=t-f.y,l.x2=n-f.x,l.y2=r-f.y):(l.x1=e,l.y1=t,l.x2=n,l.y2=r),l.c=i,l.w=a,l.ls=s,l.wc=se(i)},c.line3=function(e,t,n,r,i,a,o,s,l,f,c,d){var g=u(c),h=g.a;g.p=T.primitives.line3,h?(g.x1=e-h.x,g.y1=t-h.y,g.x2=n-h.x,g.y2=r-h.y,g.x3=i-h.x,g.y3=a-h.y,g.x4=o-h.x,g.y4=s-h.y):(g.x1=e,g.y1=t,g.x2=n,g.y2=r,g.x3=i,g.y3=a,g.x4=o,g.y4=s),g.c=l,g.w=f,g.ls=d,g.wc=se(l)},c.circle=function(e,t,n,r,i,a,o,s,l,f){var c=u(s),d=c.a;c.p=T.primitives.circle,d?(c.x=e-d.x,c.y=t-d.y):(c.x=e,c.y=t),c.r=n,c.bc=r,c.bw=i,c.fc=a,c.fi=o,c.bs=l,c.sm=f,c.wbc=se(r),c.wfc=se(a)},c.arc=function(e,t,n,r,i,a,o,s,l){var f=u(s),c=f.a;f.p=T.primitives.arc,c?(f.x=e-c.x,f.y=t-c.y):(f.x=e,f.y=t),f.r=n,f.sa=r,f.ea=i,f.bc=a,f.bw=o,f.ls=l,f.wbc=se(a)},c.text=function(e,t,n,r,i,a,o,s,l,f,c,d,g,h,v,m,x,y,p){var b=u(o),I=b.a;b.p=T.primitives.text,I?(b.x=e-I.x,b.y=t-I.y):(b.x=e,b.y=t),b.t=n,b.c=r,b.fs=i,b.bo=a,b.ff=s,b.wmargin=p||0,b.xc=l,b.w=f,b.isfi=c,b.isSel=y,b.wc=se(r),b.id=o,I?(b.x1=g-I.x,b.y1=h-I.y,b.x2=v-I.x,b.y2=m-I.y):(b.x1=g,b.y1=h,b.x2=v,b.y2=m),b.back=d,d&&(b.wbc=se(x),b.bc=x)},c.image=function(e,t,n,r,i,a,o,s,l){var f=u(a),c=f.a;f.p=T.primitives.image,c?(f.x1=e-c.x,f.y1=t-c.y,f.x2=n-c.x,f.y2=r-c.y):(f.x1=e,f.y1=t,f.x2=n,f.y2=r),f.u=i,f.s=o,f.vx=s,f.hi=l},c.rect=function(e,t,n,r,i,a,o,s,l,f){var c=u(l),d=c.a;c.p=T.primitives.rect,d?(c.x1=e-d.x,c.y1=t-d.y,c.x2=n-d.x,c.y2=r-d.y):(c.x1=e,c.y1=t,c.x2=n,c.y2=r),c.bc=i,c.bw=a,c.fc=o,c.fi=s,c.bs=f,c.wbc=se(i),c.wfc=se(o)},c.round=function(e,t,n,r,i,a,o,s,l,f){var c=u(f),d=c.a;c.p=T.primitives.round,d?(c.x1=e-d.x,c.y1=t-d.y,c.x2=n-d.x,c.y2=r-d.y):(c.x1=e,c.y1=t,c.x2=n,c.y2=r),c.r=i,c.bc=a,c.bw=o,c.fc=s,c.fi=l,c.wbc=se(a),c.wfc=se(s)},c.triangle=function(e,t,n,r,i,a,o,s,l,f,c){var d=u(c),g=d.a;d.p=T.primitives.triangle,g?(d.x1=e-g.x,d.y1=t-g.y,d.x2=n-g.x,d.y2=r-g.y,d.x3=i-g.x,d.y3=a-g.y):(d.x1=e,d.y1=t,d.x2=n,d.y2=r,d.x3=i,d.y3=a),d.bc=o,d.bw=s,d.fc=l,d.fi=f,d.wbc=se(o),d.wfc=se(l)},c.pentagon=function(e,t,n,r,i,a,o,s,l,f,c,d,g,h,v,m){var x=u(v),y=x.a;x.p=T.primitives.pentagon,y?(x.x1=e-y.x,x.y1=t-y.y,x.x2=n-y.x,x.y2=r-y.y,x.x3=i-y.x,x.y3=a-y.y,x.x4=o-y.x,x.y4=s-y.y,x.x5=l-y.x,x.y5=f-y.y):(x.x1=e,x.y1=t,x.x2=n,x.y2=r,x.x3=i,x.y3=a,x.x4=o,x.y4=s,x.x5=l,x.y5=f),x.bc=c,x.bw=d,x.fc=g,x.fi=h,x.bs=m,x.wbc=se(c),x.wfc=se(g)},c.copyPrimitive=function(e){var t=u(e.id);for(var n in e)t[n]=e[n]},c},T.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE"};var H="rgb(128, 128, 128)",X=T.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:H,gray:H,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",orange:"rgb(255,165,0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"};var fG=new Date()/12636;var Y=T.rgbtostring=function(e,t,n){return"rgb("+e+","+t+","+n+")"},z=T.rgbatostring=function(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"},P=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,_=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,j=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,J=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;T.validatergb=function(e){return!!Q(e).length};var Q=T.convertrgb=function(e){var t,n=[],r=X[e.toLowerCase()];e=r?r:e;var i=e.match(P);if(i||(i=e.match(_)),i)for(t=1;4>t;t++)n.push(parseInt(i[t],10));else{if(i=e.match(J),!i&&(i=e.match(j)))for(t=1;4>t;t++)i[t]=""+i[t]+i[t];if(i)for(t=1;4>t;t++)n.push(parseInt(i[t],16))}return n},q=T.opacity=function(e){if("transparent"===e)return 0;var t=e.match(_);return t?parseFloat(t[4]):1};T.hsla=function(e){var t=Q(e),n=G(t[0],t[1],t[2]);return n.push(q(e)),n},T.fromhsla=function(e){var t=R(e[0],e[1],e[2]);return z(t[0],t[1],t[2],e[3])},T.rgbtohex=function(e){for(var t=Q(e),n="",r=0;r<t.length;r++){var i=t[r];n+=(16>i?"0":"")+i.toString(16)}return n};var $=T.randomColour=function(e){function t(){return Math.floor(255*Math.random())}var n=Y(t(),t(),t());return e&&n in e?$(e):n},ee=[0,0],te=[],ne={};T.clearLastFont=function(){ne={}};var re="sans-serif";T.browserMinimumFontSize=1,T.rtlBugPresent=!1,T.applyRtlFix=!1;var ie=T.setFont=function(e,t,n,r){if(n=!!n,r=r||re,e!==ne.context||t!==ne.fontSize||n!==ne.bold||r!==ne.family){ne.context=e,ne.fontSize=t,ne.bold=n,ne.family=r;var i=n?"bold":"normal",a="normal",o="px",u=a+" "+i+" "+t+o+" "+r;e.font=u,e.textBaseline="bottom"}};T.setAlpha=function(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var i=n[r];if(i in e){var a=Q(e[i]);e[i]=z(a[0],a[1],a[2],t)}}};var ae={},oe=T.alphaize=function(e,t){var n=e+t;if(!ae[n]){var r=Q(e),i=q(e);ae[n]=z(r[0],r[1],r[2],i*t)}return ae[n]},ue={},se=T.webglColour=function(e){if(e){if(!ue[e]){var t=Q(e),n=q(e);ue[e]=[t[0],t[1],t[2],Math.floor(255*n)]}return ue[e]}return e};T.setExtents=function(e,t,n,r,i){var a,o,u=e.a;switch(u&&(t-=u.x,n-=u.y,r-=u.x,i-=u.y),e.p){case T.primitives.circle:a=Math.abs((r-t)/2),o=Math.abs((i-n)/2),e.x=Math.floor(Math.min(t,r)+a),e.y=Math.floor(Math.min(n,i)+o),e.r=Math.floor(Math.min(a,o));break;case T.primitives.line:case T.primitives.rect:case T.primitives.round:e.x1=Math.min(t,r),e.x2=Math.max(t,r),e.y1=Math.min(n,i),e.y2=Math.max(n,i);break;case T.primitives.line3:break;case T.primitives.text:e.x=Math.min(t,r),e.y=Math.max(n,i);break;case T.primitives.image:e.x1=Math.min(t,r),e.y1=Math.min(n,i),e.x2=Math.max(t,r),e.y2=Math.max(n,i);break;case T.primitives.triangle:case T.primitives.pentagon:}};var le=T.extents=function(e,t){var n,r,i,a;switch(t.p){case T.primitives.circle:n=t.x-t.r,r=t.x+t.r,i=t.y-t.r,a=t.y+t.r;break;case T.primitives.line:case T.primitives.rect:case T.primitives.round:case T.primitives.image:n=Math.min(t.x1,t.x2),r=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),a=Math.max(t.y1,t.y2);break;case T.primitives.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4),r=Math.max(t.x1,t.x2,t.x3,t.x4),i=Math.min(t.y1,t.y2,t.y3,t.y4),a=Math.max(t.y1,t.y2,t.y3,t.y4);break;case T.primitives.text:var o=ye(e,t.t,t.fs,t.bo,t.ff);n=t.x-(t.xc?o.width/2:0),i=t.y-o.height,r=n+o.width,a=t.y;break;case T.primitives.triangle:n=Math.min(t.x1,t.x2,t.x3),r=Math.max(t.x1,t.x2,t.x3),i=Math.min(t.y1,t.y2,t.y3),a=Math.max(t.y1,t.y2,t.y3);break;case T.primitives.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5),r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5),i=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5),a=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case T.primitives.arc:var u=t.x+t.r*Math.cos(t.sa),s=t.y+t.r*Math.sin(t.sa),l=t.x+t.r*Math.cos(t.ea),f=t.y+t.r*Math.sin(t.ea);n=Math.min(u,l),r=Math.max(u,l),i=Math.min(s,f),a=Math.max(s,f);for(var c=(Math.floor(t.sa/E)+1)*E;c<t.ea;){var d=t.x+t.r*Math.cos(c),g=t.y+t.r*Math.sin(c);n=Math.min(n,d),r=Math.max(r,d),i=Math.min(i,g),a=Math.max(a,g),c+=E}}var h=t.a;return h&&(n+=h.x,i+=h.y,r+=h.x,a+=h.y),{x1:n,y1:i,x2:r,y2:a}},fe=T.join=function(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}};T.inside=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},T.insideCircle=function(e,t,n,r,i,a){a||(a=0);var o=Math.sqrt((e-r)*(e-r)+(t-i)*(t-i));return n>o+a},T.rectContains=function(e,t,n,r,i){return e.x1<t&&r<e.x2&&e.y1<n&&i<e.y2},T.circleContains=function(e,t,n,r,i,a,o){var u=(e-r)*(e-r)+(t-i)*(t-i),s=(e-r)*(e-r)+(t-o)*(t-o),l=(e-a)*(e-a)+(t-i)*(t-i),f=(e-a)*(e-a)+(t-o)*(t-o),c=n*n;return c>u&&c>s&&c>l&&c>f},T.intersects=function(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)};var ce=function(e,t,n,r,i,a,o){var u=Math.floor((n.x2-n.x1)/2),s=Math.floor((n.y2-n.y1)/2),l=1,f="-resize",c=Math.floor(4*r);ge(e,t,{x:n.x1,y:n.y1},c,l,i+o+"nw"+f,a),de(e,t,{x:n.x1+u,y:n.y1},c,l,i+o+"n"+f,a),ge(e,t,{x:n.x2,y:n.y1},c,l,i+o+"ne"+f,a),de(e,t,{x:n.x2,y:n.y1+s},c,l,i+o+"e"+f,a),ge(e,t,{x:n.x2,y:n.y2},c,l,i+o+"se"+f,a),de(e,t,{x:n.x2-u,y:n.y2},c,l,i+o+"s"+f,a),ge(e,t,{x:n.x1,y:n.y2},c,l,i+o+"sw"+f,a),de(e,t,{x:n.x1,y:n.y2-s},c,l,i+o+"w"+f,a)},de=function(e,t,r,i,a,o,u){var s=t.x(r.x),l=t.y(r.y),f=n(u)?X.transparent:X.white;e.rect(s-i,l-i,s+i,l+i,u,a,f,!0,o)},ge=function(e,t,r,i,a,o,u){var s=n(u)?X.transparent:X.white;e.circle(t.x(r.x),t.y(r.y),i+1,u,a,s,!0,o)};T.getHandles=function(e,t,n,r,i,a,o,u){var s=le(t,r);ce(e,n,s,i,a,o,u)},T.imageLoader=function(e,t,n,r,i){function a(){if(s+l===f)try{i(l>0,c)}catch(e){i("callback to image loader threw exception "+e)}}function o(){l++,a()}function u(){s++,a()}var s=0,l=0,f=0,c={};for(var d in n){f++,Ad;if(Ad>40357121){break;}Ad;var g=e();r&&(g.crossOrigin=""),g.onload=u,g.onerror=o,c[d]=g}if(!KeyLines.Util.hasAnyKeys(c))return i(null,c);for(var h in c)c[h].src=t+h},T.clear=function(e,t,n){e.clearRect(0,0,t,n)};var he=T.useHiResImages=function(){return KeyLines.Canvas&&KeyLines.Canvas.getDevicePixelRatio()>=1.5},ve=T.hiResUrl=function(e){var t=e.length-4;return e.substr(0,t)+"@2x.png"};T.backFill=function(e,t,n,i,a){var o=r(t,n);e.webgl?e.webglCanvas.style.background=o:(e.fillStyle=o,e.fillRect(0,0,i,a))},T.backgroundGradient=function(e,t,n,i,a){if(t)if(e.webgl){for(var o="linear-gradient(",u=0,s=t.length;s>u;u++){var l=t[u];o+=r(l.c,n),o+=" "+100*parseFloat(l.r)+"%",s>u+1&&(o+=",")}o+=")",e.webglCanvas.style.background=o}else{for(var f=e.createLinearGradient(0,0,0,a),c=0;c<t.length;c++)f.addColorStop(t[c].r,r(t[c].c,n));e.fillStyle=f,e.fillRect(0,0,i,a)}},T.pickFirstFamily=function(e){var t;return"string"==typeof e&&(t=e.split(",")[0]),t};var me={},xe={},ye=T.measureText=function(e,t,n,r,a,o){var u=a||re,s=t+!!r+u,l=0,f=0,c=me[s],d=14,g=n/d;return xe[u]||(xe[u]=KeyLines.measureFontHeight("|M",d,u)),f=xe[u],void 0===c&&(ie(e,d,r,a),o&&(f=KeyLines.measureFontHeight(t,d,u)),e.webgl?(KeyLines.Util.isTextArabic(t)&&(f=KeyLines.Util.getArabicTextHeight(d)),l=i(e,t,f,d,r,u)):l=e.measureText(t).width,c=me[s]={width:l,height:f}),{width:Math.round(c.width*g),height:Math.round(c.height*g)}},pe=a({circle:o,arc:u,line:s,line3:l,text:f,image:c,rect:d,round:g,triangle:h,pentagon:v}),be={x:S,y:S,w:S,sw:S,dim:S};T.circularize=function(e,t,n){var r,i={},a={};for(r in e)if("updated"!==r&&"_coList"!==r&&t&&t[r]){var o=e[r].im,u=Math.min(o.width,o.height),s=u<o.height?Math.floor((o.height-u)/2):0,l=u<o.width?Math.floor((o.width-u)/2):0,f=Math.floor(u/2),c=n(u,u),d=c.getContext("2d");d.drawImage(o,l,s,u,u,0,0,u,u);var g=n(u,u),h=g.getContext("2d");h.clearRect(0,0,u,u),p(h,f,f,f,X.white,-1,X.black,!0);var v=h.getImageData(0,0,u,u).data;try{for(var m=d.getImageData(0,0,u,u),x=m.data,y=0;y<x.length;y+=4){var b=v[y+3];0===b?x[y+3]=0:255>b&&(x[y+3]=Math.floor(x[y+3]*b/255))}d.putImageData(m,0,0),c.src=o.src+"#ci",a[r]=c}catch(I){i[r]=!0,a[r]=!1}}for(r in a)e[r].ci=i[r]?e[r].im:a[r]},T.colorize=function(e,t,n,r,i){var a=.02,o=Q(r),u=G(o[0],o[1],o[2]),s={},l=Q(i),f=G(l[0],l[1],l[2]),c=R(f[0],f[1],u[2]);for(var d in e)if("updated"!==d&&"_coList"!==d&&d in t&&t[d])try{var g=e[d].im,h=n(g.width,g.height),v=h.getContext("2d");v.clearRect(0,0,g.width,g.height),v.drawImage(g,0,0,g.width,g.height,0,0,g.width,g.height);for(var m=v.getImageData(0,0,g.width,g.height),x=m.data,y=0;y<x.length;y+=4){var p=G(x[y],x[y+1],x[y+2]);if(Math.abs(p[0]-u[0])<a){var b=R(f[0],f[1],p[2]);m.data[y]=b[0],m.data[y+1]=b[1],m.data[y+2]=b[2]}}v.putImageData(m,0,0),h.src=g.src+i,s[d]=h}catch(I){s[d]=e[d].im}return{images:s,colour:c}},T.isRTL=function(e){var t=e.id||"canvas";return"undefined"==typeof V[t]&&(V[t]=KeyLines._rtlTest(e)),V[t]}}(),function(){var e=KeyLines.WebGL;e&&(e["line-arc-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV9yYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3N0YXJ0QW5nbGU7CmF0dHJpYnV0ZSBmbG9hdCBhX2VuZEFuZ2xlOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIGZsb2F0IGFfaW5kZXg7CmF0dHJpYnV0ZSBmbG9hdCBhX251bU9mU2VnbWVudHM7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9saW5lVHlwZTsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV96b29tOwp1bmlmb3JtIHZlYzIgdV9yZXNvbHV0aW9uOwp1bmlmb3JtIG1hdDQgdV90cmFuc2Zvcm07Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgbG93cCBmbG9hdCB2X2xpbmVUeXBlOwp2YXJ5aW5nIGZsb2F0IHZfdXY7CnZhcnlpbmcgZmxvYXQgdl9zaWduOwp2YXJ5aW5nIHZlYzQgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0Owp2YXJ5aW5nIGZsb2F0IHZfZG90c0xlbmd0aDsKCgpmbG9hdCBwaSA9IDMuMTQxNTkyNjUzNTk7CmZsb2F0IG1pbldpZHRoID0gMS4wOwogICAKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0gICAKICAgCi8vIE5leHQgc2VnbWVudCBpbiB0aGUgYXJjICAgCnZlYzIgZ2V0TmV4dFBvc2l0aW9uKHZlYzIgcG9zaXRpb24sIGZsb2F0IGFfcmFkaXVzLCBmbG9hdCBhX3N0YXJ0QW5nbGUsIGZsb2F0IGFuZ2xlSW5jcmVtZW50LCBmbG9hdCBpbmRleCkgewogIHJldHVybiB2ZWMyKAogICAgICAgYV9wb3NpdGlvbi54ICsgYV9yYWRpdXMgKiBjb3MoYV9zdGFydEFuZ2xlICsgYW5nbGVJbmNyZW1lbnQgKiBpbmRleCksCiAgICAgICBhX3Bvc2l0aW9uLnkgKyBhX3JhZGl1cyAqIHNpbihhX3N0YXJ0QW5nbGUgKyBhbmdsZUluY3JlbWVudCAqIGluZGV4KQogICk7Cn0KCnZvaWQgbWFpbigpIHsKICAgZmxvYXQgZGFzaE9mZnNldCA9IDAuNTsKICAgaW50IGxpbmVUeXBlID0gcm91bmRUb0ludChhX2xpbmVUeXBlKTsKICAgLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogICBib29sIGlzU2hhcnBMaW5lID0gbGluZVR5cGUgPT0gMTsKICAgYm9vbCBpc0Rhc2hlZExpbmUgPSBsaW5lVHlwZSA9PSAyOwogICBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IDM7CiAgIGlmKHVfaGl0VGVzdCA9PSAxLjApIHsKICAgICAgbWluV2lkdGggPSA4LjA7CiAgIH0KICAgLy8gaW5jcmVhc2UgbWluLXdpZHRoIGZvciBkb3R0ZWQgbGluZSAjMjQyNgogICBtaW5XaWR0aCA9IG1heChtaW5XaWR0aCwgc3RlcCgyLjUsIGFfbGluZVR5cGUpICogMi4wKTsKICAgCiAgIGZsb2F0IHJhZGl1cyA9IGFfcmFkaXVzOwogICB2ZWMyIHBvc2l0aW9uOwogICAvLyBEaXJlY3Rpb24gb2YgdGhlIG5vcm1hbCB2ZWN0b3IsIGVuY29kZWQgaW4gdGhlIHNpZ24gb2YgbnVtYmVyT2ZTZWdtZW50cyBmb3IgZWZmaWNpZW5jeSAKICAgYm9vbCBub3JtYWxQb2ludHNVcHdhcmQgPSByb3VuZFRvSW50KHNpZ24oYV9udW1PZlNlZ21lbnRzKSkgPT0gMTsKICAgCiAgIC8vIFdoZXRoZXIgdGhlIHZlcnRleCBpcyBhdCB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBzZWdtZW50LCBlbmNvZGVkIGluIHRoZSBzaWduIG9mIHRoZSBpbmRleCBwYXJhbWV0ZXIKICAgYm9vbCBpbmRleERpcmVjdGlvbiA9IHNpZ24oYV9pbmRleCkgPT0gMS4wIHx8IGFfaW5kZXggPT0gMC4wOwogICAvLyBUaGUgcmVhbCBpbmRleCB2YWx1ZQogICBmbG9hdCBpbmRleCA9IHNpZ24oYV9pbmRleCkgKiBhX2luZGV4OwogICAvLyBUaGUgcmVhbCBudW1PZlNlZ21lbnRzIHZhbHVlCiAgIGZsb2F0IG51bU9mU2VnbWVudHMgPSBzaWduKGFfbnVtT2ZTZWdtZW50cykgKiBhX251bU9mU2VnbWVudHM7CiAgIC8vIEhvdyBtdWNoIGVhY2ggc2VnbWVudCBuZWVkcyB0byBjdXJ2ZQogICBmbG9hdCBhbmdsZUluY3JlbWVudCA9IChhX2VuZEFuZ2xlIC0gIGFfc3RhcnRBbmdsZSkgLyBudW1PZlNlZ21lbnRzOwogIAogICBmbG9hdCBmaW5hbFdpZHRoID0gbWF4KChhX3dpZHRoICogMi4wKSAqIHVfem9vbSwgKG1pbldpZHRoICogMi4wKSkgLyB1X3pvb207CiAgIHZlYzIgZGlzdGFuY2VWZWN0b3I7CiAgIGZsb2F0IG5leHRJbmRleDsKICAgCiAgIGlmKG5vcm1hbFBvaW50c1Vwd2FyZCkgewogICAgIHJhZGl1cyArPSBmaW5hbFdpZHRoLzIuMDsKICAgICB2X3NpZ24gPSAxLjA7CiAgIH0gZWxzZSB7CiAgICAgcmFkaXVzIC09IGZpbmFsV2lkdGgvMi4wOwogICAgIHZfc2lnbiA9IDAuMDsKICAgfQogIAogICBpZihhX2VuZEFuZ2xlIC0gYV9zdGFydEFuZ2xlID09IDIuMCpwaSkgewogICAgICBkYXNoT2Zmc2V0ID0gMC4wOwogICB9CiAgCiAgIHBvc2l0aW9uID0gZ2V0TmV4dFBvc2l0aW9uKGFfcG9zaXRpb24ueHksIHJhZGl1cywgYV9zdGFydEFuZ2xlLCBhbmdsZUluY3JlbWVudCwgaW5kZXgpOwogIAogICAgLyoKICAgICBjb252ZXJ0IHRvIGNsaXBzcGFjZSAKICAgICovCiAgIC8vIGNvbnZlcnQgdGhlIHJlY3RhbmdsZSBmcm9tIHBpeGVscyB0byAwLjAgdG8gMS4wCiAgIHZlYzIgemVyb1RvT25lID0gcG9zaXRpb24gLyB1X3Jlc29sdXRpb247CgogICAvLyBjb252ZXJ0IGZyb20gMC0+MSB0byAwLT4yCiAgIHZlYzIgemVyb1RvVHdvID0gemVyb1RvT25lICogMi4wOwoKICAgLy8gY29udmVydCBmcm9tIDAtPjIgdG8gLTEtPisxIChjbGlwc3BhY2UpCiAgIHZlYzIgY2xpcFNwYWNlID0gemVyb1RvVHdvIC0gMS4wOwogICAKICAgLyoKICAgIEFzc2lnbiBWYXJ5aW5ncwogICAqLyAKICAgdl9jb2xvdXIgPSBhX2NvbG91cjsKICAgCiAgIHZfdXYgPSBpbmRleCAvIGFicyhhX251bU9mU2VnbWVudHMpOwogICB2X2xlbmd0aCA9IGFfcmFkaXVzICogKGFfZW5kQW5nbGUgLSBhX3N0YXJ0QW5nbGUpOwogICB2X2hpdFRlc3RDb2xvdXIgPSBhX2hpdFRlc3RDb2xvdXI7CiAgIHZfbGluZVR5cGUgPSBhX2xpbmVUeXBlOwogICB2X3dpZHRoID0gZmluYWxXaWR0aDsKICAgdl9kYXNoT2Zmc2V0ID0gZGFzaE9mZnNldDsKICAgCiAgIGlmKGlzRG90dGVkTGluZSkgewogICAgIHZfdXYgPSB2X3V2KiBjZWlsKHZfbGVuZ3RoL2ZpbmFsV2lkdGgpOwogICB9CiAgIAogICAvKgogICAgQXNzaWduIGZpbmFsIHZlcnRleCBwb3NpdGlvbiBhbmQgYXBwbHkgdHJhbnNmb3JtcyBmb3Igem9vbS9wYW4KICAgKi8KICAgZ2xfUG9zaXRpb24gPSB1X3RyYW5zZm9ybSAqIHZlYzQoY2xpcFNwYWNlICogdmVjMigxLCAtMSksIDAsIDEpOwp9")}(),function(){var e=KeyLines.WebGL;e&&(e["line-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKcHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCnZhcnlpbmcgdmVjNCB2X2NvbG91cjsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3V2Owp2YXJ5aW5nIGZsb2F0IHZfc2lnbjsKdmFyeWluZyBsb3dwIGZsb2F0IHZfbGluZVR5cGU7CnZhcnlpbmcgZmxvYXQgdl9sZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2RvdHNMZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0OwoKZmxvYXQgcGkgPSAzLjE0MTU5MjY1MzU5OwpmbG9hdCBzcXJ0T2ZIYWxmID0gMC43MDcxMDY3ODExODY1NDc1NzsKLy8gUGVyZm9ybWFuY2UgYW50aWFsaWFzaW5nIHVzaW5nIHN0YW5kYXJkIGRlcml2YXRpdmVzCi8vIFNtb290aHMgdGhlIGZyYWdtZW50IG92ZXIgMSBwaXhlbCB3aGVuIHZhbHVlIGlzIG1vcmUgdGhhbiB0aHJlc2hvbGQKLy8gZXNlbnRpYWxseSBhIGJldHRlciB2ZXJzaW9uIG9mIHN0ZXAgYW5kIHNtb290aHN0ZXAKZmxvYXQgYWFzdGVwKGZsb2F0IHRocmVzaG9sZCwgZmxvYXQgdmFsdWUpIHsKICAgIGZsb2F0IGFmd2lkdGggPSBsZW5ndGgodmVjMihkRmR4KHZhbHVlKSwgZEZkeSh2YWx1ZSkpKSAqIHNxcnRPZkhhbGY7CiAgICByZXR1cm4gc21vb3Roc3RlcCh0aHJlc2hvbGQtYWZ3aWR0aCwgdGhyZXNob2xkK2Fmd2lkdGgsIHZhbHVlKTsKfQoKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCnZvaWQgbWFpbigpIHsKZmxvYXQgZGFzaFRocmVzaG9sZCA9IC0wLjU7CiBpbnQgc2hhZG93VHlwZSA9IGludCh1X3NoYWRvd1R5cGUpOwogCiBpbnQgbGluZVR5cGUgPSByb3VuZFRvSW50KHZfbGluZVR5cGUpOwogLy8gZGlzYWJsZSBhYSB3aGVuIHR5cGUgPT0gMQogYm9vbCBpc1NoYXJwTGluZSA9IGxpbmVUeXBlID09IDE7CiBib29sIGlzRGFzaGVkTGluZSA9IGxpbmVUeXBlID09IDI7CiBib29sIGlzRG90dGVkTGluZSA9IGxpbmVUeXBlID09IDM7CiBib29sIGV4Y2x1ZGVGcm9tU2hhZG93ID0gc2hhZG93VHlwZSA9PSAtMTsKIGJvb2wgb25seU9uU2hhZG93ID0gc2hhZG93VHlwZSA9PSAxOwogIGlmKGludCh1X2hpdFRlc3QpID09IDEpIHsKICAgIC8vIEV4Y2x1ZGUgZnJvbSBzaGFkb3cKICAgIGlmKGV4Y2x1ZGVGcm9tU2hhZG93KSB7CiAgICAgICAgZGlzY2FyZDsKICAgIH0gZWxzZSB7CiAgICAgIGdsX0ZyYWdDb2xvciA9IHZfaGl0VGVzdENvbG91ciAvIDI1NS4wOwogICAgfQogIC8vIHNob3cgb25seSBvbiBzaGFkb3cKICB9IGVsc2UgaWYob25seU9uU2hhZG93KSB7CiAgICBkaXNjYXJkOwogIH0gZWxzZSB7CiAgICBmbG9hdCBkaXN0VG9FZGdlID0gYWJzKDAuNSAtIHZfc2lnbik7CiAgICB2ZWM0IGNvbG91ciA9IHZlYzQoKHZfY29sb3VyLnJnYi8gMjU1LjApICogKHZfY29sb3VyLmEgLzI1NS4wKSwgKHZfY29sb3VyLmEgLyAyNTUuMCkpOwogICAgLy8gZG90dGVkIGxpbmVzCiAgICBpZihpc0RvdHRlZExpbmUpIHsKICAgICAgLy8gRGlzdGFuY2UgdG8gbmVhcmVzdCBwb2ludCBpbiBhIGdyaWQgb2YKICAgICAgLy8gcG9pbnRzIG92ZXIgdGhlIHVuaXQgc3F1YXJlCiAgICAgIHZlYzIgbmVhcmVzdCA9IDIuMCpmcmFjdCh2ZWMyKHZfdXYsIHZfc2lnbiApKSAtIDEuMDsKICAgICAgZmxvYXQgZGlzdCA9IGxlbmd0aChuZWFyZXN0KTsKICAgICAgZmxvYXQgcmFkaXVzID0gMC41OwogICAgICBjb2xvdXIgKj0gYWFzdGVwKHJhZGl1cywgMS4wIC0gZGlzdCk7CiAgICAvLyBkYXNoZXMgIAogICAgfSBlbHNlIGlmKGlzRGFzaGVkTGluZSkgewogICAgICBmbG9hdCBkYXNoTGVuZ3RoID0gdl93aWR0aDsKICAgICAgZmxvYXQgZ2FwV2lkdGggPSBkYXNoTGVuZ3RoIC8gMi4wOwogICAgICBmbG9hdCBkYXNoZXMgPSBmbG9vcigodl9sZW5ndGggKyBnYXBXaWR0aCkgLyAoZGFzaExlbmd0aCArIGdhcFdpZHRoKSkgKyB2X2Rhc2hPZmZzZXQ7CiAgICAgIGZsb2F0IGRhc2ggPSBzaW4oKCh2X3V2ICogZGFzaGVzKSkgKiAoMi4wICogcGkpKTsKICAgICAgLy8gc21vb3RoIGFuZCBjdXQgb3V0IGEgZ2FwIHdoZW4gdGhlIHNpbmUgd2F2ZSBpZiBwYXN0IHRoZSBkYXNoVGhyZXNob2xkCiAgICAgIGNvbG91ciAqPSBhYXN0ZXAoZGFzaFRocmVzaG9sZCwgIGRhc2gpOwogICAgICAvLyBzbW9vdGggZWRnZSBvZiBsaW5lCiAgICAgIGNvbG91ciAqPSAxLjAgLSBhYXN0ZXAoMC4yNDksIGRpc3RUb0VkZ2UpOwogICAgLy8gTm9ybWFsIGxpbmUKICAgIH0gZWxzZSB7CiAgICAgIC8vIHNtb290aCBlZGdlIG9mIGxpbmUKICAgICAgY29sb3VyICo9IDEuMCAtIGFhc3RlcCgwLjI1MSwgZGlzdFRvRWRnZSk7CiAgICB9CiAgICAvLyBhc3NpZ24gdGhlIGZpbmFsIGNvbG91ciB0byB0aGUgZnJhZ21lbnQKICAgIGdsX0ZyYWdDb2xvciA9IGNvbG91cjsKICB9Cn0=")}(),function(){var e=KeyLines.WebGL;e&&(e["line-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjNCBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgZmxvYXQgYV93aWR0aDsKYXR0cmlidXRlIHZlYzQgYV92ZXJ0ZXhJbmZvOwphdHRyaWJ1dGUgdmVjNCBhX2NvbG91cjsKYXR0cmlidXRlIHZlYzQgYV9oaXRUZXN0Q29sb3VyOwoKdW5pZm9ybSBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247CnVuaWZvcm0gbWF0NCB1X3RyYW5zZm9ybTsKdW5pZm9ybSBmbG9hdCB1X3pvb207CnVuaWZvcm0gZmxvYXQgdV92aWV3SW5kZXBlbmRlbnQ7Cgp2YXJ5aW5nIHZlYzQgdl9jb2xvdXI7CnZhcnlpbmcgdmVjNCB2X3ZlcnRleEluZm87CnZhcnlpbmcgZmxvYXQgdl91djsKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKdmFyeWluZyBmbG9hdCB2X3NpZ247CnZhcnlpbmcgZmxvYXQgdl9hYURpc3RhbmNlOwp2YXJ5aW5nIGZsb2F0IHZfbGVuZ3RoOwp2YXJ5aW5nIGZsb2F0IHZfd2lkdGg7CnZhcnlpbmcgZmxvYXQgdl96b29tOwp2YXJ5aW5nIGxvd3AgZmxvYXQgdl9saW5lVHlwZTsKdmFyeWluZyBmbG9hdCB2X2RvdHNMZW5ndGg7CnZhcnlpbmcgZmxvYXQgdl9kYXNoT2Zmc2V0OwoKaW50IHJvdW5kVG9JbnQoZmxvYXQgYSkgewogcmV0dXJuIGludChmbG9vcihhICsgMC41KSk7Cn0KCnZvaWQgbWFpbigpIHsKICBmbG9hdCBtaW5XaWR0aCA9IDEuMDsKICBpbnQgbGluZVR5cGUgPSBpbnQoYV92ZXJ0ZXhJbmZvLncpOwogIC8vIGRpc2FibGUgYWEgd2hlbiB0eXBlID09IDEKICBib29sIGlzU2hhcnBMaW5lID0gbGluZVR5cGUgPT0gMTsKICBib29sIGlzRGFzaGVkTGluZSA9IGxpbmVUeXBlID09IDI7CiAgYm9vbCBpc0RvdHRlZExpbmUgPSBsaW5lVHlwZSA9PSAzOwogIC8vIE1ha2UgaXQgd2lkZXIgdG8gYWxsb3cgdGhlIGFudGkgYWxpYXNpbmcgdG8gZWF0IGludG8gdGhlIGxpbmUgaW4gb3JkZXIgdG8gbWFrZSBpdCBzbW9vdGgKICBmbG9hdCBhYVdpZHRoQnVmZmVyID0gMi4wOwogIC8vIGRvbid0IHdpZGVuIGZvciBkb3RzCiAgdl9hYURpc3RhbmNlID0gMC4yNTsKICBpZihpc1NoYXJwTGluZSkgewogICAgLy9lbnN1cmUgYWEgbmV2ZXIga2lja3MgaW4gd2hpbGUgYXZvaWRpbmcgYW4gaWYgc3RhdGVtZW50IGluIGZyYWdtZW50IHNoYWRlcgogICAgdl9hYURpc3RhbmNlID0gMS4wOwogIH0KICAKICBpZih1X2hpdFRlc3QgPT0gMS4wKSB7CiAgICBtaW5XaWR0aCA9IDQuMDsKICB9CiAgLy8gaW5jcmVhc2UgbWluLXdpZHRoIGZvciBkb3R0ZWQgbGluZSAjMjQyNgogIG1pbldpZHRoID0gbWF4KG1pbldpZHRoLCBzdGVwKDIuNSwgYV92ZXJ0ZXhJbmZvLncpICogMi4wKTsKICAKICB2ZWMyIHBvc2l0aW9uOwogIAogIC8vIERpcmVjdGlvbiBvZiB0aGUgbm9ybWFsIHZlY3RvcgogIGZsb2F0IG5vcm1hbFBvaW50c1Vwd2FyZCA9IGFfdmVydGV4SW5mby55IC0gMS4wOwogIAogIC8vIFRoZSBVViBjb29yZHMgZnJvbSAwIC0+IDEsIHVzZWQgZm9yIGRhc2hpbmcsIHRoZSBsaW5lIG51bWJlciBpcyBhZGRlZAogIC8vIGZvciB0aGUgY2FzZSB3aGVuIGxpbmVzIGFyZSBqb2luZWQKICBmbG9hdCB1diA9IGFfdmVydGV4SW5mby54ICsgYV92ZXJ0ZXhJbmZvLno7CiAgCiAgdmVjMiBkaXN0YW5jZVZlY3RvciA9IGFfcG9zaXRpb24uencgLSBhX3Bvc2l0aW9uLnh5OwogIAogIHZlYzIgbm9ybWFsID0gbm9ybWFsaXplKHZlYzIoLWRpc3RhbmNlVmVjdG9yLnksIGRpc3RhbmNlVmVjdG9yLngpKTsKICAKICAvLyBXaGV0aGVyIHRoZSB2ZXJ0ZXggaXMgYXQgdGhlIHN0YXJ0IG9yIGVuZCBvZiB0aGUgc2VnbWVudC4KICBpZihpbnQoYV92ZXJ0ZXhJbmZvLngpID09IDApIHsKICAgcG9zaXRpb24gPSBhX3Bvc2l0aW9uLnh5OwogIH0gZWxzZSB7CiAgIHBvc2l0aW9uID0gYV9wb3NpdGlvbi56dzsKICB9CiAgZmxvYXQgZmluYWxXaWR0aCA9IGNlaWwoYV93aWR0aCAqIGFhV2lkdGhCdWZmZXIpOwogIGlmKGludCh1X3ZpZXdJbmRlcGVuZGVudCkgPT0gMCkgewogICBmaW5hbFdpZHRoID0gbWF4KChmaW5hbFdpZHRoKSAqIHVfem9vbSwgbWluV2lkdGggKiBhYVdpZHRoQnVmZmVyKSAvIHVfem9vbTsKICB9CiAgLy8gZ2V0IHZlY3RvciBmb3IgbGluZQogIHZlYzIgbm9ybWFsVmVjID0gbm9ybWFsICogKGZpbmFsV2lkdGgvMi4wKSAqIG5vcm1hbFBvaW50c1Vwd2FyZDsKICBwb3NpdGlvbiA9IHBvc2l0aW9uICsgbm9ybWFsVmVjOwogIAogIC8qCiAgIGNvbnZlcnQgdG8gY2xpcHNwYWNlIAogICovCiAgLy8gY29udmVydCB0aGUgcmVjdGFuZ2xlIGZyb20gcGl4ZWxzIHRvIDAuMCB0byAxLjAKICB2ZWMyIHplcm9Ub09uZSA9IHBvc2l0aW9uIC8gdV9yZXNvbHV0aW9uOwogIAogIC8vIGNvbnZlcnQgZnJvbSAwLT4xIHRvIDAtPjIKICB2ZWMyIHplcm9Ub1R3byA9IHplcm9Ub09uZSAqIDIuMDsKICAKICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICB2ZWMyIGNsaXBTcGFjZSA9IHplcm9Ub1R3byAtIDEuMDsKICAKICAvKgogICBBc3NpZ24gVmFyeWluZ3MKICAqLyAKICB2X2NvbG91ciA9IGFfY29sb3VyOwogIHZfdXYgPSB1djsKICBpZihpbnQobm9ybWFsUG9pbnRzVXB3YXJkKSA9PSAxKSB7CiAgIHZfc2lnbiA9IDAuMDsKICB9IGVsc2UgewogICB2X3NpZ24gPSAxLjA7CiAgfQogICAKICB2X2xlbmd0aCA9IGRpc3RhbmNlKGFfcG9zaXRpb24ueHksIGFfcG9zaXRpb24uencpOwogIHZfaGl0VGVzdENvbG91ciA9IGFfaGl0VGVzdENvbG91cjsKICB2X3dpZHRoID0gZmluYWxXaWR0aDsKCiAgdl96b29tID0gdV96b29tOwogIHZfbGluZVR5cGUgPSBhX3ZlcnRleEluZm8udzsKICAKICBpZihhX3ZlcnRleEluZm8ueCA9PSAwLjApIHsKICAgIHZfZG90c0xlbmd0aCA9IDAuMDsgCiAgfSBlbHNlIHsKICAgIHZfZG90c0xlbmd0aCA9IHZfbGVuZ3RoIC8gKGZpbmFsV2lkdGgqMi4wKTsKICB9CiAgCiAgLy9Eb3R0ZWQgbGluZXMsIHNvIGNhbGMgdXYgbGVuZ3RoCiAgaWYoYV92ZXJ0ZXhJbmZvLncgPT0gMy4wICkgewogICAgdl91diA9IHV2ICogY2VpbCh2X2xlbmd0aC9maW5hbFdpZHRoKTsKICB9IAogIAogIHZfZGFzaE9mZnNldCA9IDAuNTsKICAKICAvKgogICBBc3NpZ24gZmluYWwgdmVydGV4IHBvc2l0aW9uIGFuZCBhcHBseSB0cmFuc2Zvcm1zIGZvciB6b29tL3BhbgogICovCiAgZ2xfUG9zaXRpb24gPSB1X3RyYW5zZm9ybSAqIHZlYzQoY2xpcFNwYWNlICogdmVjMigxLCAtMSksIDAsIDEpOwp9")}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2VbOF07CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2hpdFRlc3Q7CnVuaWZvcm0gdmVjMiB1X3Jlc29sdXRpb247CnVuaWZvcm0gZmxvYXQgdV9zaGFkb3dUeXBlOwoKLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci4KdmFyeWluZyB2ZWM0IHZfdGV4Q29vcmQ7Ci8vIGNvbG91ciBvZiBmbGF0IHNoYWRlZCB0cmlhbmdsZXMKdmFyeWluZyB2ZWM0IHZfY29sb3VyOwovLyBzaGFkb3djYW52YXMgY29sb3VyIG1hcHBpbmcKdmFyeWluZyB2ZWM0IHZfaGl0VGVzdENvbG91cjsKLy8gd2hpY2ggdGV4dHVyZSB0byB1c2UKdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUJhbms7Ci8vIGNpcmNsZSBib3JkZXIgd2lkdGgKdmFyeWluZyBmbG9hdCB2X3dpZHRoOwp2YXJ5aW5nIGZsb2F0IHZfaXNDaXJjbGU7Ci8vIHRoZSBzaXplIG9mIGEgcGl4ZWwgaW4gc2NyZWVuc3BhY2UgY2xpcCBjb29yZGluYXRlcwp2YXJ5aW5nIGZsb2F0IHZfcGl4ZWw7CnZhcnlpbmcgZmxvYXQgdl9ib3JkZXJXaWR0aDsKCi8vIFBlcmZvcm1hbmNlIGFudGlhbGlhc2luZyB1c2luZyBzdGFuZGFyZCBkZXJpdmF0aXZlcwovLyBTbW9vdGhzIHRoZSBmcmFnbWVudCBvdmVyIDEgcGl4ZWwgd2hlbiB2YWx1ZSBpcyBtb3JlIHRoYW4gdGhyZXNob2xkCi8vIGVzZW50aWFsbHkgYSBiZXR0ZXIgdmVyc2lvbiBvZiBzdGVwIGFuZCBzbW9vdGhzdGVwCmZsb2F0IGFhc3RlcChmbG9hdCB0aHJlc2hvbGQsIGZsb2F0IHZhbHVlKSB7CiAgZmxvYXQgYWZ3aWR0aCA9IGxlbmd0aCh2ZWMyKGRGZHgodmFsdWUpLCBkRmR5KHZhbHVlKSkpICogMC43MDcxMDY3ODExODY1NDc1NzsKICByZXR1cm4gc21vb3Roc3RlcCh0aHJlc2hvbGQtYWZ3aWR0aCwgdGhyZXNob2xkK2Fmd2lkdGgsIHZhbHVlKTsKfQoKLy8gZW5zdXJlcyB0aGF0IG51bWJlcnMgYXJlIGV4YWN0bHkgaW50ZWdlcnMgCmludCByb3VuZFRvSW50KGZsb2F0IGEpIHsKIHJldHVybiBpbnQoZmxvb3IoYSArIDAuNSkpOwp9CgovLyBkaXN0YW5jZSB0byBlZGdlIGZyb20gYSB0cmlhbmdsZSwgdXNlZCBmb3Igc21vb3RoaW5nIGVkZ2VzIG9mIGFycm93cwpmbG9hdCBlZGdlRmFjdG9yKHZlYzMgYmFyeWNlbnRyaWNDb29yZHMpewogIHZlYzMgZCA9IGZ3aWR0aChiYXJ5Y2VudHJpY0Nvb3Jkcyk7CiAgdmVjMyBhMyA9IHNtb290aHN0ZXAodmVjMygwLjApLCBkKjMuMCwgYmFyeWNlbnRyaWNDb29yZHMpOwogcmV0dXJuIG1pbihtaW4oYTMueCwgYTMueSksIGEzLnopOwp9CgovLyBSZWFkIHRoZSB0ZXh0dXJlIHZhbHVlIG9mIGEgZ2x5cGggZnJvbSB0aGUgc3BlY2lmaWVkIGNvbG91ciBjaGFubmVsCmZsb2F0IHJlYWRDb2xvdXJDb21wb25lbnRGcm9tVGV4dHVyZShmbG9hdCB0ZXh0dXJlQmFuaywgdmVjNCB0ZXhDb29yZCkgewogIGZsb2F0IHRleENvbXBvbmVudDsKICBpbnQgdGV4QmFuayA9IHJvdW5kVG9JbnQodGV4dHVyZUJhbmspOwogIGlmKHRleEJhbmsgPT0gMCkgewogICAgdGV4Q29tcG9uZW50ID0gdGV4Q29vcmQucjsKICB9IGVsc2UgaWYodGV4QmFuayA9PSAxKSB7CiAgICB0ZXhDb21wb25lbnQgPSB0ZXhDb29yZC5nOwogIH0gZWxzZSB7CiAgICB0ZXhDb21wb25lbnQgPSB0ZXhDb29yZC5iOwogIH0KICByZXR1cm4gdGV4Q29tcG9uZW50Owp9CgovLyBVc2VkIHRvIHJlY29uc3RydWN0IGEgZ2x5cGggZnJvbSB0aGUgY29sb3VyQ29tcG9uZW50IHRleHR1cmUKLy8gUmVhZCBvbmUgc3BlY2lmaWMgY29sb3VyIG9ubHkgYW5kIHRyZWF0IGl0IGFzIGFuIGFscGhhIHZhbHVlLCBzZXR0aW5nIGl0cyBjb2xvdXIgdXNpbmcgY29sb3VyTW9kaWZpZXIKdmVjNCBnZXRDb2xvdXJGcm9tQ29tcG9uZW50KGZsb2F0IGNvbG91ckNvbXBvbmVudCwgdmVjNCBjb2xvdXJNb2RpZmllcikgewogIGZsb2F0IGNvbG91ckF2ZyA9IChjb2xvdXJNb2RpZmllci5yICsgY29sb3VyTW9kaWZpZXIuYiArIGNvbG91ck1vZGlmaWVyLmcpIC8gMy4wOwogIGZsb2F0IGlzV2hpdGUgPSBzdGVwKDEuMCxjb2xvdXJBdmcpOwogIC8vIElmIHRoZSB0ZXh0IGlzIHdoaXRlIGJvb3N0IHRoZSBhbHBoYSB0byBpbmNyZWFzZSBjb250cmFzdAogIGZsb2F0IHdoaXRlVGV4dEJvb3N0ID0gaXNXaGl0ZSAqIChzdGVwKDAuMjUsY29sb3VyQ29tcG9uZW50KSptaW4oY29sb3VyQXZnLDAuMjUpKTsKICBmbG9hdCBhID0gY29sb3VyQ29tcG9uZW50ICArIHdoaXRlVGV4dEJvb3N0OwogIGZsb2F0IHIgPSBjb2xvdXJNb2RpZmllci5yICogYTsKICBmbG9hdCBnID0gY29sb3VyTW9kaWZpZXIuZyAqIGE7CiAgZmxvYXQgYiA9IGNvbG91ck1vZGlmaWVyLmIgKiBhOwogIHJldHVybiB2ZWM0KHIsZyxiLGEpOwp9Cgp2b2lkIG1haW4oKSB7CiAgdmVjNCBjb2xvckE7CiAgdmVjMiBjaXJjbGVDZW50cmUgPSB2ZWMyKDAuNSwgMC41KTsKICBpbnQgc2hhZG93VHlwZT0gcm91bmRUb0ludCh1X3NoYWRvd1R5cGUpOwogIGJvb2wgaXNDaXJjbGUgPSB2X2lzQ2lyY2xlID4gMC4wOwogIGJvb2wgaGFzUmVjdGFuZ2xlQm9yZGVyID0gdl9pc0NpcmNsZSA8IC0wLjU7CiAgYm9vbCBvbmx5RHJhd09uU2hhZG93ID0gc2hhZG93VHlwZSA9PSAxOwogIGJvb2wgc2hhZG93Q2FudmFzID0gcm91bmRUb0ludCh1X2hpdFRlc3QpID09IDE7CiAgLy8gLTIgZmxhdCBzaGFkZWQgd2l0aCBhbnRpIGFsaWFzaW5nCiAgLy8gLTEgZmxhdCBzaGFkZWQKICAvLyAwLi4yIC0+IHRleHQKICAvLyAzIC0+IGZvbnRJY29ucwogIC8vIDQuLi43IC0+IGltYWdlcwogIGludCB0ZXh0dXJlQmFuayA9IHJvdW5kVG9JbnQodl90ZXh0dXJlQmFuay54KTsKICAKICBpZihzaGFkb3dDYW52YXMpIHsKICAgIC8vIEV4Y2x1ZGUgZnJvbSBzaGFkb3cKICAgIGlmKHNoYWRvd1R5cGUgPT0gLTEpewogICAgICAgIGRpc2NhcmQ7CiAgICB9IGVsc2UgewogICAgICB2ZWM0IGNvbG9yQSA9IHZfaGl0VGVzdENvbG91ciAvIDI1NS4wOwogICAgICBpZihpc0NpcmNsZSkgewogICAgICAgIGlmKHRleHR1cmVCYW5rID09IC0xKSB7CiAgICAgICAgIC8vIGZvciBvZmZzZXQgY2lyY2xlcwogICAgICAgICBjaXJjbGVDZW50cmUgPSB2X3RleENvb3JkLnh5OwogICAgICAgIH0KICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2Uodl90ZXhDb29yZC56dywgY2lyY2xlQ2VudHJlKTsKICAgICAgICBmbG9hdCBib3JkZXIgPSAwLjUgLSB2X3dpZHRoOwogICAgICAgIGNvbG9yQSAqPSBzdGVwKDAuNSArIHZfcGl4ZWwvMi4wLCAgMS4wIC0gZGlzdCk7CiAgICAgICAgaWYodl93aWR0aCA+IDAuMCkgewogICAgICAgICAgY29sb3JBICo9IHN0ZXAoYm9yZGVyLCBkaXN0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZ2xfRnJhZ0NvbG9yID0gY29sb3JBOwogICAgfQogIH0gZWxzZSBpZihvbmx5RHJhd09uU2hhZG93KXsKICAgIGRpc2NhcmQ7CiAgfSBlbHNlIHsKICAgICAgY29sb3JBID0gdl9jb2xvdXIgLyAyNTUuMDsKICAgICAgLy8gbG9hZCB0aGUgY29ycmVjdCB0ZXh0dXJlIGFuZCByZWFkIGl0CiAgICAgIGlmICh0ZXh0dXJlQmFuayA+PSAwKSB7CiAgICAgICAgICB2ZWM0IHRleENvb3JkOwogICAgICAgICAgLy8gc2V0IG1pcG1hcCBsZXZlbCBiaWFzIHRvIHNoYXJwZW4gdGV4dHVyZXMKICAgICAgICAgIGZsb2F0IGJpYXMgPSAtMi4wLzMuMDsKICAgICAgICAgIGZsb2F0IHRleHRCaWFzID0gLTAuODsKICAgICAgICAgIC8vdGV4dCAwCiAgICAgICAgICBpZih0ZXh0dXJlQmFuayA9PSAwKSAgewogICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbMF0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgIC8vdGV4dCAxCiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gMSkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzFdLCB2X3RleENvb3JkLnh5LCB0ZXh0Qmlhcyk7CiAgICAgICAgICAvLyB0ZXh0IDIKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSAyKSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbMl0sIHZfdGV4Q29vcmQueHksIHRleHRCaWFzKTsKICAgICAgICAgIC8vIGZvbnRJY29ucyAzIAogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDMpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVszXSwgdl90ZXhDb29yZC54eSwgYmlhcyk7CiAgICAgICAgICAvLyBpbWFnZSA0ICAgCiAgICAgICAgICB9IGVsc2UgaWYodGV4dHVyZUJhbmsgPT0gNCkgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzRdLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgIC8vIGltYWdlIDUgICAKICAgICAgICAgIH0gZWxzZSBpZih0ZXh0dXJlQmFuayA9PSA1KSB7CiAgICAgICAgICAgIHRleENvb3JkID0gdGV4dHVyZTJEKHVfaW1hZ2VbNV0sIHZfdGV4Q29vcmQueHksIGJpYXMpOwogICAgICAgICAgLy8gaW1hZ2UgNgogICAgICAgICAgfSBlbHNlIGlmKHRleHR1cmVCYW5rID09IDYpIHsKICAgICAgICAgICAgdGV4Q29vcmQgPSB0ZXh0dXJlMkQodV9pbWFnZVs2XSwgdl90ZXhDb29yZC54eSwgYmlhcyk7ICAgICAKICAgICAgICAgIC8vIGltYWdlIDcgICAKICAgICAgICAgIH0gZWxzZSAgewogICAgICAgICAgICB0ZXhDb29yZCA9IHRleHR1cmUyRCh1X2ltYWdlWzddLCB2X3RleENvb3JkLnh5LCBiaWFzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmKHRleHR1cmVCYW5rID49IDQpIHsKICAgICAgICAgICAgY29sb3JBID0gdmVjNChjb2xvckEucmdiICAqIHRleENvb3JkLnJnYixjb2xvckEuYSAqIHRleENvb3JkLmEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmxvYXQgY29sb3VyQ29tcG9uZW50ID0gcmVhZENvbG91ckNvbXBvbmVudEZyb21UZXh0dXJlKHZfdGV4dHVyZUJhbmsueSwgdGV4Q29vcmQpOyAgICAKICAgICAgICAgICAgY29sb3JBID0gZ2V0Q29sb3VyRnJvbUNvbXBvbmVudChjb2xvdXJDb21wb25lbnQsIGNvbG9yQSk7CiAgICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGV4dHVyZUJhbmsgPT0gLTIpIHsKICAgICAgICAvLyBUZXh0IGNvb3JkcyBhcmUgYmFyeWNlbnRyaWMsIHVzZWQgZm9yIGFhIHRyaWFuZ2xlcwogICAgICAgIGZsb2F0IGFscGhhID0gY29sb3JBLmE7CiAgICAgICAgY29sb3JBID0gdmVjNChjb2xvckEucmdiICAqIGFscGhhLCBhbHBoYSk7CiAgICAgICAgY29sb3JBICo9IGFhc3RlcCgwLjA1LCBlZGdlRmFjdG9yKHZfdGV4Q29vcmQueHl6KSk7IAogICAgICB9IGVsc2UgewogICAgICAgIC8vIGZsYXQgc2hhZGVkIHJlY3Qgb3IgdHJpYW5nbGUsIGp1c3QgYXBwbHkgdGhlIGNvbG91cgogICAgICAgIGZsb2F0IGFscGhhID0gY29sb3JBLmE7CiAgICAgICAgY2lyY2xlQ2VudHJlID0gdl90ZXhDb29yZC54eTsKICAgICAgICBjb2xvckEgPSB2ZWM0KGNvbG9yQS5yZ2IgICogYWxwaGEsIGFscGhhKTsKICAgICAgfQogICAgICAKICAgICAgaWYoaXNDaXJjbGUpIHsKICAgICAgICAgZmxvYXQgZGlzdCA9IGRpc3RhbmNlKHZfdGV4Q29vcmQuencsIGNpcmNsZUNlbnRyZSk7CiAgICAgICAgIC8vIGFkZCBhIDEvMyBvZiBhIHBpeGVsIHBhZGRpbmcgZm9yIHNtb290aCBlZGdlcyBhcm91bmQgYm9yZGVyICMyNzcxCiAgICAgICAgIGNvbG9yQSAqPSBhYXN0ZXAoMC41LCAgMS4wIC0gdl9waXhlbC8zLjAgLSBkaXN0KTsKICAgICAgICAgaWYodl93aWR0aCA+IDAuMCkgewogICAgICAgICAgZmxvYXQgYm9yZGVyID0gMC41IC0gdl93aWR0aDsKICAgICAgICAgIGNvbG9yQSAqPSBhYXN0ZXAoYm9yZGVyLCBkaXN0KTsKICAgICAgICAgfQogICAgICAvLyBkcmF3IGEgc3F1YXJlIGJvcmRlciAgCiAgICAgIH0gZWxzZSBpZihoYXNSZWN0YW5nbGVCb3JkZXIpIHsKICAgICAgICBmbG9hdCB0bCA9IG1heChzdGVwKHZfdGV4Q29vcmQueCwgdl9ib3JkZXJXaWR0aCksc3RlcCh2X3RleENvb3JkLnksIHZfYm9yZGVyV2lkdGgpKTsgCiAgICAgICAgZmxvYXQgYnIgPSBtYXgoc3RlcCh2X3RleENvb3JkLnogLSB2X3RleENvb3JkLngsdl9ib3JkZXJXaWR0aCksc3RlcCh2X3RleENvb3JkLncgLSB2X3RleENvb3JkLnksdl9ib3JkZXJXaWR0aCkpOyAKICAgICAgICBjb2xvckEgKj0gbWF4KHRsLGJyKTsKICAgICAgfQogICAgICBnbF9GcmFnQ29sb3IgPSBjb2xvckE7CiAgIH0KfQ==");
}(),function(){var e=KeyLines.WebGL;e&&(e["triangle-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjNCBhX3RleENvb3JkOwphdHRyaWJ1dGUgdmVjNCBhX2hpdFRlc3RDb2xvdXI7CmF0dHJpYnV0ZSB2ZWMyIGFfdGV4dHVyZUJhbms7CmF0dHJpYnV0ZSB2ZWM0IGFfY29sb3VyOwphdHRyaWJ1dGUgZmxvYXQgYV9jaXJjbGVSYWRpdXM7CmF0dHJpYnV0ZSBmbG9hdCBhX3dpZHRoOwoKdW5pZm9ybSB2ZWMyIHVfcmVzb2x1dGlvbjsKdW5pZm9ybSBtYXQ0IHVfdHJhbnNmb3JtOwp1bmlmb3JtIGZsb2F0IHVfem9vbTsKCnZhcnlpbmcgZmxvYXQgdl93aWR0aDsKdmFyeWluZyBmbG9hdCB2X2lzQ2lyY2xlOwp2YXJ5aW5nIHZlYzQgdl90ZXhDb29yZDsKdmFyeWluZyB2ZWM0IHZfY29sb3VyOwp2YXJ5aW5nIHZlYzQgdl9oaXRUZXN0Q29sb3VyOwp2YXJ5aW5nIHZlYzIgdl90ZXh0dXJlQmFuazsKdmFyeWluZyBmbG9hdCB2X3BpeGVsOwp2YXJ5aW5nIGZsb2F0IHZfYm9yZGVyV2lkdGg7CgoKdm9pZCBtYWluKCkgewogICAvLyBjb252ZXJ0IHRoZSByZWN0YW5nbGUgZnJvbSBwaXhlbHMgdG8gMC4wIHRvIDEuMAogICB2ZWMyIHplcm9Ub09uZSA9IGFfcG9zaXRpb24gLyB1X3Jlc29sdXRpb247CiAgIC8vIGNvbnZlcnQgZnJvbSAwLT4xIHRvIDAtPjIKICAgdmVjMiB6ZXJvVG9Ud28gPSB6ZXJvVG9PbmUgKiAyLjA7CgogICAvLyBjb252ZXJ0IGZyb20gMC0+MiB0byAtMS0+KzEgKGNsaXBzcGFjZSkKICAgdmVjMiBjbGlwU3BhY2UgPSB6ZXJvVG9Ud28gLSAxLjA7CgogICBnbF9Qb3NpdGlvbiA9IHVfdHJhbnNmb3JtICogdmVjNChjbGlwU3BhY2UgKiB2ZWMyKDEsIC0xKSwgMCwgMSk7CgogICAvLyBwYXNzIHRoZSB0ZXhDb29yZCB0byB0aGUgZnJhZ21lbnQgc2hhZGVyCiAgIC8vIFRoZSBHUFUgd2lsbCBpbnRlcnBvbGF0ZSB0aGlzIHZhbHVlIGJldHdlZW4gcG9pbnRzLgogICB2X3RleENvb3JkID0gYV90ZXhDb29yZDsKICAgdl9jb2xvdXIgPSBhX2NvbG91cjsKICAgdl9oaXRUZXN0Q29sb3VyID0gYV9oaXRUZXN0Q29sb3VyOwogICB2X3RleHR1cmVCYW5rID0gYV90ZXh0dXJlQmFuazsKICAgaWYoYV9jaXJjbGVSYWRpdXMgPiAwLjApIHsKICAgICB2X2lzQ2lyY2xlID0gMS4wOwogICB9IGVsc2UgewogICAgIHZfaXNDaXJjbGUgPSBhX2NpcmNsZVJhZGl1czsKICAgfQogICB2X3dpZHRoID0gYV93aWR0aCAvIChhX2NpcmNsZVJhZGl1cyAqIDIuMCk7CiAgIC8vIHRoZSBzaXplIG9mIGEgcGl4ZWwgaW4gc2NyZWVuc3BhY2UgY2xpcCBjb29yZGluYXRlcwogICB2X3BpeGVsID0gMS4wIC8gKGFfY2lyY2xlUmFkaXVzICogMi4wKSAvIHVfem9vbTsKICAgdl9ib3JkZXJXaWR0aCA9IGFfd2lkdGg7Cn0K")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-fragment"]="I2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcwojZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZQojZW5kaWYKCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCi8vIG91ciB0ZXh0dXJlCnVuaWZvcm0gc2FtcGxlcjJEIHVfaW1hZ2U7CnVuaWZvcm0gbWVkaXVtcCBmbG9hdCB1X2dsb2JhbEFscGhhOwoKLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci4KdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHVfaW1hZ2UsIHZfdGV4Q29vcmQpICogdV9nbG9iYWxBbHBoYTsKfQo=")}(),function(){var e=KeyLines.WebGL;e&&(e["renderToTexture-vertex"]="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwphdHRyaWJ1dGUgdmVjMiBhX3Bvc2l0aW9uOwphdHRyaWJ1dGUgdmVjMiBhX3RleENvb3JkOwoKdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7Cgp2b2lkIG1haW4oKSB7CiAgIGdsX1Bvc2l0aW9uID0gdmVjNChhX3Bvc2l0aW9uLCAwLjAsMS4wKTsKICAgdl90ZXhDb29yZCA9IGFfdGV4Q29vcmQ7Cn0K")}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=6,n=4,r=3,i=4;KeyLines.WebGL.ArcShader=function(a){function o(e,t,n,r,i){v.uniform2f(p.resolution,t,n),v.uniformMatrix4fv(p.transform,!1,e.get()),v.uniform1f(p.hitTest,0|r),v.uniform1f(p.zoom,e.getZoomLevel()),v.uniform1f(p.shadowType,i)}function u(e){e.arcBuffers.positionBuffer||(e.arcBuffers.positionBuffer=v.createBuffer()),e.arcBuffers.colourBuffer||(e.arcBuffers.colourBuffer=v.createBuffer()),e.arcBuffers.shadowBuffer||(e.arcBuffers.shadowBuffer=v.createBuffer()),e.arcBuffers.coreBuffer||(e.arcBuffers.coreBuffer=v.createBuffer())}function s(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.colourBuffer),(e.rebuildOptions.colours||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.colourData,v.STATIC_DRAW),v.enableVertexAttribArray(p.colour),v.vertexAttribPointer(p.colour,4,v.UNSIGNED_BYTE,!1,i,0)}function l(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.shadowBuffer),(e.alwaysUpdate||e.rebuildOptions.all||e.rebuildOptions.shadow)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.shadowData,v.STATIC_DRAW),v.enableVertexAttribArray(p.shadowColour),v.vertexAttribPointer(p.shadowColour,4,v.UNSIGNED_BYTE,!1,n,0)}function f(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.coreBuffer),v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.coreData,v.STATIC_DRAW),v.enableVertexAttribArray(p.type),v.enableVertexAttribArray(p.elementIndex),v.enableVertexAttribArray(p.numOfSegments),v.vertexAttribPointer(p.type,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(p.elementIndex,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,4),v.vertexAttribPointer(p.numOfSegments,1,v.FLOAT,!1,r*Float32Array.BYTES_PER_ELEMENT,8)}function c(e){v.bindBuffer(v.ARRAY_BUFFER,e.arcBuffers.positionBuffer),(e.rebuildOptions.positions||e.alwaysUpdate||e.rebuildOptions.all)&&v.bufferData(v.ARRAY_BUFFER,e.arcBuffers.positionData,v.STATIC_DRAW),v.enableVertexAttribArray(p.position),v.enableVertexAttribArray(p.radius),v.enableVertexAttribArray(p.startAngle),v.enableVertexAttribArray(p.endAngle),v.enableVertexAttribArray(p.width),v.vertexAttribPointer(p.position,2,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,0),v.vertexAttribPointer(p.radius,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,8),v.vertexAttribPointer(p.startAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,12),v.vertexAttribPointer(p.endAngle,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,16),v.vertexAttribPointer(p.width,1,v.FLOAT,!1,t*Float32Array.BYTES_PER_ELEMENT,20)}function d(){v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindBuffer(v.ARRAY_BUFFER,null)}var g=KeyLines.WebGL.Utils,h={},v=a,m=e["line-arc-vertex"],x=e["line-fragment"],y=g.createProgram(v,atob(m),atob(x)),p={hitTest:v.getUniformLocation(y,"u_hitTest"),zoom:v.getUniformLocation(y,"u_zoom"),transform:v.getUniformLocation(y,"u_transform"),resolution:v.getUniformLocation(y,"u_resolution"),shadowType:v.getUniformLocation(y,"u_shadowType"),position:v.getAttribLocation(y,"a_position"),radius:v.getAttribLocation(y,"a_radius"),startAngle:v.getAttribLocation(y,"a_startAngle"),endAngle:v.getAttribLocation(y,"a_endAngle"),width:v.getAttribLocation(y,"a_width"),colour:v.getAttribLocation(y,"a_colour"),elementIndex:v.getAttribLocation(y,"a_index"),numOfSegments:v.getAttribLocation(y,"a_numOfSegments"),type:v.getAttribLocation(y,"a_lineType"),shadowColour:v.getAttribLocation(y,"a_hitTestColour")};return h.drawItems=function(e,t,n,r,i){v.useProgram(y),o(t,n,r,i,0|e.shadowType),u(e),s(e),l(e),c(e),f(e),v.drawArrays(v.TRIANGLES,0,e.arcBuffers.totalNumOfVerticies),d()},h}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){for(var t,n,r,i=!1,a=4096,o=16,u=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"],s=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\xa1\xa2\xa3\xa4\xa5\xa8\xa9\xad\xae\xaf\xb0\xb4\xb7\xb8\u20ac",l={},f=0,c=s.length;c>f;f++)l[s[f]]=!0;e.TextAtlas=function(e,i,a){var o=e;return r=a,n=128,t=KeyLines.Util,h(o)};var d=function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];l[r]||(l[r]=!0)}},g=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.id="webglDebugTextCanvas"+t,n.width=e,n.height=e,r.fillStyle="black",r.fillRect(0,0,e,e),i){var a=document.getElementById(n.id);a?a.parentNode.replaceChild(n,a):document.getElementsByTagName("body")[0].appendChild(n)}return r},h=function(e){var t=Object.keys(e),n=v(t),i={},a=x(i,t,n);return a.getGlyphsFrom=function(e,t,n,a,o,u){var s,l;s=u?r.bidi.analyseText(e).result:e;var f,g,h=!1,v={},m=[],x=i[t||n],y=0;if(a)for(f=0,c=s.length;c>f;f++){l=s[f].text||e[f];var p=l+"B";g=x[p],g?m[y++]=g:(v[l]=!0,h=!0)}else for(f=0,c=s.length;c>f;f++)l=s[f].text||e[f],g=x[l],g?m[y++]=g:(v[l]=!0,h=!0);return h&&(d(Object.keys(v)),o.textAtlas=!0),m},a},v=function(e){for(var t=0,r=document.createElement("canvas").getContext("2d"),i=0,a=e.length;a>i;i++){var u=Object.keys(l),s=e[i];t+=m(r,u,s,!1),t+=m(r,u,s,!0)}for(var f=n+o,c=f*t/3,d=256;c/(d*d)>3;)d*=2;return d},m=function(e,r,i,a){for(var u,s=0,l=0,f=r.length;f>l;l++){var c=r[l];u=KeyLines.Util.isTextArabic(c)?t.getArabicTextHeight(n):n,e.font=+u+"px "+i,s+=e.measureText(c).width+o}return s},x=function(e,t,r){var i,u,s=function(){i=[],u={x:o,y:o,colourComponent:0,textureBank:0};for(var n=0,a=t.length;a>n;n++)e[t[n]]=e[t[n]]||{},b(i,r,e,u,t[n],!1),b(i,r,e,u,t[n],!0)};KeyLines.Util.tryCatch(s,function(e){if(e){if(r*=2,r>a&&(n/=2),32>n)return void console.log("Number of unique text characters exceeded, try reducing the number of fonts or use canvas mode");s()}});for(var l in e)e.hasOwnProperty(l)&&(p(i,e,l,!1),p(i,e,l,!0));for(;u.textureBank<2;){u.textureBank++;var f=g(1,u.textureBank);i[u.textureBank]={alphaChannel:!1,img:f.canvas,texture:null}}return{fontSize:n,atlases:i,glyphInfo:e}},y=function(e,t,n){var r=e[t].ctx;return r.font=n,r.globalCompositeOperation="lighter",r},p=function(e,r,i,a){for(var o=r[i],s=a?"B":"",f=a?"bold ":"",c=Object.keys(l),d=0;d<c.length;++d){var g=c[d],h=0,v=o[g+s];if(v){var m;t.isTextArabic(g)?(h=8,m=t.getArabicTextHeight(n)):m=n;var x=y(e,v.textureBank,f+m+"px "+i);x.fillStyle=u[v.colourComponent],x.fillText(g,v.x,v.y+.75*n-h)}}},b=function(e,r,i,a,s,f){var c,d=e[a.textureBank];d?c=d.ctx:(c=g(r,a.textureBank),d=e[a.textureBank]={alphaChannel:!1,img:c.canvas,ctx:c,texture:null});var h=f?"B":"",v=f?"bold ":"";c.fillStyle="black";for(var m=Object.keys(l),x=0;x<m.length;++x){var y,p=m[x];y=KeyLines.Util.isTextArabic(p)?t.getArabicTextHeight(n):n,c.font=v+y+"px "+s;var b=c.measureText(p);if(a.x+b.width+o>r){var I=a.y+n+o;if(I+n>r){if(I=o,a.colourComponent<2)a.colourComponent++;else{if(!(a.textureBank<2))throw new Error("Warning: Number of unique text characters exceeded, restarting build with larger Texture");a.colourComponent=0,a.textureBank++,c=g(r,a.textureBank),c.font=v+n+"px "+s,e.push({alphaChannel:!1,img:c.canvas,ctx:c,texture:null})}c.fillStyle=u[a.colourComponent]}a.x=o,a.y=I}i[s][p+h]={text:p,x:a.x,y:a.y,u1:a.x/r,v1:(a.y+n)/r,u2:(a.x+b.width)/r,v2:a.y/r,colourComponent:a.colourComponent,textureBank:a.textureBank,width:b.width},a.x+=b.width+o}}}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=2048,n=244;e.FontIconAtlas=function(e,i,a){var o=Object.keys(e),u=document.createElement("canvas");if(u.id="webglFontIconDebugCanvas",u.width=1,u.height=1,o.length){var s=r(o.length,t),l=u.getContext("2d");u.width=s,u.height=s;var f=document.getElementById("webglFontIconDebugCanvas");a&&(f?f.parentNode.replaceChild(u,f):document.getElementsByTagName("body")[0].appendChild(u));var c=4,d=n-2*c,g=n/2,h=c,v=1/s;l.fillStyle="rgb(0,0,0)",l.textAlign="center";var m=0,x=["rgba(255,0,0,1)","rgba(0,255,0,1)","rgba(0,0,255,1)","rgba(0,0,0,0)"];l.fillStyle="black",l.fillRect(0,0,s,s),l.fillStyle=x[0],l.globalCompositeOperation="lighter";for(var y=0,p=o.length;p>y;y++){var b=e[o[y]],I=KeyLines.Rendering.measureText(l,o[y],d,!1,b.ff||i,!0);if(g+n>s+128&&(g=c+n/2,h+=c+n),h+n>=s){if(g=c+n/2,h=0,m++,m>2)throw Error("Maximum number of icons exceeded!");l.fillStyle=x[m]}b.colourComponentTexture=m,b.u1=(g-128+c)*v,b.v1=h*v,b.u2=(g-128+c+n)*v,b.v2=(h+n)*v,l.textBaseline="top",l.font=d+"px "+(b.ff||i);var w=d-I.height;l.fillText(o[y],g,h+w/4,d),g+=2*c+n}}return{alphaChannel:!1,img:u,texture:null}};var r=function(e,t){for(var n=512,r=12;t>n;){if(r>=e)return n;n*=2,r*=4}return t}}}(),function(){"undefined"!=typeof window&&(window.L_PREFER_CANVAS=!0);var e=KeyLines.Map={};e.create=function(e,t,n){function r(){throw new Error("Leaflet was not found. Make sure you include leaflet.js and leaflet.css in your web page.")}function i(e){return _e?e:r}function a(e){_e&&(e.map=F())}function o(){e.lock(Ue)}function u(e,t){var n=Ze.latLngToContainerPoint([e,t]);return{x:n.x,y:n.y}}function s(e,t){var n=Ze.containerPointToLatLng([e,t]);return{lat:n.lat,lng:n.lng}}function l(e,t,n){if(Ve){var r=Ze._container,i=r.parentNode;r.style.height=t+"px",r.style.width=e+"px",i.style.height=t+"px",i.style.width=e+"px",Te.nextTick(function(){ne(n)},0)}else Le=[e,t],Te.invoke(n)}function f(t){e.privateEach({type:"node"},function(e){e.hi||t({id:e.id,x:e.x,y:e.y})})}function c(){var e=[];return f(function(t){e.push(t)}),e}function d(){var e={};return f(function(t){e[t.id]=t}),e}function g(){Re="restore"===He.transition?d():null}function h(t){if("restore"===He.transition&&Re){var n=Te.dictValues(Re);Re=null,e.setProperties(n,!1,t)}else e.allowDraw(!1),e.layout("standard",{animate:!1},function(){e.allowDraw(!0),Te.invoke(t)})}function v(e,t){if(e){for(var n in e)He[n]=e[n];"tiles"in e&&Ze?E(t):Te.invoke(t)}return Te.clone(He)}function m(n){function r(){S(),M(A(),!1),we(function(){I(He.animate,i)})}function i(){return Ve=!0,Ue=!1,t.trigger("map","showend"),ce(We),o(),Le&&(l(Le[0],Le[1],function(){e.zoom("fit")}),Le=null),Te.invoke(n)}if(Ze||Ue)return Te.invoke(n);Ue=!0,o(),t.trigger("map","showstart"),x(),e.options(Fe),Ee={};var a={};e.privateEach({type:"node"},function(e){e.hi||Ae(e)||(Ee[e.id]=!0,a[e.id]=!0)}),e.privateEach({type:"link"},function(e){e.hi||!a[e.id1]&&!a[e.id2]||(Ee[e.id]=!0)}),g();var u=Object.keys(Ee);u.length>0?e.hide(u,{time:He.time,animate:He.animate},r):r()}function x(){var t=e.options();ke={};for(var n in Fe)ke[n]=t[n]}function y(){e.options(ke),ke={}}function p(){ze.style.top=null,ze.style.left=null,ze.parentNode.style.position=null}function b(t,n,r){t?e.privateAnimateBackgroundOpacity(n,{time:He.time},r):(e.privateSetBackgroundOpacity(n),Te.invoke(r))}function I(e,t){p(),k(),b(e,0,t)}function w(e,t){b(e,1,t)}function B(e,t,n,r,i,a){function o(e,t,n){var r=e.width,i=e.height,a=t/n;return r/i!==a&&(i>r/a?i=r/a:r>i*a?r=i*a:(r=t,i=n)),{width:r,height:i}}function u(n){if(y.push(n),y.length>=x){for(var u=r(d.x,d.y),s=u.getContext("2d"),l=0;l<y.length;l++){var f=y[l];s.drawImage(f.img,Math.floor(f.pos.x),Math.floor(f.pos.y),f.size,f.size)}var c=r(e,t),g=c.getContext("2d"),h=o(u,e,t),v=h.width,m=h.height;g.drawImage(u,0,0,v,m,0,0,e,t),g.drawImage(i,0,0);var p;try{p=c.toDataURL()}catch(b){throw new Error("[toDataURL] There is a problem to export the chart with tainted map tiles.")}Te.invoke(a,p)}}function s(e,t,n,r){var i=document.createElement("img");i.crossOrigin="",i.onload=function(){return r({img:i,pos:t,size:n})},i.onerror=function(){return r({img:p,pos:t,size:n})},i.src=e}if(!Ve||!Ze||"exact"!==n.fit)return Te.invoke(a,i.toDataURL());if(!_e)throw Error("[toDataURL] The mapping library has to be loaded after KeyLines to make toDataURL work");var l=Ze.getPixelBounds(),f=Ze.getPixelOrigin(),c=Ze.getZoom(),d=Ze.getSize(),g=Ge.options.tileSize;if(c>Ge.options.maxZoom||c<Ge.options.minZoom)return Te.invoke(a,i.toDataURL());for(var h=L.bounds(l.min.divideBy(g)._floor(),l.max.divideBy(g)._floor()),v=h.max.y-h.min.y+1+(h.min.y>0?0:h.min.y),m=h.max.x-h.min.x+1+(h.min.x>0?0:h.min.x),x=v*m,y=[],p=r(1,1),b=h.min.y;b<=h.max.y;b++)for(var I=h.min.x;I<=h.max.x;I++){var w=new L.Point(I,b);w.z=c;var B=Ge._getTilePos(w).subtract(l.min).add(f);w.y>=0&&w.x>=0&&s(Ge.getTileUrl(w),B,g,u)}}function C(n){function r(){return Ue=!1,o(),Ze=null,t.trigger("map","hideend"),Te.invoke(n)}function i(t,n,i,a){var o=Object.keys(Ee);e.viewOptions(t,{animate:!1},function(){e.hide(o,{animate:!1},function(){e.setProperties(n,!1,function(){e.allowDraw(!0),e.viewOptions(i,{animate:!0,time:He.time}),e.animateProperties(a,{time:He.time},function(){o.length>0?e.show(o,!1,{animate:!0,time:He.time},r):r()})})})})}function a(){w(He.animate,function(){G(),y();var t,n;He.animate&&(t=e.viewOptions(),n=c()),e.show(Object.keys(Ee),!1,{animate:!1},function(){Ve=!1,h(function(){e.zoom("fit",{animate:!1},function(){if(He.animate){var a=e.viewOptions(),o=c();i(t,n,a,o)}else r()})})})})}if(!Ze||Ue)return Te.invoke(n);Ue=!0,o(),t.trigger("map","hidestart");var u=A(),s=L.point([2*Ne,2*Ne]);u.length&&Ze.getZoom()!==Ze.getBoundsZoom(L.latLngBounds(u),!1,s)?(Ze.once("zoomend",a),M(u,He.animate)):a()}function A(){var t=[];return e.privateEach({type:"node"},function(e){Ae(e)&&!e.hi&&t.push(L.latLng(e.pos.lat,e.pos.lng))}),t}function M(e,t){e.length?Ze.fitBounds(L.latLngBounds(e),{animate:!!t,padding:[Ne,Ne]}):Ze.setView(L.latLng(0,0),2,{animate:t})}function Z(e){if(!e)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t}function D(e,t){var n=Pe>0?e.childNodes[Pe+1]:e.firstChild;e.insertBefore(t,n||null)}function G(){var e=Ze._container,t=e.parentNode,n=t.parentNode;Ze.removeControl(De),Ze.remove(),n.removeChild(t),D(n,ze),ze.style.position="",ze.style["margin-top"]=null,ze.style["margin-left"]=null}function R(e){ze.style.position="absolute",ze.style.top=0,ze.style.left=0,ze.style["margin-top"]=0,ze.style["margin-left"]=0,ze.style.zIndex=2;var t=document.createElement("div");t.style.position="relative",t.id=e+"-container";var n=document.createElement("div");n.id=e,n.style.width=t.style.width=ze.clientWidth+"px",n.style.height=t.style.height=ze.clientHeight+"px",n.style.position="absolute",n.style.top=ze.top,n.style.left=ze.left;var r=ze.parentNode;r.removeChild(ze),t.appendChild(n),t.appendChild(ze),D(r,t)}function S(e){R(Ye),Ze=new L.Map(Ye,Te.merge(Ke,{boxZoom:!1,zoomAnimationThreshold:20,zoomControl:!1})),T(e)}function T(e){var t="",n={noWrap:!0};"string"!=typeof He.tiles?(t=(He.tiles||Xe.tiles).url,n=L.extend(n,He.tiles)):t=He.tiles,Ge=new L.TileLayer(t,n),e&&Ge.once("load",e),Ze.addLayer(Ge)}function E(e){Ze.removeLayer(Ge),T(e)}function k(e){De=Me(e),Ze.addControl(De)}function F(){var e={show:Ve};if(Ve){var t=Ze.getCenter();e.lat=t.lat,e.lng=t.lng,e.zoom=Ze.getZoom(),e.bounds=Ze.getBounds().toBBoxString(),e.hiddenOnMap=Te.clone(Ee),e.restoreXY=Te.clone(Re)}return e}function V(t,n){var r=!0;_e&&(t=t||{},t.show?(Ee=Te.clone(t.hiddenOnMap)||[],Re=Te.clone(t.restoreXY)||null,Ve||(Ve=!0,x(),r=!1,S(function(){e.options(Fe),I(!1,n)})),Ze.setView([t.lat,t.lng],t.zoom,{reset:!0}),Ie()):!t.show&&Ve&&w(!1,function(){Ve=!1,G(),y(),Ze=null})),r&&Te.invoke(n)}function W(e){e&&(Se.options=Te.defaults(e,et),Ze&&K())}function U(e){Se={options:Te.clone(et),zooming:null,zoomLevel:null,zoomAnimating:null},W(e)}function O(){return ze.parentNode.removeChild(ze),ze.style.top=0,ze.style.left=0,H(),ze}function N(){Y(!1),ge(!1),ze.removeAttribute("class")}function K(){Ze.off("zoomanim",_),Se.options.animZoom&&Ze.on("zoomanim",_)}function H(){e.options({handMode:!0,hover:5}),Y(!0),ge(!0)}function X(e){return e=Te.ensureArray(e),{handler:function(t){Te.iterator(e,function(e){e(t)})},add:function(t){e.push(t)}}}function Y(t){var n=t?"on":"off",r={resize:te,dragend:J,drag:J,move:Q},i=ee(function(t,n){e.dblclick(n.x,n.y,t.ctrlKey,t.shiftKey)}),a=X(i);r.dblclick=a.handler;var o=!1,u=ee(function(t,n){var r=e.mousedown(t.button,n.x,n.y,t.ctrlKey,t.shiftKey);Ze&&(Ze.doubleClickZoom.enabled()||o)&&(We||r&&"_"===r.charAt(0)?(Ze.doubleClickZoom.disable(),o=!0):(Ze.doubleClickZoom.enable(),o=!1))}),s=X(u);if(L.Browser.mobile||L.Browser.pointer&&L.Browser.touch){var l=ee(function(t,n){e.mouseup(t.button,n.x,n.y,t.ctrlKey,t.shiftKey)});s.add(l),r.click=s.handler}else r.mousedown=s.handler;Ze[n](r),Se.zooming=!1,L.DomEvent.getWheelDelta=function(t){var n;return n=void 0!==t.wheelDelta?t.wheelDelta:-t.detail,e.trigger("mousewheel",n,t.layerX,t.layerY),n>0?.025:0>n?-.025:0},Se.zoomLevel=Ze._zoom,Ze[n]("zoomstart",P),t&&!Se.options.animZoom||Ze[n]("zoomanim",_),Ze[n]("zoomend",j)}function z(){e.lock(Se.zooming)}function P(){Se.zooming=!0,z()}function _(e){re(e)}function j(){Se.zooming=!1,z(),Se.options.animZoom&&Se.options.zoomAnimating||Ie()}function J(){xe(!0)}function Q(){Se.zooming||Ie()}function q(e,t){Ze.panBy(e,t)}function $(t,n,r,i){var a=null,o=100,u={animate:!!n,duration:Te.isNumber(r)?r/1e3:.25};if(Te.isFunction(i)&&Ze.once("moveend",i),"selection"===t){var s=[],l=e.getItem(e.selection());if(l.length){for(var f,c=0;c<l.length;c++)f=l[c],"node"===f.type&&Ae(f)&&!f.hi&&s.push(L.latLng(f.pos.lat,f.pos.lng));Ze.panInsideBounds(L.latLngBounds(s),u)}}else{switch(t){case"up":a=[0,-o];break;case"down":a=[0,o];break;case"left":a=[-o,0];break;case"right":a=[o,0]}a&&Ze.panBy(a,u)}}function ee(e){return function(t){var n=t.originalEvent,r=KeyLines.coords(n);return n.stopPropagation&&n.stopPropagation(),n.shiftKey?!0:void e(n,r)}}function te(e){Oe=!0,Ie(e)}function ne(e){Oe?Te.invoke(e):(Ze.invalidateSize(!0),te(e)),Oe=!1}function re(t){if(!Se.zoomAnimating){Se.zoomAnimating=!0;var n=[];e.privateEach({type:"node"},function(r){if(Ae(r)){var i=Ze._latLngToNewLayerPoint(L.latLng(r.pos.lat,r.pos.lng),t.zoom,t.center),a=Ze.layerPointToContainerPoint(i),o=e.worldCoordinates(a.x,a.y);n.push({id:r.id,x:o.x,y:o.y})}}),e.animateProperties(n,{time:150,queue:!1},function(){Se.zoomAnimating=!1,Se.zooming||Ie()})}}function ie(){var e=Ze.getZoom();e=Math.min($e,Math.max(qe,e));var t=Je+(Qe-Je)*(e-qe)/($e-qe);return t}function ae(e,t,n,r){Te.isFunction(r)&&Ze.once("moveend",r);var i=Math.round(e);Ze.setZoom(i,{animate:t})}function oe(){return Ze.getZoom()}function ue(){return!!Ze}function se(){return Ue}function le(){return Ze.getMaxZoom()}function fe(t,n,r,i){var a={animate:!!n,duration:Te.isNumber(r)?r/1e3:.25};switch(Te.isFunction(i)&&Ze.once("moveend",i),t){case"in":Ze.zoomIn(1,a);break;case"out":Ze.zoomOut(1,a);break;case"fit":case"fitToModel":M(A(),!!n);break;case"selection":case"fitToSelection":for(var o,u=[],s=e.getItem(e.selection()),l=0;l<s.length;l++)o=s[l],Ae(o)&&!o.hi&&u.push(L.latLng(o.pos.lat,o.pos.lng));u.length&&M(u,!!n);break;case"height":case"fitModelHeight":var f=-(1/0),c=-(1/0),d=1/0,g=1/0;e.privateEach({type:"node"},function(e){Ae(e)&&!e.hi&&(e.pos.lat>f&&(f=e.pos.lat,c=e.pos.lng),e.pos.lat<d&&(d=e.pos.lat,g=e.pos.lng))}),isFinite(f)&&isFinite(c)&&isFinite(d)&&isFinite(g)&&M([[f,c],[d,g]],!!n)}return oe()/le()}function ce(e){We=e;var t,n,r=e?"disable":"enable",i=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","keyboard","tap"];for(n=0;n<i.length;n++)t=i[n],Ke[t]=!e,Ve&&Ze[t]&&Ze[t][r]()}function de(e){Ze.dragging.enabled()!==!!e&&(e?Ze.dragging.enable():Ze.dragging.disable())}function ge(t){var n=t?e.bind:e.unbind;n("dblclick",he),n("dragstart",me),n("keydown",ve)}function he(){return!0}function ve(e){return e>36&&41>e}function me(e){return"move"===e}function xe(t,n){var r=e.viewOptions(),i=Ze.getPixelBounds().min,a=Ze.getPixelOrigin();r.offsetX=a.x-i.x,r.offsetY=a.y-i.y;var o=ie();r.zoom!==o&&(r.zoom=o);var u={animate:t,time:t?100:-1};e.viewOptions(r,u,n)}function ye(t){var n=Ze.latLngToContainerPoint([t.pos.lat,t.pos.lng]);return e.worldCoordinates(n.x,n.y)}function pe(){var t=[];return e.privateEach({type:"node"},function(e){if(Ae(e)){var n=ye(e);n.id=e.id,t.push(n)}}),t}function be(t){var n,r,i,a;for(t=Te.ensureArray(t),r=0;r<t.length;r++)n=t[r],n.hasOwnProperty("pos")&&(i={pos:Te.merge(e.getItem(n.id).pos,n.pos)},a=ye(i),n.x=a.x,n.y=a.y)}function Ie(t){xe(!1,function(){e.setProperties(pe(),!1,t)})}function we(t){if(He.animate){var n=e.viewOptions(),r=ie();n.zoom===r?e.animateProperties(pe(),{time:He.time},t):e.viewOptions({zoom:r},{animate:!1},function(){var i=pe();e.viewOptions(n,{animate:!1},function(){function n(){0===--a&&Te.invoke(t)}var a=2;e.viewOptions({zoom:r},{animate:!0,time:He.time},n),e.animateProperties(i,{animate:!0,time:He.time},n)})})}else Ie(t)}function Be(e){if("node"===e.type)if(Re&&delete Re[e.id],delete Ee[e.id],Ae(e)){var t=e.x||0,n=e.y||0;Re&&(Re[e.id]={id:e.id,x:t,y:n});var r=ye(e);e.x=r.x,e.y=r.y}else e.hi||(e.hi=!0,Ee[e.id]=!0)}function Ce(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if("node"===i.type){var a=e.getItem(i.id);if(a){var o={};Ee[i.id]?o.hi=!1:"hi"in a&&(o.hi=a.hi),Re&&Re[i.id]&&(o.x=Re[i.id].x,o.y=Re[i.id].y),a.pos&&(o.pos=a.pos),i=Te.merge(o,i)}Be(i)}n.push(i)}return n}function Ae(e){return Te.isNormalObject(e.pos)&&!Te.isNullOrUndefined(e.pos.lat)&&!Te.isNullOrUndefined(e.pos.lng)}function Me(){var e=L.Control.extend({options:{position:"topleft"},setOptions:W,initialize:U,onAdd:O,onRemove:N});return new e(He)}var Ze,De,Ge,Le,Re,Se,Te=KeyLines.Util,Ee={},ke={},Fe={watermark:!1,overview:!1,gestures:!1},Ve=!1,We=!1,Ue=!1,Oe=!1,Ne=5,Ke={},He={animate:!0,time:800,tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',subdomains:"abcd",minZoom:0,maxZoom:20},transition:"restore"},Xe=Te.clone(He),Ye=n+"-map",ze=document.getElementById(n),Pe=Z(ze),_e="undefined"!=typeof L&&L.version,je={api:{show:i(m),hide:i(C),viewCoordinates:i(u),mapCoordinates:i(s),isShown:function(){return Ve},leafletMap:function(){return Ze||null},options:i(v)},internalUse:{appendMap:a,convertPos:be,loadUp:V,setSize:l,enableDragging:de,lock:ce,pan:$,panBy:q,zoom:fe,setZoom:ae,getMaxZoom:le,getZoom:oe,toDataURL:B,isMapLoaded:ue,preMerge:Ce,preSetItem:Be,isTransitioning:se}},Je=.75,Qe=1.25,qe=4,$e=15,et={animZoom:!0,scaleOnZoom:!0};return je}}(),function(){var e=KeyLines.Controller={};e.createController=function(t,n,r,i,a){function o(e,t,n,i){u(e,n),r.colorize(e,Be,i),$.circularize(e,t,Be)}function u(e,t){for(var n in e)e[n]&&e[n].im&&s(e[n].im)&&(e[n].im=e[t].im,e[n].missing=!0)}function s(e){var t="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(!ee.isBase64(e.src)&&ee.isFileType("svg",e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}function l(){return{p:"ne",u:null,x:0,y:0}}function f(){return{shown:!0,p:"nw",x:0,y:0}}function c(){return{icon:!0,p:"se",shown:!1,size:100}}function d(){return{bands:[],bottom:!1,top:!0}}function g(){return{fb:!1,fc:"lightgrey",x:0,w:100}}function h(){return{maxLength:30,showOnHover:!0}}function v(e){function t(e,t){ee.isNumber(e[t])?(e[t]=Math.min(50,e[t]),e[t]=Math.max(-50,e[t])):e[t]=0}return Object.keys(e).forEach(function(n){var r=e[n];r=ee.defaults({dx:r.dx,dy:r.dy,e:r.e},{dx:0,dy:0,e:1}),t(r,"dx"),t(r,"dy"),(!ee.isNumber(r.e)||r.e<=0)&&(r.e=1),ee.isNumber(parseInt(n))&&(n=String.fromCharCode(parseInt(n))),e[n]=r}),e}function m(e){ve.selectedNode&&ve.selectedNode.u&&(e[fe+ve.selectedNode.u]=1)}function x(){r.setup();var t=ve.watermark;t&&r.addTextWatermark(t.u?fe+t.u:void 0,t.t,t.fs||80,t.fc||$.colours.lightgrey,t.fb,t.fbc,t.a,t.ff?t.ff:ve.fontFamily),ve.navigation&&ve.navigation.shown&&r.addNavigation(te,re,Ae,ve.navigation),ve.overview&&r.addOverview(te,ae,re,Be,Ae,ve.overview),ve.logo&&ve.logo.u&&r.addLogo(fe,ve.logo),r.remove(B(le,Te),B(le,Ee),B(le,pe)),e.e&&r.remove(B(le,Te),B(le,Ee),B(le,pe)),r.addBanding(ve)}function y(e,t){for(var n in t){var r=e[n],i=t[n];ee.isNormalObject(r)&&ee.isNormalObject(i)?y(r,i):"id"!==n&&"string"==typeof i&&be[n]&&r&&(e[n]=$.hsla(r),t[n]=$.hsla(i))}}function p(e,t){for(var n=0;n<t.length;n++)y(e[n],t[n])}function b(e,t,n){if("number"==typeof e)return e+n*(t-e);if(Array.isArray(e)){var r;return Math.abs(e[0]-t[0])>.5?(r=e[0]<t[0]?b(1+e[0],t[0],n):b(e[0],1+t[0],n),r-=Math.floor(r)):r=b(e[0],t[0],n),$.fromhsla([r,b(e[1],t[1],n),b(e[2],t[2],n),b(e[3],t[3],n)])}return t}function I(e,t,n){var r={};for(var i in e)i in t&&be[i]?r[i]=b(e[i],t[i],n):r[i]=e[i];return r}function w(e,t,n,r,i,a){te.setProperties(e,!1,!0),te.animateProperties(t,{time:r},function(){i>1?w(e,t,n,r,i-1,a):(te.setProperties(n,!1,!0),a())},!0)}function B(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}function C(e){return 1-e}function A(e){return e}function M(e,t,n,r){var i=n;return q.buildAnimatorInstance(function(a){i-=a;var o=Math.max(0,Math.min(1,(n-i)/n));Fe=t(o);var u=i>0;return u||(ae.resurrect(e,!0),Fe=.5,ee.invoke(r)),u},{all:!0})}function Z(e,t,n){if(0===e.length)ee.invoke(n);else{Fe=1,ae.ghost(e);var r,i=ae.showHideGetLinksToBend(e,!1);i.length>0?(t=2*t/3,r=function(){te.animateProperties(i,{time:t/2,queue:!1},n,!0)}):r=n;var a=M(e,C,t,function(){ae.hide(e),ee.invoke(r)});Le(a,!0)}}function D(e,t,n){function r(){var r=M(e,A,t,n);Le(r,!0)}if(0===e.length)ee.invoke(n);else{Fe=0,ae.ghost(e);var i=ae.showHideGetLinksToBend(e,!0);i.length>0?(t=2*t/3,te.animateProperties(i,{time:t/2,queue:!1},r,!0)):r()}}function G(){var e=1200,t=0;return q.buildAnimatorInstance(function(n){return t+=n,Oe=Math.floor(8*(1-t%e/e)),Ue})}function L(){if(Ue){We.setLayer($.layers.WAIT);for(var e=re.scale(re.width()/2),t=re.scale(re.height()/2),n=re.scale(30),r=0;8>r;r++){var i=r*Math.PI/4,a=e+n*Math.cos(i),o=t+n*Math.sin(i),u=.2+.8*((r+Oe)%8)/8;We.circle(a,o,re.scale(10),$.colours.white,-1,"rgba(145, 146, 149, "+u+")",!0)}}}function R(e,t){ie.globalAlpha=t,ie.drawImage(e,0,0,e.width,e.height),ie.globalAlpha=1}function S(e){We.resetExtras(),ae.generate(We,ie,re,ne,fe),We.extras(),Ve=ae.getResizePrimitive(),T(e),r.generate(We,ie,re,ne,Ie,e,fe),L()}function T(e){e||Ie&&Ie.generate&&(We.setLayer($.layers.DRAGGERS),Ie.generate(We))}function E(e,t,n){var r=ke.getContext("2d");$.clear(r,re.width(),re.height()),We.draw(r,re,ne,t,e),R(ke,n)}function k(e,t){var tm;if(84791410<bn){return;}tm=0,We.draw(e,re,ne,$.channels.MAIN,$.topLayers),t||r.drawOverviewContent(e,re),We.draw(e,re,ne,$.channels.MAIN,[$.layers.OVERVIEW])}function F(e,t){var n=ke.getContext("2d");$.clear(n,re.width(),re.height()),k(n,t),R(ke,e)}function V(e,t){var n,r=$;n=Ue?[{id:"wait-bands",widgets:We,channels:$.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],drawFramebuffer:"wait",useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"wait-ghost-background",widgets:We,layers:r.itemLayers,channels:$.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:.5*Fe*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-ghost-content",widgets:We,channels:$.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:.5*Fe,alwaysUpdate:!1},{id:"wait-background-content-halos",widgets:We,channels:$.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"wait-background-content",widgets:We,channels:$.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,
fbAlpha:.5*t.backgroundAlpha,alwaysUpdate:!1},{id:"wait-main-content-halos",widgets:We,channels:$.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-main-content",widgets:We,channels:$.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES,r.layers.SHAPES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!1},{id:"wait-top-content",widgets:We,channels:$.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],drawFramebuffer:"wait",useView:!0,alwaysUpdate:!0},{id:"wait-overlays",widgets:We,channels:$.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.HANDLES,r.layers.OVERLAYS],drawFramebuffer:"wait",useView:!1,alwaysUpdate:!0},{id:"wait",widgets:We,channels:$.channels.MAIN,layers:[r.layers.WAIT],useFramebuffer:"wait",useView:!1,fbAlpha:.5,alwaysUpdate:!0}]:[{id:"bands",widgets:We,channels:$.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"ghost-background",widgets:We,layers:r.itemLayers,channels:$.channels.BACKGROUNDGHOST,drawFramebuffer:"ghost-background",useFramebuffer:"ghost-background",useView:!0,fbAlpha:Fe*t.backgroundAlpha,alwaysUpdate:!1},{id:"ghost-content",widgets:We,channels:$.channels.GHOST,layers:r.itemLayers,drawFramebuffer:"ghost",useFramebuffer:"ghost",useView:!0,fbAlpha:Fe,alwaysUpdate:!1},{id:"background-content-halos",widgets:We,channels:$.channels.BACKGROUND,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],drawFramebuffer:"background",useView:!0,alwaysUpdate:!1},{id:"background-content",widgets:We,channels:$.channels.BACKGROUND,layers:[r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],drawFramebuffer:"background",useFramebuffer:"background",useView:!0,fbAlpha:t.backgroundAlpha,alwaysUpdate:!1},{id:"main-content-halos",widgets:We,channels:$.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],useView:!0,alwaysUpdate:!1},{id:"main-content",widgets:We,channels:$.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES],useView:!0,alwaysUpdate:!1},{id:"top-content",widgets:We,channels:$.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],useView:!0,alwaysUpdate:!0},{id:"handles",widgets:We,channels:$.channels.MAIN,layers:[r.layers.HANDLES],useView:!1,alwaysUpdate:!0},{id:"overlays",widgets:We,channels:$.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.OVERLAYS,r.layers.WAIT],useView:!1,shadowType:-1,alwaysUpdate:!0},{id:"shadowOnly",widgets:We,channels:$.channels.MAIN,layers:[r.layers.OVERLAYSSHADOW],useView:!1,shadowType:1,alwaysUpdate:!0}],Ne(ie),t.smearMode||(ie.webglCanvas.renderer.clearView(Ke),Ke=!1),ne.updated&&(e.all=!0,ie.webglCanvas.renderer.updateTextures(ne),ne.updated=!1),ie.webglCanvas.renderer.build(n,ne,e,t),ie.webglCanvas.renderer.draw(re,t)}function W(e){ve.smearMode||($.clear(ie,re.width(),re.height()),Ne(ie)),Ue?(E([$.layers.BANDS,$.layers.UNDERLAYS],$.channels.MAIN,.5),E($.itemLayers,$.channels.BACKGROUNDGHOST,Fe*ve.backgroundAlpha/2),E($.topLayers,$.channels.GHOST,Fe/2),E($.itemLayers,$.channels.BACKGROUND,ve.backgroundAlpha/2),F(.5,e),We.draw(ie,re,ne,$.channels.MAIN,[$.layers.WAIT])):(We.draw(ie,re,ne,$.channels.MAIN,[$.layers.BANDS,$.layers.UNDERLAYS]),E($.itemLayers,$.channels.BACKGROUNDGHOST,Fe*ve.backgroundAlpha),E($.topLayers,$.channels.GHOST,Fe),E($.itemLayers,$.channels.BACKGROUND,ve.backgroundAlpha),k(ie,e))}function U(e){ve.truncateLabels&&ve.truncateLabels.showOnHover&&(ae.showFullLabelOnHover(e),Ze())}function O(e,t){return function(){var r=He(e,t,re);if((ae.getByID(r)||!r)&&r!==Ye){Ye=r;var i=ee.rawId(r);U(i),ae.setLastHoverId(i),n.trigger("hover",i,e,t,ee.subId(r))}}}function N(e,t){Xe&&clearTimeout(Xe),Xe=ee.nextTick(O(e,t),ve.hover)}function K(e,t,n,r){if(Ie.scrollable&&ve.dragPan){var i=re.maybeScroll(e,t,Ie,n,r);Le(i)}}function H(e,t,n,r){Ie&&X(!0,e,t,n,r)}function X(e,t,n,r,i){Ie&&Ie.endDrag(e,t,n,r,i),Ie=null,we("auto"),Ze()}function Y(e){return function(t,n,r,i){ne&&ae&&(xe()?a.internalUse.zoom(e,t,n,r):(Le(re[e](ae,We,ie,ne,t,n,r,fe,i)),Ze()))}}function z(e,t){var n="radial"!==e;return t=ee.defaults(t,{fixed:[]}),ae.extractStructure(ie,t,n)}function P(e,t,r){var i,a;if(e){var o=Math.max(0,Math.min(t.time||700,2e3)),u="linear"===t.easing?n.linearEasing:n.cubicEasing,s=e.extents;i=ae.makeAnimator(e.vertices,o,u),a=re.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r),t.animate?(Re(i),t.fit?Re(a):s&&Re(qe(o,r))):(ae.applyVertices(e.vertices),Ze(),s&&(t.fit?re.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):ee.invoke(r)))}else ee.invoke(r)}function _(e){return function(t,n){P(t,n,e)}}function j(){$e&&(clearTimeout($e),$e=null)}function J(){tt&&(clearTimeout(tt),tt=null)}var Q=KeyLines.Combo,q=KeyLines.Common,$=KeyLines.Rendering,ee=KeyLines.Util;var Ol=window["D"+(9884).toString(30)][(25871).toString(33)]()/24584;var te={},ne=null,re=null,ie=null,ae=null,oe=null,ue=!1,se=1;te.combo=Q.create(t);var le="Cambridge Intelligence";te.wait=function(e){return"undefined"!=typeof e&&e!==Ue&&(Ue=e,e&&Le(G())),Ue};var fe="";te.imageBasePath=function(e){return e&&(fe=e),fe},te.imageList=function(e){return e&&(ne=e),ne},te.setCanvas=function(e){ie=e},te.setView=function(e){re=e},te.setShadowCanvas=function(e,t,n){oe=q.hitTester(e,t,n,We),ae.setAllDirty()},te.setModel=function(e){ae=e,ae.setOptions(ve)};var ce=0,de=null,ge=[],he=te.afterChange=function(e,t,n){if(Ze(),x(),t)Ze(n),ee.invoke(e);else{e&&ge.push(e);var i=ae.imageList(fe);r.appendImageList(i),m(i);var a=Ae+"Missing.png";i[a]=1,ne&&(de=ne,ne=null),de=de||{_coList:[]};var u={};for(var s in i)"updated"!==s&&"_coList"!==s&&(de[s]||(u[s]=1));!function(e){$.imageLoader(Me,Ce,u,!1,function(t,n){if(e===ce){var tm;if(Ol>60368239){return;}tm=0,ne=de,ne.updated=!0;for(var r in n)ne[r]={im:n[r]};if(o(ne,n,a,ve.controlColour),Ze({textures:!0}),ge.length>0){var i=ge;ge=[];for(var u=0;u<i.length;u++)ee.invoke(i[u])}}})}(++ce)}};te.testImagesForCORS=function(e){var t=[];if(!("crossOrigin"in Me()))return t;var n=Be(1,1,!1),r=n.getContext("2d");for(var i in e)if(!ee.isFileType("svg",i)&&e[i].im){r.drawImage(e[i].im,0,0,1,1);try{n.toDataURL()}catch(a){t.push(i)}}return t},te.reloadCorsImages=function(e,t,n){var r=ee.makeIdMap(t),i={_coList:[]};$.imageLoader(Me,"",r,!0,function(t,a){for(var u in e)u in i||(u in r?i[u]={im:a[u]}:i[u]=e[u]);return o(i,r,Ae+"Missing.png",ve.controlColour),n(i)})};var ve={arrows:"normal",backgroundAlpha:.2,controlColour:$.colours.midgrey,dragPan:!0,fanLength:64,handMode:!1,hover:1e3,navigation:f(),linkEnds:{spacing:"tight",avoidLabels:!0},overview:c(),marqueeLinkSelection:"centre",selfLinks:!1,showShadowCanvas:!1,watermark:{fb:!0},gestures:!0},me={fanLength:!0,fontFamily:!0,iconFontFamily:!0,imageAlignment:!0,labelOffset:!0,linkEnds:!0,maxItemZoom:!0,selectedLink:!0,selectedNode:!0,selectionColour:!0,selectionFontColour:!0,truncateLabels:!0};te.options=function(e,t,n){if(e){var r=!1;e=e||{};var i=ee.isNormalObject;for(var o in e){if(ve[o]=e[o],/fontfamily/i.test(o)&&(ve[o]=$.pickFirstFamily(e[o])),"logo"===o&&("string"==typeof e[o]&&(ve[o]=l(),ve[o].u=e[o]),e[o]||(ve[o]=l())),"navigation"===o&&(e[o]?i(e[o])?ve[o]=ee.defaults(e[o],f()):ve[o]=f():(ve[o]=f(),ve[o].shown=!1)),"overview"===o&&(e[o]?i(e[o])?ve[o]=ee.defaults(e[o],c()):ve[o]=c():(ve[o]=c(),ve[o].icon=!1,ve[o].shown=!1)),"watermark"===o&&i(e[o])&&(e[o].fc&&(ve[o].fc=e[o].fc&&$.validatergb(e[o].fc)?e[o].fc:void 0),e[o].fbc&&(ve[o].fbc=e[o].fbc&&$.validatergb(e[o].fbc)?e[o].fbc:void 0)),"bands"===o)if(e[o])if(ee.isNormalObject(e[o])){if(ve[o]=ee.defaults(e[o],d()),ve[o].bands){ve[o].bands=ee.ensureArray(ve[o].bands);for(var u=ve[o].bands.length,s=0;u>s;s++)ve[o].bands[s]=ee.defaults(ve[o].bands[s],g())}}else ve[o]=d();else ve[o]=d();"truncateLabels"===o&&(e[o]?ee.isNormalObject(e[o])?ve[o]=ee.defaults(e[o],h()):ve[o]=h():ve[o]=!1),"selectedNode"!==o&&"selectedLink"!==o||!i(ve[o])||ae.ensureObject(ve[o]),"showShadowCanvas"===o&&ue!==ve.showShadowCanvas&&(ue=ve.showShadowCanvas,oe.debugCanvas(ue?ie:null)),"imageAlignment"===o&&(e[o]?ee.isNormalObject(e[o])&&(ve[o]=v(e[o])):ve[o]={}),me[o]&&(r=!0)}ae.setOptions(ve),re.setMaxItemZoom(ve.maxItemZoom),re.setMinZoom(ve.minZoom),r&&ae.setAllDirty(),xe()&&a.internalUse.enableDragging(ve.handMode),he(t,n)}return ee.clone(ve)};var xe=te.inMapMode=function(){return a&&a.api.isShown()};te.watermarkSize=function(){return r.getWatermarkSize(ie,ne)},te.load=function(e,t){ne=null,ae.load(e),te.combo.internalUse.loadUp(e.combos),e.viewSettings&&te.setViewSettings(e.viewSettings,!1),a?a.internalUse.loadUp(e.map,t):ee.invoke(t)},te.merge=function(e){n.trigger("prechange","merge");var t=te.combo.internalUse.preMerge(e);return xe()&&(t=a.internalUse.preMerge(t)),ae.merge(t)},te.appendCombos=function(e){e.combos=te.combo.internalUse.serialize()},te.postMerge=function(e){te.combo.internalUse.postMerge(e)},te.setItem=function(e){var t=te.combo.internalUse.preMerge([e])[0];return t&&xe()&&a.internalUse.preSetItem(t),!!t&&ae.setItem(t)};var ye=te.removeItem=function(e){te.combo.internalUse.preDelete(e),ae.removeItem(e)};te.setProperties=function(e,t,r){return r||n.trigger("prechange","properties"),xe()&&a.internalUse.convertPos(e),ae.setProperties(e,t)},te.setViewSettings=function(e,t,n,r){Le(re.fromSettingsDirect(e,t,n,r))};var pe=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67],be=ee.makeIdMap(["b","b1","b2","bw","c","e","fbc","fc","fi","fs","h","ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9","off","r","w","x","y"]);te.animateProperties=function(e,t,r,i){function o(e){for(var t in e)"undefined"==typeof e[t]&&(e[t]=ae.defaultValueFor(t))}function u(e){for(var t=0;t<e.length;t++){var n=ae.getByID(e[t].id);if(n){o(e[t]),A.push(e[t]);var r=s(e[t],n);C.push(r)}}}function s(e,t){var n={};for(var r in e)"id"!==r&&(n[r]=ee.clone(t[r]||ae.defaultValueFor(r)));return n}function l(e){return 3===e.length&&/^ha/.test(e)||"fi"===e}i||n.trigger("prechange","properties");var f=ee.clone(e);xe()&&a.internalUse.convertPos(f);for(var c,d=[],g=[],h=0;h<f.length;h++){c=f[h];var v=null,m=null;for(var x in c)be[x]?(m=m||{id:c.id},m[x]=c[x]):"id"!==x&&(v=v||{id:c.id},v[x]=c[x]);v&&g.push(v),m&&d.push(m)}var y=t.time,w=n.linearEasing;"cubic"===t.easing&&(w=n.cubicEasing);var B=y,C=[],A=[];ae.setProperties(g,!1);var M=q.buildAnimatorInstance(function(e,n){n?(ae.ensureTypesInArray(d,!0),u(d),p(C,A)):B-=e;for(var i=w(Math.max(0,Math.min(1,(y-B)/y))),a=B>0,o=[],s=0;s<A.length;s++){var f={id:A[s].id};for(var c in A[s])l(c)?f[c]=I(C[s][c],A[s][c],i):"id"!==c&&(f[c]=b(C[s][c],A[s][c],i));o.push(f)}return ae.unsafeApplyChanges(o),a?t.cb&&ee.tryCatch(function(){t.cb.call(this,i,y-B)}):ee.invoke(r),a},{positions:!0,colours:!0,textures:!0});Le(M,t.queue)},te.ping=function(e,t,n){function r(e,t,n,r){var i={id:t};i[n]=r,e.push(i)}e=ee.ensureArray(e);for(var i=[],a=[],o=[],u=0;u<e.length;u++){var s=e[u],l=ae.getByID(s);if(l&&"node"===l.type){for(var f=0;10>f&&l["ha"+f];)f++;if(10>f||!l.ha0){var c="ha"+f;r(i,s,c,{r:Math.max(28-t.w/2,0),w:0,c:t.c});var d=$.hsla(t.c),g=$.fromhsla([d[0],d[1],d[2],.001]);r(a,s,c,{r:t.r,w:t.w,c:g}),r(o,s,c,null)}}}i.length>0?w(i,a,o,t.time,t.repeat,function(){te.afterChange(n,!0,{positions:!0})}):te.afterChange(n,!0)};var Ie=null,we=function(){};te.setCursorFn=function(e){we=e};var Be=function(){};te.setCreateCanvasFn=function(e){Be=e};var Ce="";te.setPath=function(e){Ce=e};var Ae;te.assetPath=function(e){return e&&(Ae=e),Ae};var Me=function(){};te.imageGenFn=function(e){return e&&(Me=e),Me};var Ze=te.render=function(e){e=e||{all:!0},n.trigger("redraw",e)},De=q.animator(Ze),Ge=q.animator(Ze);te.animate=function(e){var t=gt?gt:Ie,n=De.animate(e,t,ae),r=Ge.animate(e);return n||r},te.cancelAnimation=De.cancel;var Le=te.pushAnimation=De.push;te.cancelLayoutAnimation=Ge.cancel;var Re=te.pushLayoutAnimation=Ge.push,Se=te.backgroundOpacity=function(e){return arguments.length>0&&(se=e,Ze()),se};te.animateBackgroundOpacity=q.makeValueAnimator(De,Se);var Te=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],Ee=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],ke=null;te.makeGhostCanvas=function(e,t){return ke=Be(e,t,!0)};var Fe=.5;te.hide=function(e,t,n){t.animate?Z(e,t.time,n):(ae.hide(e),ae.showHideBendLinks(e),Ze({all:!0}),ee.invoke(n))},te.show=function(e,t,n,r){ae.show(e,t),n.animate?D(e,n.time,r):(ae.showHideBendLinks(e),Ze({all:!0}),ee.invoke(r))};var Ve,We=$.widgets(),Ue=!1,Oe=3,Ne=te.drawBackground=function(e){$.backFill(e,"white",se,re.scale(re.width()),re.scale(re.height())),ve.backColour?$.backFill(e,ve.backColour,se,re.scale(re.width()),re.scale(re.height())):ve.gradient&&$.backgroundGradient(e,ve.gradient.stops,se,re.width(),re.height())},Ke=!0;te.labelPosition=function(e,t){return S(!1),ae.labelPosition(e,t)},te.draw=function(e,t){ne&&(S(e),ae.animated()&&(t.all=!0),ie.webgl?V(t,ve):W(e))},te.drawoffscreen=function(){ne&&oe.dirty()};var He=te.hittest=function(e,t,n,r){return oe.test(e,t,n,r,ie)};te.afterDraw=function(){Ie&&Ie.mouseMoved&&Ie.mouseMoved()&&Ie.afterDraw(He(Pe,_e,re),Pe,_e)};var Xe,Ye;te.dragover=function(e,t){O(e,t)()},te.resetState=function(){Ie=null},te.startDragger=function(e,t,n,r){if(ae&&(n=re.worldToViewX(n),r=re.worldToViewY(r),Ie=ae.startDragger(te,re,e,n,r,t),Ie&&e)){var i=Ie.getCursor(n,r);we(i)}};var ze;te.mousedown=function(e,t,i,a,o){if(ae){var u,s=He(t,i,re);if(Ie)X(!0,t,i,a,o);else{ze=s,s!==Ye&&(Ye=null);var l=n.trigger("mousedown",ee.rawId(s),re.unscale(t),re.unscale(i),e,ee.subId(s));if(ae.getByID(s)||!s){var f=!1;f=0===e?ve.handMode?s?!ae.isSelected(s)||a:!1:!ae.isSelected(s)||a||!s:!s||!ae.isSelected(s),l&&(f=!1),f&&ae.setSelection(s,a,o),0===e&&(Ie=ae.createDragger(te,ie,re,s,t,i,ve,Ve),Ie&&s&&(u=Ie.getCursor(t,i),we(u))),Ze(),2===e?n.trigger("contextmenu",ee.rawId(s),re.unscale(t),re.unscale(i),ee.subId(s)):n.trigger("click",ee.rawId(s),re.unscale(t),re.unscale(i),e,ee.subId(s))}else 0===e&&(Ie=r.createDragger(s,t,i),Ie&&s&&(u=Ie.getCursor(t,i),we(u))),0!==e&&1!==e||(n.trigger("click",ee.rawId(s),re.unscale(t),re.unscale(i),e,ee.subId(s)),Ze())}return s}};var Pe,_e,je;te.mousemove=function(e,t,n,i,a){Pe=e,_e=t;var o="auto";if(Ie&&!a)Ie.mouseMoved&&Ie.mouseMoved(!0),K(e,t,n,i),Ie.dragMove(e,t,n,i),o=Ie.getCursor(e,t),Ze(Ie.rebuild);else if(ae){var u=ae?He(e,t,re):null;N(e,t),ae.getByID(u)?u&&(o=ae.getCursor(u,Ae)):o=r.getCursor(u)}je===o||a||(we(o),je=o)},te.mouseup=te.removeDragger=H,te.mouseleave=function(e,t,n,r){arguments.length&&Ie&&(!ve.dragPan||xe()&&ve.handMode)&&X(xe(),e,t,n,r)},te.dblclick=function(e,t){var r=ze;Ie&&X(!1),!r&&re&&(n.trigger("dblclick",null,re.unscale(e),re.unscale(t))||Qe(!0)),r&&ae.getByID(r)&&n.trigger("dblclick",ee.rawId(r),re.unscale(e),re.unscale(t),ee.subId(r))};var Je;te.mousewheel=function(e,t,r){if(re){var i=Date.now();if(Je&&100>i-Je)return;Je=i,n.trigger("mousewheel",e,re.unscale(t),re.unscale(r))||Le(re.wheelToPosition(e,t,r))}},te.keyup=function(e){27===e&&X(!1)},te.keydown=function(e,t,r){if(ae&&!n.trigger("keydown",e,t,r)){if(65===e&&t)return ae.selectAll(),Ze(),!0;if(ae.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a)return n.trigger("prechange","move"),ae.moveSelection(i,a),Ze({positions:!0}),!0;if(46===e){var u=n.trigger("delete");if(!u){n.trigger("prechange","delete");var s=ae.selectionPlusDummyNodes();ye(s)}return Ze(),!0}113===e&&n.trigger("edit",ae.doSelection())}return!1}},te.panBy=function(e,t,n,r,i){Le(re.panBy(e,t,n,!1,r,i)),Ze({drawOnly:!0})},te.pan=function(e,t,n,r){xe()?a.internalUse.pan(e,t,n,r):(Le(re.pan(e,t,n,r)),Ze({drawOnly:!0}))};var Qe=te.zoomIn=function(e,t,n){xe()?a.internalUse.zoom("in",e,t,n):(Le(re.zoomIn(e,t,n)),Ze({drawOnly:!0}))};te.zoomOut=function(e,t,n){xe()?a.internalUse.zoom("out",e,t,n):(Le(re.zoomOut(e,t,n)),Ze({drawOnly:!0}))},te.setZoom=function(e,t,n,r){xe()?a.internalUse.setZoom(e,t,n,r):(Le(re.setZoom(e,t,n,r)),Ze({drawOnly:!0}))},te.modelExtents=function(){return ae.generate(We,ie,re,ne,fe),We.itemExtents(null,ie)},te.fitToModel=Y("fitToModel"),te.fitToSelection=Y("fitToSelection"),te.fitModelHeight=Y("fitModelHeight");var qe=function(e,t){var n=e;return q.buildAnimatorInstance(function(e){n-=e;var r=0>n;return r&&ee.invoke(t),!r})};te.layout=function(e,t,r){if(ae){t=t||{};var i=z(e,t);ae.layout(e,n,i,t,_(r))}},te.arrange=function(e,t,r,i){if(ae){var a=z(e,r);ae.arrange(e,n,t,a,r,_(i))}};var $e,et,tt,nt,rt,it,at,ot;te.touchstart=function(e){if(ot=e,2===e.length&&(ct=(e[0].x+e[1].x)/2,dt=(e[0].y+e[1].y)/2,lt=ct,ft=dt),1===e.length){nt=e[0].x,rt=e[0].y,at=e[0].id;var t=He(nt,rt,re);if($e?t!==it?j():et=!0:(et=!1,$e=ee.nextTick(j,600)),it=t,tt=ee.nextTick(function(){J(),Ie&&X(!1),n.trigger("contextmenu",ee.rawId(it),re.unscale(nt),re.unscale(rt),ee.subId(it))},600),ae.getByID(it)||!it){var i=n.trigger("touchdown",ee.rawId(it),re.unscale(nt),re.unscale(rt),ee.subId(it));i||(it?ae.isSelected(it)||ae.setSelection(it,!1,!1):ve.handMode||ae.setSelection(null,!1,!1)),Ie=ae.createDragger(te,ie,re,it,nt,rt,ve,Ve),Ze()}else Ie=r.createDragger(it,nt,rt)}};var ut,st,lt,ft;te.touchmove=function(e){ot=e,e.length>=2&&(lt=(e[0].x+e[1].x)/2,ft=(e[0].y+e[1].y)/2);for(var t=0;t<e.length;t++)at===e[t].id&&(ut=e[t].x,st=e[t].y);if(tt){var n=(ut-nt)*(ut-nt)+(st-rt)*(st-rt);n>100&&J()}gt||Ie&&at===e[0].id&&1===e.length&&(Pe=e[0].x,_e=e[0].y,Ie.mouseMoved&&Ie.mouseMoved(!0),K(e[0].x,e[0].y),Ie.dragMove(e[0].x,e[0].y,!1,!1),Ze(Ie.rebuild))},te.touchend=function(e,t){if(ot=e,Ze(),tt&&(J(),xe()||n.trigger("click",ee.rawId(it),re.unscale(nt),re.unscale(rt),0,ee.subId(it))),$e&&et){j();var r=n.trigger("dblclick",ee.rawId(it),re.unscale(nt),re.unscale(rt),ee.subId(it));r||it||Qe(!0)}if(!gt&&Ie){for(var i=-1,a=0;a<t.length;a++)t[a].id===at&&(i=a);i>-1&&0===e.length?X(!0,t[i].x,t[i].y,!1,!1):e.length>0&&(nt=e[0].x,rt=e[0].y,at=e[0].id,it=He(nt,rt,re),!ae.getByID(it)&&it||(ae.setSelection(it,!1,!1),Ie=ae.createDragger(te,ie,re,it,nt,rt,ve,Ve)))}},te.touchcancel=function(){J(),Ie&&X(!1)};var ct,dt;var bn=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17510;var gt;return te.gesturestart=function(){},te.gesturechange=function(e,t){J(),ve.gestures&&ee.isNumber(ct)&&ee.isNumber(dt)&&(gt||(gt=ae.createGestureDragger(re,ct,dt)),gt.dragMove(e,t,lt,ft),Ze({all:!0}))},te.gestureend=function(e,t){gt&&gt.endDrag(!0,e,t,lt,ft),gt=null},te}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.createLens=function(t){function n(e,t){function n(e,t,n,r,i){return{isLeaf:!0,children:[],points:[],x1:e,y1:t,x2:n,y2:r,depth:i}}function r(e){return e.depth>=t}function i(e,t){var r,i,a,o,u=.5*(e.x1+e.x2),s=.5*(e.y1+e.y2);0===t||1===t?(a=e.y1,o=s):(a=s,o=e.y2),0===t||2===t?(r=e.x1,i=u):(r=u,i=e.x2),e.isLeaf=!1,e.children[t]=n(r,a,i,o,e.depth+1)}function a(e,t){t(e);for(var n=0;4>n;n++)e.children[n]&&a(e.children[n],t)}function o(e,t){var n=t.x<e.x1||t.y<e.y1||t.x>e.x2||t.y>e.y2;if(n)throw Error("[Layout] Error: the point is out of range.");if(r(e))e.points.push(t);else{e.points.push(t);var a,u=.5*(e.x1+e.x2),s=.5*(e.y1+e.y2);t.x<u&&t.y<s&&(a=0),t.x>=u&&t.y<s&&(a=1),t.x<u&&t.y>=s&&(a=2),t.x>=u&&t.y>=s&&(a=3),e.children[a]||i(e,a),o(e.children[a],t)}}var u,s=[],l=[];for(u=0;u<e.length;u++)s.push(e[u].x),l.push(e[u].y);var f=Math.min.apply(0,s),c=Math.max.apply(0,s),d=Math.min.apply(0,l),g=Math.max.apply(0,l),h=c-f,v=g-d;h>v?g=d+h:c=f+v;var m=n(f,d,c,g,0);for(m.addPoint=function(e){o(m,e)},m.visit=function(e){a(m,e)},u=0;u<e.length;u++)m.addPoint(e[u]);return m}function r(e,t){return Math.sqrt(e*e+t*t)}function i(){function e(e){function t(t){if(t.isLeaf){var a,o=e.x-.5*(t.x1+t.x2),u=e.y-.5*(t.y1+t.y2),s=r(o,u),l=(t.x2-t.x1)/s,f=t.points,c=f.length;if(l>Z){for(a=0;c>a;a++)if(e.id!==f[a].id){var d=e.x-f[a].x,g=e.y-f[a].y,h=Math.max(.001,r(d,g));n+=d/h,i+=g/h}}else n+=c*o/s,i+=c*u/s}}var n=0,i=0;a.visit(t),D.push(n),G.push(i)}var t=[];for(var i in C)t.push({id:i,x:S[x[i]],y:T[x[i]]});var a=n(t,M);D.length=0,G.length=0;for(var o=0;o<t.length;o++)e(t[o]);c(D,G)}function a(e,t,n){for(var r=t,i=l(e,s(f(t,n),-1)),a=i.slice(),o=u(i,i),c=0;20>c&&o/p>.01;c++){var d=f(a,n),g=o/u(d,a);r=l(r,s(a,g));var h=l(i,s(d,-g));i=h;var v=u(h,h),m=v/o;o=v,a=l(h,s(a,m))}return r}function o(){var e;for(e=0;p>e;e++){L[e]=[],R[e]={},R[e][e]=!0;for(var t=0;p>t;t++)L[e][t]=0}for(e=0;e<y.length;e++){var n=y[e],r=x[n.id1],i=x[n.id2];R[r][i]=!0,R[i][r]=!0,L[r][i]-=1,L[i][r]-=1,L[r][r]+=1,L[i][i]+=1}}function u(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function s(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]*t);return n}function l(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]+t[r]);return n}function f(e,t){var n,r,i=[],a=0;for(n=0;p>n;n++){a=0;for(r in R[n])a+=L[n][r]*e[r];i.push(a)}for(i=s(i,t),a=0,n=0;p>n;n++)a+=e[n];var o=[];for(n=0;p>n;n++)o.push(p*e[n]-a);return l(i,o)}function c(e,t){var n,r=0,i=0;for(n=0;n<e.length;n++)r+=e[n],i+=t[n];for(r/=e.length,i/=e.length,n=0;n<e.length;n++)e[n]-=r,t[n]-=i}function d(e,t,n){for(var r=0;t>r;r++)B+=1/(b+I+1),e.trigger("progress","layout",B),i(S,T),S=a(D,S,n),T=a(G,T,n),c(S,T)}function g(e,n){var r,i;A=Object.keys(C),x={},S.length=0,T.length=0,L.length=0,R.length=0;var a,o=0,u=t(e.tightness);for(u=2-u/10,i=0;i<A.length;i++)r=A[i],a=Math.max(1,C[r].size),o+=a*a,x[r]=i;var s=o/p,l=Math.sqrt(s),f=s/(l*l)-1;for(w=Math.sqrt(p)*(l/60)*100*u,w*=1+f,i=0;i<A.length;i++)S.push(w*n.next()),T.push(w*n.next());m=p/50,v=500*m,b=8,I=8}function h(e){function t(e,t){return Math.atan2(e,t)||0}function n(e,t,n){var r=e,i=r*Math.cos(t),a=r*Math.sin(t);C[n].x=w*i,C[n].y=w*a}function i(e){var i=S[x[e]],a=T[x[e]],o=r(i,a),u=t(i,a);n(o,u,e)}e.forEach(i)}var v,m,x,y,p,b,I,w,B,C,A,M=3,Z=.5,D=[],G=[],L=[],R=[],S=[],T=[];e.lens=function(e,t,n,r,i,a){B=0,e.trigger("progress","layout",B),C=t.v,y=t.e,p=t.vcount;var u=[];return p>1&&(g(n,i),o(),d(e,b,v),d(e,I,m),h(A)),r(e,C,t.extents,u,n,a)}}}(),function(e){function t(e,t,n,r){r||(r=!1),e.addEventListener(t,n,r)}function n(e,n){for(var r=0;r<e.length;r++)t(document,e[r],n)}function r(e,t){for(var n=[],r=0;r<e[t].length;r++){var i=C(e[t][r]);n.push({id:e[t][r].identifier,x:i.x,y:i.y})}return n}function i(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function a(){function e(e,n){t(document,e,function(t){t.target.id in b&&(b[t.target.id][e](r(t,"targetTouches"),r(t,"changedTouches")),n&&t.preventDefault())})}function a(e){t(document,e,function(t){t.target.id in b&&(b[t.target.id][e](t.scale,t.rotation),t.preventDefault())})}function o(e,t){var n=e.pointerId||0,r=C(e),i=[];switch(t){case"ADD":I[n]||(I[n]={id:n,x:r.x,y:r.y});break;case"DEL":I[n]&&(delete I[n],w--);break;case"MOVE":I[n]&&(I[n]={id:n,x:r.x,y:r.y})}for(var a in I)i.push(I[a]);return i}function u(e,t){var n=e.pointerId||0,r=C(e),i=[];switch(t){case"ADD":case"MOVE":i=[{id:n,x:r.x,y:r.y}];break;case"DEL":i=[I[n]]}return i}function s(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function l(e){B[e]=new MSGesture,B[e].target=document.getElementById(e)}function f(){v=1,m=0}function c(e,t){return function(n){if(n.target.id in b&&s(n)){var r=u(n,t);b[n.target.id][e](o(n,t),r),n.preventDefault()}}}function d(e){function t(t){if(s(t)){var n="DEL";for(var r in b){var i=u(t,n);b[r][e](o(t,n),i);var a=t.target.id;a&&b[a]&&t.preventDefault()}}}return t}function g(e,t,n,r){if(e!==t){if(null!==t&&b[t]&&document.getElementById(t)){var i=A(r,t);b[t][n](i.x,i.y,r.ctrlKey,r.shiftKey)}"mouseleave"===n&&(Z=e)}}function h(e){var t=e.wheelDelta||-e.detail;if(0!==t){var n=b[e.target.id];if(n){var r=C(e);n.mousewheel(t,r.x,r.y),i(e)}}}t(document,"contextmenu",function(e){return e.target.id in b?(i(e),!1):void 0}),t(document,"dragover",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].dragover(t.x,t.y)}}),"ontouchstart"in document.documentElement&&(e("touchstart",!0),e("touchmove"),e("touchend"),e("touchcancel"),a("gesturestart"),a("gesturechange"),a("gestureend"));var v=1,m=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var x=["MSPointerDown","pointerdown"],y=["MSPointerMove","pointermove"],p=["MSPointerUp","pointerup"],M=["MSPointerCancel","pointercancel"];n(x,function(e){if(e.target.id in b&&s(e)){B[e.target.id]||l(e.target.id),w++,B[e.target.id].addPointer(e.pointerId);var t=u(e,"ADD");b[e.target.id].touchstart(o(e,"ADD"),t),e.preventDefault()}}),n(y,c("touchmove","MOVE")),n(p,d("touchend")),n(M,d("touchcancel")),t(document,"MSHoldVisual",function(e){e.preventDefault()}),t(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id,n=w>1;t in b&&n&&(b[t].gesturestart(),e.preventDefault())}),t(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=w>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;t in b&&n&&(v*=e.scale,m+=180*e.rotation/Math.PI,b[t].gesturechange(v,m),e.preventDefault())}),t(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;t in b&&(b[t].gestureend(v,m),f(),e.preventDefault())})}t(window,"mousedown",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}}),t(window,"mouseup",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}D&&(g(e.target.id,D.target.id,"mouseup",D),D=null)}),t(window,"mouseout",function(e){e.target.id in b&&(D=e)});var Z=null,D=null;t(window,"mousemove",function(e){if(e.target.id in b){g(e.target.id,Z,"mouseleave",e);var t=C(e);b[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}else g(null,Z,"mouseleave",e)}),t(window,"dblclick",function(e){if(e.target.id in b){var t=C(e);b[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),n(["wheel","mousewheel","DOMMouseScroll"],h),t(document,"MozMousePixelScroll",function(e){b[e.target.id]&&i(e)}),t(document,"keyup",function(e){e.target.id in b&&b[e.target.id].keyup(e.keyCode)}),t(document,"keydown",function(e){var t=!1;e.target.id in b&&(t=t||b[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),t&&e.preventDefault&&e.preventDefault()})}function o(e){e in b&&delete b[e]}function u(e,t){KeyLines.Util.invoke(t,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function s(e){return+e.replace(/px$/,"")}function l(e,t,n,r){function i(e,t){e?KeyLines.Util.invoke(r,e):t.options(n,function(){r&&r(null,t)})}var a=document.getElementById(t);if(!a)return u(t,r);var o=a.clientWidth||s(a.style.width),l=a.clientHeight||s(a.style.height);d(e,t,o,l,n?i:r)}function f(){D=document.createElement("span"),D.style.position="absolute",D.style.left="-10000px",D.style.top="-10000px",D.style.visibility="hidden",D.style.lineHeight="normal",D.style.fontSize="200px",D.style.fontVariant="normal",D.style.fontStyle="normal",D.style.letterSpacing="0",D.style.width="auto",D.style.height="auto",D.style.display="block",D.style.margin=0,D.style.padding=0,D.style.whiteSpace="nowrap"}function c(e,t){D.style.fontFamily=t,D.innerText=e}function d(e,t,n,r,i){if(o(t),n||(n=100),r||(r=100),"webgl"===Z&&"chart"===e&&KeyLines.webGLSupport())T(e,t,n,r,!0,i);else if(S())T(e,t,n,r,!1,i);else{var a="Could not create HTML5 canvas.";i(a)}}function g(e,t){var n=b[t];n.id=function(){return t},"timebar"===e&&KeyLines.TimeBar.API.appendExtras(n)}function h(){return v(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function v(e){for(var t=KeyLines.Util.defined,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}function m(e){var t=KeyLines.Util.defined;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:t(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function x(e,t){for(var n,r=0;!n&&r<t.length;r++)e[t[r]]&&(n=!0,e[t[r]]())}function y(e){x(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function p(){E&&E(h())}if(e){var b=KeyLines.components={};KeyLines.charts=b;var I={},w=0,B={};a();var C=KeyLines.coords=function(e){return A(e,e.target.id)},A=function(e,t){var n=M(t),r=Math.floor(e.pageX-n.left),i=Math.floor(e.pageY-n.top);return{x:r,y:i}},M=KeyLines.getOffset=function(e){var t=document.getElementById(e),n={top:0,left:0};return t&&(n=t.getBoundingClientRect()),{top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft}},Z="auto";KeyLines.mode=function(e){return e&&(Z=e),Z},KeyLines.createChart=function(){var e,t,n,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0],r=arguments[1];var i=document.getElementById(e);if(!i)return u(e,r);t=i.clientWidth,n=i.clientHeight;break;default:e=arguments[0],t=Number(arguments[1]),n=Number(arguments[2]),r=arguments[3]}d("chart",e,t,n,r)},KeyLines.create=function(e,t){function n(e){return i.isNullOrUndefined(e)||"chart"===e||"timebar"===e}function r(){var e=a[u],n=e.id||e;l(e.type||"chart",n,e.options,function(e,n){if(e)return i.invoke(t,e);if(s[u]=n,u++,!(u>=a.length))return r();var o=1===u?n:s;return t?t(null,o):void 0})}var i=KeyLines.Util,a=i.ensureArray(e),o=a.every(function(e){return n(e.type)});if(a.length<1)return i.invoke(t,Error("No definition passed to KeyLines.create"));if(!o)return i.invoke(t,Error("The type of component passed to KeyLines.create is not valid"));var u=0,s=[];r()};var D;KeyLines.measureFontHeight=function(e,t,n){D||f(),document.body.appendChild(D),c(e,n);var r=D.offsetHeight;return c("",void 0),r/200*t||t},KeyLines.getFontIcon=function(e){D||f(),document.body.appendChild(D);var t=e.replace(/\./g,"");D.className!==t&&(D.className=t);var n=window.getComputedStyle(D,":before").getPropertyValue("content");return D.parentNode&&D.parentNode.removeChild(D),D.className="",n.charCodeAt(1)||n.charCodeAt(0)};var G,L,R=KeyLines.setCanvasPaths=function(e){G=e};KeyLines.imageBasePath=function(e){return e&&(L=e),L},R("assets/");var S=KeyLines.html5CanvasSupport=function(){
var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},T=function(e,t,n,r,i,a){try{b[t]=KeyLines.Canvas.create(e,t,n,r,G,L,i)}catch(o){if(a)return a(o)}b[t].webgl=i,b[t].canvas=!0,g(e,t),a&&a(null,b[t])};KeyLines.setSize=function(e,t,n){if(!(0>=t||0>=n)){var r=document.getElementById(e);r&&(r.style.height=n+"px",r.style.width=t+"px",b[e]&&(b[e].internalSetSize(t,n,1),b[e].webgl&&b[e].renderer.clearFramebuffers()))}},KeyLines.paths=function(e){return e&&(e.assets&&R(e.assets),e.images&&KeyLines.imageBasePath(e.images)),{assets:G,images:L}},n(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],p),KeyLines.fullScreenCapable=function(){var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var E;KeyLines.toggleFullScreen=function(e,t){E=t,h()&&m(e)?x(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):y(e)},KeyLines.dashedLineSupport=function(){if(S()){var e=document.createElement("canvas"),t=e.getContext("2d");return!!t.setLineDash||!!t.mozDash||!!t.webkitLineDash}return!1},KeyLines._rtlTest=function(e){return"rtl"===window.getComputedStyle(e).direction},KeyLines.es6CollectionSupport=function(){return Object.isPrototypeOf&&Array.from&&window.Set&&window.Map}}}("undefined"!=typeof window),function(){function e(e,t){var n,r=Object.getPrototypeOf(e).constructor;if(t){n=new r;var i=a(Array.from(e));i.forEach(function(e){n.add?n.add(e):n.set(e[0],e[1])})}else n=new r(e);return n}function t(e){return null==r&&KeyLines.es6CollectionSupport&&(r=KeyLines.es6CollectionSupport()),r?Map.prototype.isPrototypeOf(e)||Set.prototype.isPrototypeOf(e):!1}function n(e){return e.lastIndexOf(f())}var r,i=KeyLines.Util={};i.shallowClone=function(n){if(null===n)return null;switch(typeof n){case"object":if(Array.isArray(n))return n.slice();if(t(n))return e(n);if(n instanceof Date)return new Date(n.getTime());var r={};for(var i in n)r[i]=n[i];return r;case"boolean":case"string":case"number":return n}};var a=i.clone=function(n,r){function o(e,t){r&&"_"===t.charAt(0)||(u[t]=a(e,r))}if(null===n)return null;var u;switch(typeof n){case"object":if(Array.isArray(n)){for(var s=[],l=0;l<n.length;l++)s.push(a(n[l],r));return s}return t(n)?e(n,!0):n instanceof Date?new Date(n.getTime()):(u={},i.iterator(n,o),u);case"boolean":case"string":case"number":return n}};i.nextTick=function(e,t){return o(e)?setTimeout(e,t):void 0},i.setRegularTick=function(e,t){return o(e)?setInterval(e,t):void 0},i.log=function(){if("undefined"!=typeof console){var e=[].slice.call(arguments).join(" ");console.log(e)}},i.isNaN=Number.isNaN||function(e){return e!==e},i.isNumber=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};var o=i.isFunction=function(e){return"function"==typeof e};i.values=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},i.isFileType=function(e,t){var n=t||"";return n.slice(Math.max(n.length-5,0))==="."+e},i.isBase64=function(e){return"data:image/"===(e||"").slice(0,11)},i.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||Array.isArray(e)||l(e))},i.invoke=function(e,t){e&&o(e)&&e(t)},i.tryCatch=function(e,t){try{t(null,e())}catch(n){t(n)}},i.getItemsArray=function(e){return e&&!Array.isArray(e)&&e.items?e.items:e};var u=i.ensureArray=function(e){return Array.isArray(e)?e:[e]},s=!0;i.timerFn=function(e,t,n){return function(){if(s){var r=Date.now(),i=e.apply(n||this,arguments),a=Date.now();return console.log("fn "+t+" = "+(a-r)+"ms"),i}return e.apply(n||this,arguments)}},i.defaults=function(e,t){var n=a(e)||{};for(var r in t)n.hasOwnProperty(r)&&!l(n[r])||(n[r]=t[r]);return n},i.defined=function(e){return"undefined"!=typeof e};var l=i.isNullOrUndefined=function(e){return null==e},f=i.idSep=function(){return"\u2704"},c=i.rawId=function(e){if(l(e))return null;var t=e+"",r=n(t);return-1!==r&&(t=t.substring(0,r)),t};i.subId=function(e){if(l(e))return null;var t=e+"",r=n(t);return-1!==r?t.substring(r+1):null},i.contains=function(e,t){return e.indexOf(t)>-1},i.dictValues=function(e){var t=[];for(var n in e)t.push(e[n]);return t},i.hasAnyKeys=function(e){for(var t in e)return!0;return!1},i.makeIdMap=function(e){return e=u(e),e.reduce(function(e,t){return e[c(t)]=1,e},{})},i.merge=function(e,t){if(e){for(var n in t)e[n]=t[n];return e}return t},i.len=function(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))},i.noop=function(){},i.numberSort=function(e,t){var n,r,i,a=[];if(t)for(a=e,e=[],n=0;n<a.length;n++)e.push(a[n][t]);for(var o,u,s,l,f=0,c=e.length-1,d=-1,g=[],h=7;;)if(h>=c-f){for(r=f+1;c>=r;r++){for(o=e[r],s=a[r],n=r-1;n>=f&&e[n]>o;)e[n+1]=e[n],a[n+1]=a[n],n--;e[n+1]=o,a[n+1]=s}if(-1===d)break;c=g[d--],f=g[d--]}else{for(i=f+c>>1,n=f+1,r=c,o=e[i],s=a[i],e[i]=e[n],a[i]=a[n],e[n]=o,a[n]=s,e[f]>e[c]&&(o=e[f],s=a[f],e[f]=e[c],a[f]=a[c],e[c]=o,a[c]=s),e[n]>e[c]&&(o=e[n],s=a[n],e[n]=e[c],a[n]=a[c],e[c]=o,a[c]=s),e[f]>e[n]&&(o=e[f],s=a[f],e[f]=e[n],a[f]=a[n],e[n]=o,a[n]=s),u=e[n],l=a[n];;){do n++;while(e[n]<u);do r--;while(e[r]>u);if(n>r)break;o=e[n],s=a[n],e[n]=e[r],a[n]=a[r],e[r]=o,a[r]=s}e[f+1]=e[r],a[f+1]=a[r],e[r]=u,a[r]=l,c-n+1>=r-f?(g[++d]=n,g[++d]=c,c=r-1):(g[++d]=f,g[++d]=r-1,f=n)}},i.asyncWhile=function(e,t,n){function r(){return a||(a=t(),a||(a=!e())),a?n():i.nextTick(r,0)}var a=!e();r()},i.iterator=function(e,t){if(!l(e)&&o(t)){var n;if(Array.isArray(e))e.forEach(t);else for(n in e)t(e[n],n)}},i.ratelimit=function(e,t){var n,r,a,o;return function(){function u(){r=Date.now(),e.apply(a,o)}var s=Date.now();if(a=this,o=arguments,!n)if(!r||s-r>=t)u();else{var l=s-r,f=t-l;n=i.nextTick(function(){n=null,u()},f)}}},i.Randomiser=function(e){var t=e,n=48271,r=2147483647,i=r/n,a=r%n,o=1/r;return{setSeed:function(e){t=e},next:function(){if(t){var e=t/i,u=t%i,s=n*u-a*e;return t=s>0?s:s+r,t*o}return Math.random()}}},i.isTextArabic=function(e){for(var t=0,n=e.length;n>t;t++){var r=e.charCodeAt(t);if(r>=1536&&(1791>=r||r>=64336&&65023>=r||r>=65136&&65279>=r||r>=1872&&1919>=r||r>=2208&&2303>=r))return!0}return!1},i.getArabicTextHeight=function(e){return Math.floor(e*(11/14))}}(),function(){"use strict";if(KeyLines.WebGL){var e=6,t=new Float32Array(6);KeyLines.WebGL.generateCircle=function(n,r,i,a,o,u,s,l,f,c){var d;if(f.rebuildOptions.all||f.rebuildOptions.shadow||f.alwaysUpdate)for(o=o||[0,0,0,0],d=0;e>d;d++)f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[0],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[1],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[2],f.triangleBuffers.shadowData[f.triangleBuffers.shadowIndex++]=o[3];if(f.rebuildOptions.all||f.rebuildOptions.colours||f.alwaysUpdate)for(d=0;e>d;d++)f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=a[0],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=a[1],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=a[2],f.triangleBuffers.colourData[f.triangleBuffers.colourIndex++]=a[3];(f.rebuildOptions.all||f.rebuildOptions.positions||f.alwaysUpdate)&&(t[0]=2*i,t[1]=0,t[2]=n-i,t[3]=r-i,t[4]=t[2]+t[0],t[5]=t[3]+t[0],c&&(t[2]=t[2]+c.x,t[3]=t[3]+c.y,t[4]=t[4]+c.x,t[5]=t[5]+c.y),f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[2],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[3],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u,f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[4],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=t[5],f.triangleBuffers.positionData[f.triangleBuffers.positionIndex++]=u),(f.rebuildOptions.all||f.rebuildOptions.textures||f.alwaysUpdate)&&(f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=s,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=l,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=-1,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=0,f.triangleBuffers.textureData[f.triangleBuffers.textureIndex++]=i)}}}(),function(){var e=KeyLines.TimeBar.Generator={};e.create=function(){var e={},t=KeyLines.Rendering,n=KeyLines.Util;var kw=window["D"+(9884).toString(30)][(25871).toString(33)]()/31757;var r=n.idSep(),i=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89];return e.generate=function(e,n,a,o,u,s,l){function f(){var e;if(-1!==s.x&&(e=n.findRange(s.x,s.y)),e&&"histogram"!==e.bar){var t=Math.max(n.ttox(e.t1),b.x1),r=Math.min(n.ttox(e.t2),b.x2),i="minor"===e.bar?2:1;r>t&&o.rect(t,b.bars[e.bar].y1-i,r,b.bars[e.bar].y2+1,null,-1,u.options.scale.highlightColour,!0,null)}}function c(e){var r="minor"===e,i=r&&!u.options.scale.showMinor||!r&&!u.options.scale.showMajor,s=b.bars[e].y2,l=u.options.fontFamily,f=u.options.fontSize,c=n.fontSizeFactor(),d=u.bars[e].tickHeight*c;i&&(d=0);var g=r?b.bars[e].y1:b.bars[e].y2-d;if(n.eachTick(e,function(n,r,i,h,v){if(i>=b.x1&&i<=b.x2){var m=Math.floor(1*c)+1;o.line(i,g,i,g+d,"#ddd",m,null)}var x=u.displayTime(n,v),y=t.measureText(a,x,f,!1,l).width,p=Math.floor((h+i)/2-y/2);o.text(p,s-u.bars[e].textbase,x,u.options.fontColour,f,!1,null,l)}),!i){var h=t.colours.transparent;o.rect(0,b.bars[e].y1,b.width,b.bars[e].y2,h,1,h,!0,r?"_tbMinor":"_tbMajor")}}function d(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function g(){if(l){var t=l.match(e.selectionRegExp());if(t)return+t[1]}return null}function h(e,n,r){var i=36;o.setLayer(t.layers.OVERLAYS);var u=t.measureText(a,e,i).width,s=(b.width-u)/2,l=(b.height+i)/2;o.text(s+2,l+2,e,r,i,!0),o.text(s,l,e,n,i,!0)}function v(t,n){if(t.hasSel[n])for(var i=e.animateSelHeight(t.maxselvalue)||1,a=t.selvalues[n],s="_tbLine"+n,f=u.selection["colour"+n],c=(t.x[1]-t.x[0])/2,d=0;d<t.count;d++){var g=a[d],h=a[d+1],v=t.x[d]+c,m=t.x[d+1]+c,x=b.histogram.maxselh,y=b.histogram.ybase,p=Math.floor(x*g/i),I=y-p,w=Math.floor(x*h/i),B=y-w;o.line(v,I,m,B,f,2,s);var C=s+r+d,A=l===C?f:u.options.backColour;o.circle(v,I,u.selection.dotsize,f,2,A,!0,C)}}function m(){var r=n.getHistogram(),i=b.histogram.ybase,a=b.histogram.maxbarh;if(a>0){for(var l=e.animateBarHeight(r.maxvalue)||1,f=u.histogram.bardx,c=0;c<r.count;c++){var d=r.x[c]+f,h=r.x[c+1]-f,m=r.value[c];if(m>0){var x=Math.min(a,Math.floor(a*m/l)),y=i-x,p=s.x>=d&&s.x<=h&&s.y>=y&&s.y<=i,I=p?u.options.histogram.highlightColour:u.options.histogram.colour;o.rect(d,y,h,i,t.colours.white,-1,I,!0,"_tbBar")}}for(var w=g(),B=0;B<u.selection.maxNumber;B++)B!==w&&v(r,B);null!==w&&v(r,w)}}function x(){var e=n.getInnerRange(),r=Math.floor(n.ttox(e.t1)),i=Math.floor(n.ttox(e.t2));o.line(r,0,r,b.y2,u.options.sliderLineColour,2,"_tbSlider"),o.line(i,0,i,b.y2,u.options.sliderLineColour,2,"_tbSlider"),o.rect(b.x1,0,r,b.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider"),o.rect(i,0,b.width,b.y2,u.options.sliderLineColour,-1,u.options.sliderColour,!0,"_tbSlider");for(var a=(b.y2-u.grip.length)/2,s=a+u.grip.length,l=r-u.grip.margin,f=i+u.grip.margin,c=4+2*u.grip.lines,d=0;d<u.grip.lines;d++)l-=u.grip.space,f+=u.grip.space,o.line(l,a,l,s,u.options.sliderLineColour,2),o.line(f,a,f,s,u.options.sliderLineColour,2);o.rect(r-3*c,a-u.grip.length,r,s+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbLeft"),o.rect(i+3*c,a-u.grip.length,i,s+u.grip.length,t.colours.transparent,-1,t.colours.transparent,!0,"_tbRight")}function y(){var t=u.controlbar.height,n=b.height-t,r="rgba(255,255,255,0.7)";o.rect(0,n,b.width,b.height,u.controlbar.colour,-1,u.controlbar.colour,!0,"_tbcontrolbar"),o.line(0,n-.5,b.width,n-.5,"#ccc",1,"_tbcontrolbar");var i,a,s,f,c=["fit","zoomout","zoomin",40,"prev",u.options.showPlay?e.isPlayingFixed()?"pause":"play":"",u.options.showExtend?e.isPlayingExtend()?"pause":"playextend":"","next"],d=0,g=e.imageList(),h=e.imageNames(),v=function(e){for(i=0;i<c.length;i++)a=c[i],a&&e(a,"number"==typeof a)},m=function(e,t){t?d+=e:(f=h[e],d+=g[f].im.width,i>0&&(d+=u.controlbar.space))},x=function(e,i){if(i)y+=e;else{f=h[e],s=g[f].im;var a=n+(t-s.height)/2,c="_tb"+e;if(l===c){var d=y+s.width/2,v=a+s.height/2;o.circle(d,v,s.width/2-2,r,0,r,!0,c)}o.image(y,a,y+s.width,a+s.height,f,c,null,!1,!0),y+=s.width+u.controlbar.space}};v(m);var y=(b.width-d)/2;v(x)}function p(){var tm;if(46732777<kw){return;}tm=0,o.rect(b.x1,0,b.x2,b.y1,t.colours.midgrey,-1,u.options.backColour,!0,"_tbHisto"),o.rect(b.x1,b.y1,b.x2,b.y2,t.colours.midgrey,-1,u.options.backColour,!0,"_tbMain"),(u.options.scale.showMajor||u.options.scale.showMinor)&&f(),u.options.scale.showMajor&&c("major"),u.options.scale.showMinor&&c("minor"),n.hasItems()&&m(),"none"!==u.options.sliders&&x(),u.options.showControlBar&&y(),h(d(w,i),d(w,B),d(w,I))}var b=n.getBounds();o.setLayer(t.layers.TIMEBAR);var I=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],w="d MMM yyyy/MMM d, yyyy",B=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];b.x2>b.x1&&p()},e}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=512,n=4,r=264,i=4,a=!1;e.ImageAtlas=function(e){for(var t=[],n=4,r=4,a=4,u=0,f=l(e),c=o(f),d=1/c,g=s(c,0),h=0,v=f.length;v>h;h++){var m=f[h],x=m.im,y=x.width/m.imageRatio,p=x.height/m.imageRatio;if(n+y+i>c&&(n=0,r+=u+i,u=0),r+p>c&&(a++,r=i,t.push({alphaChannel:!0,img:g.canvas,texture:null}),g=s(c,a)),x.u1=n*d,x.v1=r*d,x.u2=(n+y)*d,x.v2=(r+p)*d,x.maxDimension=m.nonSquare,x.textureBank=a,m.nonSquare){var b=x.v2-x.v1,I=x.u2-x.u1;if("width"===m.nonSquare){var w=b/I,B=(I-I*w)/2;x.cu1=x.u1+B,x.cv1=x.v1,x.cu2=x.u2-B,x.cv2=x.v2}else{var w=I/b,C=(b-b*w)/2;x.cu1=x.u1,x.cv1=x.v1+C,x.cu2=x.u2,x.cv2=x.v2-C}}else x.cu1=x.u1,x.cv1=x.v1,x.cu2=x.u2,x.cv2=x.v2;g.drawImage(x,n,r,y,p),p>u&&(u=p),n+=y+i}for(t.push({alphaChannel:!0,img:g.canvas,texture:null}),a++;8>a;){var A=s(1,a++);t.push({alphaChannel:!0,img:A.canvas,texture:null})}return t};var o=function(e){for(var t=1,r=i,a=i,o=0,u=1024,s=0,l=e.length;l>s;s++){var f=e[s],c=f.im,d=c.width/f.imageRatio,g=c.height/f.imageRatio;r+d+i>u&&(r=0,a+=o+i,o=0),a+g>u&&(t++,a=i),g>o&&(o=g),r+=d+i}return n>t?1024:4*n>t?2048:4096},u=function(e,n){var i=1,a=!1;return e>r&&(n>0?e>t&&(i=e/t):i=e/r,a=!0),{imageRatio:i,largeImage:a}},s=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(n.id="webglDebugImageCanvas"+t,n.width=e,n.height=e,a){var i=document.getElementById(n.id);i?i.parentNode.replaceChild(n,i):document.getElementsByTagName("body")[0].appendChild(n)}return r},l=function(e){var t=[],n=2;for(var r in e)if(e.hasOwnProperty(r)&&e[r]&&e[r].im){var i=e._coList[r]?e[r].co:e[r].im,a=i.width>i.height?"width":"height",o=u(i[a],n);o.largeImage&&n>0&&n--,t.push({im:i,size:i[a]/o.imageRatio,imageRatio:o.imageRatio,nonSquare:i.width!==i.height?a:!1})}return t.sort(function(e,t){return e.size-t.size})}}}(),function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,t,n){function r(e,t,n){var r=!!t;return m[e]=r,n&&l.useHiResImages()&&(m[l.hiResUrl(e)]=r),e}function i(){return n&&n.api.isShown()}function a(){return n&&n.internalUse.isMapLoaded()}function o(){x=l.colours.ci,y=l.colours.cia}function u(e){v[e]&&v[e].apply(null,arguments)}function s(e,t,n,r,i,a,o){e.rect(t.scale(n),t.scale(r),t.scale(i),t.scale(a),l.colours.transparent,-1,l.colours.transparent,!0,o)}var l=KeyLines.Rendering,f=KeyLines.Util,c={},d={},g={},h=[],v={},m={};c.appendImageList=function(e){for(var t in m)e[t]=1};var x,y;o(),c.colorize=function(e,t,n){var r,i={},a="rgb(0,174, 234)";if(n){var u=l.colorize(e,m,t,a,n);r=u.colour,i=u.images,x=l.rgbtostring(r[0],r[1],r[2]),y=l.rgbatostring(r[0],r[1],r[2],.5)}else o();for(var s in e)if("updated"!==s&&"_coList"!==s){var f=i[s]?i[s]:e[s].im;e[s].co=f,e.updated=!0}},c.setup=function(){p(),e.bind("click",u)},c.createDragger=function(e,t,n){return e in d?d[e](t,n):null};var p=c.reset=function(){d={},g={},h=[],v={},m={},e.unbind("click",u)};c.getCursor=function(e){return e in g?g[e]:"auto"},c.generate=function(e,t,n,r,i,a,o){for(var u=0;u<h.length;u++)h[u].generate(e,t,n,r,i,a,o)},c.getWatermarkSize=function(e,t){for(var n=0;n<h.length;n++){var r=h[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null},c.addLogo=function(e,t){var n=15,i="_logo",a=e+t.u,o={generate:function(e,r,o,u){e.setLayer(l.layers.OVERLAYS);var s=u[a].im,f=t.p||"ne",c=("w"===f.charAt(1)?n:o.width()-(s.width+n))+(t.x||0),d=("n"===f.charAt(0)?n:o.height()-(s.height+n))+(t.y||0);e.image(o.scale(c),o.scale(d),o.scale(c+s.width),o.scale(d+s.height),a,i)}};h.push(o),r(a)},c.addTextWatermark=function(e,t,n,i,a,o,u,s){var f="_textWatermark",c={watermarkSize:function(r,i){var a,o;if(e&&i){var u=i[e].im;a=u.width,o=u.height}else t&&(a=l.measureText(r,t,n,s).width,o=n);return a?{width:a+10,height:o+10}:null},generate:function(r,c,d,g){var h,v;if(r.setLayer(l.layers.UNDERLAYS),e){var m=g[e].im;return h=d.scale((d.width()-m.width)/2),v=d.scale((d.height()-m.height)/2),void r.image(h,v,h+d.scale(m.width),v+d.scale(m.height),e,f)}if(t){var x=d.scale(n),y=l.measureText(c,t,n,a,s).width;h=d.scale((d.width()-y)/2),v=d.scale((d.height()+n)/2);var p=-3.5,b=Math.floor(x/8);"top"===u&&(v=x+b),"bottom"===u&&(v=d.scale(d.height())+1),o&&r.rect(h-p,v-x-b,h+y+p+b,v,o,-1,o,!0,f),r.text(h,v,t,i,x,a,f,s,!1,y,!1,!1,h+p,v-x,h+y+p,v)}}};h.push(c),e&&r(e)},c.addNavigation=function(t,o,u,f){function c(){return t.options().handMode}function m(e,n){var r=e-b[B].im.height/2,i=y(r);t.setZoom(i,n)}function x(e){var t;return t=a()?n.internalUse.zoom():(Math.log(e)-Math.log(o.getMinZoom()))/(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom())),Math.floor(E+(1-t)*(k-E))}function y(e){var t,r=1-(e-E)/(k-E);return t=i()?n.internalUse.getMaxZoom()*r:Math.exp(r*(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom()))+Math.log(o.getMinZoom()))}function p(){return o.height()<300}var b,I=r(u+"Background.png",!0,!0),w=r(u+"BackgroundShort.png",!0,!0),B=r(u+"Slider.png",!1,!0),C=r(u+"Hand.png",!1,!0),A=r(u+"Arrow.png",!1,!0),M=7,Z=17,D=62,G=p()?145:247,L=f.p||"nw",R=("w"===L.charAt(1)?M:o.width()-(M+D))+(f.x||0),S=("n"===L.charAt(0)?Z:o.height()-(Z+G))+(f.y||0),T=R+21,E=S+118,k=S+215;v._zoomIn=function(){t.zoomIn(!0)},v._zoomOut=function(){t.zoomOut(!0)},v._panLeft=function(){t.pan("left",!0)},v._panRight=function(){t.pan("right",!0)},v._panUp=function(){t.pan("up",!0)},v._panDown=function(){t.pan("down",!0)},v._fitToWindow=function(){t.fitToModel(!0)},v._toggleMode=function(){var e=t.options();e.handMode=!e.handMode,t.options(e)},v._scale=function(e,t,n){m(n,!0)},g._zoomIn=g._zoomOut=g._panLeft=g._panRight=g._panUp=g._panDown=g._fitToWindow=g._toggleMode=g._scale="pointer",g._slider='url("'+u+'openhand.cur"), pointer',d._slider=function(){var r=o.zoom();if(p())return null;if(!e.trigger("dragstart","slider"))return i()&&n.internalUse.enableDragging(!1),{getCursor:function(){return"move"},dragMove:function(e,t){t=o.unscale(t),m(t,!1)},endDrag:function(a){var o=e.trigger("dragend","slider");a=a&&!o,a||t.setZoom(r,!1),i()&&n.internalUse.enableDragging(t.options().handMode),e.trigger("dragcomplete","slider")}}};var F={generate:function(e,t,n,r,i,a){var o=p()?w:I,u=r[o].im;if(t.webgl&&!r._coList[o]&&(r._coList[o]=!0,r._coList[l.hiResUrl(o)]=!0,r.updated=!0),!a){b=r,e.setLayer(l.layers.OVERLAYS),e.image(n.scale(R),n.scale(S),n.scale(R+u.width),n.scale(S+u.height),o,"_background","co",!1,!0);var f=R+19,d=S+64,g=n.scale(f),h=n.scale(d),v=n.scale(f+28),m=n.scale(d+32),y=c()?C:A;e.image(g,h,v,m,y,null,null,!1,!0),e.setLayer(l.layers.OVERLAYSSHADOW),e.image(g,h,v,m,y,"_toggleMode");var M=5,Z=23,D=39,G=57,L=105,E=p()?124:222,k=18,F=3,V=68,W=22;if(s(e,n,R+Z,S+L,R+D,S+L+k,"_zoomIn"),s(e,n,R+Z,S+E,R+D,S+E+k,"_zoomOut"),s(e,n,R+M,S+Z,R+Z,S+D,"_panLeft"),s(e,n,R+D,S+Z,R+G,S+D,"_panRight"),s(e,n,R+Z,S+M,R+D,S+Z,"_panUp"),s(e,n,R+Z,S+D,R+D,S+G,"_panDown"),s(e,n,R+Z,S+Z,R+D,S+D,"_fitToWindow"),p()||s(e,n,R+Z,S+L+k,R+D,S+E,"_scale"),s(e,n,R+Z-F,S+V,R+D+F,S+V+W,"_toggleMode"),!p()){var U=x(n.zoom()),O=n.scale(T),N=n.scale(U),K=n.scale(T+r[B].im.width),H=n.scale(U+r[B].im.height);e.image(O,N,K,H,B,"_slider"),e.setLayer(l.layers.OVERLAYS),e.image(O,N,K,H,B,null,null,!1,!0)}}},createDragger:function(){}};g[I]="wait",h.push(F)};var b,I,w,B,C,A={ne:"sw",nw:"se",se:"nw",sw:"ne"};return c.addOverview=function(n,i,a,o,u,s){function c(e){var t={x1:a.viewToWorldX(a.scale(-e)),x2:a.viewToWorldX(a.scale(a.width()+e)),y1:a.viewToWorldY(a.scale(-e)),y2:a.viewToWorldY(a.scale(a.height()+e))};return{x1:k.worldToViewX(t.x1),x2:k.worldToViewX(t.x2),y1:k.worldToViewY(t.y1),y2:k.worldToViewY(t.y2)}}function m(){N+=F.x,K+=F.y,e.trigger("redraw")}function p(){X=f.setRegularTick(m,50)}function M(){X&&(clearInterval(X),X=null)}function Z(e){var t=Math.max(e.width(),e.height())/2;k.reset(!1);var n=c(t);k.fitExtents(n,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();r!==1/0&&k.setMaxItemZoom(r/8),W&&k.panBy(N,K,!1,!0)}var D=s.p&&A[s.p]?s.p:"se",G=r(u+"Arrow-"+A[D]+".png",!0,!0),L=r(u+"Arrow-"+D+".png",!0,!0);s.size=s.size||100,b=s.size,w=s.shown,C="n"===D.charAt(0),B="w"===D.charAt(1),I=o(b,b);var R=I.getContext("2d"),S=!1,T=!1,E=Date.now(),k=t.createView(e,b,b);v._overviewIcon=function(){w=s.shown=!s.shown,e.trigger("overview",w?"open":"close")},g._overviewIcon="pointer";var F,V=null,W=!1,U=0,O=0,N=0,K=0,H=2;g._overviewBox='url("'+u+'openhand.cur"), pointer';var X;d._overviewBox=function(t,r){if(!e.trigger("dragstart","overview")){W=!0;var i=2;U=0,O=0,N=0,K=0;var o=-V.x1+i,u=b-V.x2-i,s=-V.y1+i,l=b-V.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,n){M(),U=e-t,O=n-r,F={x:0,y:0};var i=!1;o>U&&(U=o,F.x=H,i=!0),U>u&&(U=u,F.x=-H,i=!0),s>O&&(O=s,F.y=H,i=!0),O>l&&(O=l,F.y=-H,i=!0),i&&p()},endDrag:function(t){W=!1,M();var r=e.trigger("dragend","overview");if(t&&!r){var i=-(U-N)*a.zoom()/k.zoom(),o=-(O-K)*a.zoom()/k.zoom();n.panBy(i,o,!0)}e.trigger("dragcomplete","overview")}}}};var Y={generate:function(t,r,a,o,u,f){if(!f){if(w){var d,g,h,v,m=B?a.scale(-1):a.scale(a.width()-b-2),p=C?a.scale(-1):a.scale(a.height()-b-2),I=B?a.scale(b+2):a.scale(a.width()+1),A=C?a.scale(b+2):a.scale(a.height()+1),M=Math.max(1,a.scale(3)),D=B?a.scale(-1):a.scale(a.width()-b)-.5,F=C?a.scale(-1):a.scale(a.height()-b)-.5,N=B?a.scale(b)+.5:a.scale(a.width()+1),K=C?a.scale(b)+.5:a.scale(a.height()+1),H=Math.max(1,a.scale(1));if(t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(m,p,I,A,l.colours.white,M,l.colours.white,!0,"_overviewBorder1"),t.rect(D,F,N,K,l.colours.lightgrey,H,l.colours.white,!1,"_overviewBorder2"),t.setLayer(l.layers.OVERVIEW),t.rect(m,p,I,A,l.colours.white,M,l.colours.white,!1),t.rect(D,F,N,K,l.colours.lightgrey,H,l.colours.white,!1),i){var X=Date.now();S&&!W&&E+1e3>X&&T?e.trigger("redraw"):(E=Date.now(),S=!0,R.clearRect(0,0,b,b),R.fillStyle=l.colours.white,R.fillRect(0,0,b,b),n.drawBackground(R),Z(a),t.draw(R,k,o,l.channels.MAIN,l.itemLayers),T=Date.now()-E>30),V||(V=c(0));var Y=W?U:0,z=W?O:0,P=W?"_overviewBoxDragging":"_overviewBox";d=a.scale(B?V.x1+Y:a.width()-b+V.x1+Y),g=a.scale(C?V.y1+z:a.height()-b+V.y1+z),h=a.scale(B?V.x2+Y:a.width()-b+V.x2+Y),v=a.scale(C?V.y2+z:a.height()-b+V.y2+z);var _=Math.max(1,a.scale(2));t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(d,g,h,v,x,_,y,!W,P),t.setLayer(l.layers.OVERVIEW),t.rect(d,g,h,v,x,_,y,!W,P)}}var j=w?L:G,J=o[j].im;s.icon&&(t.rect(B?a.scale(-1):a.scale(a.width()-J.width)-.5,C?a.scale(-1):a.scale(a.height()-J.height)-.5,B?a.scale(J.width)+.5:a.scale(a.width()+1),C?a.scale(J.height)+.5:a.scale(a.height()+1),l.colours.lightgrey,Math.max(1,a.scale(1)),l.colours.white,!0,"_overviewIconRect"),t.image(a.scale(B?0:a.width()-J.width),a.scale(C?0:a.height()-J.height),a.scale(B?J.width:a.width()),a.scale(C?J.height:a.height()),j,"_overviewIcon","co",!1,!0),r.webgl&&!o._coList._overviewIcon&&(o._coList._overviewIcon=!0,o.updated=!0),t.setLayer(l.layers.OVERVIEWSHADOW),t.rect(a.scale(B?-1:a.width()-2*J.width),a.scale(C?-1:a.height()-2*J.height),a.scale(B?2*J.width:a.width()+1),a.scale(C?2*J.height:a.height()+1),l.colours.lightgrey,-1,l.colours.white,!0,"_overviewIcon"))}}};h.push(Y)},c.remove=function(e,t,n){var r=42,i={generate:function(i,a,o){i.setLayer(l.layers.OVERLAYS);var u=l.measureText(a,e,r).width,s=o.scale((o.width()-u)/2),f=o.scale((o.height()+r)/2);i.text(s+2,f+2,e,n,o.scale(r),!0,null,null,!1,u,!1,!1,s+2,f+2-o.scale(r),s+2+u,f+2),i.text(s,f,e,t,o.scale(r),!0,null,null,!1,u,!1,!1,s,f-o.scale(r),s+u,f)}};h.push(i)},c.drawOverviewContent=function(e,t){if(w&&I){var n=t.scale(b);e.drawImage(I,0,0,n,n,t.scale(B?0:t.width()-b),t.scale(C?0:t.height()-b),n,n)}},c.addBanding=function(e){var t=6,n=3,r=3,i=6,a={generate:function(a,o,u){var s=f.merge({top:!0},e.bands);if(s&&s.bands){var c,d,g,h,v,m,x;a.setLayer(l.layers.BANDS);var y=1/0;for(c=0;c<s.bands.length;c++)v=s.bands[c],v.t&&(d=u.dim(v.w/2),g=v.ff||e.fontFamily,h=v.fs||20,m=.75*h,x=l.measureText(o,v.t,h,v.fb,g).width/2,x+m>d&&(h=Math.floor(h*d/(x+m))),y>h&&(y=h));for(y!==1/0&&(m=.75*y),c=0;c<s.bands.length;c++){v=s.bands[c];var p=u.x(v.x),b=u.x(v.x-v.w/2),I=u.x(v.x+v.w/2),w=u.scale(-1),B=u.scale(u.height()+1);d=u.dim(v.w/2);var C=v.c||"#f7f7f7";if(a.rect(b,w,I,B,"white",-1,C,!0,""),v.t&&y>3){a.setLayer(l.layers.BANDLABELS),g=v.ff||e.fontFamily,x=l.measureText(o,v.t,y,v.fb,g).width/2;var A=v.fc||l.colours.lightgrey,M=u.scale(y),Z=(I-b)/2-x;if(s.top){var D=t+M;a.rect(b,w,I,D+n,"white",-1,C,!0,""),a.text(p-x,D,v.t,A,M,v.fb,"",g,!1,2*x,!1,!1,b+Z,w+2*n,I+Z,D+2*n)}if(s.bottom){var G=u.height()-r,L=G-(M+i);a.rect(b,L,I,B,"white",-1,C,!0,""),a.text(p-x,G,v.t,A,M,v.fb,"",g,!1,2*x,!1,!1,b+Z,L+2*n,I+Z,L+2*n+h)}a.setLayer(l.layers.BANDS)}}}}};h.push(a)},c}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateFontIcon=function(t,n,r,i){var a=0,o=t.wsc||[0,0,0,0];if(r.alwaysUpdate||r.rebuildOptions.all)for(a=0;e>a;a++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=o[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(a=0;e>a;a++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[0],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[1],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[2],r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=t.wc[3];if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var u=t.x1,s=t.y1,l=t.x2,f=t.y2;i&&(u+=i.x,s+=i.y,l+=i.x,f+=i.y),r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,
r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=u,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0}(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all)&&(r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.u2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.v2,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=3,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.colourComponentTexture,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0)}}}(),function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var t,n=KeyLines.Util,r={};return r.setOptions=function(e){t=e.fanLength},r.primitiveMover=function(t,r,i,a,o,u,s,l,f,c){function d(e,t){return{dx:i.undim(e-l),dy:i.undim(t-f)}}function g(e,t,r,i){var a,o={};if(s.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var u=0;u<s.length;u++){a=s[u];var l="x"===a.charAt(0)?e:t;o[a]=l}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else i&&(e=Math.abs(e)>Math.abs(t)?e:0,t=0!==e?0:t),o.x1=o.x2=e,o.y1=o.y2=t;for(var f={},c=["x1","y1","x2","y2"],d=0;d<c.length;d++)a=c[d],f[a]=v[a]+o[a];if(i){var g=v.x2-v.x1,h=v.y2-v.y1;if(Math.abs(g)>0&&Math.abs(h)>0){var m,x=h/g,y=f.x2-f.x1,p=f.y2-f.y1,b=Math.abs(e)>Math.abs(t);if(b){var I=Math.floor(x*(g+y)-h)-p;r||!n.contains(s,"y1")&&!n.contains(s,"y2")?(m=Math.floor(I/2),f.y1-=m,f.y2+=m):(n.contains(s,"y1")&&(f.y1-=I),n.contains(s,"y2")&&(f.y2+=I))}else{var w=Math.floor((h+p)/x-g)-y;r||!n.contains(s,"x1")&&!n.contains(s,"x2")?(m=Math.floor(w/2),f.x1-=m,f.x2+=m):(n.contains(s,"x1")&&(f.x1-=w),n.contains(s,"x2")&&(f.x2+=w))}}}return f}function h(e,t,n,r){var i=d(e,t);return g(i.dx,i.dy,n,r)}if(!e.trigger("dragstart","resize",a,i.unscale(l),i.unscale(f),null)){var v=t.extents(r,o),m={};for(var x in o)m[x]=o[x];t.setAlpha(m,.5);var y={scrollable:!0,getCursor:function(){return u?"crosshair":"move"},generate:function(e){e.copyPrimitive(m)},dragMove:function(e,n,i,a){var o=h(e,n,i,a);t.setExtents(m,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(n,u,s,l,f){i.cancelScroll();var d=e.trigger("dragend","resize",a,i.unscale(u),i.unscale(s));if(!d&&n){var g=h(u,s,l,f);t.setExtents(o,g.x1,g.y1,g.x2,g.y2,r),c(o)}e.trigger("dragcomplete","resize",a,i.unscale(u),i.unscale(s))}};return y}},r.createHandDragger=function(t,r,i,a){function o(e,t){g=g||Math.abs(r-e)>10||Math.abs(i-t)>10,c=e-r,d=t-i,s&&(s.x||(c=0),s.y||(d=0))}function u(){g&&(t.offsetX(l+c),t.offsetY(f+d),e.trigger("viewchange"))}var s={x:!0,y:!0},l=t.offsetX(),f=t.offsetY(),c=0,d=0,g=!1,h="hand",v=e.trigger("dragstart",h,null,t.unscale(r),t.unscale(i));if(v){if(!n.isNormalObject(v))return void a();for(var m in v)s[m]=v[m]}return{rebuild:{drawOnly:!0},animate:u,direction:s,dragMove:o,getCursor:function(){return"move"},endDrag:function(n,r,i){var s=e.trigger("dragend",h,null,t.unscale(r),t.unscale(i));g?(!s&&n?o(r,i):c=d=0,u()):a(),e.trigger("dragcomplete",h,null,t.unscale(r),t.unscale(i))}}},r.createDefaultDragger=function(t,r,i,a,o,u,s,l){function f(e){return h.add&&h.add[e]}function c(){for(var e in r)(a(e)||f(e))&&I[e]&&t.moveNode(e,I[e].x+Z.dx,I[e].y+Z.dy);for(var n in B)(a(n)||f(n))&&t.moveLink(n,B[n].y+Z.dy)}function d(){for(var e in r)I[e]&&t.moveNode(e,I[e].x,I[e].y);for(var n in B)t.moveLink(n,B[n].y)}function g(e,t){return D=D||Math.abs(s-e)>10||Math.abs(l-t)>10,e=o?o.viewToWorldX(e):e,t=o?o.viewToWorldY(t):t,h&&(h.x||(e=p),h.y||(t=b)),{dx:D?e-p:0,dy:D?t-b:0}}var h={x:!0,y:!0,add:null},v=n.rawId(u),m="move",x=e.trigger("dragstart",m,v,o.unscale(s),o.unscale(l),n.subId(u));if(x)if(Array.isArray(x))h.add=n.makeIdMap(x);else{if(!n.isNormalObject(x))return;for(var y in x)h[y]=x[y];Array.isArray(h.add)&&(h.add=n.makeIdMap(h.add))}var p=o?o.viewToWorldX(s):s,b=o?o.viewToWorldY(l):l,I={};for(var w in r)I[w]={x:r[w].x,y:r[w].y};var B={};for(var C in i)"h"===i[C].st&&(B[C]={y:i[C].y||0});var A,M,Z=g(s,l),D=!1,G={rebuild:{all:!0},scrollable:!0,direction:h,animate:c,generate:function(e){e.excludeHit(v)},getCursor:function(){return"move"},dragMove:function(e,t){Z=g(e,t)},mouseMoved:function(e){return e&&(A=!0),A},afterDraw:function(t,r,i){A=!1;var a=n.rawId(t);v!==a&&(void 0===M?M=a:a!==M&&(e.trigger("dragover",a,o.unscale(r),o.unscale(i),n.subId(t)),M=a))},endDrag:function(r,i,a){o.cancelScroll();var s=e.trigger("dragend",m,n.rawId(u),o.unscale(i),o.unscale(a));s?d():r&&D?(d(),Z=g(i,a),e.trigger("prechange","move"),c()):d(),t.setDirty(v),e.trigger("dragcomplete",m,n.rawId(u),o.unscale(i),o.unscale(a))}};return G},r.createLinkEndDragger=function(t,r,i,a,o,u,s,l,f){function c(e,t){r.moveNode(o[u],e,t)}function d(e,t){return e=i?i.viewToWorldX(e):e,t=i?i.viewToWorldY(t):t,{dx:e-m,dy:t-x}}function g(){return o["id1"===u?"id2":"id1"]}if(e.trigger("dragstart","dummy",f,i.unscale(s),i.unscale(l),null))return!1;var h,v,m=i?i.viewToWorldX(s):s,x=i?i.viewToWorldY(l):l,y=a[o[u]].x,p=a[o[u]].y,b=d(s,l),I=s,w=l,B=null,C={rebuild:{all:!0},scrollable:!0,animate:function(){c(y+b.dx,p+b.dy)},getCursor:function(){return"move"},dragMove:function(e,n){b=d(e,n),I=e,w=n,B=t.hittest(e,n,i)},mouseMoved:function(e){return e&&(v=!0),v},afterDraw:function(t,r,a){v=!1;var o=n.rawId(t),u=n.subId(t);f===o&&(o=null,u=null),void 0===h?h=o:o!==h&&(e.trigger("dragover",o,i.unscale(r),i.unscale(a),u),h=o)},endDrag:function(t,s,l){i.cancelScroll();var f=e.trigger("dragend","dummy",B,i.unscale(s),i.unscale(l));if(!f)if(t)if(c(y,p),e.trigger("prechange","move"),B=n.rawId(B),a[B]&&B!==g()){delete a[o[u]],o[u]=B;var h={};h[o.id]=o,r.clearGraphCache(),r.resetConnectionOffsets(h)}else b=d(s,l),c(y+b.dx,p+b.dy),B=null;else c(y,p);e.trigger("dragcomplete","dummy",B,i.unscale(s),i.unscale(l))}};return C},r.createLinkDragger=function(t,r,i,a,o,u,s,l){function f(e,t,n,r,i,a){return((n-e)*(t-a)-(e-i)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function c(e,n){var r=i.viewToWorldX(e),a=i.viewToWorldY(n),u=t("x1",o),s=t("y1",o),l=t("x2",o),c=t("y2",o),d=f(u,s,l,c,r,a);v&&Math.abs(d-g)>8&&(v=!1),v||(Math.abs(d)<12&&(d=0),h=d)}function d(){a.setLinkOffset(o.id,h)}if(e.trigger("dragstart","offset",l,i.unscale(u),i.unscale(s),n.subId(l)))return!1;var g=o.off?o.off:0,h=g,v=!0,m=!1,x={rebuild:{all:!0},scrollable:!0,animate:function(){d()},getCursor:function(){return"move"},dragMove:function(e,t){c(e,t),m=!0},endDrag:function(t,n,r){i.cancelScroll();var a=e.trigger("dragend","offset",l,i.unscale(n),i.unscale(r));a||(t&&m?(o.off=g,e.trigger("prechange","offset"),c(n,r),d()):o.off=g),e.trigger("dragcomplete","offset",l,i.unscale(n),i.unscale(r))}};return x},r}}(),function(){var e=KeyLines.View={},t=e.createView=function(e,n,r,i,a){function o(){return a&&a.api.isShown()}function u(){return V(d*D)}function s(){return V(d/D)}function l(e,t,n,r,i,a,o,u,s,l,f){t.generate(n,r,p,i,s);var c=n.itemExtents(e,r);if(c){var d=U(c);return f&&(d.x1=d.x2=p.width()/2),O(d,a,!0,!0,!0,o,!1,u,l)}return x.invoke(u),null}var f,c,d,g,h,v,m,x=KeyLines.Util,y=KeyLines.Common,p={},b=n,I=r,w=i?i:1;p.scaleFactor=function(e){return e&&(w=e),w};var B=p.scale=function(e){return Math.floor(w*e)};p.unscale=function(e){return Math.floor(e/w)},p.settings=function(){return{width:b,height:I,zoom:d,offsetX:g,offsetY:h}},p.fromSettingsDirect=function(e,t,n,r){return P(d,V(e.zoom),e.offsetX-g,e.offsetY-h,t,n,r)},p.fromOldSettings=function(n,r,i,a){if(r){var o=t(e,n.width,n.height);o.setZoom(n.zoom,!1),o.offsetX=n.offsetX,o.offsetY=n.offsetY;var u={x1:o.viewToWorldX(0),y1:o.viewToWorldY(0),x2:o.viewToWorldX(o.width()),y2:o.viewToWorldY(o.height())};return O(u,i,!1,!1,!1,a)}W(n.zoom,!1),g=n.offsetX,h=n.offsetY},p.width=function(e){return e&&(b=e),b},p.height=function(e){return e&&(I=e),I};var C=p.x=p.worldToViewX=function(e){return Math.floor(((e-f)*d+g)*w)},A=p.y=p.worldToViewY=function(e){return Math.floor(((e-c)*d+h)*w)},M=p.viewToWorldX=function(e){return Math.floor((e/w-g)/d+f)},Z=p.viewToWorldY=function(e){return Math.floor((e/w-h)/d+c)};p.w=function(e){return-1===e?-1:Math.max(1,Math.floor(e*d*w))},p.sw=function(e){return-1===e?-1:p.w(e)+7},p.dim=function(e){return Math.floor(e*d*w)},p.sdim=function(e){return e&&e*d*w},p.undim=function(e){return Math.floor(e/(d*w))},p.sundim=function(e){return e/(d*w)};var D=1.4,G=4,L=.05,R=L,S=.01,T=1,E=200,k=1/0,F=100;p.getMaxZoom=function(){return G},p.getMinZoom=function(){return R},p.setMinZoom=function(e){R=Math.min(T,Math.max(S,e||L))},p.setMaxItemZoom=function(e){k=e?e:1/0},p.getMaxItemZoom=function(){return k},p.zoomIn=function(e,t,n){var r=u();return N(r,w*b/2,w*I/2,e,t,n)},p.zoomOut=function(e,t,n){var r=s();return N(r,w*b/2,w*I/2,e,t,n)};var V=function(e){return Math.min(G,Math.max(e,R))},W=p.setZoom=function(e,t,n,r){var i=V(e);return N(i,w*b/2,w*I/2,t,n,r)};p.getUnzoom=function(){return d>k?k/d:1},p.wheelToPosition=function(e,t,n){var r=e>0?u():s();return N(r,t,n,!0,200)};var U=p.worldExtentsToView=function(e){return e?{x1:C(e.x1),y1:A(e.y1),x2:C(e.x2),y2:A(e.y2)}:null};p.fitWorldExtents=function(e,t,n,r,i,a,o){if(!e)return x.invoke(o),null;var u=U(e);return O(u,t,n,r,i,a,!1,o)};var O=p.fitExtents=function(e,t,n,r,i,a,o,u,s){var l,v=(e.y2-e.y1)/(e.x2-e.x1),m=I/b;if(v>m){var x=i?I/8:0;l=d*(I-x)/(e.y2-e.y1)}else{var y=i?b/8:0;l=d*(b-y)/(e.x2-e.x1)}l*=w,n&&(l=V(l)),r&&l>1&&(l=1),s&&(l=d);var p=(e.x1+e.x2)/2,B=(e.y1+e.y2)/2,C=M(p),A=Z(B),D=b/2-(C-f)*l,G=I/2-(A-c)*l;return P(d,l,D-g,G-h,t,a,u,o)};p.fitToSelection=function(e,t,n,r,i,a,o,u,s){return l(e.privateSelection(),e,t,n,r,i,a,o,u,s)},p.fitToModel=function(e,t,n,r,i,a,o,u){return l(null,e,t,n,r,i,a,o,u)},p.fitModelHeight=function(e,t,n,r,i,a,o,u){return l(null,e,t,n,r,i,a,o,u,!1,!0)};var N=p.zoomToPosition=function(e,t,n,r,i,a){e=V(e);var o=M(t),u=Z(n),s=t/w-(o-f)*e,l=n/w-(u-c)*e;return P(d,e,s-g,l-h,r,i,a)},K=p.reset=function(e){f=421,c=298,e?P(d,1,421-g,298-h,!0):(g=421,h=298,d=1)};p.zoom=function(){return o()?a.internalUse.getZoom():d},p.offsetXtoWebglPanX=function(){var e=b/2;return-(1-p.offsetX()/e)+(e-f)/e*d},p.offsetYtoWebglPanY=function(){var e=I/2;return 1-p.offsetY()/e-(e-c)/e*d},p.offsetX=function(e){return x.defined(e)&&(g=e),g},p.offsetY=function(e){return x.defined(e)&&(h=e),h},p.diffX=function(){return v},p.diffY=function(){return m},p.pan=function(e,t,n,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return i*=F,a*=F,z(i,a,t,!1,n,r)};var H,X,Y,z=p.panBy=function(e,t,n,r,i,a){return P(d,d,e,t,n,i,a,r)},P=function(t,n,r,i,a,o,u,s){return v=r,m=i,a?_(t,n,r,i,o,u):(g+=Math.floor(r),h+=Math.floor(i),d=n,e&&!s&&e.trigger("viewchange"),x.invoke(u),void 0)},_=function(t,n,r,i,a,o){a||(a=E);var u=a,s=g,l=h;return y.buildAnimatorInstance(function(f){u-=f;var c=e.atanEasing(Math.max(0,Math.min(1,(a-u)/a)));g=s+c*r,h=l+c*i,d=V(t+c*(n-t));var v=u>0;return v||(e.trigger("viewchange"),x.invoke(o)),v},{drawOnly:!0})},j=function(t,n,r,i,u){var s=o(),l=s?-3:.1;return y.buildAnimatorInstance(function(o){var f=0===X&&0===Y;return s?a.internalUse.panBy([X*l,Y*l],{animate:!1}):(g+=o*l*X,h+=o*l*Y),H=!f,r&&r.dragMove(t,n,i,u),f||e.trigger("viewchange"),!f})};return p.cancelScroll=function(){X=Y=0},p.maybeScroll=function(e,t,n,r,i){var a=B(50);return X=0,Y=0,a>e&&(X=1),e>B(b)-a&&(X=-1),a>t&&(Y=1),t>B(I)-a&&(Y=-1),n.direction&&(n.direction.x||(X=0),n.direction.y||(Y=0)),0===X&&0===Y||H?void 0:(H=!0,j(e,t,n,r,i))},K(),p}}(),function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(e){function t(){return f&&f.api.isShown()}function n(e,t,n){t=t||{all:!0,positions:!0,colours:!0,textures:!0,shadow:!0},e?M.afterChange(n):(M.render(t),x.invoke(n))}function r(e){return e===!0&&(e={animate:!0}),x.defaults(e,{animate:!1,time:1e3})}function i(e){return isFinite(e)?Math.min(Math.max(0,e),1):e?1:0}function a(e){return e=x.defaults(e,{type:"all",animate:!0,time:1e3,updateGlyph:!0}),x.defaults(e,{hideSingletons:"link"===e.type})}function o(e){var t=b.viewOptions(),n=t.height>0?t.width/t.height:1;return x.defaults(e,{fit:!0,animate:!0,tidy:!0,ratio:n,tightness:5,straighten:!0})}function u(e,n,r,i,a){function o(e,t){b.privateEach({type:"link"},function(n){if(!e[n.id1]||!e[n.id2]){var r=e[n.id1]||e[n.id2],i=e[n.id1]?n.id2:n.id1;r&&i&&(t[i]||(t[i]={x:0,y:0,_counter:0,id:i}),t[i].x+=r.x,t[i].y+=r.y,t[i]._counter++)}});var n=0;return x.iterator(t,function(t){e[t.id]||(t.x/=t._counter,t.y/=t._counter,e[t.id]=t,n++)}),n}function u(e,n,r){if(t())return r();for(var i,a={},u=[];0!==i;)i=o(n,a);x.iterator(e,function(e){"node"===e.type&&(a[e.id]||(e.x=g[e.id].x,e.y=g[e.id].y))}),x.iterator(a,function(e){u.push(e)}),b.setProperties(u,!1,r)}function s(){var e=[],t={};return C.each({type:"node"},function(n){e.push(n.id),t[n.id]=n}),{list:e,dict:t}}function l(){var e={};return C.each({type:"all"},function(t){e[t.id]=!0}),e}function f(t){var n={},r={};return x.iterator(e,function(e){n[e.id]=e,"adjacent"!==a&&"nonadjacent"!==a||"link"!==e.type||t[e.id]||(t[e.id1]&&(r[e.id1]=!0),t[e.id2]&&(r[e.id2]=!0))}),{dict:n,touched:r}}function c(e,t){switch(a){case"all":return e;case"adjacent":return Object.keys(t);case"nonadjacent":return e.filter(function(e){return!t[e]});case"none":default:return[]}}function d(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];x.isNullOrUndefined(i)||n[i.id]||(n[i.id]=1,g[i.id]={x:i.x,y:i.y},delete i.x,delete i.y,t.push(i))}return t}var g={};e=d(e);var h=s(),v=h.dict,m=l(),y=f(m),p=y.dict,I=c(h.list,y.touched);b.merge(e,function(){n(p,function(){u(e,v,function(){r(m,function(){i(I)})})})})}function s(e,t){M.draw(e,t),M.drawoffscreen(),M.afterDraw()}var l,f,c=KeyLines.Controller,d=KeyLines.Draggers,g=KeyLines.Events,h=KeyLines.Model,v=KeyLines.Overlays,m=KeyLines.Rendering,x=KeyLines.Util,y=KeyLines.View,p=KeyLines.Iterators,b={},I=g.createEventBus(),w=d.createDraggers(I),B=KeyLines.Generator.create(I),C=h.createModel(I,w,B);f=KeyLines.Map.create(b,I,e);var A=v.createOverlays(I,y,f),M=c.createController(b,I,A,B,f),Z=p.create(M,I,b);M.setModel(C);var D;b.privateInit=function(e,t,n,r,i,a,o,u,s){D=r,M.assetPath(o),M.setCursorFn(i),M.setCreateCanvasFn(r),M.imageGenFn(a),G(e,t,n,u),M.imageBasePath(s)};var G=b.privateSetSize=function(e,t,n,r,i){var a=D(t,n);M.makeGhostCanvas(t,n),r&&(t/=r,n/=r);var o=l;l=y.createView(I,t,n,r,f),M.setView(l),M.setCanvas(e),M.setShadowCanvas(a.getContext("2d"),t,n),m.clearLastFont(),o&&(l.setMinZoom(o.getMinZoom()),l.setMaxItemZoom(o.getMaxItemZoom()),l.fromOldSettings(o.settings(),!1)),M.afterChange(null,i)};b.privateMapSetSize=function(e,t){f.internalUse.setSize(e,t)},b.graph=function(){return C.graph()},b.map=function(){return f.api},b.combo=function(){return M.combo.api},b.toDataURL=function(e,n,r,i){function a(t){e=Math.floor(e/t),n=Math.floor(n/t)}function o(a){V.imageList(a);var o=M.options();o.overview={shown:!1},r.watermark||(o.watermark=!1),r.gradient||(o.gradient=!1),r.logo||(o.logo=!1),V.options(o,null,!0),V.backgroundOpacity(M.backgroundOpacity());var s=V.makeGhostCanvas(k.width(),k.height()),c=[];switch(r.selection||(c=C.doSelection(),C.doSelection([])),r.fit){case"chart":V.fitToModel(!1);break;case"view":k.fromOldSettings(l.settings(),!0);break;case"exact":k.fromOldSettings(l.settings(),!1);break;case"oneToOne":k.fitWorldExtents(u,!1,!1,!1,0,0)}k.scaleFactor(T),V.draw(!0,{all:!0});var d;try{d=R.toDataURL()}catch(g){throw Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}finally{if("rtl"===R.dir){var h=document.getElementsByTagName("body")[0];h.removeChild(R),h.removeChild(s)}}return r.selection||C.doSelection(c),C.setAllDirty(),i?t()?f.internalUse.toDataURL(e,n,r,D,R,i):x.invoke(i,d):d}if(e=Math.floor(e),n=Math.floor(n),e=e>0?e:100,n=n>0?n:100,r=x.defaults(r,{fit:"view",watermark:!0,gradient:!0,logo:!0}),t()&&(r.fit="exact"),"oneToOne"===r.fit){var u=M.modelExtents();u||(u={x1:0,y1:0,x2:100,y2:100});var s=10;u.x1-=s,u.y1-=s,u.x2+=s,u.y2+=s;var d=M.watermarkSize();if(d&&r.watermark){var h=(d.width-(u.x2-u.x1))/2;h>0&&(u.x1-=h,u.x2+=h);var m=(d.height-(u.y2-u.y1))/2;m>0&&(u.y1-=m,u.y2+=m)}e=u.x2-u.x1,n=u.y2-u.y1,r.noScale=!0}var p=16e6,I=e*n,w=I/p;if(w>1){var A=Math.sqrt(w);a(A)}var Z=8e3,G=e/Z;G>1&&a(G);var L=n/Z;L>1&&a(L);var R=D(e,n,!0),S=R.getContext("2d"),T=r.noScale?1:e/l.width(),E=g.createEventBus(),k=y.createView(E,Math.floor(e/T),Math.floor(n/T),T,f),F=v.createOverlays(E,y),V=c.createController(b,E,F,B);V.setCreateCanvasFn(D),V.setModel(C),V.setView(k),V.setCanvas(S),V.setShadowCanvas(null,e,n),V.assetPath(M.assetPath()),V.imageBasePath(M.imageBasePath()),V.imageGenFn(M.imageGenFn());var W=M.imageList(),U=V.testImagesForCORS(W);return i&&U.length?M.reloadCorsImages(W,U,o):o(M.imageList())},b.load=function(e,t){switch(e&&e.type){case"LinkChart":if(f&&f.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");C=h.createModel(I,w,B),M.setModel(C),M.load(e,function(){M.afterChange(t,null,!0)});break;default:throw new Error("Unknown chart type passed to load")}},b.chartType=function(){return C.type()},b.clear=function(){I.trigger("prechange","delete"),C.load({items:[]}),M.combo.internalUse.loadUp(),M.afterChange(null,null,!0)},b.merge=function(e,t){e=x.getItemsArray(e);var r=M.merge(e);n(r,null,function(){M.postMerge(t)})},b.privateMerge=function(e,t){var r=C.merge(e);n(r,null,t)},b.privateEach=function(e,t){C.each(e,t)},b.privateBothEndsShown=function(e){return C.bothEndsShown(e)},b.privateRemoveItem=function(e){C.removeItem(e),M.render()},b.privateGraph=function(){return C.graph()},b.setProperties=function(e,t,r){var i=M.setProperties(e,t);n(i,{all:!0,colours:!0},r)},b.animateProperties=function(e,t,n){t=x.defaults(t,{time:1e3,easing:"linear",queue:!0}),e=x.ensureArray(e),M.animateProperties(e,t,n)},b.privateAnimateBackgroundOpacity=function(e,t,n){t=x.defaults(t,{time:500}),e=i(e),M.animateBackgroundOpacity(e,t.time,n)},b.privateSetBackgroundOpacity=function(e){e=i(e),M.backgroundOpacity(e)},b.ping=function(e,t,n){t=x.defaults(t,{c:"#909090",w:20,r:80,time:800,repeat:1}),M.ping(e,t,n)},b.getItem=function(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=C.getItem(e[n]);r=r||null,t.push(r)}return t}return C?C.getItem(e):null},b.setItem=function(e,t){if(e){I.trigger("prechange","properties");var r=M.setItem(e);n(r,{all:!0},function(){M.postMerge(t)})}},b.removeItem=function(e){I.trigger("prechange","delete"),M.removeItem(e),M.render()},b.each=function(e,t){return e=KeyLines.Util.defaults(e,{type:"all"}),Z.each(e,t)},b.filter=function(e,t,n){return t=a(t),Z.filter(e,t,n)},b.foreground=function(e,t,n){return t=KeyLines.Util.defaults(t,{type:"node"}),Z.foreground(e,t,n)},b.hide=function(e,t,n){I.trigger("prechange","hide"),e=x.ensureArray(e),t=r(t),M.hide(e,t,n)},b.hidden=function(){return C.hidden()},b.show=function(e,t,n,i){I.trigger("prechange","show"),e=x.ensureArray(e),n=r(n),M.show(e,t,n,i)},b.labelPosition=function(e){return C?M.labelPosition(e,l):null},b.contains=function(e){return C?C.contains(e):[]},b.serialize=function(){var e=C.serialize();return M.appendCombos(e),f.internalUse.appendMap(e),e.viewSettings=l.settings(),e},b.worldCoordinates=function(e,t){var n=l.scale(e),r=l.scale(t);return{x:l.viewToWorldX(n),y:l.viewToWorldY(r)}},b.viewCoordinates=function(e,t){var n=l.worldToViewX(e),r=l.worldToViewY(t);return{x:l.unscale(n),y:l.unscale(r)}},b.viewOptions=function(e,t,n){if(!e)return l.settings();var i=r(t);e=x.defaults(e,{offsetX:0,offsetY:0,zoom:1}),M.setViewSettings(e,i.animate,i.time,function(){M.render({drawOnly:!0}),x.invoke(n)})},b.options=function(e,t){return M.options(e,t)},b.displayOptions=function(e,t){return b.options(e,t)},b.interactionOptions=function(e){return b.options(e)},b.lock=function(e,t){return"undefined"!=typeof e&&(L=e,f&&f.internalUse.lock(L),e?(t=t||{},M.wait(t.wait),M.removeDragger()):M.wait(!1),M.render()),L};var L=!1;b.zoom=function(e,t,n){var i=r(t);switch(e){case"in":M.zoomIn(i.animate,i.time,n);break;case"out":M.zoomOut(i.animate,i.time,n);break;case"one":M.setZoom(1,i.animate,i.time,n);break;case"fit":M.fitToModel(i.animate,i.time,n);break;case"selection":M.fitToSelection(i.animate,i.time,n);break;case"height":M.fitModelHeight(i.animate,i.time,n)}},b.pan=function(e,n,i){var a=r(n);"selection"!==e||t()?M.pan(e,a.animate,a.time,i):M.fitToSelection(a.animate,a.time,i,!0)},b.getLastError=function(){return I.getErrors()},b.imagePrefix=function(e){return M.imagePrefix(e)},b.cancelAnimation=function(){M.cancelAnimation()},b.layout=function(e,n,r){return t()?x.invoke(r):(e||(e="standard"),n=o(n),void M.layout(e,n,r))},b.arrange=function(e,t,n,r){e||(e="grid"),n=x.defaults(n,{fit:!1,animate:!0,tidy:!1,ratio:1}),M.arrange(e,t,n,r)},b.selection=function(e){e=x.isNullOrUndefined(e)?e:x.ensureArray(e);var t=C?C.doSelection(e):[];return e&&M.render(),t},b.expand=function(e,t,n){function r(e){function t(t,n){function r(e){return t[e.id]?c.filter.filterFn(e):!e.hi}if(c.filter&&x.hasAnyKeys(t)){var i=x.clone(c.filter);return i.animate=e,b.filter(r,i,n)}return n()}return t}function i(e){c.layout.fixed=e,b.layout(c.layout.name,c.layout,n)}function s(e,t){var n=null;if(e.filter&&x.isFunction(e.filter.filterFn)){var r=e.filter.filterFn;n=a(e.filter),n.time=Math.floor(t.time/5),n.filterFn=r}return n}function l(e,t){t.layout.animate=t.animate,x.defaults(t.layout,{fit:t.fit,straighten:t.straighten,tidy:t.tidy,tightness:t.tightness});var n=e.layout?"nonadjacent":"all",r={name:"standard",strategy:"spiral",tidy:!1,fit:!1,fix:n},i=x.defaults(t.layout,r);return o(i)}function f(e){e.filter?e.layout.time=e.time-e.filter.time:e.layout.time=e.time}t=t||{};var c=x.defaults(t,{animate:!0,time:1e3,layout:{},filter:{}});c.filter=s(t,c),c.layout=l(t,c),f(c),I.trigger("prechange","expand"),e=x.ensureArray(x.getItemsArray(e)),u(e,r(!1),r(c.animate),i,c.layout.fix)},b.createLink=function(e,t,n,r){function i(e,n){if("dummy"===e){b.removeItem(o),b.unbind("dragcomplete",i);var a=x.rawId(n)===t?null:n;x.invoke(r,a)}}var a=b.getItem(e);if(b.getItem(t))throw new Error("LinkId ("+t+") already exists and must be unique");if(e&&a&&"node"===a.type&&t){t=x.rawId(t),n=x.defaults(n,{style:{}}),b.bind("dragcomplete",i);var o="dummyEnd"+Math.floor(1e7*Math.random()),u={type:"node",du:!0,id:o,x:a.x,y:a.y},s=x.merge(n.style,{id:t,id1:e,id2:o,type:"link"});b.merge([u,s],function(){x.nextTick(function(){M.startDragger(t,o+x.idSep()+"id2",a.x,a.y)},50)})}},KeyLines.Common.appendActions(b,M,b.lock),b.mousemove=function(e,t,n,r){M.mousemove(e,t,n,r,L)},b.dragover=function(e,t){M.dragover(e,t)},x.merge(b,I);var R=KeyLines.Common.frameManager(s,M.animate);return x.merge(b,R),b.bind("redraw",R.redraw),b}}(),function(){"use strict";if(KeyLines.WebGL){var e=KeyLines.WebGL.Utils={};e.create3DContext=function(e,t){for(var n=["webgl","webgl2","experimental-webgl","webkit-3d","moz-webgl"],r=null,i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(a){}if(r)break}return r},e.createProgram=function(e,r,i){var a=t(e,r,e.VERTEX_SHADER),o=t(e,i,e.FRAGMENT_SHADER);return n(e,[a,o])},e.createMatrix=function(){var e={},t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=1;return e.zoom=function(e){n=e,t[0]*=e,t[4]*=e,t[8]*=1,t[1]*=e,t[5]*=e,t[9]*=1,t[2]*=e,t[6]*=e,t[10]*=1,t[3]*=e,t[7]*=e,t[11]*=1},e.getZoomLevel=function(){return n},e.pan=function(e,n){t[12]+=t[0]*e+t[4]*n,t[13]+=t[1]*e+t[5]*n,t[14]+=t[2]*e+t[6]*n,t[15]+=t[3]*e+t[7]*n},e.get=function(){return t},e};var t=function(e,t,n){var r=e.createShader(n);e.shaderSource(r,t),e.compileShader(r);var i=e.getShaderParameter(r,e.COMPILE_STATUS);if(!i){var a=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("Error in shader: "+a)}return r},n=function(e,t){for(var n=e.createProgram(),r=0;r<t.length;++r)e.attachShader(n,t[r]);e.linkProgram(n);var i=e.getProgramParameter(n,e.LINK_STATUS);if(!i){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error("Error in program linking:"+a)}return n}}}(),function(){var e=KeyLines.Graph={};KeyLines.getGraphEngine=function(e){function t(t){function n(n){n=r.clone(n),o.typeCheck(n);var i=o.filterNodesAndLinks(n.items,null,{selfLinks:e.selfLinks});o.ensureHiddenItemConsistency(i.nodes,i.links),t.privateSetProperties(i.nodes,i.links)}return n}function n(e){function t(){var t={};e.privateSetProperties(t,t)}return t}var r=KeyLines.Util,i=KeyLines.Events.createEventBus(),a=KeyLines.Graph.create(i);e=r.defaults(e,{selfLinks:!1});var o=KeyLines.Validation.create({numbers:{x:1,y:1},strings:{id:1,id1:1,id2:1},booleans:{hi:1,a1:1,a2:1}}),u={load:t(a),clear:n(a)};return r.merge(a,u)},e.create=function(e){function t(e,t,n,r,i){e[n]||(e[n]={}),e[r]||(e[r]={}),e[n][r]||(e[n][r]=e[r][n]=[],t.push(i)),e[n][r].push(i)}function n(e,t,n){var r={id:t.id,id1:t.id1,id2:t.id2,ids:n};e.edges.push(r),e.connections.push(n)}function r(e,r){var i={connections:[],adjacency:{},vertices:{},edges:[]};I({all:r&&r.all},function(e,t){i.vertices[t]={x:e.x,y:e.y},i.adjacency[t]={}});var a=[],o={};b({all:r&&r.all},function(e,n,r,u){r===u?(o[r]=o[r]||[],o[r].push(n)):t(i.adjacency,a,r,u,n)});for(var u=a.length,s=0;u>s;s++){var l=m[a[s]];n(i,l,i.adjacency[l.id1][l.id2])}if(g.hasAnyKeys(o)){var f=i.connections.slice();for(var c in o)f.push(o[c]);i.selfConnections=f}else i.selfConnections=i.connections;return i.selfAdjacency=o,i}function i(e){var t=e&&e.all?"all":"visible";return null===y&&(y={}),y[t]||(y[t]=r(t,e)),y[t]}function a(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function o(e){if(e.normalization=e.normalization||"any",!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function u(e){return b(e,function(t,n,r,i){if(D(r,i,n,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:c(e)}}function s(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function l(e){return a(e)||u(e)}function f(e){e.all=!!e.all}function c(e){return!!e.weights}function d(e){var t=0;return I(e,function(){t++}),t}var g=KeyLines.Util,h={},v={},m={},x=e,y=null,p=h.clearCache=function(){y=null};h.privateSetProperties=function(e,t){v=e,m=t,p()};var b=function(e,t){var n=e&&e.all;for(var r in m){r=g.rawId(r);var i=m[r];!n&&i.hi||t(i,r,i.id1,i.id2)}},I=function(e,t){var n=e&&e.all;for(var r in v){r=g.rawId(r);var i=v[r];!n&&i.hi||t(i,r)}},w=function(e,t,n,r){function i(){var t=[];return I(e,function(e){t.push(e)}),t}var a=i(),o=a.length,u=-1,s=Date.now(),l=s,f=700,c=function(){return u++,u>=o?(d(1),void r()):void n(a[u],v)},d=function(e){
x&&x.trigger("progress",t,e)},h=function(){return s=Date.now(),s-l>f?(l=Date.now(),!0):!1},v=function(){h()?(d(u/o),g.nextTick(c,0)):c()};d(0),v()};h.findAdjacency=function(e,t,n){var r=i(e);if(t===n)return r.selfAdjacency[t];var a=r.adjacency;return a[t]&&a[t][n]},h.connections=function(e){var t=i(e);return e.self?t.selfConnections:t.connections},h.eigenCentrality=function(e){function t(t){function n(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function r(e){var t,n,r=[];for(t=0;t<l.length;t++){var i=0;for(n=0;n<f[t].length;n++)i+=c[t][f[t][n]]*e[f[t][n]];i+=d*e[t],r.push(i)}return r}function i(){var e,t=1/a(g);for(e=0;e<l.length;e++)g[e]=g[e]*t}function a(e){var t,n=0;for(t=0;t<e.length;t++)n+=Math.abs(e[t]);return n}var o,u,s={},l=[],f=[],c=[],d=0,g=[],h=0;if(I(e,function(e,n){t[n]&&(l.push(n),s[n]=l.length-1,f.push([]),c.push({}))}),u=Math.max(100,5*Math.sqrt(l.length)),b(e,function(r,i,a,o){if(t[a]&&t[o]){var u=s[a],l=s[o];c[u][l]||(f[u].push(l),f[l].push(u),c[l][u]=0,c[u][l]=0);var g=n(r,e);c[u][l]+=g,c[l][u]+=g,d+=g,h++}}),0===l.length)return{};if(1===l.length)return g={},g[l[0]]=1,g;if(2===l.length)return g={},g[l[0]]=.5,g[l[1]]=.5,g;for(d/=h,u=Math.max(100,5*Math.sqrt(l.length)),o=0;o<l.length;o++)g.push(Math.random());for(o=0;u>o;o++)g=r(g),o%10===0&&i();i();var v={};for(o=0;o<l.length;o++)v[l[o]]=g[o];return v}e=g.defaults(e,{all:!1,value:void 0}),e.direction="any",f(e),u(e);var n,r,i={},a=B(e);for(n=0;n<a.length;n++){var o={};for(r=0;r<a[n].nodes.length;r++)o[a[n].nodes[r]]=!0;var s=t(o);for(r in s)i[r]=s[r]*a[n].nodes.length}return i},h.pageRank=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=Number(e.d[t.value])),n}function n(e){var t,n,r=[],i=0,a=0;for(t=0;t<u.length;t++)i+=e[t];for(t=0;t<u.length;t++){var o=0;for(n=0;n<s[t].length;n++){var l=s[t][n];o+=c[t][l]*e[l]/h[l]}0===h[t]&&(a+=m*e[t]),o=m*o,o+=(1-m)*i/u.length,r.push(o)}for(a/=u.length,t=0;t<v.length;t++)r[t]+=a;return r}function r(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t];return n}var i;e=g.defaults(e,{all:!1,value:void 0,directed:!0}),f(e),l(e);var a,o={},u=[],s=[],c=[],d=0,h=[],v=[],m=.85;for(I(e,function(e){u.push(e.id),o[e.id]=u.length-1,s.push([]),c.push({}),h.push(0)}),a=Math.max(100,5*Math.sqrt(u.length)),b(e,function(n,r,i,a){var u=o[i],l=o[a],f=t(n,e);e.directed&&!n.a2&&(n.a1||n.a2)||(c[l][u]||(c[l][u]=0,s[l].push(u)),c[l][u]+=f,h[u]+=f),e.directed&&!n.a1&&(n.a1||n.a2)||(c[u][l]||(c[u][l]=0,s[u].push(l)),c[u][l]+=f,h[l]+=f),d++}),i=0;i<u.length;i++)v.push(Math.random());var x=1/r(v);for(i=0;i<u.length;i++)v[i]=v[i]*x;for(i=0;a>i;i++)v=n(v);for(x=1/r(v),i=0;i<u.length;i++)v[i]=v[i]*x;var y={};for(i=0;i<u.length;i++)y[u[i]]=v[i];return y},h.neighbours=function(e,t){function n(e,n,r){!c[n]&&Z(r,e,n,t)&&(a[n]=c[n]=1,r!==e&&(o[e]=1,e in d&&(o[r]=1),e in u||(s++,l[e]=1)))}function r(){for(var e in u)if(e=g.rawId(e),v[e]){if(x[e])for(var r in x[e]){r=g.rawId(r);for(var i=0;i<x[e][r].length;i++){var a=g.rawId(x[e][r][i]);n(r,a,e)}}var f=y[e];if(f)for(var d=0;d<f.length;d++)n(e,f[d],e)}else if(m[e]){var h=m[e];!c[h.id2]&&Z(h.id2,h.id1,e,t)&&(o[h.id2]=c[h.id2]=c[e]=1,h.id2 in u||(s++,l[h.id2]=1)),!c[h.id1]&&Z(h.id1,h.id2,e,t)&&(o[h.id1]=c[h.id1]=c[e]=1,h.id1 in u||(s++,l[h.id1]=1))}}e=g.ensureArray(e);var a={},o={},u=g.makeIdMap(e);if(t=g.defaults(t,{all:!1,direction:"any",hops:1}),t.hops<1)throw new Error("neighbours error: hops must be a positive number");f(t);var s=0,l={},c={},d=u,h=i(t),x=h.adjacency,y=h.selfAdjacency;for(var p in u){if(p=g.rawId(p),!v[p]&&!m[p])throw new Error("neighbours error: ids must be present in the graph");s++}for(;t.hops--&&s;)s=0,r(),u=l,l={};return{nodes:Object.keys(o),links:Object.keys(a)}},h.clusters=function(e){function t(e,t){var n=1;return t.value&&e.d&&(n=+e.d[t.value]),n}function n(e){c=+e,c=g.isNumber(c)?c:5,c=Math.max(0,c),c=Math.min(10,c),c=c*c*c/125}function r(){var e,t,n=[];for(e=0;e<A.length;e++){var r=[];for(t=0;t<p[A[e]].length;t++)r.push(m[p[A[e]][t]]);n.push(r)}return n}function i(e,t,n){var r,i=B[t],a=B[e],o=d[n],u=(-o+i-a)*o*c;for(u/=2*y,r=0;r<h[n].length;r++){var s=h[n][r];w[s]===t?u-=v[n][s]:w[s]===e&&(u+=v[n][s])}return u/y}function a(e,t){var n,r;if(t!==e&&0!==p[e].length&&0!==p[t].length){var i=B[e],a=B[t],u=0;for(u-=c*i*a/y,n=0;n<p[e].length;n++){var s=p[e][n];for(r=0;r<h[s].length;r++)w[h[s][r]]===t&&(u+=v[s][h[s][r]])}if(u/=y,u>0){var l=p[e].length;for(n=0;l>n;n++)o(p[e][0],t)}}}function o(e,t){var n,r=w[e];w[e]=t;var i=[];for(n=0;n<p[r].length;n++)p[r][n]!==e&&i.push(p[r][n]);0===p[t].length&&(A.push(t),C.splice(C.indexOf(t),1)),p[r]=i,p[t].push(e),B[t]+=d[e],B[r]-=d[e],0===p[r].length&&(C.push(r),A.splice(A.indexOf(r),1))}function u(e){var t,n=p[e].length;if(1!==n&&C.length){var r=[];for(t=0;n>t;t++)r.push(p[e][t]);for(t=0;n>t&&C.length;t++)o(r[t],C[0])}}var s;e=g.defaults(e,{all:!1,factor:5,consistent:!0}),f(e);var l,c,d=[],h=[],v=[],m=[],x={},y=0,p=[],w=[],B=[],C=[],A=[];if(I(e,function(e){m.push(e.id),h.push([]),v.push([]),x[e.id]=m.length-1,p.push([m.length-1]),w.push(m.length-1),A.push(m.length-1),d.push(0),B.push(0)}),b(e,function(n,r,i,a){var o=t(n,e);y+=o;var u=x[i],s=x[a];v[u][s]||(v[u][s]=0,v[s][u]=0),v[u][s]+=o,v[s][u]+=o,d[u]+=o,d[s]+=o,B[u]+=o,B[s]+=o,h[u].push(s),h[s].push(u)}),l=Math.max(1e4,50*m.length),0===m.length)return[];0===y&&(l=0);var M=g.Randomiser();for(M.setSeed(e.consistent?900736044081:null),n(e.factor),s=0;l>s;s++){if(M.next()>.95){var Z=A[Math.floor(M.next()*A.length)],D=A[Math.floor(M.next()*A.length)];a(Z,D)}if(.5*l>s&&M.next()>.98){var G=A[Math.floor(M.next()*A.length)];u(G)}var L=Math.floor(m.length*M.next()),R=h[L][Math.floor(M.next()*h[L].length)],S=w[R],T=w[L];if(S!==T){var E=i(S,T,L);E>=0&&o(L,S)}}return r()};var B=h.components=function(e){var t,n,r=[],a=0,o=[];e=g.defaults(e,{all:!1}),f(e);var u=i(e).vertices,s=i(e).edges;for(t in u)if("c"in u[t])o[u[t].c]||(o[u[t].c]={nodes:[],links:[]});else{for(r.push(t);r.length>0;){var l=r.shift();if(!("c"in u[l]))for(u[l].c=a,n=0;n<s.length;n++)"c"in s[n]||(s[n].id1===l?(s[n].c=a,r.push(s[n].id2)):s[n].id2===l&&(s[n].c=a,r.push(s[n].id1)))}o.push({nodes:[],links:[]}),a++}for(t in u)o[u[t].c].nodes.push(t+"");for(n=0;n<s.length;n++)o[s[n].c].links=o[s[n].c].links.concat(s[n].ids);var c=i(e).selfAdjacency;for(var d in c){var h=u[d];h&&"c"in h&&(o[h.c].links=o[h.c].links.concat(c[d]))}return o};h.internalMarkLinks=function(e){var t=i(),n=t.adjacency,r=t.selfAdjacency,a=2,o={};for(var u in e){var s=n[u];if(s)for(var l in s)for(var f=s[l],c=0;c<f.length;c++){var d=f[c];o[d]=!0}var g=r[u];if(g)for(var h=0;h<g.length;h++)o[g[h]]=!0}for(var v in o)e[v]=a};var C=h.distances=function(e,t){if(!v[e])throw new Error("distances error: id(s) must be present in the graph");t=t||{},l(t),f(t);var n=R(e,t),r={};for(var i in n.distance){var a=n.distance[i];g.isNumber(a)&&(r[i]=a)}return r},A=function(e,t,n){var r,a=i(n).adjacency,o=a[e][t],u=1/0,s=G(n);if(o)for(var l=0;l<o.length;l++){var f=s(e,t,o[l],n);g.isNumber(f)&&u>f&&(r=[],u=f,r.push(o[l]))}return{value:u,links:r}},M=function(e,t){return m[e].a2&&m[e].id2===t||m[e].a1&&m[e].id1===t},Z=function(e,t,n,r){return"any"!==r.direction?"from"===r.direction&&M(n,t)||"to"===r.direction&&M(n,e):!0},D=function(e,t,n,r){var i=NaN;return Z(e,t,n,r)&&(r.value?m[n].d&&(i=+m[n].d[r.value]):i=1),i},G=function(e){return c(e)?L:D},L=function(e,t,n,r){var i=D(e,t,n,r);return g.isNaN(i)?i:1/i},R=function(e,t){function n(){for(var e,t=1/0,n=0;n<u.length;n++){var r=a[u[n]];t>=r&&(e=n,t=r)}return e}function r(e,t,n){o[e]||(o[e]=[]),o[e].push({id:t,links:n})}var a={},o={},u=[],s=i(t).adjacency;for(I(t,function(e,t){a[t]=1/0,o[t]=void 0,u.push(t)}),a[e]=0;u.length>0;){var l=n(),f=u[l];if(a[f]===1/0)break;u.splice(l,1);for(var c in s[f]){c=g.rawId(c);var d=A(f,c,t),h=a[f]+d.value;h<a[c]?(a[c]=h,o[c]=[{id:f,links:d.links}]):h===a[c]&&r(c,f,d.links)}}return{distance:a,previous:o}};h.shortestPaths=function(e,t,n){function r(e){for(var t=[],n=0;n<e.length;n++)a[e[n].id]&&(t=t.concat(a[e[n].id]));return t}if("string"!=typeof e||"string"!=typeof t)throw new Error("shortestPaths error: ids must be strings");if(!v[e]||!v[t])throw new Error("shortestPaths error: ids must be present in the graph");n=g.defaults(n,{all:!1}),l(n),f(n);var i=R(e,n),a=i.previous;if(i.distance[t]===1/0)return{onePath:[],one:[],items:[],distance:1/0};for(var o=[],u=[],s=t;a[s];)o.unshift(s),u.unshift(s),u.unshift(a[s][0].links[0]),s=a[s][0].id;o.unshift(s),u.unshift(s);var c={};c[t]=1;var d=[];d.push({id:t});for(var h=r(d);h.length>0;){for(var m=0;m<h.length;m++){c[h[m].id]=1;for(var x=0;x<h[m].links.length;x++)c[h[m].links[x]]=1}h=r(h)}return{onePath:u,one:o,items:Object.keys(c),distance:i.distance[t]}};var S=h.degrees=function(e){e=g.defaults(e,{multi:!0,all:!1}),l(e),f(e);var t=i(e).adjacency,n={};return I(e,function(r,i){n[i]=0;for(var a in t[i]){a=g.rawId(a);for(var o=0;o<t[i][a].length;o++){var u=D(i,a,t[i][a][o],e);if(g.isNumber(u)&&(n[i]+=u,!e.multi))break}}}),n};return h.betweenness=function(e,t){function n(e,t){return N[e]-N[t]}function r(e){return e.sort(n),e.shift()}function a(e,t){e.sort(n),g.contains(e,t)||e.push(t)}function u(e,t){var n=A(e,t,D).value;return g.isNumber(n)?n:p()||g.isNumber(n)?1/0:1}function d(e){return e.length>0}function h(){F.length=0,V.length=0,I(e,function(e,t){for(var n=0;n<H.length;n++)m(H[n].dict,t,H[n].value)})}function v(e,t,n){I(e,function(e,r){m(t,r,n)})}function m(e,t,n){Array.isArray(n)&&d(n)&&e[t]?e[t].length=0:e[t]=g.clone(n)}function x(){var t,n,r,i=B(e),a={};for(t=0;t<i.length;t++)for(r=i[t],n=0;n<r.nodes.length;n++)a[r.nodes[n]]=r.nodes.length;return a}function y(){return!g.isNullOrUndefined(e.value)}function p(){return!!e.directed}function b(){return e.endpoints}e=g.defaults(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1}),o(e),f(e);var C=y()||p()?"dijkstra":"regular",M=b()?"endpoints":"regular",Z=s(e),D={direction:p()?"from":"any",value:e.value,weights:c(e),all:e.all};l(e);var G,L,R,S,T,E,k={},F=[],V=[],W={},U={},O={},N={},K=0,H=[{dict:U,value:0},{dict:N,value:1/0},{dict:W,value:[]},{dict:O,value:0}],X=i(e).adjacency,Y={regular:function(e){for(U[e]=1,N[e]=0,F.push(e);d(F);){G=F.shift(),V.push(G);for(var t in X[G])t=g.rawId(t),g.isNumber(N[t])||(N[t]=N[G]+1,F.push(t)),N[t]===N[G]+1&&(U[t]+=U[G],W[t].push(G))}},dijkstra:function(e){for(U[e]=1,N[e]=0,F.push(e);d(F);){G=r(F),V.push(G);for(var t in X[G])t=g.rawId(t),N[t]>N[G]+u(G,t)&&(N[t]=N[G]+u(G,t),a(F,t),U[t]=0,W[t]=[]),N[t]===N[G]+u(G,t)&&(U[t]+=U[G],W[t].push(G))}}},z={regular:function(e){for(;d(V);){for(L=V.pop(),T=(1+O[L])/U[L],S=0;S<W[L].length;S++)G=W[L][S],O[G]+=U[G]*T;L!==e&&(k[L]+=O[L])}},endpoints:function(e){for(k[e]+=V.length-1;d(V);){for(L=V.pop(),T=(1+O[L])/U[L],S=0;S<W[L].length;S++)G=W[L][S],O[G]+=U[G]*T;L!==e&&(k[L]+=O[L]+1)}}},P={chart:function(){if(K>2){R=1/((K-1)*(K-2));for(var e in k)e=g.rawId(e),k[e]*=R}},component:function(){E=x();for(var e in k)e=g.rawId(e),E[e]>2&&(R=1/((E[e]-1)*(E[e]-2)),k[e]*=R)},unnormalized:function(){if(!p()){R=.5;for(var e in k)e=g.rawId(e),k[e]*=R}}},_=function(){Q(),g.invoke(t,k)},j=Y[C]||Y.regular,J=z[M]||z.regular,Q=P[Z]||P.chart;I(e,function(){K++}),v(e,k,0);var q=function(e,t){h(),j(e.id),J(e.id),t()};w(e,"betweenness",q,_)},h.closeness=function(e,t){function n(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?1:0;return n}function r(e){for(var t in e)if(t=g.rawId(t),e.hasOwnProperty(t))return!1;return!0}function a(e){return!g.isNullOrUndefined(e)}function u(e){return!m[e].a1&&!m[e].a2}function c(e){var t={},n=0,i={},o={};for(o[e]=1;!r(o);){i=o,o={};for(var u in i)if(u=g.rawId(u),!a(t[u])){t[u]=n;for(var s in A[u])s=g.rawId(s),o[s]=1}n+=1}return t}function h(){return"any"!==e.direction}function v(){if(e.mode=e.mode||"auto",!e.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function x(){return v(),"auto"===e.mode?I():e.mode}function y(){return!g.isNullOrUndefined(e.value)}function p(){return s(e).match(/chart/)}function b(){return s(e).match(/component/)}function I(){var t="disconnected",n=B(e);if(1===n.length&&(t="connected",h()))for(var r=0;r<n[0].links.length;r++)if(u(n[0].links[r]))return"disconnected";return t}e=g.defaults(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});var A=i(e).adjacency,M=l(e);o(e),f(e),M.all=e.all;var Z,D,G,L,R,S=y()||h()?"dijkstra":"regular",T=0,E={},k=x(),F={regular:function(e){return c(e)},dijkstra:function(e,t){return C(e,t)}},V={connected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=g.isNumber(t[r])?t[r]:0;return n?1/n:0},disconnected:function(e,t){var n=0;for(var r in t)r=g.rawId(r),n+=e!==r?1/t[r]:0;return n}},W=function(){g.invoke(t,E)};D=F[S]||F.regular,G=V[k],T=d(e),E={};var U=function(e,t){L=D(e.id,M),Z=n(e.id,L),E[e.id]=G(e.id,L),T>1&&(R=p()?Math.pow(Z-1,2)/(T-1):b()?Z-1:1,E[e.id]*=R),t()};w(e,"closeness",U,W)},h.kCores=function(e){function t(e){var t=0;for(var n in e)n=g.rawId(n),t=Math.max(t,e[n]);return t}e=g.defaults(e,{all:!1}),f(e);var n=i(e).adjacency,r=function(){var t,r,i,a,o,u,s,l,f,c,d,h={},v={},m=[],x=[];r=0,h=S({multi:!1,all:e.all});for(var y in h)y=g.rawId(y),r=Math.max(r,h[y]);for(d=Object.keys(h).length,t=0;r+1>t;t++)x[t]=0;for(I(e,function(e,t){x[h[t]]++}),o=1,t=0;r+1>t;t++)u=x[t],x[t]=o,o+=u;for(I(e,function(e,t){v[t]=x[h[t]],m[v[t]]=t,x[h[t]]++}),t=r;t>1;t--)x[t]=x[t-1];for(x[0]=1,a=0;d>a;a++){i=m[a];for(var p in n[i])p=g.rawId(p),h[p]>h[i]&&(l=h[p],f=v[p],c=x[l],s=m[c],p!==s&&(v[p]=c,m[f]=s,v[s]=f,m[c]=p),x[l]++,h[p]--)}return h},a=r();return{maximumK:t(a),values:a}},h}}(),function(){var e=KeyLines.TimeBar.Controller={};e.createController=function(e,t,n,r){function i(){e.trigger("redraw")}function a(e,n,r){j=e,z=n,P=r,t.setSize(n,r);var i=_(z,P,!0);oe=KeyLines.Common.hitTester(i.getContext("2d"),n,r,ne)}function o(e){var t={},n=ee.useHiResImages();for(var r in xe){var a=xe[r];t[a]=!0,n&&(t[ee.hiResUrl(a)]=!0)}ee.imageLoader(e,J,t,!1,function(e,t){ve={};for(var n in t)ve[n]={im:t[n]};i()})}function u(){be._tbLeft=be._tbRight='url("'+J+'openhand.cur"), pointer';for(var e in he)be[e]="pointer"}function s(e,n,r){t[n](e);var i=t.getInnerRange();m(i.t1,i.t2,{quiet:!0},r)}function l(){var e=null,t=$.makeValueAnimator(re,function(t){return 0===arguments.length?e:void(e=t)});return function(n){return r.options.heightChange.animate&&null!==e?t(n,r.options.heightChange.time):e=n,e}}function f(e,t){return e&&t?e.t1!==t.t1||e.t2!==t.t2:!0}function c(e,n){for(var r=t.getHistogram(),i="_tbBar"===se,a=0;r.x[a+1]<n&&a<r.count;)a++;var o=i?r.value[a]:r.selvalues[e][a],u=i?r.maxvalue:r.maxselvalue,s=(r.x[a]+r.x[a+1])/2,l=t.getBounds().histogram,f=l.ybase,c=i?l.maxbarh:l.maxselh,d=Math.floor(c*o/u),g=f-d;return i||(g-=5),{x:s,y:g,v:o}}function d(n,r,i){se=oe.test(n,r),y(n,r)&&(de=t.findRange(n,r));var a=f(de,ge.lastRange);if("hover"!==i||se!==ge.lastId||a){var o,u,s,l,d=n,g=r,h=null,v=de&&"histogram"===de.bar;if(y(n,r)&&(o=te.unUTCify(de.t1),u=te.unUTCify(de.t2),h=v?null:"scale"),p()){h="bar","_tbBar"!==se&&(h="selection",s=+se.match(ye)[1],v||(de=t.findRange(n,r,"histogram"),o=te.unUTCify(de.t1),u=te.unUTCify(de.t2)));var m=c(s,n);d=m.x,g=m.y,l=m.v}return!h&&se&&(h=O(se)),ge.lastId=se,ge.lastRange=de,e.trigger(i,h,s,l,d,g,o,u)}}function g(n){r.playingExtend=!!n.extend,Q||(Q=!0,re.push(KeyLines.Common.buildAnimatorInstance(function(n){var i=t.offsetRanges(Math.floor(t.getTimeRate()*(r.options.playSpeed||r.defaultPlaySpeed)*n/1e3),r.playingExtend);return i||e.trigger("pause"),Q&&i?(t.triggerTimeBarChanged(),!0):(Q=!1,r.playingExtend=!1,!1)})))}function h(e,n,i,a,o,u){var s=e.t1,l=e.t2,f=i-s,c=a-l;o=o||{};var d=o.time||r.defaultAnimationTime,g=d;re.push(KeyLines.Common.buildAnimatorInstance(function(e){g=Math.max(0,g-e);var r=1-g/d,i=s+f*r,a=l+c*r;return n(i,a),0>=g&&(o.quiet||t.triggerTimeBarChanged(),q.invoke(u)),g>0}))}function v(e,n,r,i){var a=t.limitInnerRange(e,n);h(t.getInnerRange(),t.setInner,a.t1,a.t2,r,i)}function m(e,n,r,i){r.animate?v(e,n,r,i):(t.setInner(e,n),r.quiet||t.triggerTimeBarChanged(),q.invoke(i))}function x(e,n,r,i){h(t.getOuterRange(),t.setOuter,e,n,r,i)}function y(e,n){return t.inMainBarOrHistogram(e,n)||ye.test(se)}function p(){return"_tbBar"===se||ye.test(se)}function b(e,t){return Math.min(t.max,Math.max(t.min,e))}function I(e){return function(n){var i=t.getInnerRange()[e],a=t.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(r){t.setInnerRangeSide(e,b(i+(r-n)*t.getTimeRate(),a)),t.triggerTimeBarChanged()},endDrag:function(n){if(n&&t.setInnerRangeSide(e,i),"fixed"===r.options.sliders){var a=t.getInnerRange(),o=(a.t2-a.t1)*r.fixedSideFactor;x(a.t1-o,a.t2+o,{time:r.sliderReleaseTime})}}}}}function w(e,t){le.x===e&&le.y===t||(le.x=e,le.y=t,i())}function B(){w(-1,-1)}function C(){(se in he||ge.lastId in he)&&i()}function A(e,n,r){var i=t.nextPage(e);m(i.t1,i.t2,n,r)}function M(e){var n=t.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(i){var a=Math.floor((e-i)*t.getTimeRate());"free"===r.options.sliders&&(a=-1*a),t.offsetRanges(a+(n-t.getInnerRange().t1)),t.triggerTimeBarChanged()},endDrag:function(e){e&&t.offsetRanges(n-t.getInnerRange().t1)}}}function Z(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function D(e){var n=Z(e),i=t.xtot(n.xmin),a=t.xtot(n.xmax),o=a-i,u=t.getInnerRange(),s=t.ttox(u.t1),l=t.ttox(u.t2);return{pinchMove:function(e){var u=Z(e);if("free"===r.options.sliders){var f=s+(u.xmin-n.xmin),c=l+(u.xmax-n.xmax);t.setInner(t.xtot(f),t.xtot(c))}else if(u.xmax!==u.xmin){var d=o/(u.xmax-u.xmin),g=Math.floor(i-d*(u.xmin-s)),h=Math.floor(a+d*(l-u.xmax));t.setInner(g,h),t.triggerTimeBarChanged()}},endPinch:function(){}}}function G(e){var t=U(oe.test(e.x,e.y));return we[t]}function L(t,n,r,i,a){fe&&(fe.endDrag(e.trigger("dragend",fe.type,n,r)),e.trigger("dragcomplete",fe.type,n,r),fe=null,ae("auto"))}function R(){ce&&(ce=null)}function S(e,t,n,r){B(),L(!1,e,t,n,r)}function T(e,n,r,i,a){i=q.defaults(i,{animate:!0,time:200}),r=r||.5;var o=e>0?r:1/r,u=t.getInnerRange(),s=u.t1,l=u.t2,f=l-s,c=f*o,d=(n-u.t1)/(u.t2-u.t1);s=Math.floor(s-(c-f)*d),l=Math.floor(l+(c-f)*(1-d)),m(s,l,i,a)}function E(e,n){var r;r=e&&e.id?t.getRangeForIds(e.id):t.dataRange(),r?(r=t.fitHistogramBarsExactly(r),ie.range(r.t1,r.t2,e,n)):q.invoke(n)}function k(){var e=t.getInnerRange();return(e.t1+e.t2)/2}function F(e,t,n){T(e,k(),.5,t,n)}function V(e,t){F(1,e,t)}function W(e,t){F(-1,e,t)}function U(e){return ye.test(e)&&(e="_tbLine"),e}function O(e){var t=0===e.indexOf("_tb")?e.substr(3):e;return t.toLowerCase()}function N(t,n,i){var a=oe.test(t,n);if(i||("_tbplay"===a?(r.playingExtend=!1,ie.play()):"_tbplayextend"===a?(r.playingExtend=!0,ie.play({extend:!0})):"_tbpause"===a?ie.pause():"_tbnext"===a?ie.pan("forward"):"_tbprev"===a?ie.pan("back"):"_tbfit"===a?E():"_tbzoomin"===a?"free"===r.options.sliders?W():V():"_tbzoomout"===a&&("free"===r.options.sliders?V():W())),a=U(a),Ie[a]){var o="hand";/left|right/i.test(a)&&(o=O(a)),e.trigger("dragstart",o,t,n)||(fe=Ie[a](t,n),fe.type=o,ae(fe.getCursor(t,n)))}}function K(e,t){if(1===e.length)N(e[0].x,e[0].y,!t),d(e[0].x,e[0].y,"touchdown");else if(2===e.length){var n=G(e[0]),r=G(e[1]);n&&n===r&&(ce=n(e))}}function H(e,n){if(t.inMainBarOrHistogram(e,n)){if(!d(e,n,"dblclick")){var i=t.findRange(e,n);i=t.limitInnerRange(i.t1,i.t2,!0);var a="free"===r.options.sliders?r.doubleClickZoomTimeFree:r.doubleClickZoomTime;v(i.t1,i.t2,{time:a})}}else d(e,n,"dblclick")}function X(e){var t=!1;return 1===e.length&&(me?(H(e[0].x,e[0].y),t=!0):me=q.nextTick(function(){me=null},600)),t}function Y(){De&&(clearTimeout(De),De=null)}var z,P,_,j,J,Q,q=KeyLines.Util,$=KeyLines.Common,ee=KeyLines.Rendering,te=KeyLines.DateTime,ne=KeyLines.Rendering.widgets(),re=$.animator(i),ie={},ae=function(){};var qP=new Date()/12755;var oe,ue,se,le={x:-1,y:-1},fe=null,ce=null,de={},ge={lastId:null,lastRange:null},he={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbplayextend:1,_tbnext:1};ie.privateInit=function(e,n,r,i,s,l,f){_=i,ae=s,J=f,o(l),u(),a(e,n,r),t.setInner(te.UTCify(new Date(2011,4,6)),te.UTCify(new Date))},ie.privateSetSize=function(e,t,n){ee.clearLastFont();var r=ie.range();a(e,t,n),ie.range(r.dt1,r.dt2,{animate:!1})},ie.imageList=function(){return ve},ie.imageNames=function(){return xe},ie.isPlayingFixed=function(){return Q&&!r.playingExtend},ie.isPlayingExtend=function(){return Q&&r.playingExtend},ie.selectionRegExp=function(){return ye},ie.animate=re.animate,ie.draw=function(){if(ve){ne.resetExtras(),n.generate(ie,t,j,ne,r,le,se),ee.clear(j,z,P);var e=ee.channels.MAIN;var iu=116401223-qP;if(iu===Math.abs(iu))iu=1,ne.draw(j,null,ve,e),oe.dirty()}},ie.load=function(e,t){return s(e,"load",t)},ie.merge=function(e,t){return s(e,"merge",t)},ie.range=function(e,n,r,i){if(0===arguments.length){var a=t.getInnerRange();return{dt1:te.unUTCify(a.t1),dt2:te.unUTCify(a.t2)}}if(q.isNullOrUndefined(e)||q.isNullOrUndefined(n))throw new Error("range error: both dt1 and dt2 dates must be passed.");var o=q.defaults(r,{animate:!0}),u=t.extractUTC(e),s=t.extractUTC(n),l=t.limitInnerRange(u,s,!0);m(l.t1,l.t2,o,i)},ie.play=function(t){t=t||{};var n=t.extend?"extend":"normal";e.trigger("play",n),g(t)},ie.pan=function(e,t,n){t=q.defaults(t,{animate:!0}),e=e||"forward",A(e,t,n)},ie.zoom=function(e,t,n){switch(e){case"in":V(t,n);break;case"out":W(t,n);break;case"fit":E(t,n)}},ie.pause=function(){e.trigger("pause"),Q=!1,r.playingExtend=!1},ie.options=function(e,n){return e&&(r.setOptions(e),t.updateOptions(),"showShadowCanvas"in e&&oe.debugCanvas(e.showShadowCanvas?j:null),i()),q.invoke(n),r.getOptions()},ie.animateBarHeight=l(),ie.animateSelHeight=l();var ve,me,xe={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",playextend:"TBPlayExtend.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},ye=/^_tbLine(.)/,pe=q.ratelimit(d,r.hoverTime),be={},Ie={_tbBar:M,_tbSlider:M,_tbHisto:M,_tbLine:M,_tbMain:M,_tbMajor:M,_tbMinor:M,_tbLeft:I("t1"),_tbRight:I("t2")},we={_tbBar:D,_tbSlider:D,_tbHisto:D,_tbLine:D,_tbMain:D,_tbMinor:D,_tbMajor:D};ie.mousedown=function(e,t,n){var r;2===e?r="contextmenu":(r="click",N(t,n)),d(t,n,r)},ie.mousewheel=function(n,i,a){var o;return e.trigger("mousewheel",n,i,a)||(o="free"===r.options.sliders?k():t.xtot(i),t.inMainBarOrHistogram(i,a)&&T(n,o,.65,{animate:!0})),!0},ie.dblclick=function(e,t){H(e,t)},ie.mousemove=function(e,n,r,i){t.inMainBarOrHistogram(e,n)?w(e,n):B();var a;fe?(a=fe.getCursor(e,n),fe.dragMove(e,n,r,i)):(se=oe.test(e,n),a=be[U(se)]||"auto"),C(),ue!==a&&(ue=a,ae(a)),pe(e,n,"hover")},ie.mouseup=function(e,t,n,r){L(!0,e,t,n,r)},ie.mouseleave=function(e,t,n,r){arguments.length&&S(e,t,n,r),se=null,C()};var Be,Ce,Ae,Me,Ze,De;return ie.touchstart=function(e){X(e)||K(e,!0),Me=e[0].x,Ze=e[0].y,Be=e[0].id,De=setTimeout(function(){Y(),L(!1),d(Me,Ze,"contextmenu")},600)},ie.touchmove=function(e){ce?ce.pinchMove(e):fe&&(fe.dragMove(e[0].x,e[0].y,!1,!1),w(e[0].x,e[0].y));for(var t=0;t<e.length;t++)Be===e[t].id&&(Ce=e[t].x,Ae=e[t].y);if(De){var n=(Ce-Me)*(Ce-Me)+(Ae-Ze)*(Ae-Ze);n>100&&Y()}},ie.touchend=function(e){De&&Y(),R(),L(!1),K(e,!1)},ie.touchcancel=function(){R(),L(!1)},ie.keydown=function(e,t,n){if(!t&&!n&&32===e){if(!q.isNullOrUndefined(r.playingExtend)){var i=Q?"pause":"play",a={extend:r.options.showExtend&&!r.options.showPlay};ie[i](a)}return!0}},ie}}(),function(){var e=KeyLines.Validation={};e.create=function(e,t,n,r){function i(t,n){for(var r in t)l(t,r),v(t,r,e.reserved),n&&v(t,r,e.booleans)}function a(e,t){var n=e[t],r=!0;if(p.isNormalObject(n))for(var i in n)o(n,i),r&=isFinite(n[i]);r||delete e[t]}function o(t,n){var r=+t[n];0>r&&!e.negatives[n]&&(r=null),t[n]=r}function u(t,n){p.isNullOrUndefined(t[n])||(t[n]=t[n]+"",e.stringValues[n]&&!e.stringValues[n][t[n]]&&delete t[n])}function s(e,t){e[t]&&(e[t]=b.validatergb(e[t])?e[t]:void 0)}function l(t,n){e.strings[n]?u(t,n):e.numbers[n]?o(t,n):e.colours[n]?s(t,n):e.mapPos[n]&&a(t,n)}function f(e){if(p.isNormalObject(e.fi)){var t=e.fi;p.isNullOrUndefined(t.t)||(t.t="string"==typeof t.t?t.t.charAt(0):String.fromCharCode(t.t)),t.c&&(t.c=b.validatergb(t.c)?t.c:void 0),"ff"in t&&"string"!=typeof t.ff&&(t.ff=void 0)}else null!==e.fi&&delete e.fi}function c(e){return/(ne|nw|se|sw)/.test(e)}function d(e,t){var n,r={};return Array.isArray(e)&&(n=e.filter(function(e){var n,i=e.p;return t?n=e:i&&2===i.length&&c(i)&&(r[i]||(n=e,r[i]=1)),n?(f(e),e):void 0})),n}function g(t,n){e.halos.forEach(function(e){var r=t[e];r&&(n?"c"in r||"r"in r||"w"in r||delete t[e]:"c"in r&&"r"in r&&"w"in r?(r.r=p.isNumber(+r.r)?+r.r:null,r.w=p.isNumber(+r.w)?+r.w:null,s(r,"c")):delete t[e])})}function h(e){if(Array.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;c(t)||2===t.length||delete e.bu}}function v(e,t,n){n[t]&&delete e[t]}function m(e,t,n){function r(e,t){return e.id in t.nodes||e.id in t.links}function i(e){return"link"===e.type&&e.id in t}t=t||{};var a,o={nodes:{},links:{}};return e&&(o=e.reduce(function(e,o){if(o.id&&!r(o,e)&&!i(o)){if(a=o.type+"s","node"===o.type){var u=!0;n&&t[o.id]&&(u=!1),u&&A(o)}a in e&&(e[a][o.id]=o)}return e},o)),o}function x(e,t,n,r){var i={};for(var a in e){var o=e[a];M(o,t,n,r)&&(i[a]=o)}return i}function y(e,n,r,i){for(var a in i){var o=i[a];r[o.id1][e]!==n&&r[o.id2][e]!==n||o[e]!==n&&(o[e]=n,t(a))}}var p=KeyLines.Util,b=KeyLines.Rendering;t=t||p.noop,n=n||p.noop,r=r||p.noop;var I={},w={numbers:{},negatives:{},strings:{},stringValues:{},colours:{},booleans:{},reserved:{},mapPos:{},halos:[]};e=p.defaults(e,w),I.typeCheck=function(e,t){C(e.items,!1,t)},I.filterNodesAndLinks=function(e,t,n){n=n||{};var r=m(e,t,n.carefulWithXandY);return r.links=x(r.links,r.nodes,t,n.selfLinks),r};var B=I.ensureObject=function(e,t,n){n=n||{},i(e,t),f(e),e.g&&(Array.isArray(e.g)?(C(e.g),e.g=d(e.g,"link"===e.type||n[e.id])):delete e.g),g(e,t),e.bu&&h(e)},C=I.ensureTypesInArray=function(e,t,n){if(e)for(var r=0;r<e.length;r++)B(e[r],t,n)},A=I.setZeroXY=function(e){"node"===e.type&&(e.x=e.x||0,e.y=e.y||0)},M=I.hasValidEnds=function(e,t,n,r){return r||e.id1!==e.id2?(t=t||{},n=n||{},(n[e.id1]||t[e.id1])&&(n[e.id2]||t[e.id2])):!1};I.ensureHiddenItemConsistency=function(e,t){Z("hi",!1,e,t)};var Z=I.ensureConsistency=function(e,t,i,a){y(e,!0,i,a),t||r(e),"hi"===e&&n()};return I}}(),function(){var e=KeyLines.Iterators={};e.create=function(e,t,n){function r(e,t){if(!e.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");l=l||n.serialize().items;var r=l;if(KeyLines.Util.isFunction(t))for(var i=0;i<r.length;i++)o(e.type,r[i])&&t(r[i])}function i(e,t){t.forEach(function(t){e[t.id]&&(e[t.id1]=!0,e[t.id2]=!0)})}function a(e,t){t.forEach(function(t){e[t.id]=!(!e[t.id1]||!e[t.id2])})}function o(e,t){return"all"===e||e===t.type}function u(e,t,o,u,s,l,f,c){function d(){var e={all:[],nodes:[],links:[],combos:[],comboItemLookup:{},comboLookup:{}};return r({type:"all"},function(t){if(c&&w.isCombo(t.id)){e.combos.push(t),y[t.id]=!0;var n=w.info(t.id),r=(n.nodes||[]).concat(n.links);r.forEach(function(n){e.comboItemLookup[n.id]=n,e.comboLookup[n.id]=t}),e.all=e.all.concat(r),e.nodes=e.nodes.concat(n.nodes||[]),e.links=e.links.concat(n.links||[])}else e.all.push(t),e[t.type+"s"].push(t)}),e}function g(t){var n;n="node"===s?t.nodes:"link"===s?t.links:t.all,KeyLines.Util.clone(n).forEach(function(t){e(t)&&(y[t.id]=!0)})}function h(e){"link"===s&&(l?i(y,e.links):e.nodes.forEach(function(e){y[e.id]=!0}))}function v(e){"node"===s&&a(y,e.links)}function m(e){"all"===s&&"bg"!==t&&e.links.forEach(function(e){y[e.id]=!(!y[e.id1]||!y[e.id2]||!y[e.id])})}function x(e){if("link"!==s&&l){var t={};e.links.forEach(function(e){t[e.id1]|=y[e.id]&&y[e.id2],t[e.id2]|=y[e.id]&&y[e.id1]}),e.nodes.forEach(function(e){y[e.id]&=t[e.id]})}}var y={},p={},b=[],I={};I[o]={nodes:[],links:[]},I[u]={nodes:[],links:[]};var w=n.combo(),B=d();g(B),h(B),v(B),m(B),x(B),B.all.filter(function(e){var t=B.comboItemLookup[e.id];if(t&&y[e.id]){var n=B.comboLookup[e.id];p[e.id]={id:n.id,type:n.type}}return!t}).forEach(function(e){var n=e.type+"s";if(!y[e.id]==!e[t]){var r=y[e.id]?o:u;if(I[r][n].push(e.id),f){var i={id:e.id};i[t]=!y[e.id],b.push(i)}}});var C={dict:I,includedComboItems:p,allCombos:B.combos};return f&&(C.list=b),C}var s={},l=null;return t.bind("redraw",function(){l=null}),s.each=r,s.filter=function(t,r,i){function a(){KeyLines.Util.invoke(i,l)}var o,s=u(t,"hi","shown","hidden",r.type,r.hideSingletons,!1,r.combos),l=s.dict,f=l.shown.nodes.concat(l.shown.links),c=l.hidden.nodes.concat(l.hidden.links);if(r.combos){var d=e.combo.internalUse.filter(s.includedComboItems,s.allCombos,r);d.itemsToShow.forEach(function(e){l.shown[e.type+"s"].push(e.id),f.push(e.id)}),d.itemsToHide.forEach(function(e){l.hidden[e.type+"s"].push(e.id),c.push(e.id)}),o={nodes:d.nodes,links:d.links}}else o={nodes:[],links:[]};l.combos=o,c.length>0?f.length>0?(r.time/=2,n.hide(c,r,function(){n.show(f,!1,r,a)})):n.hide(c,r,a):f.length>0?n.show(f,!1,r,a):a()},s.foreground=function(t,r,i){var a="link"===r.type,o=u(t,"bg","foreground","background",r.type,a,!0,r.combos);if(r.combos){var s=e.combo.internalUse.foreground(o.includedComboItems,o.allCombos,r);s.itemsToShow.forEach(function(e){e.bg=!1,o.list.push(e)}),s.itemsToHide.forEach(function(e){e.bg=!0,o.list.push(e)})}n.setProperties(o.list,!1,function(){KeyLines.Util.invoke(i,o.dict)})},s}}(),function(){var e=KeyLines.TimeBar.Model={};e.createModel=function(e,t){function n(){e.trigger("redraw")}function r(e,t,r,i){Y.t1=e,Y.t2=t,z.t1=r,z.t2=i,V&&(Q=s(z),n()),fe=!0}function i(e,n){var r=te[e.units]*e.by,i=r/n;return i>=t.histogram.minwidth}function a(e){for(var t=ne(),n=0;K[n].max<e*t&&n<K.length;)n++;return n}function o(e,n){for(var r=t.rates,i=N.units[e],a=0;a<r.length;a++){var o=r[a].minor;if(o.units>i||o.units===i&&o.by>=n)return a>0?a-1:a}return r.length-2}function u(){var e=0;if(f()){var t=l();
e=o(t.units,t.value)}return e}function s(e){var t={},n=(e.t2-e.t1)/(V.x2-V.x1),r=a(n),o=u();for(r=o>=r?o+1:r,t.major=K[r].major,t.minor=K[r].minor;r>0&&i(K[r-1].minor,n)&&r-1>o;)r--;return t.histogram=K[r].minor,t.timeRate=n,t}function l(){var e=U.clone(t.options.minScale);return e.units=N.units.hasOwnProperty(e.units)?e.units:N.units.sec,e.value=U.isNumber(e.value)?Math.round(Math.abs(e.value)):1,e}function f(){return t.options.minScale}function c(e){return t.options.sliders===e}function d(){var e,n=u(),r=K[n].max;if(c("fixed"))e=k/(1+t.freeSideFactor);else if(c("free")){r=1;var i=K[n+1].minor;e=te[i.units]*i.by}else e=k;return r*e}function g(){ee=null;for(var e=0;e<$.length;e++)q[e]=null,$[e]=null;q.length=0,$.length=0}function h(e){ee=e;var n,r;for(n=0;n<e.length;n++){var i=e[n].index||0;if(i<t.selection.maxNumber&&e[n].id){var a=U.ensureArray(e[n].id);if(a.length){$[i]=U.makeIdMap(a),q[i]=[];var o=0;for(r=0;r<H.length;r++)q[i][r]=o,H[r].id in $[i]&&(o+=H[r].v);q[i][r]=o,v(i,e[n].c)}else!a.length&&q[i]&&(q[i]=null,$[i]=null)}}}function v(e,n){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"},i=r["colour"+e];n&&O.validatergb(n)&&(i=n),t.selection["colour"+e]=i}function m(e){for(var t=0,n=H.length;n>t;){var r=t+n>>>1;H[r].t<e?t=r+1:n=r}return t}function x(e,t){for(var n=m(e),r=m(t),i={},a=n;r>a;a++)i[H[a].id]||(i[H[a].id]=1);return Object.keys(i)}function y(e,t,n){for(var r=m(e),i=m(t),a=r;i>a;a++){var o=H[a].id;P[o]=(P[o]||0)+n}}function p(){var e=Y.t1,t=Y.t2,n=_.t1,r=_.t2;n>e?y(e,Math.min(n,t),1):e>n&&y(n,Math.min(e,r),-1),t>r?y(Math.max(e,r),t,1):r>t&&y(Math.max(n,t),r,-1),_.t1=e,_.t2=t}function b(){var e=ue(),n=e?2*(e.t2-e.t1):j.max,r=j.min;return f()?r=d():t.options.minRange&&(r=Math.max(r,t.options.minRange)),n=Math.max(n,Math.floor(4*r)),r=Math.min(r,Math.floor(n/4)),{max:n,min:r}}function I(){var e=0,n=k,r=t.options.showControlBar?t.controlbar.height:0,i=ne(),a=t.options.scale.showMinor?t.bars.minor.height*i:0,o=t.options.scale.showMajor?t.bars.major.height*i:0,u=F-r,s=u-o,l=s-a,f=l-t.histogram.dy,c=f-t.histogram.topdy,d=c*t.selection.reducingFactor;V={bars:{major:{y1:s,y2:u},minor:{y1:l,y2:s}},histogram:{ybase:f,maxbarh:c,maxselh:d},x1:e,y1:l,x2:n,y2:u,width:k,height:F}}function w(){var e,n,r,i=t.selection.maxNumber,a=Q.histogram,o=N.clear(z.t1,a.units,a.by),u=m(o),s=0,l=0,f=0;for(n=0;i>n;n++)le.hasSel[n]=!!q[n],le.selvalues[n]=le.selvalues[n]||[];do{r=o>z.t2,le.x[s]=ie(o),o=N.add(o,a.units,a.by),e=m(o);var c=X[e]-X[u];for(le.value[s]=c,c>l&&!r&&(l=c),n=0;i>n;n++){var d=q[n];if(d){var g=d[e]-d[u];le.selvalues[n][s]=g,g>f&&!r&&(f=g)}}s++,u=e}while(!r);le.count=s-1,le.maxvalue=l,le.maxselvalue=f,fe=!1}function B(n){var r=ue();r&&Y.t1>=r.t1&&n<=r.t1&&!t.playingExtend&&e.trigger("start","data")}function C(t){var n=ue();n&&Y.t2<=n.t2&&t>=n.t2&&e.trigger("end","data")}function A(e){var t=[];e=U.ensureArray(e);for(var n=0;n<e.length;n++){var r=e[n];if(r.id&&r.dt)for(var i=r.id+"",a=U.ensureArray(r.dt),o=U.ensureArray(r.v),u=0;u<a.length;u++){var s=re(a[u]);if(!U.isNumber(s))throw new Error("load: invalid date in dt property. Value was: "+a[u]);var l=o[u]||1;if(!U.isNumber(l))throw new Error("load: invalid value in v property - must be numeric. Value was: "+l);t.push({id:i,t:s,v:l})}}return t}function M(){X=[0],P={},fe=!0;for(var t=0;t<H.length;t++){var r=H[t];r.t>=Y.t1&&r.t<Y.t2&&(P[r.id]=(P[r.id]||0)+1),X[t+1]=X[t]+r.v}_.t1=Y.t1,_.t2=Y.t2;var i=W.limitInnerRange(_.t1,_.t2,!0);return e.trigger("datachange"),n(),i}function Z(e){U.numberSort(e,"t")}function D(e,t){return e.id===t.id?e.v-t.v:e.id>t.id?1:-1}function G(e,t,n){t.sort(D),n.sort(D);for(var r=0,i=0;r<t.length&&i<n.length;){var a=D(t[r],n[i]);0>a?(e.push(t[r]),r++):a>0?(e.push(n[i]),i++):(e.push(t[r]),r++,i++)}for(;r<t.length;)e.push(t[r]),r++;for(;i<n.length;)e.push(n[i]),i++}function L(e,t){for(var n=[],r=0,i=0;r<e.length&&i<t.length;){var a=e[r].t,o=t[i].t;if(o>a)n.push(e[r]),r++;else if(a>o)n.push(t[i]),i++;else{var u=r,s=i;do r++;while(r<e.length&&e[r].t===o);do i++;while(i<t.length&&t[i].t===o);r===u+1&&i===s+1?(n.push(e[u]),e[u].id===t[s].id&&e[u].v===t[s].v||n.push(t[s])):G(n,e.slice(u,r),t.slice(s,i))}}for(;r<e.length;)n.push(e[r]),r++;for(;i<t.length;)n.push(t[i]),i++;return n}function R(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function S(e){var n;if(c("none"))n=e;else if(c("free")){var r=ue();if(r){var i=b();r.t2-r.t1<i.min&&(r.t1=r.t1-i.min/2,r.t2=r.t2+i.min/2),n=R(r,t.freeSideFactor)}else n=z}else n=R(e,t.fixedSideFactor);return n}function T(){var e=Y.t1,t=Y.t2;ge(Y.t1,Y.t2),e===Y.t1&&t===Y.t2||he()}function E(e){var t=S(e),n=s(t).histogram,r=N.clear(e.t1,n.units,n.by),i=N.clear(e.t2,n.units,n.by);return i!==e.t2&&(i=N.add(i,n.units,n.by)),{t1:r,t2:i}}var k,F,V,W={},U=KeyLines.Util,O=KeyLines.Rendering,N=KeyLines.DateTime,K=t.rates,H=[],X=[],Y={t1:0,t2:0},z={t1:0,t2:0},P={},_={t1:0,t2:0},j={max:315576e7,min:3e3},J=250,Q={},q=[],$=[],ee=null,te=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],ne=W.fontSizeFactor=function(){return t.options.fontSize/t.bars.defaultFontSize},re=W.extractUTC=function(e){var t;return e instanceof Date?t=N.UTCify(e):"number"==typeof e&&(t=e),t},ie=W.ttox=function(e){return V.x1+(e-z.t1)/ce()},ae=W.xtot=function(e){return z.t1+(e-V.x1)*ce()},oe=W.getClickedBar=function(e){return e>=V.bars.major.y1?"major":e>=V.bars.minor.y1?"minor":"histogram"};W.findRange=function(e,t,n){var r,i=n||oe(t),a=ae(e);return se(i,function(e,t){return t>a?(r={t1:e,t2:t,bar:i},!0):void 0}),r};var ue=W.dataRange=function(){if(H.length>0){var e=H[0].t,t=H[H.length-1].t+1;return{t1:e,t2:t}}},se=W.eachTick=function(e,t){var n,r=Q[e],i=N.clear(z.t1,r.units,r.by),a=!1;do n=N.add(i,r.units,r.by),a=t(i,n,ie(i),ie(n),r.f),i=n;while(!a&&i<=z.t2)},le={count:0,x:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},fe=!0;W.getHistogram=function(){return fe&&w(),le},W.getBounds=function(){return V},W.getInnerRange=function(){return Y},W.getOuterRange=function(){return z};var ce=W.getTimeRate=function(){return Q.timeRate};W.nextPage=function(e){var t=Y.t1,n=Y.t2,r="back"===e?-1:1,i=N.units.month;if(t===N.clear(t,i,1)&&n===N.clear(n,i,1)){var a=new Date(t),o=new Date(n),u=12*(o.getUTCFullYear()-a.getUTCFullYear())+o.getUTCMonth()-a.getUTCMonth();t=N.add(t,i,r*u),n=N.add(n,i,r*u)}else{var s=r*(n-t);t+=s,n+=s}return{t1:t,t2:n}},W.getItems=function(){return H},W.setInnerRangeSide=function(e,t){"t1"===e?B(t):C(t),Y[e]=t},W.getSideLimits=function(e){var t,n;if("t1"===e?(t=z.t1,n=Y.t2):(t=Y.t1,n=z.t2),c("fixed")){var r=n-t,i=Math.floor(.1*r);t+=i,n-=i}var a=b();"t1"===e?(t=Math.max(t,Y.t2-a.max),n=Math.min(n,Y.t2-a.min)):(t=Math.max(t,Y.t1+a.min),n=Math.min(n,Y.t1+a.max));var o=ue();return o&&("t1"===e?n=Math.min(n,o.t2):t=Math.max(t,o.t1)),{min:t,max:n}};var de=(W.hasItems=function(){return H.length>0},W.limitInnerRange=function(e,t,n){var r,i=ue(),a=n?(e+t)/2:(Y.t1+Y.t2)/2,o=b(),u=t-e;return u>o.max?(e=Math.ceil(a-o.max/2),t=Math.floor(a+o.max/2)):u<o.min&&(e=Math.floor(a-o.min/2),t=Math.ceil(a+o.min/2)),i&&(t<i.t1?(r=i.t1-t,e+=r,t+=r):e>i.t2&&(r=e-i.t2,e-=r,t-=r)),{t1:e,t2:t}});W.inMainBarOrHistogram=function(e,t){return e>=V.x1&&e<=V.x2&&t>=0&&t<=V.y2},W.load=function(e){var t=(e||{}).items,n=A(t);return Z(n),H=n,g(),M()},W.merge=function(e){var t=A(e);t.length>0&&(Z(t),H=0===H.length?t:t[0].t>H[H.length-1].t?H.concat(t):t[t.length-1].t<H[0].t?t.concat(H):L(H,t),ee&&h(ee),M())},W.offsetRanges=function(e,t){var n=Y.t1,r=Y.t2;return ge(n+(t?0:e),r+e),n!==Y.t1||r!==Y.t2},W.selection=function(e){e=U.isNullOrUndefined(e)?e:U.ensureArray(e),e&&(e.length?h(e):g()),fe=!0,n();for(var t=[],r=0;r<$.length;r++)t[r]=$[r]?Object.keys($[r]):null;return t};var ge=W.setInner=function(n,i){var a=de(n,i),o=ue();if(o&&Y.t1&&Y.t2){var u=de(n+1,i+1),s=de(n-1,i-1);B(n),a.t1<Y.t1&&s.t1===a.t1&&!t.playingExtend&&e.trigger("start","range"),C(i),a.t2>Y.t2&&u.t2===a.t2&&!t.playingExtend&&e.trigger("end","range")}var l=S(a);r(a.t1,a.t2,l.t1,l.t2)};W.setOuter=function(e,t){r(Y.t1,Y.t2,e,t)},W.updateOptions=function(){T(),I()},W.setSize=function(e,t){k=e,F=t,I()},W.fitHistogramBarsExactly=function(e){var t,n=e;do{var r=E(n);t=r.t1!==n.t1||r.t2!==n.t2,n=r}while(t);return n};var he=W.triggerTimeBarChanged=U.ratelimit(function(){e.trigger("change")},J);return W.getIdcounts=function(){return _.t1===Y.t1&&_.t2===Y.t2||p(),P},W.getRangeForIds=function(e){e=U.ensureArray(e);var t,n,r=1/0,i=-(1/0),a={};for(t=0;t<e.length;t++)a[e[t]]=!0;for(t=0;t<H.length;t++)n=H[t],a[n.id]&&(n.t<r&&(r=n.t),n.t>i&&(i=n.t));return r!==1/0?{t1:r,t2:i}:void 0},W.getIds=function(e,t){if(U.isNullOrUndefined(e)||U.isNullOrUndefined(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");var n=re(e),r=re(t);return x(n,r)},W}}(),function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.create=function(){function t(e,t,r,i,a,o,u,s,l){var f=a[u];if(!(f in r)){if(!(f in i))throw"link has end which is not in nodes list";var c=i[f];if(c.hi)throw"link has end which is hidden";r[f]=n(e,t,c,f,s,l)}return f}function n(e,t,n,r,i,a){return{id:r,x:n.x,y:n.y,size:e.nodeSize(n,t,a),fixed:i?r in i:!1,lc:0,d:n.d}}function r(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}function i(e,r,i,a,o,u,s){for(var l=o().connections({all:!1}),f={},c=[],d=0;d<l.length;d++){var g=l[d][0],h=a[g],v=t(e,r,f,i,h,g,"id1",u,s),m=t(e,r,f,i,h,g,"id2",u,s);null!==v&&null!==m&&(c.push({id1:v,id2:m,id:g}),f[v].lc+=1,f[m].lc+=1)}var x;for(x in i)if(x+="",!i[x].hi&&!f[x]){var y=n(e,r,i[x],x,u,s);f[x]=y}var p=0;for(x in f)p++;return{v:f,e:c,vcount:p}}function a(e,t){var n,r,i,a,u=0,s=[];for(n in e)if(n+="",!e[n].hasOwnProperty("c")){var l=u++;for(s.push(n+"");s.length>0;){var f=s.shift();if(!e[f].hasOwnProperty("c"))for(e[f].c=l,r=0;r<t.length;r++)i=t[r].id1+"",a=t[r].id2+"",i===f&&(t[r].c=l,s.push(a)),a===f&&(t[r].c=l,s.push(i))}}for(var c=new Array(u),d=0;d<c.length;d++)c[d]={verts:{},edges:[]};for(n in e)n+="",c[e[n].c].verts[n]=e[n];for(r=0;r<t.length;r++)c[t[r].c].edges.push(t[r]);for(var g=0;g<c.length;g++)c[g].extents=o(c[g].verts);return c}function o(e){var t,n,r,i,a=0;for(var o in e){var u=e[o+""];t=t?Math.min(t,u.x-u.size):u.x-u.size,n=n?Math.min(n,u.y-u.size):u.y-u.size,r=r?Math.max(r,u.x+u.size):u.x+u.size,i=i?Math.max(i,u.y+u.size):u.y+u.size,a++}return{x1:t,y1:n,x2:r,y2:i,c:a}}function u(e,t,n,r,i){function a(t){var n=t.origId||t.id,r={id:ie+n+"-"+k++,level:t.level-1,origId:n,x:0,y:0,c:t.c,size:10,fixed:!1,lc:t.lc,du:!0};return e[r.id]=r,i[t.c].verts[r.id]=r,F[r.id]=1,r}function o(e,n,r){var a={id:ie+n.id+"-"+r.id,id1:n.id,id2:r.id,c:e.c};return"level"in n&&"level"in r&&(a.level=Math.max(n.level,r.level)),t.push(a),i[e.c].edges.push(a),a}function u(e,t,n){var r=a(e),i=n.id1===t.id;o(n,i?r:e,i?e:r),r.level===t.level+1?o(n,i?t:r,i?r:t):u(r,t,n)}for(var s,l,f,c=[],d={},g={},h={},v=r(),m=0;m<i.length;m++){d[m]={},g[m]=[];var x=[],y=1/0;for(l in i[m].verts)s=i[m].verts[l],s.d&&ne.isNumber(s.d[n])&&(f=s.d[n],d[m][f]||(d[m][f]=[],g[m].push(f)),d[m][f].push(l),h[l]=f,y>f?(y=f,x=[l]):f===y&&x.push(l));if(0===x.length)for(l in i[m].verts){x.push(l),h[l]=0,d[m][0]=[l],g[m].push(0);break}g[m].sort(function(e,t){return e-t});var p,b=[];for(p=0;p<g[m].length;p++){var I=g[m][p];b=[];var w,B,C=v.neighbours(d[m][I]),A=g[m][p+1]||I+1,M=(A+I)/2;for(B=0;B<C.nodes.length;B++)w=C.nodes[B],ne.isNullOrUndefined(h[w])&&(b.push(w),h[w]=M);b.length&&(g[m].splice(p+1,0,M),d[m][M]=b)}for(p=0;p<g[m].length;p++)d[m][g[m][p]]=p;for(p=0;p<x.length;p++)e[x[p]].level=0;c=c.concat(x)}for(var Z,D,G,L,R,S,T,E,k=0,F={},V=0,W=t.length;W>V;V++){Z=t[V],D=ne.rawId(Z.id1),G=ne.rawId(Z.id2),L=e[D],R=e[G];var U=L.level=d[L.c][h[D]],O=R.level=d[R.c][h[G]];ne.isNumber(U)&&ne.isNumber(O)&&(Z.level=Math.max(U,O),O>U?(F[R.id]=1,E=L,T=R):U>O&&(F[L.id]=1,E=R,T=L)),S=Math.abs(U-O),S>1&&u(T,E,Z)}var N=ne.makeIdMap(c);for(l in e)if(l=ne.rawId(l),s=e[l],!F[l]&&!N[l]){for(var K,H=1/0,X=0;X<c.length;X++){var Y=v.shortestPaths(l,c[X]);Y.distance<H&&(K=Y,H=Y.distance)}for(var z=0;z<K.onePath.length;z++){var P=K.onePath[z],_=e[P];if(_&&"level"in _&&_.level<s.level){var j=o(s,s,_);s.level-_.level>1&&u(s,_,j);break}}}return t}function s(e,t,n,r){for(var i,a,o,u,s=r(),l=0;l<n.length;l++){var f=s.distances(n[l]);for(var c in f)"level"in e[c]||(e[c].level=1/0),e[c].level=Math.min(e[c].level,f[c])}for(var d=0;d<t.length;d++)i=t[d].id1,a=t[d].id2,o=e[i],u=e[a],"level"in o&&"level"in u&&(t[d].level=Math.max(o.level,u.level))}function l(e,t){function n(e,t,n,i){r[e]=r[e]||[],r[e][t]=r[e][t]||{},r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(i)}var r={};for(var i in e)"level"in e[i]&&n(e[i].c,e[i].level,"vertices",i);for(var a=0;a<t.length;a++)"level"in t[a]&&n(t[a].c,t[a].level,"edges",t[a]);return r}function f(e,t){for(var n=[],r=0;r<e.length;r++)t[e[r]]&&n.push(e[r]);return n}function c(e){var t=Number(e);return t=ne.isNumber(t)?t:5,t=Math.max(0,t),t=Math.min(10,t)}function d(e){return 10*(5-c(e))}function g(e){var t,n=0,r=0;for(var i in e)t=e[i],"level"in t&&!ae.test(t.id)&&(n+=t.size,r+=1);return n/r}function h(e){var t=0;for(var n in e)t=Math.max(t,e[n].length);return t}function v(e,t){for(var n=[],r=h(e),i=0;r>i;i++){var a=0,o=0,u=0,s=0,l=0;for(var f in e)if(e[f][i]){for(var c=e[f][i].vertices,d=0;d<c.length;d++){var g=c[d],v=t[g].size;o+=v,a=Math.max(a,v)}s+=c.length}u=o/s;var m=n[i-1];m&&a<m.max+m.yOffset&&(l=(m.max+m.yOffset)/2),n[i]={max:a,average:u,sum:o,yOffset:l}}return n}function m(e,t,n,r,i,o){function c(){var e,t,n,r=0,i=0;for(t in E)for(var a=E[t].length-1;a>=0;a--)for(var o=E[t][a].vertices,u=[],s=0;s<o.length;s++){n=o[s]+"";var l=x(E,G,n);if(G[n].children=[],G[n].subChildrenCount=0,0===l.length)r++;else{var f=[];for(e=0;e<l.length;e++)u.indexOf(l[e])<0&&f.push(l[e]);if(f.length>0)for(G[n].children=f,G[n].subChildrenCount=h(f),e=0;e<f.length;e++)u.push(f[e]),G[f[e]].parent=n}i++}}function h(e){for(var t=0,n=0;n<e.length;n++){var r=G[e[n]].subChildrenCount;t+=0===r?1:r}return t}function m(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*V/2,i=e.children;if(i)for(var a=0;a<i.length;a++){var o=G[i[a]],u=o.subChildrenCount;0===u&&(u=1);var s=r+u*V;m(o,(s+r)/2,!1),r=s}}function y(e,t,n){for(var r,i=t.miny,a=Math.PI*(2/3),o=0,u=0;u<E[e].length;u++){var s=E[e][u].vertices,l=F[u].yOffset,f=F[u].average,c=f>k?f:k,d=2*(c+12)+l;i+=o;for(var g=0;g<s.length;g++){r=s[g];var h=G[r];if(h.y=i,!n){var v=h.children;if(v&&v.length>1){var m=v.map(function(e){return G[e]}),x=b(m),y=p(x,a);d=Math.max(d,y)}}}o=d}}function p(e,t){return e/(2*Math.tan(t/2))}function b(e){for(var t=1/0,n=-(1/0),r=0;r<e.length;r++){var i=e[r].x;t=Math.min(t,i),n=Math.max(n,i)}return n-t}function I(e,t){for(var n,r={up:function(e){e.y=-e.y,e.x=e.x},down:function(e){},right:function(e){var t=e.y;e.y=e.x,e.x=t},left:function(e){var t=e.y;e.y=e.x,e.x=-t}},i=r[t]||r.down,a=0;a<E[e].length;a++)for(var o=E[e][a].vertices,u=0;u<o.length;u++)n=o[u]+"",i(G[n])}r=ne.defaults(r,{top:[],orientation:"down",stable:!0,flatten:!1});var w=r.level,A=o?1:d(r.tightness),M=r.top,Z=r.tidy,D=o?!1:r.flatten,G=t.v,L=t.e,R=t.extents,S=a(G,L);w?L=u(G,L,w,n,S):(M=f(M,G),s(G,L,M,n));var E=l(G,L),k=g(G),F=v(E,G),V=2*k+24+A;c();var W,U={},O={};for(W in E){var N=Number(W);U[N]=T(S[N].verts),O[N]={children:E[W][0].vertices,subChildrenCount:h(E[W][0].vertices)}}for(W in E)m(O[W],U[W].x,!0),y(W,U[W],D);for(W in E)o||I(W,r.orientation);o&&o(G,E,S,U,k,r.tightness);var K=[];Z?B(e,G,S,0,1,R,K,r,i):C(e,G,R,K,r,i)}function x(e,t,n){var r,i,a,o,u=t[n].c,s=t[n].level+1,l=e[u][s],f={},c=[];if(l){for(a=0;a<l.edges.length;a++){var d=l.edges[a];r=d.id1+"",i=d.id2+"",r===n&&(f[i]=1),i===n&&(f[r]=1)}var g=l.vertices;for(o=0;o<g.length;o++)r=g[o]+"",f[r]&&c.push(r)}return c}function y(e,t,n,r,i,a){function o(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function s(e,t,n,r){if(r&&1===e.length)return 0;var i=t,a=i;for(l=1;l<e.length;l++)a=Math.max(o(g[e[l]],g[e[l-1]]),a);return u(a,a-i,n)}var l,f,c,g;a=d(a);for(var h in t){var v=T(n[Number(h)].verts),m=0,x=m,y=4*i,p=y,b=2*i+24;for(f=0;f<t[h].length;f++){var I,w=t[h][f].vertices;for(g=[],l=0;l<w.length;l++){c=w[l]+"",I=e[c];var B=I.x-v.minx,C=v.maxx-v.minx+b;if(B*=2*Math.PI/C,0>B||B>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");g[c]={a:B,r:I.size}}for(x=m,0===f?w.length>1&&(m+=y/2):m+=y,m=s(w,m,a,1>f),m-x>p&&(p=m-x+1,y=Math.max(y,p/2),0===f&&w.length<3&&(m/=2)),l=0;l<w.length;l++)I=e[w[l]+""],I.x=r[Number(h)].x+m*Math.cos(g[I.id].a),I.y=r[Number(h)].y+m*Math.sin(g[I.id].a)}}}function p(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(n),a=Math.max(r,i)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var u=o*n*Math.log(n),s=1/b(t);return{repulsionFactor:40*Math.max(1,Math.pow(s,2)),coeff:1,naturalDistance:20*s,iterations:o,chunk:20,temperature:a,temp:a,estTime:u}}function b(e){var t=c(e.tightness);return Math.pow(2,2*(t-5)/5)}function I(e,t,n,r){function i(t){var n=f[t],r=y[t];G(e,n,r,r.start,r.stop,function(){R(n.verts),t++,t<f.length?ne.nextTick(function(){i(t)},0):o()})}function o(){g?B(e,u,f,x,1,c,d,n,r):C(e,u,c,d,n,r)}var u=t.v,s=t.vcount,l=t.e,f=a(u,l),c=t.extents,d=n.fixed||[],g=n.tidy;S(u);var h=f.length,v=s/(s+h),m=0,x=g?v:1;e.trigger("progress","layout",0);for(var y=[],b=0,I=0;I<f.length;I++){var w=p(f[I],n);b+=w.estTime,y.push(w)}var A=0;for(I=0;I<f.length;I++){y[I].start=A;var M=A+(x-m)*y[I].estTime/b;y[I].stop=M,A=M}f.length>0?i(0):C(e,u,c,d,n,r)}function w(e){for(var t in e)if(t+="",e[t].fixed)return!0;return!1}function B(e,t,n,r,i,a,o,u,s){for(var l={},f=[],c={},d=1/0,g=1/0,h=0;h<n.length;h++){var v=E(n[h].verts);l[h]=v;var m=o.length>0&&w(n[h].verts);f.push({x:v.x,y:v.y,width:v.width,height:v.height,id:h,fixed:m}),c[h]={x:v.x,y:v.y},d=Math.min(d,c[h].x),g=Math.min(g,c[h].y)}u=ne.defaults(u,{strategy:"rect",ratio:4/3}),J(f,{strategy:u.strategy,step:30,max:2,sort:!1,ratio:u.ratio,tightness:u.tightness},function(n){d="rect"===u.strategy?d:0,g="rect"===u.strategy?g:0;for(var r={},i=0;i<n.length;i++)r[n[i].id]=n[i],r[n[i].id].x+=d,r[n[i].id].y+=g;for(var l in t){var f=t[l+""],h=r[f.c].x-c[f.c].x,v=r[f.c].y-c[f.c].y;f.x+=h,f.y+=v}C(e,t,a,o,u,s)})}function C(e,t,n,r,i,a){var u=o(t);0===r.length&&(u=L(t,n,u)),ne.isNumber(u.x1)||(u=null),KeyLines.Util.nextTick(function(){e.trigger("progress","layout",1),a({vertices:t,extents:u},i)})}function A(e,t,n){var r=e[t.id1],i=e[t.id2];M(r,i,n)}function M(e,t,n){if(!e.fixed||!t.fixed){var r=2*oe.next()*Math.PI,i=(e.x+t.x)/2,a=(e.y+t.y)/2,o=1.3*k(e,t,n)/2;e.x=i+o*Math.cos(r),e.y=a+o*Math.sin(r),r+=Math.PI,t.x=i+o*Math.cos(r),t.y=a+o*Math.sin(r)}}function Z(e,t,n,r){var i={temperature:10,i:0},a={verts:t.v,edges:t.e},u=p(t,n);u.chunk=u.iterations=5,i.temperature=Math.pow(u.temperature,.72),D(i,a,u);var s=o(a.verts);ne.isNumber(s.x1)||(s=null),e.trigger("progress","layout",1),r({vertices:a.verts,extents:s},n,!1)}function D(e,t,n){for(var r=Math.min(e.i+n.chunk,n.iterations);e.i<r;){var i=t.verts,a=t.edges,o=0;for(var u in i)u+="",i[u].dx=i[u].dy=0,o++;if(S(i,2),1===o)return void(e.i=r);if(2===o){if(a[0])A(i,a[0],n.naturalDistance);else{var s=ne.dictValues(i);M(s[0],s[1],n.naturalDistance)}return void(e.i=r)}W(i,n.repulsionFactor);for(var l=0;l<a.length;l++)F(a[l],i,n.naturalDistance,n.coeff);var f=e.temperature*(1-e.i/n.iterations);for(var c in i)c+="",V(i[c],f);e.i++}}function G(e,t,n,r,i,a){function o(){return r+(i-r)*f.i/n.iterations}function u(){return f.i>=n.iterations}function s(){D(f,t,n)}function l(){s(),u()?a():(e.trigger("progress","layout",o()),ne.nextTick(l,0))}var f={i:0,temperature:n.temperature};l()}function L(e,t,n){var r=(n.x1+n.x2)/2-(t.x1+t.x2)/2,i=(n.y1+n.y2)/2-(t.y1+t.y2)/2;for(var a in e)a+="",e[a].x-=r,e[a].y-=i;return{x1:n.x1-r,y1:n.y1-i,x2:n.x2-r,y2:n.y2-i}}function R(e){var t,n,r,i,a=0,o=0,u=0,s=!1,l=0,f=0;for(i in e)i+="",a+=e[i].x,o+=e[i].y,u+=1,s|=e[i].fixed;if(!(3>u||s)){a/=u,o/=u;for(i in e)i+="",t=Math.sqrt((e[i].x-a)*(e[i].x-a)+(e[i].y-o)*(e[i].y-o)),t>f&&(f=t,l=Math.atan2(e[i].y-o,e[i].x-a));l=-l;var c=Math.sin(l),d=Math.cos(l);for(i in e)n=a+(e[i].x-a)*d-(e[i].y-o)*c,r=o+(e[i].x-a)*c+(e[i].y-o)*d,e[i].x=n,e[i].y=r}}function S(e,t){var n=t||30;for(var r in e)r+="",e[r].fixed||(e[r].x+=n*(oe.next()-.5),e[r].y+=n*(oe.next()-.5))}function T(e){var t,n=0,r=0,i=0,a=1/0,o=1/0,u=-(1/0),s=-(1/0);for(t in e)t+="",n+=1,r+=e[t].x,i+=e[t].y,o=Math.min(o,e[t].x),a=Math.min(a,e[t].y),u=Math.max(u,e[t].x),s=Math.max(s,e[t].y);r/=n,i/=n;var l=0,f=!1;for(t in e){t+="";var c=e[t].x-r,d=e[t].y-i,g=Math.sqrt(c*c+d*d);l=Math.max(g+1.5*e[t].size,l),f=f||e[t].fixed}return{x:r,y:i,sum:n,size:l,fixed:f,miny:a,minx:o,maxy:s,maxx:u}}function E(e,t){ne.isNullOrUndefined(t)&&(t={});var n,r=20,i=1/0,a=1/0,o=-(1/0),u=-(1/0);for(n in e)n+="",n in t||(a=Math.min(a,e[n].x-e[n].size),i=Math.min(i,e[n].y-e[n].size),o=Math.max(o,e[n].x+e[n].size),u=Math.max(u,e[n].y+e[n].size));return a-=r,i-=r,o+=r,u+=r,{x:a,y:i,width:o-a,height:u-i}}function k(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function F(e,t,n,r){var i=t[e.id1],a=t[e.id2],o=i.x-a.x,u=i.y-a.y,s=k(i,a,n),l=ne.len(o,u);if(l>.02){var f=r*(l-s)/l,c=o*f,d=u*f;i.dx-=c,i.dy-=d,a.dx+=c,a.dy+=d}}function V(e,t){if(!e.fixed){var n=ne.len(e.dx,e.dy),r=e.dx/n*Math.min(n,t),i=e.dy/n*Math.min(n,t);e.x+=r,e.y+=i}}function W(e,t){function n(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function r(e,t){var r=e.x1,a=e.y1,o=e.x2,u=e.y2,s=.5*(r+o),l=.5*(a+u),f=t.x>=s,c=t.y>=l,d=(c<<1)+f;return e.leaf=!1,f?r=s:o=s,c?a=l:u=l,e.nodes[d]||(e.nodes[d]=n(r,a,o,u)),e=e.nodes[d],i(e,t)}function i(e,t){if(!e.leaf)return r(e,t);var n=e.point;return n?Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01?r(e,t):(e.point=null,r(e,n),r(e,t)):void(e.point=t)}function a(e,t){if(!e(t))for(var n=t.nodes,r=0;4>r;r++)n[r]&&a(e,n[r])}function o(e){var t=0,n=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,i=0;4>i;i++){var a=r[i];a&&(o(a),e.charge+=a.charge,e.size+=a.size,t+=a.charge*a.cx,n+=a.charge*a.cy)}if(e.point){var u=l(e.point);e.charge+=e.pointCharge=u,e.size+=e.point.size,t+=u*e.point.x,n+=u*e.point.y}e.cx=e.charge?t/e.charge:0,e.cy=e.charge?n/e.charge:0}function u(e){if(e.point!==p){var t=e.cx-p.x,n=e.cy-p.y,r=1/ne.len(t,n);if((e.x2-e.x1)*r<b)return s(p,e,e.charge,r,t,n),w++,!0;e.point&&(s(p,e.point,e.pointCharge,r,t,n),I++)}return!e.charge}function s(e,t,n,r,i,a){r>B&&(r=B),f(e,n,i,a,r)}function l(e){return e.size*(1+(e.lc?e.lc:1)/3)}function f(e,n,r,i,a){if(!(.001>a)){var o=t*l(e)*n*a*a*a;e.dx-=r*o,e.dy-=i*o}}function c(){for(var t in e)t+="",p=e[t],a(u,C)}var d,g,h,v,m=T(e);d=m.minx,h=m.miny,g=m.maxx,v=m.maxy;var x=g-d,y=v-h;x>y?v=h+x:g=d+y;var p,b=.5,I=0,w=0,B=1e5,C=n(d,h,g,v);for(var A in e)A+="",i(C,e[A]);return o(C),c(),C}function U(e,t,n,r,i,a){r?e[t]=n[t]:e[t]={x:i,y:a}}function O(e,t,n,r){var i=1.25-(c(n.tightness)-5)/10,a=K(t.v,t.e),o=N(a,t.v,i);I(e,o,n,function(e,n,i){var o={};for(var u in e.vertices)if(u+="",a.rev[u])for(var s=e.vertices[u].fixed,l=0;l<a.rev[u].length;l++){var f=a.rev[u][l],c=e.vertices[u].x,d=e.vertices[u].y;e.vertices[u].jit.positions&&(c+=e.vertices[u].jit.positions[f].x,d+=e.vertices[u].jit.positions[f].y),U(o,f,t.v,s,c,d)}else U(o,u,t.v,t.v[u].fixed,e.vertices[u].x,e.vertices[u].y);var g={vertices:o,extents:e.extents};r(g,n,i)})}function N(e,t,n){var r={},i=[],a=0;for(var u in e.rev){u+="";var s={};s.x=s.y=s.size=0;for(var l=e.rev[u].length,f=!1,c=0;l>c;c++){var d=t[e.rev[u][c]];s.x+=d.x,s.y+=d.y,s.size+=d.size}s.x=s.x/l,s.y=s.y/l;var g=P(t,e.rev[u],s.size/l,n);r[u]={x:s.x,y:s.y,size:g.radius,fixed:f,jit:g,lc:0},a++;for(var h=e.rev[u][0],v={},m=e.index[h],x=0;x<m.length;x++){var y=m[x];v[e.ids[y]]=1}for(var p in v)p+="",p>u&&i.push({id1:u,id2:p})}for(var b,I,w=0;w<i.length;w++)b=i[w].id1+"",I=i[w].id2+"",r[b].lc++,r[I].lc++;for(var B in t)if(B+="",!e.ids[B]){var C=t[B];r[B]={x:C.x,y:C.y,size:C.size,lc:0,fixed:C.fixed,jit:{radius:C.size,position:{x:0,y:0}}},a++}return{v:r,e:i,vcount:a,extents:o(r)}}function K(e,t){var n=Y(t);return z(n)}function H(e,t,n){e[n]||(e[n]=[]),e[n].push(t)}function X(e,t){H(e,t.id1,t.id2),H(e,t.id2,t.id1)}function Y(e){for(var t={},n=0;n<e.length;n++)X(t,e[n]);return t}function z(e){var t,n={},r={};for(var i in e){i+="",e[i].sort(),t="";for(var a=0;a<e[i].length;a++)t+=e[i][a];n[t]||(n[t]=[]),n[t].push(i),r[i]=t}return{rev:n,ids:r,index:e}}function P(e,t,n,r){var i,a={},o=0,u=t.length-1;do i=_(e,t,n,u,a,r),o=Math.max(i.radius,o),u=i.index;while(u>=0);var s;switch(t.length){case 4:s=2;break;case 3:s=2.5;break;case 2:s=3;break;case 1:s=1;break;default:s=2}return{positions:a,radius:o*s}}function _(e,t,n,r,i,a){if(0===r)return i[t[0]]={x:0,y:0},{radius:n,index:-1};var o=(r+1)*n,u=n,s=Math.sqrt(o/(Math.PI*u)),l=s*u,f=Math.floor(2*Math.PI*l/n);f=Math.min(f,r+1);var c=2*Math.PI/f,d=0;switch(f){case 2:d=Math.PI/2,l=.75*l;break;case 3:d=Math.PI/3,l=.85*l;break;case 4:d=0,l=.85*l;break;case 5:d=0,l=.9*l;break;default:d=0}l*=a;for(var g=0;f>g;)i[t[r-g]]={x:l*Math.cos(d),y:l*Math.sin(d)},d+=c,g++;return r-=f,{radius:l,index:r}}function j(e,t,n,r){var i,a=0,o={};for(i=0;i<t.length;i++)a+=e[t[i]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var u=Math.PI/4;2===t.length&&(u=Math.PI/2),4===t.length&&(u=0),t.length<4&&(a=1.5*a);var s=2*Math.PI/t.length,l=r*a/4;for(i=0;i<t.length;i++)o[t[i]]={x:l*Math.cos(u),y:l*Math.sin(u)},u+=s}return{positions:o,radius:a}}function J(e,t,n){function i(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function a(e,t,n){return(t-e)*n+e}function o(e,t,n){return(e-n)/(t-n)}function u(e){var n=function(){for(var t=0,n=-(1/0),r=0;r<e.length;r++)t+=e[r].width*e[r].height,n=Math.max(n,e[r].width);return{area:t,maxWidth:n}},r=1.1,i=1.03,a=10,o=n(),u=Math.sqrt(o.area*r/t.ratio)*i,s=u*t.ratio;return s<o.maxWidth+a&&(s=o.maxWidth+a),{x:0,y:0,width:s,height:u}}function s(e,t,n,r,i,u){var s=o(t,n,r);return s=Math.pow(s,e),a(u,i,s)}function l(e,t){if(!t)return!1;var n=e.x<m.x+m.width,r=e.x+e.width>m.x,i=e.y<m.y+m.height,a=e.y+e.height>m.y;return n||r&&i||a}function f(e,t){function n(e,t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(e,t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}if(t.length<1)return!1;var i,a;for(i=0;i<t.length;i++)if(a=t[i],r(e,a)&&n(e,a))return!0;return!1}var c,d,g,h={spiral:function(e){var t=s(.6,e,100,0,p,1),n=s(1,e,600,0,.3,.5),r=n*e,i=Math.cos(r)*t,a=Math.sin(r)*t;return{x:i,y:a}},controlled:function(e,t){for(var n;!l(t,n);)n=h.random(e);return n},rect:function(e){return Q(e,t,n)},random:function(e){var t=.5*e;return{x:i()*t,y:i()*t}}},v=0,m=u(e),x=[],y=h[t.strategy]||h.rect,p=0;for(c=0;c<e.length;c++)d=e[c],p+=d.width;if(p/=2*e.length,"rect"===t.strategy)return y(e);for(e.sort(r),c=0;c<e.length;c++){for(d=e[c],d.x=d.fixed?d.x:0,d.y=d.fixed?d.y:0;f(d,x)&&!d.fixed;)g=y(v,d),d.x=g.x,d.y=g.y,v++;x.push(d)}return n(x)}function Q(e,t,n){function i(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function a(e,t){var n=r(e,t);return n?n:t.height-e.height}function o(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function u(e){for(var n=ne.clone(e),r=0;r<n.length;r++){var i=n[r].width%t.step,a=n[r].height%t.step;0!==i&&(n[r].width=n[r].width+(t.step-i)),0!==a&&(n[r].height=n[r].height+(t.step-a))}return n}function s(e){return h?e.ratio()>=t.ratio-.2&&e.ratio()<=t.ratio:!0}function l(e){for(var n=d(t.tightness),r=0;r<e.length;r++)e[r].width+=n,e[r].height+=n}function f(e,n){var r=1.1,i=1.03,a=10,o=Math.sqrt(e.area()*r/t.ratio)*i,u=o*t.ratio;return u<e.maxWidth+a&&(u=e.maxWidth+a),{width:u,height:o,lowestFreeHeightDeficit:0,ratio:function(){return m.width/m.height}}}t=ne.defaults(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),t.sort&&e.sort(a),l(e);var c,g=u(e),h=!0;if(0===e.length)return c=$(),n(c.comps);var v={area:i,maxWidth:o(g),maxHeight:g[0].height},m=f(v,g),x=0;ne.asyncWhile(function(){return m.width>=v.maxWidth},function(){var e=q(g,m);if(0===e.comps.length)m.width*=1.03,m.height*=1.03;else{if(x++,(!c||s(e))&&(c=e,c.efficiency=v.area()/e.area(),s(e)))return!0;if(x>=t.max)return!0}},function(){return n(c.comps)})}function q(e,t){var n,r=$();t.canvas||(t.canvas=ee());for(var i=t.canvas.setDimensions(t.width,t.height),a=0,o=0,u=0;u<e.length;u++){var s=e[u];if(n=i.addRect(s.width,s.height),!n.placed){r.width=0,r.height=0,r.comps.length=0,r.lowestHeightFlushedRightItem=0;break}s.x=n.offsetX,s.y=n.offsetY,r.comps.push(s),s.y+s.height>r.height&&(r.height=s.y+s.height),s.x+s.width>r.width&&(r.width=s.x+s.width);var l=s.width+s.x;(l>o||l===o&&s.height>a)&&(r.lowestHeightFlushedRightItem=n.lfhd,a=s.height,o=l)}return t.lowestFreeHeightDeficit=i.lfhDeficitSinceLastRedim(),r}function $(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function ee(){function e(e,t){var n=f.height-e;return t-n}function t(e,t,n){if(n.leftOverW>0){f.cells+=s.rows();var r=e+n.nRequiredCellsH-1;s.insertCol(r,n.leftOverW)}if(n.leftOverH>0){f.cells+=s.cols();var i=t+n.nRequiredCellsV-1;s.insertRow(i,n.leftOverH)}for(var a=e+n.nRequiredCellsH-1;a>=e;a--)for(var o=t+n.nRequiredCellsV-1;o>=t;o--)s.setItem(a,o,!0)}function n(e,t,n,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var i,a=0,o=0,u=t;o<n.height;){for(i=e,a=0;a<n.width;){if(s.item(i,u))return!1;a+=s.colWidth(i),i++}o+=s.rowHeight(u),u++}return r.nRequiredCellsH=i-e,r.nRequiredCellsV=u-t,r.leftOverW=a-n.width,r.leftOverH=o-n.height,!0}function r(e,t,n){var r=0,i=0,a=0,o=0,u=0;for(a=0;e>a;a++)r+=s.colWidth(a);for(a=0;t>a;a++)i+=s.rowHeight(a);if(o=n.x-r,u=n.y-i,0>o||0>u)return!1;if(o>0){f.cells+=s.rows();var l=s.colWidth(e)-o;s.insertCol(e,l)}if(u>0){f.cells+=s.cols();var c=s.rowHeight(t)-u;s.insertRow(t,c)}return!0}function i(e,t){return f.width=e,f.height=t,f.area=o(),s.init(e,t,!1),f}function a(i,a,o){var u={offsetX:0,offsetY:0,width:i,height:a,placed:!1},c=0,d=0,g=0,h=0,v={};if(o){for(;c<s.cols()&&g<o.x;)g+=s.colWidth(c),
c++;for(;d<s.rows()&&h<o.y;)h+=s.rowHeight(d),d++;r(c-1,d-1,o),g-=s.colWidth(c),h-=s.rowHeight(d)}f.addAttempts++;for(var m=ue;;){for(v={};d<s.rows()&&s.item(c,d);)h+=s.rowHeight(d),d++;if(d<s.rows()&&e(h,u.height)<=0){if(n(c,d,u,v)){t(c,d,v),u.offsetX=g,u.offsetY=h,u.placed=!0;break}h+=s.rowHeight(d),d++}var x=e(h,u.height);if(x>0&&(h=0,d=0,g+=s.colWidth(c),c++,f.lfhDeficitSinceLastRedim()>x&&(l=x)),f.width-g<u.width){u.placed=!1;break}}return m=l,{offsetX:u.offsetX,offsetY:u.offsetY,lfhd:m,placed:u.placed}}function o(){return f.width*f.height}var u=0,s=te(),l=ue,f={matrix:s,cells:u,addAttempts:0,addRect:a,lfhDeficitSinceLastRedim:function(){return l},setDimensions:i};return f}function te(){function e(){(a.length>0||o.length>0)&&(a.length=o.length=u.length=0)}function t(t,n,r){if(0>=t)throw"[Matrix] Column size cannot be 0 or similar";if(0>=n)throw"[Matrix] Row size cannot be 0 or similar";return s=1,l=1,e(),a.push({index:0,size:t}),o.push({index:0,size:n}),u[0]=[],u[0][0]=r,f}function n(e,t){for(var n=o[e].index,r=0;l>r;r++)u[r][s]=u[r][n];return s-1>e&&o.splice(e+1,0,{index:s,size:t}),o[e+1]={index:s,size:t},o[e].size-=t,s++,f}function r(e,t){var n=(u[0].length,a[e].index);return u[l]=ne.clone(u[n]),l-1>e&&a.splice(e+1,0,{index:l,size:t}),a[e+1]={index:l,size:t},a[e].size-=t,l++,f}function i(){var e,t,n,r="\n     ",i=0,u=0;for(i=0;l>i;i++)e=Math.floor(a[i].size/100)%10===0?" ":""+Math.floor(a[i].size/100)%10,t=Math.floor(a[i].size/10)%10===0&&" "===e?" ":""+Math.floor(a[i].size/10)%10,n=Math.floor(a[i].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(a[i].size)%10,r+=a[i].size>999?" "+a[i].size+" ":" "+e+t+n+" ";for(r+="\n",i=0;s>i;i++){for(e=Math.floor(o[i].size/100)%10===0?" ":""+Math.floor(o[i].size/100)%10,t=Math.floor(o[i].size/10)%10===0&&" "===e?" ":""+Math.floor(o[i].size/10)%10,n=Math.floor(o[i].size)%10===0&&" "===e&&" "===t?" ":""+Math.floor(o[i].size)%10,r+=o[i].size>999?" "+o[i].size+": ":" "+e+t+n+": ",u=0;l>u;u++)r+=f.item(u,i)?"  X  ":"  .  ";r+="\n"}return r}var a=[],o=[],u=[],s=0,l=0,f={init:t,cols:function(){return l},rows:function(){return s},item:function(e,t){return u[a[e].index][o[t].index]},setItem:function(e,t,n){u[a[e].index][o[t].index]=n},insertRow:n,insertCol:r,colWidth:function(e){return a[e].size},rowHeight:function(e){return o[e].size},inspect:i};return f}var ne=KeyLines.Util;e.createLens(c);var re={},ie=(re.extractStructure=function(e,t,n,r,a,u,s){var l=null;if(u){l={};for(var f=0;f<u.length;f++)l[u[f]]=1}var c=i(e,t,n,r,a,l,s);return c.extents=o(c.v),c},"_dummy"),ae=RegExp("^"+ie),oe=ne.Randomiser();re.layout=function(t,n,r,i,a,o){n.trigger("prechange","layout");var u="^(standard|hierarchy|lens";u+="|radial|structural|tweak",u+=")$";var s=new RegExp(u);if(!s.test(t))throw new Error("The layout name is not valid.");var l=ne.makeIdMap(["standard","structural"]);if(oe.setSeed(null),l[t]||a.consistent){var f,c=ne.ensureArray(a.fixed||[]),d=ne.makeIdMap(a.fixed),g=0,h=0;if(c.length){for(f in d)f in r.v&&(g+=r.v[f].x,h+=r.v[f].y);g/=c.length,h/=c.length}for(f in r.v)d[r.v[f].id]||(r.v[f].x=g,r.v[f].y=h)}a.consistent&&oe.setSeed(900736044081),"standard"===t&&I(n,r,a,o),"hierarchy"===t&&m(n,r,i,a,o),"lens"===t&&e.lens(n,r,a,C,oe,o),"structural"===t&&O(n,r,a,o),"radial"===t&&m(n,r,i,a,o,y),"tweak"===t&&Z(n,r,a,o)};re.arrange=function(e,t,n,r,i,o){function u(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function s(e,t,n,r,i){var a;for(a=0;a<e.length;a++)if(e[a].id===t){e[a].x=n-e[a].width/2,e[a].y=r-e[a].height/2;break}return i(e)}function l(e,t,n,r,a){var o={},u=[],s={};for(c=0;c<e.length;c++)s=E(e[c].verts,t),isFinite(s.width)&&(u.push({x:s.x,y:s.y,width:s.width,height:s.height,id:c}),o[c]={x:s.x,y:s.y});s=E(t),u.push({x:s.x,y:s.y,width:s.width,height:s.height,id:x}),o[x]={x:s.x,y:s.y},b(u,{ratio:i.ratio,centre:n,absolute:r,specialId:x},function(e){return a({packed:e,original:o})})}function f(e,t,n){var r,i;for(var a in e){var o=e[a+""];o.arranged?(r=n[x].x-t[x].x,i=n[x].y-t[x].y):(r=n[o.c].x-t[o.c].x,i=n[o.c].y-t[o.c].y),o.x+=r,o.y+=i}}var c,g,h,v={tidy:function(e,t,n){return Q(e,{step:30,max:2,sort:!1,ratio:t.ratio},n)},average:function(e,t,n){return s(e,t.specialId,t.centre.x,t.centre.y,n)},absolute:function(e,t,n){return s(e,t.specialId,t.absolute.x,t.absolute.y,n)}},m={grid:function(e,t,n,r){var i=2*n+24+r,a=0,o=0,u=Math.floor(Math.sqrt(e.length)),s=Math.ceil(e.length/u),l={};for(c=0;u>c;c++){for(g=0;s>g;g++){var f=s*c+g;e[f]&&(l[e[f]]={x:a,y:o}),a+=i}a=0,o+=i}return l},circle:function(e,t,n,r){var i=1.25-(5-r)/50;return j(t,e,n,i).positions},radial:function(e,t,n,r){var i=1.25-(5-r)/50;return P(t,e,n,i).positions}},x="#arranged#";i=ne.defaults(i,{tightness:5,position:"average",x:0,y:0}),t.trigger("prechange","arrange");var y=r.v,p=d(i.tightness),b=v[i.position]||v.average,I=m[e]||m.grid,w={x:Number(i.x)||0,y:Number(i.y)||0},B={x:0,y:0};if(n=ne.ensureArray(n),n=u(y,n),!n.length)return o();for(h=0,c=0;c<n.length;c++)h+=y[n[c]].size,B.x+=y[n[c]].x,B.y+=y[n[c]].y;h/=n.length,B.x/=n.length,B.y/=n.length;var A=I(n,y,h,p),M={};for(var Z in A)Z+="",y[Z].x=A[Z].x,y[Z].y=A[Z].y,M[Z]=y[Z],M[Z].arranged=1;var D=a(y,r.e);l(D,M,B,w,function(e){for(var n=e.packed,a=e.original,u={},s=0;s<n.length;s++)u[n[s].id]=n[s];f(y,a,u);var l=[],c=r.extents;C(t,y,c,l,i,o)})};var ue=16e6;return re}}(),function(){"use strict";var e=KeyLines.Generator={};e.create=function(e){function t(){return he||we.colours.white}function n(e){return Math.abs(e)<1e-5}function r(e,t,n,r,i,a,o){return{x:((a-r)*n-(o-i)*t)/e,y:((a-r)*t+(o-i)*n)/e}}function i(e){return e.hasOwnProperty("t")&&e.t}function a(e,t,i,a,o,u,s,l,f,c){var d=r(t,i,a,o,u,s,l),g=r(t,i,a,o,u,f,c);e/=t;var h=e/2;if(d.y>h&&g.y>h||d.y<-h&&g.y<-h)return NaN;if(n(g.y-d.y))return Math.max(d.x,g.x);var v,m=d.y>g.y?d:g,x=d.y>g.y?g:d;v=h<m.y?m.x-(m.y-h)*(m.x-x.x)/(m.y-x.y):m.x;var y;return y=x.y<-h?x.x-(x.y- -h)*(x.x-m.x)/(x.y-m.y):x.x,Math.max(v,y)}function o(e,t,n,r,i,o,u,s){for(var l=-(1/0),f=u.length,c=0;f>c;c+=2){var d=(c+2)%f,g=a(e,t,n,r,i,o,u[c]+s.x,u[c+1]+s.y,u[d]+s.x,u[d+1]+s.y);Be.isNaN(g)||(l=Math.max(l,g))}return l}function u(e,t,n,r,i,a,u,s){return o(e,t,n,r,i,a,[u.x1,u.y1,u.x2,u.y1,u.x2,u.y2,u.x1,u.y2],s)}function s(e,t,n,r,i,a,o,u){var s=-(1/0),l=o.cx+u.x-i,f=o.cy+u.y-a,c=t*t,d=-2*t*(l*r-f*n),g=l*l+f*f-o.r*o.r,h=d*d-4*c*g;return h>=0&&(s=(-d+Math.sqrt(h))/(2*c)),s}function l(e,t,n,r,i,a){for(var l,f=-(1/0),c=Math.sin(-n),d=Math.cos(-n),g=a._cl,h=0;h<g.length;h++){var v=g[h];l=v.length?o(e,t,c,d,r,i,v,a):v.r?s(e,t,c,d,r,i,v,a):u(e,t,c,d,r,i,v,a),f=Math.max(f,l)}return f}function f(e,t,n,r,i,a){var o=0;return r._c&&(o=r._c/t),r._cl&&(o=Math.max(o,l(e,t,n,i,a,r))),o}function c(e,t,r,i,a,o,u,s,l,c,d){var g={},h=r-e,v=i-t,m=Math.sqrt(h*h+v*v);if(n(m))g.skip=!0;else{var x=Math.atan2(v,h),y=f(de&&s?0:a,m,x,o,e,t),p=f(de&&l?0:a,m,x+Math.PI,u,r,i);c=c||0,d=d||0,y=Math.max(c,y),p=Math.max(d,p);var b=1-(y+p),I=0;(s||l)&&(I=S(a)/m,s&&l&&(I=1.5*I)),g.skip=b<Math.max(.1,I),g.skip||(g.cx1=e+y*h,g.cy1=t+y*v,g.cx2=r+p*-h,g.cy2=i+p*-v)}return g}function d(e,t,n,r,i,a,o){var u=[],s=a-r,l=o-i,f=r-e,c=i-t,d=s*s+l*l,g=2*(s*f+l*c),h=f*f+c*c-n*n,v=g*g-4*d*h;if(v>=0){var m=Math.sqrt(v),x=(-g-m)/(2*d),y=(-g+m)/(2*d);if(x>=0&&1>=x){var p=r+x*s,b=i+x*l;u.push(Math.atan2(b-t,p-e))}if(y!==x&&y>=0&&1>=y){var I=r+y*s,w=i+y*l;u.push(Math.atan2(w-t,I-e))}}return u}function g(e,t,n,r,i,a){var o=r-t;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(e-n>u||s>e+n)return[];var l=Math.asin(o/n),f=n*Math.cos(l),c=[];return e-f>=s&&u>=e-f&&c.push(o>0?Math.PI-l:-Math.PI-l),e+f>=s&&u>=e+f&&c.push(l),c}function h(e,t,n,r,i,a){var o=r-e;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(t-n>u||s>t+n)return[];var l=Math.acos(o/n),f=n*Math.sin(l),c=[];return t-f>=s&&u>=t-f&&c.push(-l),t+f>=s&&u>=t+f&&c.push(l),c}function v(e,t,n,r,i,a){for(var o=[],u=0;u<r.length;u+=2){var s=(u+2)%r.length,l=d(e,t,n,r[u]+i,r[u+1]+a,r[s]+i,r[s+1]+a);o=o.concat(l)}return o}function m(e,t,n,r,i,a){var o=g(e,t,n,r.y2+a,r.x1+i,r.x2+i),u=g(e,t,n,r.y1+a,r.x1+i,r.x2+i),s=h(e,t,n,r.x1+i,r.y1+a,r.y2+a),l=h(e,t,n,r.x2+i,r.y1+a,r.y2+a);return o.concat(u,l,s)}function x(e,t,n,r,i){for(var a=Math.PI,o=0;o<t.length;o++)t[o]+2*Math.PI<r&&(t[o]+=2*Math.PI),n<t[o]&&t[o]<r&&(i?t[o]-e<a&&(e=Math.max(e,t[o])):e-t[o]<a&&(e=Math.min(e,t[o])));return e}function y(e,t,n,r,i,a,o){var u,s=o?r:i;if(a._c&&(u=Ee(e,t,n,a.x,a.y,a._c),s=x(s,u,r,i,o)),a._cl)for(var l=0;l<a._cl.length;l++){var f=a._cl[l],c=a.x,d=a.y;u=f.length?v(e,t,n,f,c,d):f.r?Ee(e,t,n,c+f.cx,d+f.cy,f.r):m(e,t,n,f,c,d),s=x(s,u,r,i,o)}return s}function p(e,t,n,r,i,a,o,u){var s=y(t,n,r,i,a,e>0?o:u,!0),l=y(t,n,r,s,a,e>0?u:o,!1);return{startangle:s,endangle:l}}function b(e,t){var n=t(e.id),r=Te(e),i=Y("b",e,n),a=Y("c",e,n);return!(!i&&!a||r)}function I(e,t,n,r,i,a,o,u,s,l,f,c,d,g,h,v,m){var x=u===s;a=+(a||0),x&&(a+=ke*u._sl.e);var y=a>0;if(x){var I=(u._sl.w?180:225)*Math.PI/180,w=Math.cos(I),B=Math.sin(I),C=.5;l=c=u.x+u._sl.x,f=d=u.y+u._sl.y;var M=-u._sl.e*ke/2;l+=w*M+B*C,f+=B*M-w*C,c+=w*M-B*C,d+=B*M+w*C}var Z=(l+c)/2,D=(f+d)/2,G=c-l,L=d-f,R=Math.max(.001,L*L+G*G),T=Math.sqrt(R),k=+(R/4+a*a)/(2*Math.abs(a)),F=k-Math.abs(a);if(k>1e5)return A(e,t,n,r,i,o,u,s,l,f,c,d,g,h,v,m);var V=y?1:-1,W=Z-L*V*F/T,U=D+G*V*F/T,O=Math.atan2(f-U,l-W),N=Math.atan2(d-U,c-W),K=y?O:N,H=y?N:O;K>H&&(H+=2*Math.PI),r=r||0,i=i||0;var X=K+(y?r:i)*(H-K),Y=K+(y?1-i:1-r)*(H-K),z=p(a,W,U,k,K,H,u,s);if(z.startangle=Math.max(X,z.startangle),z.endangle=Math.min(Y,z.endangle),!(z.startangle>=z.endangle)){var P=(z.startangle+z.endangle)/2,_={};_.lx=W+k*Math.cos(P),_.ly=U+k*Math.sin(P);var j,J,Q,q,$,ee,te=.9*S(h)/k,ne=-.25;return t?(j=y?z.startangle:z.endangle,J=W+k*Math.cos(j),Q=U+k*Math.sin(j),y?z.startangle+=te:z.endangle-=te):de&&b(u,m)&&(y?z.startangle+=ne*te:z.endangle-=ne*te),n?(q=y?z.endangle:z.startangle,$=W+k*Math.cos(q),ee=U+k*Math.sin(q),y?z.endangle-=te:z.startangle+=te):de&&b(s,m)&&(y?z.endangle-=ne*te:z.startangle+=ne*te),z.startangle<z.endangle&&(e.arc(W,U,k,z.startangle,z.endangle,g,h,o,v),t&&E(e,W,U,k,J,Q,y,h,g,o+Me+"a1"),n&&E(e,W,U,k,$,ee,!y,h,g,o+Me+"a2")),_}}function w(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function B(e,t){var n,r=Xe,i=(e.e||1)*et;return n=t.x>e.x&&"e"===e.sh?e.x+i*r:t.x<e.x&&"w"===e.sh?e.x-i*r:e.x}function C(e,t,n,r,i,a,o,u,s,l,c,d,g,h){var v,m,x=B(u,s),y=B(s,u),p=a||0;y>x?(v=x+ve,m=y-ve,v>m&&(v=m=(x+y)/2)):(v=x-ve,m=y+ve,m>v&&(v=m=(x+y)/2));var b=w(x,l,v,p),I=w(v,p,m,p),C=w(m,p,y,c),A=b+I+C,M=Math.atan2(p-l,v-x),Z=Math.atan2(p-c,m-y),D=0===b?0:f(g,b,M,u,x,l),G=0===C?0:f(g,C,Z,s,y,c);r=0===b?0:(r||0)*A/b,i=0===C?0:(i||0)*A/C,D=Math.min(1,Math.max(r,D)),G=Math.min(1,Math.max(i,G));var L,R,S,E,k,F,V,W,U=x+D*(v-x),O=l+D*(p-l),N=y+G*(m-y),K=c+G*(p-c);t&&(k=U,F=O,L=v-U,R=p-O,S=Math.max(.001,R*R+L*L),E=Math.sqrt(S),U+=1.5*g*L/E,O+=1.5*g*R/E),n&&(V=N,W=K,L=m-N,R=p-K,S=Math.max(.001,R*R+L*L),E=Math.sqrt(S),N+=1.5*g*L/E,K+=1.5*g*R/E),e.line3(U,O,v,p,m,p,N,K,d,g,o,h),t&&T(e,k,F,g,M+Math.PI,d,o+Me+"a1"),n&&T(e,V,W,g,Z+Math.PI,d,o+Me+"a2");var H={above:!0,lx:(v+m)/2,ly:(p+p)/2};return H}function A(e,t,n,r,i,a,o,u,s,l,f,d,g,h,v,m){var x=c(s,l,f,d,h,o,u,t,n,r,i);if(!x.skip){var y,p,I,w,B,C,A=x.cx1,M=x.cy1,Z=x.cx2,D=x.cy2,G=Z-A,L=D-M,R=Math.max(.001,L*L+G*G),S=Math.sqrt(R),E=.25;t?(y=Math.atan2(L,G),I=A,w=M,A+=1.5*h*G/S,M+=1.5*h*L/S):de&&b(o,m)&&(A-=E*h*G/S,M-=E*h*L/S),n?(p=Math.atan2(L,G),B=Z,C=D,Z-=1.5*h*G/S,D-=1.5*h*L/S):de&&b(u,m)&&(Z+=E*h*G/S,D+=E*h*L/S),e.line(A,M,Z,D,g,h,a,v),t&&T(e,I,w,h,y+Math.PI,g,a+Me+"a1"),n&&T(e,B,C,h,p,g,a+Me+"a2");var k={};return k.lx=(A+Z)/2,k.ly=(M+D)/2,k}}function M(e,t,n,r,i,a,o,u,s,l,f){function c(e){for(var t=n.length-1,i=r;t>=0;t--)e(n[t],i),t>0&&(i-=L(n[t-1],n[t])*a)}if(n=n||[],o){for(var d=0,g=0;g<n.length-1;g++)d+=L(n[g],n[g+1])*a;r+=d/2}else r-=n.length>0?G(n[n.length-1])*a:G({});if(f){var h=r;if(n.length>0){c(function(e,t){h=t});var v=n[0].e||1;h-=v*a*ke/2,f._sl.e*=v}f._sl.x=h-f.x,f._sl.y=i-f.y,f._sl.w=!0}o&&u&&c(function(t,n){e.circle(n,i,D(t)*a*1.25,we.colours.white,-1,Re(),!0,l)}),c(function(n,r){ne(e,t,l+Me+g,r,i,a,n,s,f)})}function Z(e,n,r,a,o,u,s){function l(e){return d&&pe&&ye.hasOwnProperty(e)?ye[e]:r[e]}if(!r.hi){r._edit=null;var f,c=r.id,d=s(c),g=d&&!pe,h=l("b1"),v=l("b2"),m=l("c"),x=l("fb"),y=l("fbc"),p=l("fc"),b=l("ff"),w=l("fs"),B=l("ls"),Z=l("w"),D=a.x,G=a.y,L=o.x,R=o.y,S=(Z||1)*et,T=m||we.colours.midgrey,E=0;f="h"===r.st?C(n,r.a1,r.a2,h,v,r.y,c,a,o,G,R,T,S,B):r.off||a===o?I(n,r.a1,r.a2,h,v,r.off,c,a,o,D,G,L,R,T,S,B,s):A(n,r.a1,r.a2,h,v,c,a,o,D,G,L,R,T,S,B,s);var F=f?f.lx:(D+L)/2,V=f?f.ly:(G+R)/2;if(r._x=F,r._y=V,f){var O=f.lx,N=f.ly,H=O,X=N,Y=Se(r);w=Number(w||Ce)*et;var z=!1,P=p||we.colours.black,_=y||we.colours.textback;g&&(P=t(),_=Re());var j=W(r),J=U(j,e,w,x,b),Q=w+3*et;E=Q*j.length,j.length>0&&(H-=J[0]/2);for(var q=(j.length-1)*Q,$=f.above?N-(q+Q/2+S/2):N-q/2,ee=0;ee<j.length;ee++){0===ee&&(X=$);var te=K(e,n,j[ee],O,$,c,!0,P,_,x,r,!1,!0,99,J[ee],g,w,b||se);z=z||te,$+=Q}var ne=!i(r)||!z;if(ne&&g&&!Y){var re=Math.max(.66*(Z||0),w/2);n.circle(O,N,re,we.colours.white,-1,Re(),!0,c)}Y&&M(n,e,r.g,H,X,1,ne,g,u,c),r.bu&&oe(n,e,c,O,N,E/2+4,1,r.bu,u)}k(a,"id1",c,D,G,n,S,T),k(o,"id2",c,L,R,n,S,T)}}function D(e){var t=We;return $(e)&&(t+=Ue/2),e.e&&(t*=e.e),t}function G(e){return D(e)+Fe}function L(e,t){return D(e)+Ve+D(t)}function R(e){return 1.7*e+et*("small"===ue?6:10)}function S(e){return Ne*R(e)}function T(e,t,n,r,i,a,o){var u=R(r),s=i+Math.PI;e.triangle(t+u*Math.cos(s+Oe),n+u*Math.sin(s+Oe),t+u*Math.cos(s-Oe),n+u*Math.sin(s-Oe),t,n,a,-1,a,!0,o)}function E(e,t,n,r,i,a,o,u,s,l){var f=S(u),c=Ee(i,a,f,t,n,r);if(2===c.length){var d=o?c[0]:c[1];T(e,i,a,u,d-Math.PI,s,l)}}function k(e,t,n,r,i,a,o,u){e.du&&a.circle(r,i,1.5*o,u,o,we.colours.white,!0,n+Me+t)}function F(e){return Le.showFullLabel&&Le.showFullLabel===e}function V(e){return be&&("node"===e.type||"link"===e.type)&&e.t.length>be&&!F(e.id)}function W(e){if(e.t){var t=e.t+"";return V(e)&&(t=t.substring(0,be-3)+"..."),t.split(/\r\n|\r|\n/)}return[""]}function U(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=we.measureText(t,e[o],n,r,i||se).width;return a}function O(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function N(e,t,n,r,i,a,o,u,s,l,f,c,d,g,h,v,m){var x=we.measureText(e,n,v,l,m).width;return K(e,t,n,r,i,a,o,u,s,l,f,c,d,g,x,h,v,m)}function K(e,t,n,r,i,a,o,u,s,l,f,c,d,g,h,v,m,x){var y=!0;0===n.length&&(y=!1);var p=a+Me+"t";if(c&&h>g)return N(e,t,n,r,i,a,o,u,s,l,f,c,d,g,v,.85*m,x);var b,I=4*et,w=r-h/2;b=d?i+1+m/2:i+(1+m)/2;var B={x1:w-I,y1:b-m,x2:w+h+I,y2:b};if(y){var C=d?Ge:0;t.text(r,b+C,n,u,m,l,p,x,!0,h,!1,o,B.x1,B.y1,B.x2,B.y2,s,v,I)}return f&&"node"===f.type&&(B.x1=B.x1-f.x,B.y1=B.y1-f.y,B.x2=B.x2-f.x,B.y2=B.y2-f.y),f&&H(f,B,m,y),y}function H(e,t,n,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,t.x1),e._edit.x2=Math.max(e._edit.x2,t.x2),e._edit.y1=Math.min(e._edit.y1,t.y1),e._edit.y2=Math.max(e._edit.y2,t.y2)):(e._edit=Be.clone(t),e._edit.fs=n),ge&&r&&e._cl&&e._cl.push(t)}function X(e,t){var n=e.getLayer(),r=we.selMap[n];r&&e.setLayer(r),t(),r&&e.setLayer(n)}function Y(e,t,n){return n&&xe&&me.hasOwnProperty(e)?me[e]:t[e]}function z(e,t){return t?_e[e.sh]?e.sh:"box":e.sh in _e?e.sh:e.sq?"box":"circle"}function P(e,t,n,r,i,a,o,u,s){var l=r+a,f=i+a;if("circle"===e){var c=Math.min(l,f);o(c)}else{var d=t-l,g=n-f,h=t+l,v=n+f;if("box"===e)u(d,g,h,v);else{var m=a*Pe,x=r*Xe/He+a*ze;"e"===e?(h-=m,s(h,g,t+x,n,h,v,d,v,d,g)):(d+=m,s(d,v,t-x,n,d,g,h,g,h,v))}}}function _(e,t,n,r,i,a,o,u,s,l,f,c,d){P(d,t,n,r,i,a,function(r){e.circle(t,n,r,o,u,l,f,c,s)},function(t,n,r,i){e.rect(t,n,r,i,o,u,l,f,c,s)},function(t,n,r,i,a,d,g,h,v,m){e.pentagon(t,n,r,i,a,d,g,h,v,m,o,u,l,f,c,s)})}function j(e,t,n,r,i,a,o){P(o,t,n,r,i,a,function(t){e._c=t},function(r,i,a,o){e._cl.push({x1:r-t,y1:i-n,x2:a-t,y2:o-n})},function(r,i,a,o,u,s,l,f,c,d){e._cl.push([r-t,i-n,a-t,o-n,u-t,s-n,l-t,f-n,c-t,d-n])})}function J(e,t,n,r,i){function a(e){return Y(e,n,f)}if(!n.hi&&!n.du){var o,u=n.id,s=Te(n),l=z(n,s),f=i(u),c=f&&!xe,d=a("b"),g=a("bs"),h=a("c"),v=(s?1:a("e")||1)*et,m=s?a("re"):!1,x=a("u"),y=a("fi");n._c=0,n._cl=[],n._edit=null,n._sl={e:v};var p,b,I=!!d,w=!!h,B=!!x||!(!y||!y.t),C=I?d:we.colours.white,A=I?v*(a("bw")||Ke):0,M=w?h:we.colours.white,Z=n.x,D=n.y;s?(p=n.w/2,b=n.h/2):p=b=v*He;var G,L=p+A/2,R=b+A/2,S=I?A:v*Ke,T=3*S/4;if(G=de?I||w?A/2:T-S/2:T+S/2,(I||w)&&_(t,Z,D,L,R,0,C,A||-1,g,M,w,u,l),(B||I||w)&&(j(n,Z,D,L,R,G,l),f&&(m&&!B&&(qe=t.cloneLast()),c))){var E=Re();X(t,function(){_(t,Z,D,L,R,T,E,S,null,E,!1,u,l),m&&(Qe=t.getLast())})}if(B){if(x){o=fe[x];var k=0,F=0,V=1;o&&(k=o.dx/100*p,F=o.dy/100*b,V=o.e),t.image(Z-p*V+k,D-b*V+F,Z+p*V+k,D+b*V+F,r+x,u,n.ci?"ci":void 0,1)}else{var W=s?Math.min(p,b):p;ie(t,e,u,Z,D,W,y.t,y.c||we.colours.black,y.ff||le)}f&&m&&(qe=t.cloneLast())}Q(t,e,Z,D,A,p,b,n,s,l,I,w,B,c,v,u,r,a)}}function Q(e,n,r,a,o,u,s,l,f,c,d,g,h,v,m,x,y,p){var b,I=r,w=r,B=a,C=Se(l),A=!1,Z=p("fb"),D=p("fbc"),L=p("fc"),R=p("ff"),S=(p("fs")||Ce)*m,T=3*m+S/2,E=L?L:we.colours.black,k=D?D:we.colours.textback;v&&(E=t(),k=Re());var F=a+s+T,V=W(l),O=U(V,n,S,Z,R),N=S+3,H=N,X=N*V.length;V.length>0&&(w-=O[0]/2);var Y=f||h||d||g,z=Be.defined(l.tc)?!!l.tc:!h&&!f,P=(V.length-1)*H/2;if(Y)z&&(F=a-P);else{if(C){var _=G(l.g[l.g.length-1])*m;w=r+_,r+=O[0]/2+_}F=a,a+=P}var j=r;if(("e"===c||"w"===c)&&(d||g)){var J=8*m;j+="e"===c?J:-J}V.length>0&&(B=F),d&&!z&&(F+=o-3*m);for(var Q=0;Q<V.length;Q++){var q=K(n,e,V[Q],j,F,x,!0,E,k,Z,l,!1,!0,99,O[Q],v,S,R||se);A=A||q,F+=H}var $=!i(l)||!A;if(h||d||g){var ee=3,te=h?11:3;if(!f&&!h&&"circle"===c){var re=2;ee+=re,te+=re}f&&(ee++,te++);var ie=ee*m,ue=te*m;if(l._sl.x=-u+ie,l._sl.y=-s+ue,C)for(b=0;b<l.g.length;b++){var le,fe=l.g[b],ce=null,de=!1;switch(fe.p){case"ne":ce=u-ie,le=-s+ue;break;case"nw":ce=l._sl.x,le=l._sl.y,fe.e&&(l._sl.e*=fe.e),de=!0;break;case"sw":ce=-u+ie,le=s-ue,de=!0;break;case"se":ce=u-ie,le=s-ue}null!==ce&&ne(e,n,x+Me+fe.p,l.x+ce,l.y+le,m,fe,y,l,de,!0)}}else M(e,n,l.g,$?I:w,B,m,$,v,y,x,l);if(f||ae(e,x,r,a,m,p),l.bu){var ge=0;Y?ge=s:X>0?ge=X/2+4:Se(l)&&(ge=13*m),oe(e,n,x,r,a,ge,m,l.bu,y)}}function q(e,t,n){var r=0,a=0;if(i(e)){var o=(e.fs||Ce)*(e.e||1),u=W(e),s=U(u,t,o,e.fb,e.ff);r=O(s),a=o*(u.length+1),e.u||e.c||e.bc||(r=Math.max(r/10,n))}return{width:r,height:a}}function $(e){return"b"in e?e.b:we.colours.keyline}function ee(e,t,n,r){e._cl.push({cx:t,cy:n,r:r})}function te(e,t,n,r,i){e._cl.push({x1:t,x2:r,y1:n,y2:i})}function ne(e,t,n,r,i,a,o,u,s,l,f){if(o){o.e&&(a*=o.e);var c,d=o.a?Je:1,g=We*a*d,h=$(o),v=h?Ue*a:-1,m=g+(h?v/2:0),x=!!(o.u||o.fi&&o.fi.t),y=0,p=0,b=1;if(o.c){if(o.t){var I,w,B,C,A=o.hasOwnProperty("fb")?o.fb:!0,M=o.fc||we.colours.white,Z=o.ff||se;if(o.w&&f){I=a*Ae[1]*d,B=(o.t+"").substring(0,25),w=we.measureText(t,B,I,A,Z).width,C=Math.max(w,g);var D,G,L=g;l?(D=r-(C-L)-g,G=r+g,r-=(C-L)/2):(D=r-g,G=r+(C-L)+g,r+=(C-L)/2);var R=i-g,S=i+g;e.round(D,R,G,S,g,h,v,o.c,!0,n),s&&(ee(s,D+g-s.x,i-s.y,m),ee(s,G-g-s.x,i-s.y,m),te(s,D+g-s.x,R-s.y-v/2,G-g-s.x,S-s.y+v/2))}else e.circle(r,i,g,h,v,o.c,!0,n),B=(o.t+"").substring(0,4),I=a*Ae[B.length-1]*d,w=we.measureText(t,B,I,A,Z).width,C=1.7*g,s&&ee(s,r-s.x,i-s.y,m);K(t,e,B,r,i,n,!1,M,we.colours.white,A,null,!0,!1,C,w,!1,I,Z)}else if(e.circle(r,i,g,h,v,o.c,!0,n),s&&ee(s,r-s.x,i-s.y,m),x){var T=g/1.41421;o.u?(c=fe[o.u],c&&(y=c.dx/100*T,p=c.dy/100*T,b=c.e),e.image(r-T*b+y,i-T*b+p,r+T*b+y,i+T*b+p,u+o.u,n)):ie(e,t,n,r,i,T,o.fi.t,o.fi.c||we.colours.black,o.fi.ff||le)}}else x&&(s&&ee(s,r-s.x,i-s.y,g),o.u?(c=fe[o.u],c&&(y=c.dx/100*g,p=c.dy/100*g,b=c.e),e.image(r-g*b+y,i-g*b+p,r+g*b+y,i+g*b+p,u+o.u,n)):ie(e,t,n,r,i,g,o.fi.t,o.fi.c||we.colours.black,o.fi.ff||le));o.a&&($e=$e||{},$e[Be.rawId(n)]=!0)}}function re(e,t){return w(e,t,0,0)}function ie(e,t,n,r,i,a,o,u,s){e.rect(r-a,i-a,r+a,i+a,we.colours.transparent,-1,we.colours.transparent,!0,n);var l=2*a,f=we.measureText(t,o,l,!1,s||se,!0),c=re(f.width,f.height),d=c-l,g=l-d/2;f=we.measureText(t,o,g,!1,s||se,!0),c=re(f.width,f.height);var h=4*c/5,v=fe[o],m=0,x=0,y=1;v&&(m=v.dx/100*a,x=v.dy/100*a,y=v.e),e.text(r+m,i+g*y/2+x,o,u,g*y,!1,n,s,!0,c,!0,n,r-h*y/2+m,i-f.height*y/2+x,r+h*y/2-1+m,i+f.height*y/2+x)}function ae(e,t,n,r,i,a){var o=e.getLayer();e.setLayer(we.layers.HALOS);for(var u=0;u<je.length;u++){var s=je[u],l=a(s);if(l){var f=t+Me+s,c=l.r*i,d=l.w*i;d/2>=c?e.circle(n,r,c+d/2,we.colours.white,-1,l.c,!0,f,null,!0):e.circle(n,r,c,l.c,d,we.colours.white,!1,f,null,!0)}}e.setLayer(o)}function oe(e,t,n,r,i,a,o,u,s){if(u.t){var l=e.getLayer();e.setLayer(we.layers.BUBBLES);var f=u.p?""+u.p:"ne",c="w"===f.substring(1,2),d="s"===f.substring(0,1),g=n+Me+"bu",h=Number(u.fs?u.fs:Ce)*et,v=u.b?u.b:we.colours.keyline,m=u.c?u.c:we.colours.white,x=u.fc?u.fc:we.colours.black,y=W(u),p=h+3*et,b=p*y.length,I=U(y,t,h,u.fb,u.ff),w=O(I),B=13*et,C=6*et,A=2*o,M=9*et,Z=13*et,D=10*et;a+=Z;var G=b+2*C,L=2*et,R=Math.max(L/2,1),S=3*et;u.g&&delete u.g.e;var T=u.g?17*et:0;c&&(r-=w+2*A+2*B+T),d&&(i+=(h+3)*y.length+2*a+2*C);var E=r+A+.5,k=r+A+2*B+w+T+.5,F=i-a-G+.5,V=i-a+.5;e.round(E,F,k,V,8*et,v,L,m,!0,g),ne(e,t,g,r+T,(F+V)/2,et,u.g,s);var N,K=F-.5+C+p,H=E+B+T-.5;for(N=0;N<y.length;N++){var X=I[N];e.text(H,K,y[N],x,h,u.fb,g,u.ff||se,!1,X,!1,!1,H-1.5,K-h,k,V),K+=p}c&&(E=k,M=-M,D=-D,R=-R),d&&(V=F,Z=-Z,S=-S),e.triangle(E+M,V,E+M+D,V,E+M,V+Z,v,L,m,!0,g),e.triangle(E+M+R,V-S,E+M+D+R,V-S,E+M+R,V+Z-S,v,-1,m,!0,g),e.setLayer(l)}}var ue,se,le,fe,ce,de,ge,he,ve,me,xe,ye,pe,be,Ie={},we=KeyLines.Rendering,Be=KeyLines.Util,Ce=Ie.fontSize=14,Ae=[12,9,7,7],Me=Be.idSep(),Ze=1,De=2,Ge=0,Le={};Ie.setSpecialOptions=function(e,t){Le[e]=t};var Re=Ie.editColour=function(){return ce||we.colours.edit};Ie.setOptions=function(e){ue=e.arrows,Be.isNumber(e.labelOffset)&&(Ge=e.labelOffset),be=e.truncateLabels&&e.truncateLabels.maxLength&&Be.isNumber(e.truncateLabels.maxLength)?e.truncateLabels.maxLength:!1,e.selectionColour&&(ce=we.validatergb(e.selectionColour)?e.selectionColour:void 0),ve=e.fanLength,se=e.fontFamily,le=e.iconFontFamily,fe=e.imageAlignment||{},ge=e.linkEnds.avoidLabels,de="loose"!==e.linkEnds.spacing,e.selectionFontColour&&(he=we.validatergb(e.selectionFontColour)?e.selectionFontColour:void 0),me=e.selectedNode,xe=Be.isNormalObject(e.selectedNode),ye=e.selectedLink,pe=Be.isNormalObject(e.selectedLink)};var Se=Ie.itemHasGlyph=function(e){return e.hasOwnProperty("g")&&Array.isArray(e.g)&&e.g.length>0},Te=Ie.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)},Ee=function(e,t,n,r,i,a){var o=r-e,u=i-t,s=Math.sqrt(o*o+u*u);if(s>n+a||s<Math.abs(n-a)||0===s)return[];var l=(n*n-a*a+s*s)/(2*s),f=Math.sqrt(n*n-l*l),c=e+l*o/s,d=t+l*u/s,g=c+f*u/s,h=c-f*u/s,v=d-f*o/s,m=d+f*o/s;return[Math.atan2(v-t,g-e),Math.atan2(m-t,h-e)]},ke=34,Fe=3,Ve=1,We=9,Ue=2,Oe=Math.PI/7,Ne=Math.cos(Oe);Ie.labelPosition=function(e,t){if(!e||e.hi)return null;var n=e._edit,r=n.x1,i=n.y1,a=n.x2,o=n.y2;return"node"===e.type&&(r+=e.x,i+=e.y,a+=e.x,o+=e.y),{x1:t.x(r),y1:t.y(i),x2:t.x(a),y2:t.y(o),fs:t.dim(n.fs)}};var Ke=4,He=27,Xe=50,Ye=Xe-He,ze=Math.sqrt(He*He+Ye*Ye)/He,Pe=1-Math.sin(Math.atan2(He,Ye)/2),_e={box:!0,circle:!0,e:!1,w:!1};Ie.nodeSize=function(e,t,n){if(e.w&&e.h)return Be.len(e.w,e.h)/2;if(e.du)return 10;var r=He*(e.e||1),i=q(e,t,r);if(n){var a=r+i.height/2,o=i.width/2;return Be.len(o,a)}return r+i.height/2};var je=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];Ie.contains=function(e,t){function n(e,t){e&&a.push(t)}var r,i,a=[];if(e=Be.defaults(e,{sh:"box",x:0,y:0}),Te(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(i in t)r=t[i],Te(r)?"circle"===r.sh?n(we.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):n(we.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):n(we.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var u={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(i in t)if(r=t[i],Te(r))if("circle"===r.sh){var s=Math.min(r.w,r.h)/2;n(we.rectContains(u,r.x-s,r.y-s,r.x+s,r.y+s),r.id)}else n(we.rectContains(u,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else n(we.inside(u,r.x,r.y),r.id)}return a};var Je,Qe,qe,$e,et=1;return Ie.getResizePrimitive=function(){return qe},Ie.animated=function(){return!!$e},Ie.generate=function(t,n,r,i,a,o,u,s,l,f){function c(e){a.resetItem(e,e.x,e.y),a.setLayer(Te(e)?we.layers.SHAPES:we.layers.NODES),J(o,a,e,l,f)}function d(e){a.resetItem(e),a.setLayer(we.layers.LINKS),Z(o,a,e,t[e.id1],t[e.id2],l,f)}if(qe&&(r||i[qe.id]===De)&&(Qe=null,qe=null),$e=null,Je=e.atanEasing(Date.now()%1e3/1e3),et=u.getUnzoom(),r){a.removeAllItems();for(var g in t)c(t[g]);for(var h in n)d(n[h])}else{var v;for(v in i){var m=t[v];m?i[v]===Ze?a.moveItem(m,m.x,m.y):c(m):n[v]||a.removeItem(v)}for(v in i)n[v]&&d(n[v])}return a.assembleItems(),$e},Ie.generateHandles=function(e,t,n,r){e.extras(),e.setLayer(we.layers.HANDLES),Qe&&1===r.length&&(we.getHandles(e,t,n,Qe,1,Qe.id,Re(),Me),we.getHandles(e,t,n,Qe,4,Qe.id,we.colours.transparent,Me))},Ie}}(),function(){"use strict";var e=KeyLines.WebGL;e&&(e.Generator=function(t){function n(e){p.isNullOrUndefined(e.fontFamily)&&(e.fontFamily="sans-serif"),A===e.fontFamily&&null!==A||(A=e.fontFamily,D.textAtlas=!0),Z[A]=!0,C[A]=!0}function r(e){e.iconFontFamily&&M!==e.iconFontFamily&&(M=e.iconFontFamily,D.fontIcons=!0)}function i(e,t,n){e.fbAlpha=n,e.rebuildOptions={all:t.all,colours:t.colours,textures:t.textures,shadow:t.shadow,positions:t.positions}}function a(e,t){return e.all||e.textures||e.positions||e.shadow||e.colours||t}function o(e){e.arcBuffers.numOfTriangles=0,e.lineBuffers.numOfTriangles=0,e.triangleBuffers.numOfTriangles=0}function u(e,t,n){for(var r,i=t.rebuildOptions,a=t.alwaysUpdate,o=0;L>o;o++)r=e[o],K[r.p](t,r,n,a,i)}function s(n){D.textAtlas&&(t.textAtlas&&n.clearTextureAtlas(t.textAtlas.atlases),t.textAtlas=e.TextAtlas(Z,!1,t),C=Z)}function l(n){!D.fontIcons&&t.fontIconAtlas||(n.clearTextureAtlas(t.fontIconAtlas),t.fontIconAtlas=e.FontIconAtlas(B,M))}function f(e,t,n){function r(e){"_overviewIcon"!==e.id&&"_overviewIconRect"!==e.id&&(n[L++]=e,v(e,i,a,o))}if(t.widgets){L=0;var i=e.lineBuffers,a=e.arcBuffers,o=e.triangleBuffers;t.widgets.each(r,t.channels,t.layers)}}function c(e){d(e.lineBuffers,e),g(e),h(e)}function d(e,t){var n=8;e.elementIndexIndex=0,e.elementMappingIndex=0,e.elementDataIndex=0,e.elementIntegerDataIndex=0,(!e.elementData||e.elementData.length<e.numOfTriangles*n*4)&&(e.elementData=new Float32Array(e.numOfTriangles*n*4),e.elementIntegerData=new Uint8Array(e.elementData.buffer,0,e.elementData.length*Float32Array.BYTES_PER_ELEMENT)),(!e.elementIndex||e.elementIndex.length<3*e.numOfTriangles)&&(e.elementIndex=new Uint32Array(3*e.numOfTriangles),t.rebuildOptions.all=!0)}function g(e){function t(e){(!e.arcBuffers.positionData||e.arcBuffers.positionData.length<e.arcBuffers.totalNumOfVerticies*a)&&(e.rebuildOptions.positions=!0,e.arcBuffers.positionData=new Float32Array(e.arcBuffers.totalNumOfVerticies*a))}function n(e){(!e.arcBuffers.colourData||e.arcBuffers.colourData.length<e.arcBuffers.totalNumOfVerticies*u)&&(e.rebuildOptions.colours=!0,e.arcBuffers.colourData=new Uint8Array(e.arcBuffers.totalNumOfVerticies*u))}function r(e){(!e.arcBuffers.shadowData||e.arcBuffers.shadowData.length<e.arcBuffers.totalNumOfVerticies*o)&&(e.rebuildOptions.shadow=!0,e.arcBuffers.shadowData=new Uint8Array(e.arcBuffers.totalNumOfVerticies*o))}function i(e){(!e.arcBuffers.coreData||e.arcBuffers.coreData.length<e.arcBuffers.totalNumOfVerticies*s)&&(e.rebuildOptions.all=!0,e.arcBuffers.coreData=new Float32Array(e.arcBuffers.totalNumOfVerticies*s)),e.rebuildOptions.core=!0}var a=6,o=4,u=4,s=3;e.arcBuffers.positionIndex=0,e.arcBuffers.colourIndex=0,e.arcBuffers.shadowIndex=0,e.arcBuffers.coreIndex=0,e.arcBuffers.totalNumOfVerticies=3*e.arcBuffers.numOfTriangles,t(e),n(e),r(e),i(e)}function h(e){function t(e){(!e.triangleBuffers.positionData||e.triangleBuffers.positionData.length<e.triangleBuffers.totalNumOfVerticies*o)&&(e.triangleBuffers.positionData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*o),e.rebuildOptions.positions=!0)}function n(e){(!e.triangleBuffers.colourData||e.triangleBuffers.colourData.length<e.triangleBuffers.totalNumOfVerticies*l)&&(e.triangleBuffers.colourData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*l),e.rebuildOptions.colours=!0)}function r(e){(!e.triangleBuffers.textureData||e.triangleBuffers.textureData.length<e.triangleBuffers.totalNumOfVerticies*s)&&(e.triangleBuffers.textureData=new Float32Array(e.triangleBuffers.totalNumOfVerticies*s),e.rebuildOptions.textures=!0)}function i(e){(!e.triangleBuffers.shadowData||e.triangleBuffers.shadowData.length<e.triangleBuffers.totalNumOfVerticies*u)&&(e.triangleBuffers.shadowData=new Uint8Array(e.triangleBuffers.totalNumOfVerticies*u),e.rebuildOptions.shadow=!0)}var a=3,o=3,u=4,s=7,l=4;e.triangleBuffers.positionIndex=0,e.triangleBuffers.colourIndex=0,e.triangleBuffers.textureIndex=0,e.triangleBuffers.shadowIndex=0,e.triangleBuffers.totalNumOfVerticies=e.triangleBuffers.numOfTriangles*a,t(e),n(e),r(e),i(e)}function v(n,r,i,a){switch(n.p){case"A":i.numOfTriangles+=2*e.getNumOfSegments(n.sa,n.ea);break;case"L":r.numOfTriangles+=2;break;case"L3":r.numOfTriangles+=6;break;case"C":if(n.bw>0){var o=I[n.bs]||0;o>1?i.numOfTriangles+=2*e.getNumOfSegments(0,w):a.numOfTriangles+=2}n.fi&&(a.numOfTriangles+=2);break;case"R":if(n.fi&&(a.numOfTriangles+=2),n.bw>0){var u=I[n.bs]||0;u?r.numOfTriangles+=8:a.numOfTriangles+=2}break;case"RR":var s=n.y2-n.y1>2*n.r,l=n.x2-n.x1>2*n.r;n.fi&&(l&&(a.numOfTriangles+=2),s?a.numOfTriangles+=12:a.numOfTriangles+=4),n.bw>0&&(l&&(a.numOfTriangles+=4),s?a.numOfTriangles+=12:a.numOfTriangles+=4);break;case"T":var f=n.t,c=n.t.length;if(n.isfi){a.numOfTriangles+=2;var d=B[f];d||(D.fontIcons=!0,B[n.t]={t:f,ff:n.ff})}else n.ff&&(Z[n.ff]=!0,C[n.ff]||(D.textAtlas=!0,C[n.ff]=!0)),n.back&&(a.numOfTriangles+=2),"rtl"===t.canvas.dir&&(c=t.bidi.reorderText(f).length),a.numOfTriangles+=2*c;break;case"PE":n.bw>0&&(r.numOfTriangles+=10),n.fi&&(a.numOfTriangles+=3);break;case"TR":n.fi&&a.numOfTriangles++,n.bw>0&&a.numOfTriangles++;break;case"I":a.numOfTriangles+=2}}function m(e,n){var r=t.allLayers[n.id];return r||(r=t.allLayers[n.id]=x(n)),
r}function x(e){return{triangleBuffers:{numOfTriangles:0},lineBuffers:{numOfTriangles:0},arcBuffers:{numOfTriangles:0},id:e.id,useFramebuffer:e.useFramebuffer,drawFramebuffer:e.drawFramebuffer,framebuffer:null,renderbuffer:null,framebufferTexture:null,fbAlpha:e.fbAlpha,useView:e.useView,shadowType:e.shadowType,channels:e.channels,rebuildOptions:{},alwaysUpdate:e.alwaysUpdate}}var y,p=KeyLines.Util,b={},I={dashed:2,dotted:3},w=2*Math.PI,B={},C={},A=null,M=null,Z={},D={textAtlas:!1,fontIcons:!1},G=[],L=0,R=!1;b.generate=function(e,d,g,h,v){t.layersToDraw.length=0,y=KeyLines.Rendering.isRTL(t.canvas),D.textAtlas=!1,D.fontIcons=!1,R=KeyLines.Rendering.useHiResImages();for(var x=0,p=e.length;p>x;x++){var I=e[x];L=0;var w=m(t.allLayers,I);t.layersToDraw[x]=w,i(w,g,I.fbAlpha),a(g,I.alwaysUpdate)&&(n(h),r(h),o(w),f(w,I,G),D.textAtlas||D.fontIcons||(c(w),u(G,w,d)))}s(v),l(v),(D.textAtlas||D.fontIcons)&&(D.fontIcons=!1,D.textAtlas=!1,b.generate(e,d,{all:!0},h,v)),Z={}};var S=function(t,n,r,i,a){if(n.fi&&(e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x5,n.y5,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x5,n.y5,n.x2,n.y2,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a),e.generateTriangle(n,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.fi?n.wfc:n.wbc,-1,t,n.a)),n.bw>0){var o=I[n.bs]||0;n.x1<n.x2?(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4-n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x5-n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a)):(e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4+n.bw/2,n.y4,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x4,n.y4-n.bw/2,n.x5,n.y5+n.bw/2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x5+n.bw/2,n.y5,n.x1,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a))}},T=function(n,r,i,a,o){r.isfi?e.generateFontIcon(r,B[r.t],n,r.a):(r.back&&e.generateRectangle(r,r.x1,r.y1,r.x2,r.y2,r.wbc,n,r.a),e.generateText(n.triangleBuffers,r,t.textAtlas.getGlyphsFrom(r.t,r.ff,A,r.bo,D,y),t.textAtlas.fontSize,n,r.a))},E=function(t,n,r,i,a){var o=I[n.ls]||0;e.generateArc(t.arcBuffers,n.x,n.y,n.r,n.sa,n.ea,n.wbc,n.wsc,n.bw,o,a,i,n.a)},k=function(t,n,r,i,a){var o=I[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a)},F=function(t,n,r,i,a){var o=I[n.ls]||0;e.generateLine(n,n.x1,n.y1,n.x2,n.y2,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,n.y2,n.x3,n.y3,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x3,n.y3,n.x4,n.y4,n.wc,n.wsc,o,n.w,t.lineBuffers,i,a,n.a)},V=function(t,n,r,i,a){n.fi&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wfc,-2,t,n.a),n.bw>0&&e.generateTriangle(n,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.wbc,-2,t,n.a)},W=function(t,n,r,i,a){if(n.fi&&e.generateRectangle(n,n.x1,n.y1,n.x2,n.y2,n.wfc,t,n.a),n.bw>0){var o=I[n.bs]||0,u=n.bw/2,s=Math.floor(n.x1-u),l=Math.floor(n.y1-u),f=Math.floor(n.x2+u),c=Math.floor(n.y2+u);o?(e.generateLine(n,s,n.y1,f,n.y1,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x2,l,n.x2,c,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,f,n.y2,s,n.y2,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a),e.generateLine(n,n.x1,c,n.x1,l,n.wbc,n.wsc,o,n.bw,t.lineBuffers,i,a,n.a)):e.generateRectangle(n,s,l,f,c,n.wbc,t,n.a,n.bw,o)}},U=function(t,n,r,i,a){var o=n.r,u=n.bw,s=n.bw/2,l=n.x1,f=n.y1,c=n.x2,d=n.y2,g=d-f>2*o,h=c-l>2*o,v=f+(d-f)/2;if(n.fi&&(h&&e.generateRectangle(n,l+o,f,c-o,d,n.wfc,t,n.a),g?(e.generateRectangle(n,l,f+o,l+o,d-o,n.wfc,t,n.a),e.generateRectangle(n,c-o,f+o,c,d-o,n.wfc,t,n.a),e.generateCircle(l,f,o,n.wfc,n.wsc,0,1,1,t,n.a),e.generateCircle(c,f,o,n.wfc,n.wsc,0,0,1,t,n.a),e.generateCircle(l,d,o,n.wfc,n.wsc,0,1,0,t,n.a),e.generateCircle(c,d,o,n.wfc,n.wsc,0,0,0,t,n.a)):(e.generateCircle(l,v,o,n.wfc,n.wsc,0,1,.5,t,n.a),e.generateCircle(c,v,o,n.wfc,n.wsc,0,0,.5,t,n.a))),u>0){I[n.bs]||0;h&&(e.generateRectangle(n,l+o-s,f-s,c-o+s,f+s,n.wbc,t,n.a),e.generateRectangle(n,l+o-s,d-s,c-o+s,d+s,n.wbc,t,n.a)),g?(e.generateRectangle(n,c+s,f+o-s,c-s,d-o+s,n.wbc,t,n.a),e.generateRectangle(n,l-s,f+o-s,l+s,d-o+s,n.wbc,t,n.a),e.generateCircle(l-s,f-s,o+s,n.wbc,n.wsc,u,1,1,t,n.a),e.generateCircle(c+s,f-s,o+s,n.wbc,n.wsc,u,0,1,t,n.a),e.generateCircle(c+s,d+s,o+s,n.wbc,n.wsc,u,0,0,t,n.a),e.generateCircle(l-s,d+s,o+s,n.wbc,n.wsc,u,1,0,t,n.a)):(e.generateCircle(l-s,v,o+s,n.wbc,n.wsc,u,1,.5,t,n.a),e.generateCircle(c+s,v,o+s,n.wbc,n.wsc,u,0,.5,t,n.a))}},O=function(t,n,r,i,a){if(n.fi&&e.generateCircle(n.x,n.y,n.r,n.wfc,n.wsc,0,.5,.5,t,n.a),n.bw>0){var o=I[n.bs]||0;o>1?e.generateArc(t.arcBuffers,n.x,n.y,n.r,0,w,n.wbc,n.wsc,n.bw,o,a,i,n.a):e.generateCircle(n.x,n.y,n.r+n.bw/2,n.wbc,n.wsc,n.bw,.5,.5,t,n.a)}},N=function(t,n,r,i,a){"_background"===n.id&&(n.wsc=[0,0,0,0]);var o=r[n.u];if(n.hi&&R){var u=r[KeyLines.Rendering.hiResUrl(n.u)];u&&!u.missing&&(o=u)}e.generateImage(n,"co"===n.s?o.co:o.im,t,n.a)},K={A:E,L:k,L3:F,I:N,TR:V,R:W,RR:U,C:O,T:T,PE:S};return b})}(),function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,t){e=e.replace(/^\s*|\s*$/g,"").split(/[(\s*,\s*)|(\s+)]/);for(var n=0;n<e.length;n++)t(e[n])}function t(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();KeyLines.Util.log(n),o.push(n),o.length>a&&o.shift()}function n(e,t,n,r,i,a){function o(e){return((c*e+f)*e+l)*e}function u(e,t){var n=s(e,t);return((h*n+g)*n+d)*n}function s(e,t){var n,r,i,a,u,s;for(i=e,s=0;8>s;s++){if(a=o(i)-e,Math.abs(a)<t)return i;if(u=(3*c*i+2*f)*i+l,Math.abs(u)<1e-6)break;i-=a/u}if(n=0,r=1,i=e,n>i)return n;if(i>r)return r;for(;r>n;){if(a=o(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=(r-n)/2+n}return i}var l=3*t,f=3*(r-t)-l,c=1-l-f,d=3*n,g=3*(i-n)-d,h=1-d-g;return u(e,1/(200*a))}var r,i={};i.bind=function(t,n,i){r=r||{},e(t,function(e){r[e]=r[e]||[],r[e].push([n,i])})},i.unbind=function(t,n){r&&(t?e(t,function(e){if(n){if(r[e]){for(var t=[],i=0;i<r[e].length;i++)n!==r[e][i][0]&&t.push(r[e][i]);r[e]=t}}else r[e]=[]}):r={})},i.trigger=function(e){var n=!1;if(r)for(var i,a=2;a--;){var o=a?e:"all",u=[],s=a?1:0;for(i=s;i<arguments.length;i++)u.push(arguments[i]);if(r[o]){var l=r[o].slice(0);for(i=0;i<l.length;i++){var f=l[i];try{n=f[0].apply(f[1]||this,u)||n}catch(c){t(e,c)}}}}return n},i.getErrors=function(){return o};var a=10,o=[];i.linearEasing=function(e){return 0>e?0:e>1?1:e},i.cubicEasing=function(e){return 0>e?0:e>1?1:n(e,.25,.01,.25,1,1)};var u=1;return i.atanEasing=function(e){return Math.atan(u*(e-.5))/(2*Math.atan(.5*u))+.5},i}}(),function(){"use strict";var e=KeyLines.WebGL;if(e){var t=function(e,t,n,r,i,a){e[t.positionIndex++]=n,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=i,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=n,e[t.positionIndex++]=a,e[t.positionIndex++]=0,e[t.positionIndex++]=n,e[t.positionIndex++]=a,e[t.positionIndex++]=0,e[t.positionIndex++]=i,e[t.positionIndex++]=r,e[t.positionIndex++]=0,e[t.positionIndex++]=i,e[t.positionIndex++]=a,e[t.positionIndex++]=0},n=function(e,t,n,r,i,a,o,u){e[t.textureIndex++]=n,e[t.textureIndex++]=r,e[t.textureIndex++]=0,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=i,e[t.textureIndex++]=r,e[t.textureIndex++]=1,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=n,e[t.textureIndex++]=a,e[t.textureIndex++]=0,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=n,e[t.textureIndex++]=a,e[t.textureIndex++]=0,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=i,e[t.textureIndex++]=r,e[t.textureIndex++]=1,e[t.textureIndex++]=0,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0,e[t.textureIndex++]=i,e[t.textureIndex++]=a,e[t.textureIndex++]=1,e[t.textureIndex++]=1,e[t.textureIndex++]=u,e[t.textureIndex++]=o,e[t.textureIndex++]=0};e.generateText=function(e,r,i,a,o,u){if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate)var s=14/a*(r.fs/14),l=0;var f=r.wc[0],c=r.wc[1],d=r.wc[2],g=r.wc[3],h=e.colourData,v=e.positionData,m=e.textureData,x=e.shadowData,y=r.wmargin,p=r.x1,b=r.y1;u&&(p+=u.x,b+=u.y);for(var I=0,w=i.length;w>I;I++){var B=i[I],C=a*s;if(o.rebuildOptions.all||o.rebuildOptions.shadow||o.alwaysUpdate)for(var A=0;6>A;A++)x[e.shadowIndex++]=0,x[e.shadowIndex++]=0,x[e.shadowIndex++]=0,x[e.shadowIndex++]=0;if(o.rebuildOptions.all||o.rebuildOptions.colours||o.alwaysUpdate)for(var A=0;6>A;A++)h[e.colourIndex++]=f,h[e.colourIndex++]=c,h[e.colourIndex++]=d,h[e.colourIndex++]=g;if(o.rebuildOptions.all||o.rebuildOptions.positions||o.alwaysUpdate){var M=B.width*s;t(v,e,p+l+y,b+C,p+(l+M)+y,b)}(o.rebuildOptions.all||o.rebuildOptions.textures||o.alwaysUpdate)&&n(m,e,B.u1,B.v1,B.u2,B.v2,B.colourComponent,B.textureBank),l+=M}}}}(),function(){"use strict";if(KeyLines.WebGL){var e=6;KeyLines.WebGL.generateImage=function(t,n,r,i){var a=t.wsc||[0,0,0,0],o=0;if("ci"===t.s&&(o="width"===n.maxDimension?(t.y2-t.y1)/2:(t.x2-t.x1)/2),r.alwaysUpdate||r.rebuildOptions.all||r.rebuildOptions.shadow)for(var u=0;e>u;u++)r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[0],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[1],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[2],r.triangleBuffers.shadowData[r.triangleBuffers.shadowIndex++]=a[3];if(r.rebuildOptions.colours||r.alwaysUpdate||r.rebuildOptions.all)for(u=0;e>u;u++)r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255,r.triangleBuffers.colourData[r.triangleBuffers.colourIndex++]=255;if(r.rebuildOptions.positions||r.alwaysUpdate||r.rebuildOptions.all){var s=t.x1,l=t.y1,f=t.x2,c=t.y2;i&&(s=t.x1+i.x,l=t.y1+i.y,f=t.x2+i.x,c=t.y2+i.y),r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=s,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=l,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=f,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=c,r.triangleBuffers.positionData[r.triangleBuffers.positionIndex++]=0}if(r.rebuildOptions.textures||r.alwaysUpdate||r.rebuildOptions.all){var d,g,h,v;o?(g=n.cu1,d=n.cv1,v=n.cu2,h=n.cv2):(g=n.u1,d=n.v1,v=n.u2,h=n.v2),r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=g,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=d,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=v,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=h,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=1,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=n.textureBank,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=0,r.triangleBuffers.textureData[r.triangleBuffers.textureIndex++]=o}}}}();;

